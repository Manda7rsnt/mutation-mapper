!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("underscore"),require("jquery"),require("qtip2"),require("qtip2/dist/jquery.qtip.css"),require("backbone"),require("d3"),require("jquery-ui/tabs"),require("jquery-tipTip/jquery.tipTip.js"),require("jquery-tipTip/tipTip.css"),require("jquery-ui-css/all.css"),require("jquery-expander"),require("filesaver.js-npm"),require("jquery-ui/draggable"),require("jquery-ui/resizable"),require("datatables.net"),require("drmonty-datatables-colvis"),require("drmonty-datatables-colvis/css/dataTables.colVis.css"),require("datatables-tabletools"),require("datatables.net-dt/css/jquery.dataTables.css"),require("jquery-flesler-scrollto"),require("jquery-ui/slider")):"function"==typeof define&&define.amd?define(["underscore","jquery","qtip2","qtip2/dist/jquery.qtip.css","backbone","d3","jquery-ui/tabs","jquery-tipTip/jquery.tipTip.js","jquery-tipTip/tipTip.css","jquery-ui-css/all.css","jquery-expander","filesaver.js-npm","jquery-ui/draggable","jquery-ui/resizable","datatables.net","drmonty-datatables-colvis","drmonty-datatables-colvis/css/dataTables.colVis.css","datatables-tabletools","datatables.net-dt/css/jquery.dataTables.css","jquery-flesler-scrollto","jquery-ui/slider"],e):"object"==typeof exports?exports.mutationMapper=e(require("underscore"),require("jquery"),require("qtip2"),require("qtip2/dist/jquery.qtip.css"),require("backbone"),require("d3"),require("jquery-ui/tabs"),require("jquery-tipTip/jquery.tipTip.js"),require("jquery-tipTip/tipTip.css"),require("jquery-ui-css/all.css"),require("jquery-expander"),require("filesaver.js-npm"),require("jquery-ui/draggable"),require("jquery-ui/resizable"),require("datatables.net"),require("drmonty-datatables-colvis"),require("drmonty-datatables-colvis/css/dataTables.colVis.css"),require("datatables-tabletools"),require("datatables.net-dt/css/jquery.dataTables.css"),require("jquery-flesler-scrollto"),require("jquery-ui/slider")):t.mutationMapper=e(t._,t.jQuery,t.qtip2,t["qtip2/dist/jquery.qtip.css"],t.Backbone,t.d3,t["jquery-ui/tabs"],t["jquery-tipTip/jquery.tipTip.js"],t["jquery-tipTip/tipTip.css"],t["jquery-ui-css/all.css"],t["jquery-expander"],t.window,t["jquery-ui/draggable"],t["jquery-ui/resizable"],t["datatables.net"],t["drmonty-datatables-colvis"],t["drmonty-datatables-colvis/css/dataTables.colVis.css"],t["datatables-tabletools"],t["datatables.net-dt/css/jquery.dataTables.css"],t["jquery-flesler-scrollto"],t["jquery-ui/slider"])}(this,function(__WEBPACK_EXTERNAL_MODULE_5__,__WEBPACK_EXTERNAL_MODULE_7__,__WEBPACK_EXTERNAL_MODULE_8__,__WEBPACK_EXTERNAL_MODULE_9__,__WEBPACK_EXTERNAL_MODULE_12__,__WEBPACK_EXTERNAL_MODULE_19__,__WEBPACK_EXTERNAL_MODULE_86__,__WEBPACK_EXTERNAL_MODULE_88__,__WEBPACK_EXTERNAL_MODULE_89__,__WEBPACK_EXTERNAL_MODULE_90__,__WEBPACK_EXTERNAL_MODULE_140__,__WEBPACK_EXTERNAL_MODULE_142__,__WEBPACK_EXTERNAL_MODULE_144__,__WEBPACK_EXTERNAL_MODULE_145__,__WEBPACK_EXTERNAL_MODULE_157__,__WEBPACK_EXTERNAL_MODULE_158__,__WEBPACK_EXTERNAL_MODULE_159__,__WEBPACK_EXTERNAL_MODULE_160__,__WEBPACK_EXTERNAL_MODULE_162__,__WEBPACK_EXTERNAL_MODULE_163__,__WEBPACK_EXTERNAL_MODULE_172__){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){t.exports={MutationMapper:n(1),model:{MutationCollection:n(112)},data:{MutationDataProxy:n(111)},util:{MutationInputParser:n(182),MutationDetailsTableFormatter:n(154),MutationDetailsUtil:n(114),MutationViewsUtil:n(129),BackboneTemplateCache:n(23),VepParser:n(4)}}},function(t,e,n){function i(t){function e(){x.proxy.mutationProxy.options.geneList=x.data.geneList.join(" ");var t=a.initDataProxies(x.proxy);x.dataManager=v.extend(!0,{},x.dataManager,{dataProxies:t});var e=new r(x.dataManager),n={mutationProxy:t.mutationProxy},i={el:x.el,config:x.render.mutationDetails,model:n},s=new o(i);_=s;var l=new m(s,e,t,x);y=l,s.render()}function n(t,e,n){var r=!1;return g(t).is(":visible")&&(i.init(),r=!0),g(e).bind("tabsactivate",function(t,e){e.newTab.text().trim().toLowerCase()==n.toLowerCase()&&(r?i.getView().refreshGenesTab():(i.init(),r=!0))}),i}var i=this,_=null,y=null,b={el:"#mutation_details",data:{geneList:[],sampleList:[]},view:{mutationDiagram:{},mutationTable:{},mutationSummary:{},pdbPanel:{},pdbTable:{},infoPanel:{},vis3d:{}},render:{mutationDetails:{init:null,format:null,activate3dOnInit:!1},mainMutation:{},pdbPanel:{},mutation3dVis:{}},proxy:{pfamProxy:{instance:null,instanceClass:s,options:{data:{}}},variantAnnotationProxy:{instance:null,instanceClass:l,options:{data:{}}},mutationProxy:{instance:null,instanceClass:u,options:{data:{},params:{},geneList:""}},clinicalProxy:{instance:null,instanceClass:c,options:{data:{}}},pdbProxy:{instance:null,instanceClass:d,options:{data:{pdbData:{},infoData:{},summaryData:{},positionData:{}},mutationUtil:{}}},pancanProxy:{instance:null,instanceClass:p,options:{data:{byKeyword:{},byProteinChange:{},byProteinPosition:{},byGeneSymbol:{}}}},mutationAlignerProxy:{instance:null,instanceClass:h,options:{data:{}}},portalProxy:{instance:null,instanceClass:f,options:{data:{}}}},dataManager:{dataFn:{},dataProxies:{}}},x=v.extend(!0,{},b,t);this.init=e,this.delayedInit=n,this.getView=function(){return _},this.getController=function(){return y}}var r=n(2),o=n(21),a=n(107),s=n(108),l=n(110),u=n(111),c=n(115),d=n(116),p=n(117),h=n(118),f=n(119),m=n(120),g=n(7),v=g;n(5);t.exports=i},function(t,e,n){function i(t){function e(t,e,n){null==p[t]&&(p[t]=new s,p[t].init(function(e){var n=d.dataFn[e.type];c.isFunction(n)?n(d.dataProxies,e.params,function(t,n){e.callback(t,n),p[e.type].complete()}):(e.callback(e.params,null),p[t].complete())})),p[t].add({type:t,params:e,callback:n})}function n(t,e){i[t]=e}var i={},l={dataFn:{variantAnnotation:function(t,e,n){var i=e.mutations||e.mutationTable.getMutations(),o=t.variantAnnotationProxy,a=[];c.each(i,function(t,e){var n=t.get("variantKey")||r.generateVariantKey(t);c.isUndefined(n)||a.push(n)}),a.length>0&&o?(a=a.join(","),o.getAnnotationData(a,function(t){r.addAnnotationData(i,t),c.isFunction(n)&&n(e)})):c.isFunction(n)&&n(e)},pdbMatch:function(t,e,n){var r=e.mutations||e.mutationTable.getMutations(),a=e.gene||e.mutationTable.getGene(),s=t.pdbProxy,l=i[a],u=l.model.uniprotId;r&&s&&u?s.getPdbRowData(u,function(t){o.addPdbMatchData(r,t),c.isFunction(n)&&n(e)}):c.isFunction(n)&&n(e)},cBioPortal:function(t,e,n){var i=t.pancanProxy,r=e.mutationUtil||e.mutationTable.getMutationUtil(),o=e.mutations||e.mutationTable.getMutations();i.getPancanData({cmd:"byProteinPos"},r,function(t){i.getPancanData({cmd:"byHugos"},r,function(i){var r=a.getMutationFrequencies({protein_pos_start:t,hugo:i});c.each(o,function(t,e){var n=t.get("proteinPosStart");if(n>0){var i=a.countByKey(r,n)||0;t.set({cBioPortal:i})}else t.set({cBioPortal:0})}),c.isFunction(n)&&n(e,r)})})}},dataProxies:{}},d=u.extend(!0,{},l,t),p={};this.getData=e,this.addView=n}var r=n(3),o=n(10),a=n(18),s=n(20),l=n(7),u=l,c=n(5);t.exports=i},function(t,e,n){var i=n(4),r={util:n(6)},o=n(5),a=function(){function t(t,i,r){var a=o.indexBy(i,"variant");o.isFunction(r)||(r=n),o.each(t,function(t,n){var i=a[t.get("variantKey")],o=null;i&&i.id?o=r(i):i&&i.annotationJSON&&(o=r(i.annotationJSON)),o&&e(t,o)})}function e(t,e){var n={};o.each(o.keys(e),function(i){o.isUndefined(t.get(i))&&(n[i]=e[i])}),o.isEmpty(n)||t.set(n)}function n(t){var e=i.parseJSON(t),n=e.canonicalTranscript,r={startPos:"",endPos:"",chr:"",referenceAllele:"",variantAllele:"",proteinChange:""};return delete e.rawData,delete e.transcripts,delete e.refseqIds,delete e.canonicalTranscript,o.extend(r,e,n)}function a(t){function e(){var t=parseInt(a),e=parseInt(s);if(!o.isNaN(t)||!o.isNaN(e)){var n=r.util.lcss(l,u);n.length>0&&(l=l.substring(n.length),u=u.substring(n.length),t+=n.length,e+=n.length,a=t.toString(),s=e.toString())}}var n=void 0,i=t.chr,a=t.startPos,s=t.endPos,l=t.referenceAllele,u=t.variantAllele;return o.isFunction(t.get)&&(i=t.get("chr"),a=t.get("startPos"),s=t.get("endPos"),l=t.get("referenceAllele"),u=t.get("variantAllele")),null!=l&&l===u&&console.log("[VariantAnnotationUtil.generateVariantKey] Warning: Reference allele ("+l+") for "+i+":"+a+"-"+s+" is the same as variant allele"),i&&a&&l&&u&&(e(),n=i+":g."+a+l+">"+u,s&&("-"===l||0===l.length?n=i+":g."+s+"_"+a+"ins"+u:"-"!==u&&0!==u.length||(n=i+":g."+a+"_"+s+"del"+l))),n}return{generateVariantKey:a,addAnnotationData:t}}();t.exports=a},function(t,e,n){var i=n(5),r=function(){function t(t){var r={};if(!t)return console.log("[warning] VEP parser error"),{};if(t.error)return console.log("[warning] VEP parser error: "+t.error),{};var a=t.allele_string,l=a.split("/",-1);2===l.length&&(r.referenceAllele=l[0],r.variantType=o(l[0],l[1])),r.ncbiBuildNo=t.assembly_name,r.chr=t.seq_region_name,r.startPos=t.start,r.endPos=t.end,r.strand=s(t.strand);var u=t.transcript_consequences,c=t.most_severe_consequence;r.transcripts=[],i.each(u,function(t,n){r.transcripts.push(e(t,c,r.variantType))});var d=n(u,c);return d&&r.transcripts[d.index]&&(r.canonicalTranscript=r.transcripts[d.index]),r.rawData=t,r}function e(t,e,n,r){r=r||{},r.geneSymbol=t.gene_symbol;var o=t.consequence_terms;if(null!=o&&o.length>0){var s=a(o[0]);"Frame_Shift"===s&&(null!=n&&"INS"===n?s+="_Ins":"DEL"===n&&(s+="_Del")),r.variantClassification=s}var u=t.refseq_transcript_ids;null!=u&&u.length>0&&(r.refseqIds=u);var c=t.hgvsc;null!=c&&(r.hgvsc=c.substr(c.indexOf(":")+1));var d=t.hgvsp;null!=d&&(r.hgvsp=d.substr(d.indexOf(":")+1)),r.transcriptId=t.transcript_id,r.proteinPosStart=t.protein_start,r.proteinPosEnd=t.protein_end,r.codons=t.codons;var p;if(null!=d&&(p=d.substr(d.indexOf(":")+1),i.each(i.pairs(l),function(t,e){p=p.replace(new RegExp(t[0],"g"),t[1])}),r.hgvspShort=p),("splice_acceptor_variant"===e||"splice_donor_variant"===e)&&r.hgvsc){var h=/c\.([0-9]+)*/.exec(r.hgvsc);if(h&&2==h.length){var f=parseInt(h[1]);f<1&&(f=1);var m=f+f%3/3;r.hgvspShort="p.X"+m+"_splice"}}return"synonymous_variant"===e&&(p="p."+t.amino_acids+t.protein_start+t.amino_acids,r.hgvspShort=p),r.mutationType=r.variantClassification,r.proteinChange=r.hgvspShort,r.refseqIds&&r.refseqIds.length>0&&(r.refseqMrnaId=r.refseqIds[0]),r}function n(t,e){var n=[];return i.each(t,function(t,e){1==t.canonical&&n.push({index:e,transcript:t})}),1===n.length?n[0]:n.length>1?r(n,e):(i.each(t,function(t,e){n.push({index:e,transcript:t})}),r(n,e))}function r(t,e){var n=null;return i.each(t,function(t,r){var o=t.transcript.consequence_terms;null==n&&null!=o&&null!=e&&i.each(o,function(i,r){i.trim().toLowerCase()===e.trim().toLowerCase()&&(n=t)})}),n}function o(t,e){var n=t.length,i=e.length;if(n="-"===t?0:n,i="-"===e?0:i,n===i){var r=["SNP","DNP","TNP"];return n<3?r[n-1]:"ONP"}return n<i?"INS":"DEL"}function a(t){return u[t.toLowerCase()]}function s(t){var e;return e=null==t||"+"===t||"-"===t?t:t<0?"-":t>0?"+":t}var l={Ala:"A",Arg:"R",Asn:"N",Asp:"D",Asx:"B",Cys:"C",Glu:"E",Gln:"Q",Glx:"Z",Gly:"G",His:"H",Ile:"I",Leu:"L",Lys:"K",Met:"M",Phe:"F",Pro:"P",Ser:"S",Thr:"T",Trp:"W",Tyr:"Y",Val:"V",Xxx:"X",Ter:"*"},u={splice_acceptor_variant:"Splice_Site",splice_donor_variant:"Splice_Site",transcript_ablation:"Splice_Site",stop_gained:"Nonsense_Mutation",frameshift_variant:"Frame_Shift",stop_lost:"Nonstop_Mutation",initiator_codon_variant:"Translation_Start_Site",start_lost:"Translation_Start_Site",inframe_insertion:"In_Frame_Ins",inframe_deletion:"In_Frame_Del",missense_variant:"Missense_Mutation",protein_altering_variant:"Missense_Mutation",coding_sequence_variant:"Missense_Mutation",conservative_missense_variant:"Missense_Mutation",rare_amino_acid_variant:"Missense_Mutation",transcript_amplification:"Intron",splice_region_variant:"Intron",intron_variant:"Intron",INTRAGENIC:"Intron",intragenic_variant:"Intron",incomplete_terminal_codon_variant:"Silent",synonymous_variant:"Silent",stop_retained_variant:"Silent",NMD_transcript_variant:"Silent",mature_miRNA_variant:"RNA",non_coding_exon_variant:"RNA",non_coding_transcript_exon_variant:"RNA",non_coding_transcript_variant:"RNA",nc_transcript_variant:"RNA","5_prime_UTR_variant":"5'UTR","5_prime_UTR_premature_start_codon_gain_variant":"5'UTR","3_prime_UTR_variant":"3'UTR",TF_binding_site_variant:"IGR",regulatory_region_variant:"IGR",regulatory_region:"IGR",intergenic_variant:"IGR",intergenic_region:"IGR",upstream_gene_variant:"5'Flank",downstream_gene_variant:"3'Flank",TFBS_ablation:"Targeted_Region",TFBS_amplification:"Targeted_Region",regulatory_region_ablation:"Targeted_Region",regulatory_region_amplification:"Targeted_Region",feature_elongation:"Targeted_Region",feature_truncation:"Targeted_Region"};return{parseJSON:t}}();t.exports=r},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_5__},function(t,e,n){var i=n(7),r=i;if(n(8),n(9),void 0===o)var o={};o.util=function(){function t(t,e){e=e||512;for(var n=atob(t),i=[],r=0;r<n.length;r+=e){for(var o=n.slice(r,r+e),a=new Array(o.length),s=0;s<o.length;s++)a[s]=o.charCodeAt(s);var l=new Uint8Array(a);i.push(l)}return i}function e(t,e){i(t).mouseenter(function(t){e.fadeIn({complete:function(){i(this).css({visibility:"visible"}),i(this).css({display:"inline"})}})}),i(t).mouseleave(function(t){e.fadeOut({complete:function(){i(this).css({visibility:"hidden"}),i(this).css({display:"inline"})}})})}function n(t){var e=document.getElementById(t),n=e;return e.contentWindow&&(n=e.contentWindow),n}function o(t){var e=document.getElementById(t),n=e.contentDocument;return!n&&e.contentWindow&&(n=e.contentWindow.document),n}function a(t,e){return"case.do?cancer_study_id="+t+"&case_id="+e}function s(t,e){return"case.do?cancer_study_id="+t+"&sample_id="+e}function l(t,e){if(t){var n={show:{ready:!0},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"top left",at:"bottom right",viewport:i(window)}};t[0]&&t[0].ownerSVGElement?t=t[0]:t[0]&&t[0][0]&&t[0][0].ownerSVGElement&&(t=t[0][0]),r.extend(!0,n,e),i(t).one("mouseenter",function(){i(this).qtip(n)})}else console.error("qTip target is not defined.")}var u=function(t,e){for(var n=0;n<t.length&&n<e.length&&t[n]===e[n];)n++;return t.substring(0,n)},c=function(){var t={},e=navigator.userAgent.toLowerCase();if(t.firefox=/mozilla/.test(e)&&/firefox/.test(e),t.mozilla=t.firefox,t.chrome=/webkit/.test(e)&&/chrome/.test(e),t.safari=/applewebkit/.test(e)&&/safari/.test(e)&&!/chrome/.test(e),t.opera=/opera/.test(e),t.msie=/msie/.test(e),t.version="",t.msie||t.firefox||t.chrome||t.safari||t.opera||/trident/.test(e)&&(t.msie=!0,t.version=11),""===t.version)for(var n in t)if(t[n]){t.version=e.match(new RegExp("("+n+")( |/)([0-9]+)"))[3];break}return t},d=function(){var t=window.location.origin;return t||(t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),t},p=function(t){return t.replace(/[^a-zA-Z0-9-]/g,"_")};return{lcss:u,b64ToByteArrays:t,browser:c(),getWindowOrigin:d,safeProperty:p,autoHideOnMouseLeave:e,getTargetWindow:n,getTargetDocument:o,getLinkToPatientView:a,getLinkToSampleView:s,addTargetedQTip:l}}(),t.exports=o.util},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_7__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_8__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_9__},function(t,e,n){var i=n(11),r=n(13),o=n(15),a=n(17),s=n(5),l=function(){function t(t){t.sort(function(t,e){var n=t.uniprotFrom-e.uniprotFrom;return 0===n&&(n=t.pdbId>e.pdbId?-1:1),n});var n=null,l=[],u={};return s.each(t,function(t,r){n=new i(t),n.alignmentString=t.alignmentString||e(t),void 0==u[n.pdbId]&&(u[n.pdbId]={}),void 0==u[n.pdbId][n.chain]&&(u[n.pdbId][n.chain]=[]),u[n.pdbId][n.chain].push(n)}),s.each(s.keys(u),function(t){var e=[];s.each(s.keys(u[t]),function(n){var i={chainId:n,alignments:u[t][n]},o=new r(i);o.mergedAlignment=c(i.alignments),e.push(o)});var n=new o({pdbId:t,chains:e});l.push(n)}),new a(l)}function e(t){var e=[],n=t.midlineAlign,i=t.uniprotAlign,r=t.pdbAlign;if(n.length===i.length&&n.length===r.length)for(var o=0;o<n.length;o++)"-"!==i[o]&&("-"===r[o]?e.push("-"):e.push(n[o]));else e.push("NA");return e.join("")}function n(t,e){var n={};return n.title=t.title,s.find(t.compound,function(t){if(t.molecule&&s.indexOf(t.chain,e.toLowerCase())!=-1)return n.molecule=t.molecule,t}),n}function u(t,e){var n="NA";return s.find(t.compound,function(i){if(s.indexOf(i.chain,e.toLowerCase())!=-1&&null!=t.source[i.mol_id])return n=t.source[i.mol_id].organism_scientific||n,i}),n}function c(t){return d(t)}function d(t){var e,n={mergedString:"",uniprotFrom:-1,uniprotTo:-1,pdbFrom:-1},i="",r=-1;return t.length>0?(i+=t[0].alignmentString,r=t[0].uniprotTo,e=t[0],s.each(t,function(t,n){var o=t.uniprotFrom-r-1,a=t.alignmentString;if(0==o)i+=a;else if(o>0){for(var s=[],l=0;l<o;l++)s.push(M);s.push(a),i+=s.join("")}else{var u=[],c=Math.min(-1*o,a.length);u.push(i.substr(i.length+o,c)),u.push(a.substr(0,c)),u[0]!=u[1]&&(console.log("[warning] alignment mismatch: "+e.alignmentId+" & "+t.alignmentId),console.log(u[0]),console.log(u[1])),i+=a.substr(-1*o)}r=Math.max(r,t.uniprotTo),r==t.uniprotTo&&(e=t)}),n.uniprotFrom=t[0].uniprotFrom,n.uniprotTo=n.uniprotFrom+i.length,n.pdbFrom=t[0].pdbFrom,n.mergedString=i,n.identityPerc=m(i),n.identity=g(i),n):n}function p(t,e){var n=null,i=t.getProteinStartPos(),r=t.get("mutationType")||"";if(r=r.trim().toLowerCase(),null==i||"fusion"===r)return n;for(var o=0;o<e.length&&!n;o++){for(var a=e[o],s=0;s<a.length&&!n;s++){var l=a[s],u=l.chain.mergedAlignment,c=i>=u.uniprotFrom&&i<=u.uniprotTo;if(c&&f(u,i)){n={pdbId:l.pdbId,chainId:l.chain.chainId};break}}if(n)break}return n}function h(t,e){return e?(s.each(t,function(t,n){if(null==t)return void console.log("warning [processMutationData]: mutation (at index %d) is null.",n);var i=l.mutationToPdb(t,e);t.set({pdbMatch:i})}),t):t}function f(t,e){var n=e-t.uniprotFrom,i=t.mergedString[n],r=i==M;return!r}function m(t){for(var e=0,n=0,i=0;i<t.length;i++){var r=t[i];r==M?e++:r!=P&&r!=I&&r!=L||n++}return 1-n/(i-e)}function g(t){t=t.toLowerCase();for(var e=0,n=0;n<t.length;n++){var i=t[n];i.match(/[a-z]/)&&e++}return e}function v(t){var e=y(t),n=[];return s.each(e,function(t,e){var i=t.chain;if(i.alignments.length>0){for(var r=!1,o=0;o<n.length;o++){for(var a=n[o],s=!1,l=0;l<a.length;l++)if(_(i,a[l].chain)){s=!0;break}if(!s){a.push(t),r=!0;break}}if(!r){var u=[];u.push(t),n.push(u)}}}),n.length>0&&n[0].sort(function(t,e){return e.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}),n}function _(t,e){var n=!0;return(t.mergedAlignment.uniprotFrom>=e.mergedAlignment.uniprotTo||e.mergedAlignment.uniprotFrom>=t.mergedAlignment.uniprotTo)&&(n=!1),n}function y(t){var e=[];return t.each(function(t,n){t.chains.each(function(n,i){var r={pdbId:t.pdbId,chain:n};e.push(r)})}),b(e,[w,A,C,T,S]),e}function b(t,e){t.sort(function(t,n){for(var i=0,r=0;r<e.length&&0==i;r++){var o=e[r];i=o(t,n)}return i})}function x(t,e){return t+":"+e}function w(t,e){return e.chain.mergedAlignment.identity-t.chain.mergedAlignment.identity}function C(t,e){return e.chain.mergedAlignment.identityPerc-t.chain.mergedAlignment.identityPerc}function A(t,e){return e.chain.mergedAlignment.mergedString.length-t.chain.mergedAlignment.mergedString.length}function T(t,e){return e.pdbId>t.pdbId?-1:e.pdbId<t.pdbId?1:0}function S(t,e){return e.chain.chainId>t.chain.chainId?-1:e.chain.chainId<t.chain.chainId?1:0}var M="*",I="+",P="-",L=" ";return{ALIGNMENT_GAP:M,ALIGNMENT_PLUS:I,ALIGNMENT_MINUS:P,ALIGNMENT_SPACE:L,alignmentString:e,processPdbData:t,mutationToPdb:p,addPdbMatchData:h,allocateChainRows:v,mergeAlignments:c,generatePdbInfoSummary:n,getOrganism:u,chainKey:x}}();t.exports=l},function(t,e,n){var i=n(12),r=i.Model.extend({initialize:function(t){this.alignmentId=t.alignmentId,this.pdbId=t.pdbId,this.chain=t.chain,this.uniprotId=t.uniprotId,this.pdbFrom=t.pdbFrom,this.pdbTo=t.pdbTo,this.uniprotFrom=t.uniprotFrom,this.uniprotTo=t.uniprotTo,this.alignmentString=t.alignmentString,this.eValue=t.eValue,this.identityPerc=t.identityPerc}});t.exports=r},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_12__},function(t,e,n){var i=n(14),r=n(12),o=r.Model.extend({initialize:function(t){this.chainId=t.chainId,this.positionMap=t.positionMap,this.alignments=new i(t.alignments),this.mergedAlignment=t.mergedAlignment}});t.exports=o},function(t,e,n){var i=n(12),r=n(11),o=i.Collection.extend({model:r,initialize:function(t){}});t.exports=o},function(t,e,n){var i=n(16),r=n(12),o=r.Model.extend({initialize:function(t){this.pdbId=t.pdbId,this.chains=new i(t.chains)}});t.exports=o},function(t,e,n){var i=n(12),r=n(13),o=i.Collection.extend({model:r,initialize:function(t){}});t.exports=o},function(t,e,n){var i=n(12),r=n(15),o=i.Collection.extend({model:r,initialize:function(t){}});t.exports=o},function(t,e,n){var i=n(19),r=n(5),o=function(){function t(t,e){return i.nest().key(function(t){return t[e]}).entries(t).reduce(function(t,e){return t[e.key]=e.values,t},{})}function e(e){var n={};return r.each(r.keys(e),function(i,o){n=r.extend(n,t(e[i],i))}),n}function n(t,e){var n=t[e];return r.reduce(n,function(t,e){return t+e.count},0)}return{getMutationFrequencies:e,countByKey:n}}();t.exports=o},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_19__},function(t,e,n){function i(t){function e(t){h.on(c.newRequestEvent,function(){p||n(t)}),h.on(c.completeEvent,function(){n(t)})}function n(t){var e=a.first(d);d=a.rest(d),e?(p=e,a.isFunction(t)&&t(e)):p=!1}function i(){p=!1,h.trigger(c.completeEvent)}function r(t){d.push(t),h.trigger(c.newRequestEvent)}var l=this,u={completeEvent:"requestQueueProcessComplete",newRequestEvent:"requestQueueNewRequest"},c=o.extend(!0,{},u,t),d=[],p=!1,h={};a.extend(h,s.Events),l.add=r,l.complete=i,l.init=e}var r=n(7),o=r,a=n(5),s=n(12);t.exports=i},function(t,e,n){var i=n(22),r=n(23),o=n(85),a={util:n(6)},s=n(12),l=n(5),u=n(7),c=u;n(86),n(87),n(88),n(89),n(90),n(91),n(95),n(97),n(99),n(101),n(103),n(105);var d=s.View.extend({initialize:function(t){var e={config:{loaderImage:o,coreTemplate:"default_mutation_details_template",mainContentTemplate:"default_mutation_details_main_content_template",listContentTemplate:"default_mutation_details_list_content_template"}};this.options=c.extend(!0,{},e,t),this._3dPanelInitialized=!1,this.dispatcher={},l.extend(this.dispatcher,s.Events)},render:function(){var t=this,e=t._generateContent(),n={loaderImage:t.options.config.loaderImage,listContent:e.listContent,mainContent:e.mainContent},i=r.getTemplateFn(t.options.config.coreTemplate),o=i(n);t.$el.html(o),t.model.mutationProxy.hasData()&&(l.isFunction(t.options.config.init)?t.options.config.init(t):t._initDefaultView()),t.options.config.format?t.options.config.format(t):t.format()},format:function(){var t=this;if(t.model.mutationProxy.hasData()){var e=t.$el.find(".mutation-details-content");e.tabs(),e.tabs("paging",{tabsPerPage:10,follow:!0,cycle:!1}),e.tabs("option","active",0),t.$el.find(".mutation-details-tabs-ref").tipTip({defaultPosition:"bottom",delay:"100",edgeOffset:10,maxWidth:200})}},refreshGenesTab:function(){u(window).trigger("resize")},init3dPanel:function(){var t=this;t.dispatcher.trigger(i.VIS_3D_PANEL_INIT),t._3dPanelInitialized=!0},is3dPanelInitialized:function(){var t=this;return t._3dPanelInitialized},_generateContent:function(){var t=this,e="",n="";return l.each(t.model.mutationProxy.getGeneList(),function(i,o){var s=r.getTemplateFn(t.options.config.mainContentTemplate);e+=s({loaderImage:t.options.config.loaderImage,geneSymbol:i,geneId:a.util.safeProperty(i)}),s=r.getTemplateFn(t.options.config.listContentTemplate),n+=s({geneSymbol:i,geneId:a.util.safeProperty(i)})}),{mainContent:e,listContent:n}},_initDefaultView:function(){var t=this,e=t.$el.find(".mutation-details-content");e.bind("tabscreate",!1),e.bind("tabsactivate",!1),e.bind("tabscreate",function(e,n){t.$el.find(".mutation-details-loader").hide(),t.dispatcher.trigger(i.GENE_TABS_CREATED)}),e.bind("tabsactivate",function(e,n){var r=n.newTab.text().trim();t.dispatcher.trigger(i.GENE_TAB_SELECTED,r)})}});t.exports=d},function(t,e){var n=function(){var t="mutationDataSelected",e="mutationDataHighlighted",n="mutationDataFiltered",i="mutationDiagramLollipopSingleSelect",r="mutationDiagramLollipopMultiSelect",o="mutationDiagramLollipopSelected",a="mutationDiagramLollipopDeselected",s="mutationDiagramAllDeselected",l="mutationDiagramLollipopMouseover",u="mutationDiagramLollipopMouseout",c="mainMutationViewInit",d="mutationDiagramInitialized",p="mutationDiagramPlotUpdated",h="mutationDiagramPlotReset",f="mutationTableFiltered",m="mutationTableInitialized",g="mutationTableRedrawn",v="mutationTableHeaderCreated",_="mutationTableProteinChangeLinkClicked",y="infoPanelMutationTypeSelected",b="infoPanelInit",x="mutationTablePdbLinkClicked",w="mutationPdbPanelResizeStarted",C="mutationPdbPanelResizeEnded",A="mutationPdbPanelChainSelected",T="mutationPdbTableChainSelected",S="mutationPdbTableChainMouseout",M="mutationPdbTableChainMouseover",I="mutationPdbTableReady",P="mutationDetailsGeneTabSelected",L="mutationDetailsGeneTabsCreated",E="mutation3dPanelInit",F="mutation3dPanelCreated",D="mutation3dPanelClosed",z="mutation3dStructureReloaded";return{MUTATION_HIGHLIGHT:e,MUTATION_SELECT:t,MUTATION_FILTER:n,LOLLIPOP_SINGLE_SELECT:i,LOLLIPOP_MULTI_SELECT:r,LOLLIPOP_SELECTED:o,LOLLIPOP_DESELECTED:a,LOLLIPOP_MOUSEOVER:l,LOLLIPOP_MOUSEOUT:u,ALL_LOLLIPOPS_DESELECTED:s,MAIN_VIEW_INIT:c,DIAGRAM_INIT:d,DIAGRAM_PLOT_UPDATED:p,DIAGRAM_PLOT_RESET:h,MUTATION_TABLE_INITIALIZED:m,MUTATION_TABLE_FILTERED:f,MUTATION_TABLE_REDRAWN:g,MUTATION_TABLE_HEADER_CREATED:v,PROTEIN_CHANGE_LINK_CLICKED:_,INFO_PANEL_MUTATION_TYPE_SELECTED:y,INFO_PANEL_INIT:b,PDB_LINK_CLICKED:x,PDB_PANEL_RESIZE_STARTED:w,PDB_PANEL_RESIZE_ENDED:C,PANEL_CHAIN_SELECTED:A,TABLE_CHAIN_SELECTED:T,TABLE_CHAIN_MOUSEOUT:S,TABLE_CHAIN_MOUSEOVER:M,PDB_TABLE_READY:I,GENE_TAB_SELECTED:P,GENE_TABS_CREATED:L,VIS_3D_PANEL_INIT:E,VIS_3D_PANEL_CREATED:F,VIEW_3D_STRUCTURE_RELOADED:z,VIEW_3D_PANEL_CLOSED:D}}();t.exports=n},function(t,e,n){var i=n(7),r=n(5),o=function(){function t(t){return r.templateSettings={interpolate:/\{\{(.+?)\}\}/g},r.template(i("#"+t).html())}function e(e){var n=o[e];return null==n&&(n=t(e),o[e]=n),n}var o={},a={"3Dmol_basic_interaction":"3d/3Dmol_basic_interaction",jsmol_basic_interaction:"3d/jsmol_basic_interaction",mutation_3d_view_template:"3d/mutation_3d_view",mutation_3d_vis_template:"3d/mutation_3d_vis",mutation_3d_vis_info_template:"3d/mutation_3d_vis_info",mutation_3d_non_protein_tip_template:"3d/non_protein_tip",mutation_3d_side_chain_tip_template:"3d/side_chain_tip",mutation_3d_structure_color_tip_template:"3d/structure_color_tip",mutation_3d_type_color_tip_template:"3d/type_color_tip",mutation_info_panel_template:"info_panel/info_panel",mutation_info_panel_type_template:"info_panel/info_panel_type",default_mutation_details_gene_info_template:"mutation_details/gene_info",default_mutation_details_info_template:"mutation_details/info",default_mutation_details_list_content_template:"mutation_details/list_content",default_mutation_details_main_content_template:"mutation_details/main_content",default_mutation_details_template:"mutation_details/mutation_details",mutation_summary_view_template:"mutation_details/mutation_summary_view",mutation_view_template:"mutation_details/mutation_view",mutation_details_lollipop_tip_template:"mutation_diagram/lollipop_tip",mutation_details_lollipop_tip_stats_template:"mutation_diagram/lollipop_tip_stats",mutation_aligner_info_template:"mutation_diagram/mutation_aligner_info",mutation_customize_panel_template:"mutation_diagram/mutation_customize_panel",mutation_diagram_view_template:"mutation_diagram/mutation_diagram_view",mutation_help_panel_template:"mutation_diagram/mutation_help_panel",mutation_details_region_tip_template:"mutation_diagram/region_tip",mutation_table_cancer_study_template:"mutation_table/cancer_study",mutation_table_case_id_template:"mutation_table/case_id",mutation_table_cbio_portal_template:"mutation_table/cbio_portal",mutation_table_cna_template:"mutation_table/cna",mutation_table_cosmic_template:"mutation_table/cosmic",mutation_details_cosmic_tip_template:"mutation_table/cosmic_tip",mutation_table_end_pos_template:"mutation_table/end_position",mutation_details_fis_tip_template:"mutation_table/fis_tip",mutation_table_igv_link_template:"mutation_table/igv_link",mutation_table_mutation_assessor_template:"mutation_table/mutation_assessor",mutation_table_mutation_count_template:"mutation_table/mutation_count",mutation_table_mutation_status_template:"mutation_table/mutation_status",mutation_details_table_template:"mutation_table/mutation_table",mutation_table_placeholder_template:"mutation_table/mutation_table_placeholder",mutation_table_mutation_type_template:"mutation_table/mutation_type",mutation_table_normal_alt_count_template:"mutation_table/normal_alt_count",mutation_table_normal_freq_template:"mutation_table/normal_freq",mutation_table_normal_ref_count_template:"mutation_table/normal_ref_count",pancan_mutation_hist_tip_template:"mutation_table/pancan_mutation_hist_tip",mutation_table_protein_change_template:"mutation_table/protein_change",mutation_table_start_pos_template:"mutation_table/start_position",mutation_table_tumor_alt_count_template:"mutation_table/tumor_alt_count",mutation_table_tumor_freq_template:"mutation_table/tumor_freq",mutation_table_tumor_ref_count_template:"mutation_table/tumor_ref_count",mutation_table_tumor_type_template:"mutation_table/tumor_type",mutation_table_validation_status_template:"mutation_table/validation_status",mutation_details_pdb_chain_tip_template:"pdb_panel/pdb_chain_tip",mutation_details_pdb_help_tip_template:"pdb_panel/pdb_help_tip",pdb_panel_view_template:"pdb_panel/pdb_panel_view",mutation_pdb_table_chain_cell_template:"pdb_table/chain_cell",mutation_pdb_table_pdb_cell_template:"pdb_table/pdb_cell",pdb_table_view_template:"pdb_table/pdb_table_view",mutation_pdb_table_summary_cell_template:"pdb_table/summary_cell"};return r.each(r.keys(a),function(t){o[t]=n(24)("./"+a[t]+".html")}),{getTemplateFn:e}}();t.exports=o},function(t,e,n){function i(t){return n(r(t))}function r(t){return o[t]||function(){throw new Error("Cannot find module '"+t+"'.")}()}var o={"./3d/3Dmol_basic_interaction.html":25,"./3d/jsmol_basic_interaction.html":26,"./3d/mutation_3d_view.html":27,"./3d/mutation_3d_vis.html":28,"./3d/mutation_3d_vis_info.html":29,"./3d/non_protein_tip.html":30,"./3d/side_chain_tip.html":31,"./3d/structure_color_tip.html":32,"./3d/type_color_tip.html":33,"./info_panel/info_panel.html":34,"./info_panel/info_panel_type.html":35,"./mutation_details/gene_info.html":36,"./mutation_details/info.html":37,"./mutation_details/list_content.html":38,"./mutation_details/main_content.html":39,"./mutation_details/mutation_details.html":40,"./mutation_details/mutation_summary_view.html":41,"./mutation_details/mutation_view.html":42,"./mutation_diagram/lollipop_tip.html":43,"./mutation_diagram/lollipop_tip_stats.html":44,"./mutation_diagram/mutation_aligner_info.html":45,"./mutation_diagram/mutation_customize_panel.html":46,"./mutation_diagram/mutation_diagram_view.html":47,"./mutation_diagram/mutation_help_panel.html":48,"./mutation_diagram/region_tip.html":49,"./mutation_table/cancer_study.html":50,"./mutation_table/case_id.html":51,"./mutation_table/cbio_portal.html":52,"./mutation_table/cna.html":53,"./mutation_table/cosmic.html":54,"./mutation_table/cosmic_tip.html":55,"./mutation_table/end_position.html":56,"./mutation_table/fis_tip.html":57,"./mutation_table/igv_link.html":59,"./mutation_table/mutation_assessor.html":60,"./mutation_table/mutation_count.html":61,"./mutation_table/mutation_status.html":62,"./mutation_table/mutation_table.html":63,"./mutation_table/mutation_table_placeholder.html":64,"./mutation_table/mutation_type.html":65,"./mutation_table/normal_alt_count.html":66,"./mutation_table/normal_freq.html":67,
"./mutation_table/normal_ref_count.html":68,"./mutation_table/pancan_mutation_hist_tip.html":69,"./mutation_table/protein_change.html":70,"./mutation_table/start_position.html":72,"./mutation_table/tumor_alt_count.html":73,"./mutation_table/tumor_freq.html":74,"./mutation_table/tumor_ref_count.html":75,"./mutation_table/tumor_type.html":76,"./mutation_table/validation_status.html":77,"./pdb_panel/pdb_chain_tip.html":78,"./pdb_panel/pdb_help_tip.html":79,"./pdb_panel/pdb_panel_view.html":80,"./pdb_table/chain_cell.html":81,"./pdb_table/pdb_cell.html":82,"./pdb_table/pdb_table_view.html":83,"./pdb_table/summary_cell.html":84};i.keys=function(){return Object.keys(o)},i.resolve=r,t.exports=i,i.id=24},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="mutation-3d-vis-help-close">\n    <a href="#"><b>&times;</b></a>\n</div>\n<h4>3D visualizer basic interaction</h4>\n<b>Zoom in/out:</b> Press and hold the SHIFT key and the left mouse button,\nand then move the mouse backward/forward.<br>\n<b>Pan:</b> Press and hold the CTRL key, click and hold the left mouse button,\nand then move the mouse in the desired direction.<br>\n<b>Rotate:</b> Press and hold the left mouse button, and then move the mouse in the desired\ndirection to rotate along the x and y axes.<br>';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="mutation-3d-vis-help-close">\n    <a href="#"><b>&times;</b></a>\n</div>\n<h4>3D visualizer basic interaction</h4>\n<b>Zoom in/out:</b> Press and hold the SHIFT key and the left mouse button,\nand then move the mouse backward/forward.<br>\n<b>Pan:</b> Press and hold the SHIFT key, double click and hold the left mouse button,\nand then move the mouse in the desired direction.<br>\n<b>Rotate:</b> Press and hold the left mouse button, and then move the mouse in the desired\ndirection to rotate along the x and y axes. To be able to rotate along the z-axis, you need to\npress and hold the SHIFT key and the left mouse button, and then move the mouse left or right.<br>\n<b>Reset:</b> Press and hold the SHIFT key, and then double click on the background\nto reset the orientation and the zoom level to the initial state.\n';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<button class='mutation-3d-vis btn btn-default'>\n    3D Structure &#187;\n</button>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='mutation-3d-vis-header'>\n    <span class='mutation-3d-close ui-icon ui-icon-circle-close' title='close'></span>\n    <span class='mutation-3d-minimize ui-icon ui-icon-circle-minus' title='minimize'></span>\n    <div class='mutation-3d-info-title'>\n        3D Structure\n    </div>\n</div>\n<div class='mutation-3d-vis-main-loader'>\n    <img src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading 3d visualization' />\n</div>\n<div class='mutation-3d-vis-body'>\n    <div class='mutation-3d-info'></div>\n    <div class='mutation-3d-residue-warning'>\n        <span class=\"mutation-3d-unmapped-info\">Selected mutation</span>\n        cannot be mapped onto this structure.\n    </div>\n    <div class='mutation-3d-nomap-warning'>\n        None of the mutations can be mapped onto this structure.\n    </div>\n    <div class='mutation-3d-vis-loader'>\n        <img src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading 3d visualization' />\n    </div>\n    <div class='mutation-3d-vis-container'></div>\n    <div class='mutation-3d-vis-toolbar'>\n        <div class='mutation-3d-vis-help-init'>\n            <table>\n                <tr>\n                    <td align=\"left\">\n                        <button class='mutation-3d-pymol-dload'>PyMOL</button>\n                    </td>\n                    <td align=\"right\">\n                        <a class='mutation-3d-vis-help-open' href=\"#\">how to pan/zoom/rotate?</a>\n                    </td>\n                </tr>\n            </table>\n        </div>\n        <div class='mutation-3d-vis-help-content'></div>\n        <table class=\"mutation-3d-controls-menu\" cellpadding=\"0\">\n            <tr>\n                <td class='mutation-3d-protein-style-menu' valign='top'>\n                    <div class='mutation-3d-style-header'>\n                        <label>Protein Style</label>\n                    </div>\n                    <table cellpadding='0'>\n                        <tr>\n                            <td>\n                                <label>\n                                    <input class='mutation-3d-display-non-protein'\n                                           type='checkbox'\n                                           checked='checked'>\n                                    Display bound molecules\n                                </label>\n                                <img class='display-non-protein-help' src='"+(null==(__t=helpImage)?"":__t)+"'\n                                     alt='Help (non-protein display)' />\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <label>Scheme:</label>\n                                <select class='mutation-3d-protein-style-select'\n                                        title='Select 3d protein style'>\n                                    <option value='cartoon'\n                                            title='Switch to the Cartoon Scheme'>cartoon</option>\n                                    <option value='spaceFilling'\n                                            title='Switch to the Space-filling Scheme'>space-filling</option>\n                                    <option value='trace'\n                                            title='Switch to the Trace Scheme'>trace</option>\n                                </select>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <label>Color:</label>\n                                <select class='mutation-3d-protein-color-select'\n                                        title='Select 3d protein coloring'>\n                                    <option value='uniform'\n                                            title='Uniform Color'>uniform</option>\n                                    <option value='bySecondaryStructure'\n                                            title='Color by Secondary Structure'>secondary structure</option>\n                                    <option value='byChain'\n                                            title='Color by Rainbow Gradient'>N-C rainbow</option>\n                                    <option value='byAtomType'\n                                            title='Color by Atom Type'\n                                            disabled='disabled'>atom type</option>\n                                </select>\n                                <img class='protein-struct-color-help' src='"+(null==(__t=helpImage)?"":__t)+"'\n                                     alt='Help (protein coloring)' />\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n                <td class='mutation-3d-mutation-style-menu' valign='top'>\n                    <div class='mutation-3d-style-header'>\n                        <label>Mutation Style</label>\n                    </div>\n                    <table cellpadding=\"0\">\n                        <tr>\n                            <td>\n                                <!--label>\n                                    <input class='mutation-3d-side-chain'\n                                           type='checkbox'\n                                           checked='checked'>\n                                    Display side chain\n                                </label-->\n                                <label>Side chain:</label>\n                                <select class='mutation-3d-side-chain-select'\n                                        title='Select 3d protein side-chain display'>\n                                    <option value='all'\n                                            title='Display side chain for all mapped residues'>all</option>\n                                    <option value='highlighted'\n                                            selected='selected'\n                                            title='Display side chain for highlighted residues only'>selected</option>\n                                    <option value='none'\n                                            title='Do not display side chains'>none</option>\n                                </select>\n                                <img class='display-side-chain-help' src='"+(null==(__t=helpImage)?"":__t)+"'\n                                     alt='Help (side chain display)' />\n                            </td>\n                        </tr>\n                        <tr>\n                            <td>\n                                <label>Color:</label>\n                                <select class='mutation-3d-mutation-color-select'\n                                        title='Select 3d protein mutation color'>\n                                    <option value='uniform'\n                                            title='Uniform color'>uniform</option>\n                                    <option value='byMutationType'\n                                            selected='selected'\n                                            title='Color by mutation type'>mutation type</option>\n                                    <option value='none'\n                                            title='Do not color'>none</option>\n                                </select>\n                                <img class='mutation-type-color-help' src='"+(null==(__t=helpImage)?"":__t)+"'\n                                     alt='Help (mutation type coloring)' />\n                            </td>\n                        </tr>\n                    </table>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='mutation-3d-info-main'>\n    PDB\n    <span class='mutation-3d-pdb-id'>\n        <a href=\"http://www.rcsb.org/pdb/explore/explore.do?structureId="+(null==(__t=pdbId)?"":__t)+'"\n           target="_blank">\n            '+(null==(__t=pdbId)?"":__t)+"\n        </a>\n    </span>\n    <span class='mutation-3d-pdb-info'>: "+(null==(__t=pdbInfo)?"":__t)+"</span><br>\n    Chain\n    <span class='mutation-3d-chain-id'>"+(null==(__t=chainId)?"":__t)+"</span>\n    <span class='mutation-3d-mol-info'>: "+(null==(__t=molInfo)?"":__t)+"</span>\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="Displays co-crystalized molecules.\nThis option has no effect if the current structure does not contain any co-crystalized bound molecules.\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="Display options for the side chain atoms.<br>\n<br>\n<b>All:</b> Displays the side chain atoms for every mapped residue.<br>\n<b>Selected:</b> Displays the side chain atoms only for the selected mutations.<br>\n<b>None:</b> Hides the side chain atoms.<br>\n<br>\nThis option has no effect for the space-filling protein scheme.";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="Color options for the protein structure.<br>\n<br>\n<b>Uniform:</b> Colors the entire protein structure with a\n<span class='mutation-3d-loop'>single color</span>.<br>\n<b>Secondary structure:</b> Colors the protein by secondary structure.\nAssigns different colors for <span class='mutation-3d-alpha-helix'>alpha helices</span>,\n<span class='mutation-3d-beta-sheet'>beta sheets</span>, and\n<span class='mutation-3d-loop'>loops</span>.\nThis color option is not available for the space-filling protein scheme.<br>\n<b>N-C rainbow:</b> Colors the protein with a rainbow gradient\nfrom red (N-terminus) to blue (C-terminus).<br>\n<b>Atom Type:</b> Colors the structure with respect to the atom type (CPK color scheme).\nThis color option is only available for the space-filling protein scheme.<br>\n<br>\nThe selected chain is always displayed with full opacity while the rest of the structure\nhas some transparency to help better focusing on the selected chain.\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="Color options for the mapped mutations.<br>\n<br>\n<b>Uniform:</b> Colors all mutated residues with a\n<span class='uniform_mutation'>single color</span>.<br>\n<b>Mutation type:</b> Enables residue coloring by mutation type.\nMutation types and corresponding color codes are as follows:\n<ul>\n    <li><span class='missense_mutation'>Missense Mutations</span></li>\n    <li><span class='trunc_mutation'>Truncating Mutations</span>\n        (Nonsense, Nonstop, FS del, FS ins)</li>\n    <li><span class='inframe_mutation'>Inframe Mutations</span>\n        (IF del, IF ins)</li>\n</ul>\n<b>None:</b> Disables coloring of the mutated residues\nexcept for manually selected (highlighted) residues.<br>\n<br>\nHighlighted residues are colored with <span class='mutation-3d-highlighted'>yellow</span>.\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="mutation-info-panel-content">\n    <div class="mutation-info-panel-mutation-type">\n        '+(null==(__t=mutationTypeContent)?"":__t)+"\n    </div>\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='mutation-type-info'>\n    <span class=\"mutation-type-info-link\" alt='"+(null==(__t=mutationType)?"":__t)+"'>\n        <span class='mutation-type-count "+(null==(__t=countStyle)?"":__t)+"'>"+(null==(__t=count)?"":__t)+"</span>\n        <span class='mutation-type-label "+(null==(__t=textStyle)?"":__t)+"'>"+(null==(__t=type)?"":__t)+"</span>\n    </span>\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<p>There are no mutation details available for this gene.</p>\n<br>\n<br>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<p>There are no mutation details available for the gene set entered.</p>\n<br>\n<br>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<li>\n    <a href="#mutation_details_'+(null==(__t=geneId)?"":__t)+'"\n       class="mutation-details-tabs-ref"\n       title="'+(null==(__t=geneSymbol)?"":__t)+' mutations">\n        <span>'+(null==(__t=geneSymbol)?"":__t)+"</span>\n    </a>\n</li>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div id='mutation_details_"+(null==(__t=geneId)?"":__t)+"'>\n    <img src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading mutation details for gene' />\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='mutation-3d-container'></div>\n<div class='mutation-details-loader'>\n    <img src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading mutation details' />\n</div>\n<div class='mutation-details-content'>\n    <ul>\n        "+(null==(__t=listContent)?"":__t)+"\n    </ul>\n    "+(null==(__t=mainContent)?"":__t)+"\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<h4>"+(null==(__t=geneSymbol)?"":__t)+": "+(null==(__t=mutationSummary)?"":__t)+"</h4>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='mutation-summary-view'></div>\n<div>\n    <table>\n        <tr>\n            <td>\n                <div class='mutation-diagram-view'></div>\n            </td>\n            <td valign=\"bottom\">\n                <div class=\"mutation-3d-initializer\"></div>\n            </td>\n        </tr>\n    </table>\n</div>\n<div class=\"mutation-pdb-panel-view\"></div>\n<div class='mutation-details-no-data-info'>\n    There are no "+(null==(__t=geneSymbol)?"":__t)+" mutations in the selected samples.\n</div>\n<div class='mutation-info-panel-container'></div>\n<div class='mutation-details-filter-info'>\n    Current view shows filtered results.\n    Click <a class='mutation-details-filter-reset'>here</a> to reset all filters.\n</div>\n<div class='mutation-table-container'></div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div>\n    <div class='diagram-lollipop-tip'>\n        <b>"+(null==(__t=count)?"":__t)+" "+(null==(__t=mutationStr)?"":__t)+"</b>\n        <br/>AA Change: "+(null==(__t=label)?"":__t)+'\n        <div class="lollipop-stats">\n            <table>\n                <thead>\n                <tr>\n                    <th>Cancer Type</th>\n                    <th>Count</th>\n                </tr>\n                </thead>\n                <tbody>\n                </tbody>\n            </table>\n        </div>\n    </div>\n</div>';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<tr>\n    <td>"+(null==(__t=cancerType)?"":__t)+"</td>\n    <td>"+(null==(__t=count)?"":__t)+"</td>\n</tr>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="'+(null==(__t=linkToMutationAligner)?"":__t)+'" target="_blank">Mutation Aligner</a>';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="diagram-customize-close">\n    <a href="#">&times;</a>\n</div>\n<h4>Customize</h4>\n<table>\n    <tr>\n        <td>\n            <div class="diagram-y-axis-slider-area">\n                <div class="diagram-slider-title"><label>max y-axis value</label></div>\n                <table>\n                    <tr>\n                        <td width="90%" valign="top">\n                            <div class="diagram-y-axis-slider"></div>\n                            <span class="diagram-slider-min-label">'+(null==(__t=minY)?"":__t)+'</span>\n                            <span class="diagram-slider-max-label">'+(null==(__t=maxY)?"":__t)+'</span>\n                        </td>\n                        <td valign="top">\n                            <input class="diagram-y-axis-limit-input" size="2" type=\'text\'>\n                        </td>\n                    </tr>\n                </table>\n            </div>\n        </td>\n    </tr>\n</table>';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='mutation-diagram-toolbar'>\n    <a href='http://www.uniprot.org/uniprot/"+(null==(__t=uniprotId)?"":__t)+"'\n       class='mutation-details-uniprot-link'\n       target='_blank'>"+(null==(__t=uniprotId)?"":__t)+"</a>\n    <span class='mutation-diagram-toolbar-buttons'>\n        <button class='diagram-to-pdf'>PDF</button>\n        <button class='diagram-to-svg'>SVG</button>\n        <button class=\"diagram-customize\">Customize</button>\n        <button class=\"diagram-help\">Color Codes</button>\n    </span>\n</div>\n<div class=\"mutation-diagram-help ui-widget\"></div>\n<div class=\"mutation-diagram-customize ui-widget\"></div>\n<div class='mutation-diagram-container'></div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class=\"diagram-help-close\">\n    <a href=\"#\">&times;</a>\n</div>\n<h4>Color Codes</h4>\n<div>\n    Mutation diagram circles are colored with respect to\n    the corresponding mutation types. In case of different mutation<br>\n    types at a single position, color of the circle is determined\n    with respect to the most frequent mutation type.<br><br>\n    Mutation types and corresponding color codes are as follows:\n    <ul>\n        <li><span class='missense_mutation'>Missense Mutations</span></li>\n        <li><span class='trunc_mutation'>Truncating Mutations</span>\n            : Nonsense, Nonstop, Frameshift deletion, Frameshift insertion, Splice site</li>\n        <li><span class='inframe_mutation'>Inframe Mutations</span>\n            : Inframe deletion, Inframe insertion</li>\n        <li><span class='other_mutation'>Other Mutations</span>\n            : All other types of mutations</li>\n    </ul>\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="diagram-region-tip">\n    <div>'+(null==(__t=identifier)?"":__t)+" "+(null==(__t=type)?"":__t)+", "+(null==(__t=description)?"":__t)+" ("+(null==(__t=start)?"":__t)+" - "+(null==(__t=end)?"":__t)+')</div>\n    <div>\n        <a href="http://pfam.xfam.org/family/'+(null==(__t=pfamAccession)?"":__t)+'" class="diagram-pfam-link" target="_blank">PFAM</a>\n        '+(null==(__t=mutationAlignerInfo)?"":__t)+"\n    </div>\n</div>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<a href='"+(null==(__t=cancerStudyLink)?"":__t)+"' target='_blank'>\n    <b title=\""+(null==(__t=cancerStudy)?"":__t)+'"\n       alt="'+(null==(__t=cancerStudy)?"":__t)+'"\n       class="cc-short-study-name simple-tip">'+(null==(__t=cancerStudyShort)?"":__t)+"</b>\n</a>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<a href='"+(null==(__t=linkToPatientView)?"":__t)+"' target='_blank'>\n    <b alt=\""+(null==(__t=caseIdTip)?"":__t)+'"\n       class="'+(null==(__t=caseIdClass)?"":__t)+'">'+(null==(__t=caseId)?"":__t)+"</b>\n</a>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=portalClass)?"":__t)+"'>"+(null==(__t=portalFrequency)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span alt='"+(null==(__t=cnaTip)?"":__t)+"' class='simple-tip "+(null==(__t=cnaClass)?"":__t)+"'>"+(null==(__t=cna)?"":__t)+"</span>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=cosmicClass)?"":__t)+"'>"+(null==(__t=cosmicCount)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='cosmic-details-tip-info'>\n    <b>"+(null==(__t=cosmicTotal)?"":__t)+" occurrences of "+(null==(__t=mutationKeyword)?"":__t)+" mutations in COSMIC</b>\n</div>\n<table class='cosmic-details-table display'\n       cellpadding='0' cellspacing='0' border='0'>\n    <thead>\n    <tr>\n        <th>COSMIC ID</th>\n        <th>Protein Change</th>\n        <th>Count</th>\n    </tr>\n    </thead>\n    <tbody>"+(null==(__t=cosmicDataRows)?"":__t)+"</tbody>\n</table>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=endPosClass)?"":__t)+"'>"+(null==(__t=endPos)?"":__t)+"</span>";return __p}},function(module,exports,__webpack_require__){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="Predicted impact score: <b>"+(null==(__t=impact)?"":__t)+"</b>\n<div class='mutation-assessor-main-link mutation-assessor-link'>\n    <a href='"+(null==(__t=linkOut)?"":__t)+"' target='_blank'>\n        <img height=15 width=19 src='"+__webpack_require__(58)+"'\n             alt='Mutation Assessor' />\n        Go to Mutation Assessor\n    </a>\n</div>\n<div class='mutation-assessor-msa-link mutation-assessor-link'>\n    <a href='"+(null==(__t=msaLink)?"":__t)+"' target='_blank'>\n        <span class=\"ma-msa-icon\">msa</span>\n        Multiple Sequence Alignment\n    </a>\n</div>\n<div class='mutation-assessor-3d-link mutation-assessor-link'>\n    <a href='"+(null==(__t=pdbLink)?"":__t)+"' target='_blank'>\n        <span class=\"ma-3d-icon\">3D</span>\n        Mutation Assessor 3D View\n    </a>\n</div>";return __p}},function(t,e,n){t.exports=n.p+"images/ma.png"},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<a href='"+(null==(__t=igvLink)?"":__t)+"' class='igv-link'>\n    <span class=\"mutation-table-igv-icon\">IGV</span>\n</a>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=omaClass)?"":__t)+" "+(null==(__t=fisClass)?"":__t)+"'>"+(null==(__t=fisText)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=mutationCountClass)?"":__t)+"'>"+(null==(__t=mutationCount)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span alt='"+(null==(__t=mutationStatusTip)?"":__t)+"' class='simple-tip "+(null==(__t=mutationStatusClass)?"":__t)+"'>\n\t"+(null==(__t=mutationStatusText)?"":__t)+"\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<table class='display mutation_details_table' cellpadding='0' cellspacing='0' border='0'></table>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<img width='"+(null==(__t=width)?"":__t)+"' height='"+(null==(__t=height)?"":__t)+"' src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading mutation table' />\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=mutationTypeClass)?"":__t)+"'>"+(null==(__t=mutationTypeText)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=normalAltCountClass)?"":__t)+"'>"+(null==(__t=normalAltCount)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span alt='<b>"+(null==(__t=normalAltCount)?"":__t)+"</b> variant reads out of <b>"+(null==(__t=normalTotalCount)?"":__t)+"</b> total'\n      class='"+(null==(__t=normalFreqClass)?"":__t)+" "+(null==(__t=normalFreqTipClass)?"":__t)+"'>"+(null==(__t=normalFreq)?"":__t)+"</span>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=normalRefCountClass)?"":__t)+"'>"+(null==(__t=normalRefCount)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div>\n    <div>\n        <h3>"+(null==(__t=gene)?"":__t)+" mutations across all cancer studies</h3>\n    </div>\n    <div style='float:right;'>\n        <button class='cross-cancer-download' file-type='pdf'>PDF</button>\n        <button class='cross-cancer-download' file-type='svg'>SVG</button>\n    </div>\n</div>\n<div>\n    <p class=\"overall-count\"></p>\n</div>\n<div class=\"pancan-histogram-container\"></div>";return __p}},function(module,exports,__webpack_require__){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=proteinChangeClass)?"":__t)+"' alt='"+(null==(__t=proteinChangeTip)?"":__t)+"'>\n    <a>"+(null==(__t=proteinChange)?"":__t)+"</a>\n</span>\n<span class='mutation-table-additional-protein-change simple-tip'\n      alt='"+(null==(__t=additionalProteinChangeTip)?"":__t)+"'>\n    <img height=12 width=12 style='opacity:0.2' src='"+__webpack_require__(71)+"' />\n</span>\n<a href='"+(null==(__t=pdbMatchLink)?"":__t)+'\' class="mutation-table-3d-link">\n    <span class="mutation-table-3d-icon">3D</span>\n</a>\n';return __p}},function(t,e,n){t.exports=n.p+"images/warning.gif"},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=startPosClass)?"":__t)+"'>"+(null==(__t=startPos)?"":__t)+"</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=tumorAltCountClass)?"":__t)+"'>"+(null==(__t=tumorAltCount)?"":__t)+"</span>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span alt='<b>"+(null==(__t=tumorAltCount)?"":__t)+"</b> variant reads out of <b>"+(null==(__t=tumorTotalCount)?"":__t)+"</b> total'\n      class='"+(null==(__t=tumorFreqClass)?"":__t)+" "+(null==(__t=tumorFreqTipClass)?"":__t)+"'>"+(null==(__t=tumorFreq)?"":__t)+"</span>";
return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=tumorRefCountClass)?"":__t)+"'>"+(null==(__t=tumorRefCount)?"":__t)+"</span>\n";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='"+(null==(__t=tumorTypeClass)?"":__t)+"' alt='"+(null==(__t=tumorTypeTip)?"":__t)+"'>\n\t"+(null==(__t=tumorType)?"":__t)+"\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span alt='"+(null==(__t=validationStatusTip)?"":__t)+"' class=\"simple-tip "+(null==(__t=validationStatusClass)?"":__t)+'">\n\t'+(null==(__t=validationStatusText)?"":__t)+"\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='pdb-chain-tip'>\n\tPDB\n\t<a href=\"http://www.rcsb.org/pdb/explore/explore.do?structureId="+(null==(__t=pdbId)?"":__t)+'"\n\t   target="_blank">\n\t\t<b>'+(null==(__t=pdbId)?"":__t)+'</b>\n\t</a>\n\t<span class="chain-rectangle-tip-pdb-info">'+(null==(__t=pdbInfo)?"":__t)+"</span><br>\n\tChain <b>"+(null==(__t=chainId)?"":__t)+'</b>\n\t<span class="chain-rectangle-tip-mol-info">'+(null==(__t=molInfo)?"":__t)+"</span>\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<span class='pdb-chain-tip'>\n\tThis panel displays a list of PDB chains for the corresponding uniprot ID.\n\tPDB chains are ranked with respect to their sequence similarity ratio,\n\tand aligned to the y-axis of the mutation diagram.\n\tHighly ranked chains have darker color than the lowly ranked ones.<br>\n\t<br>\n\tEach chain is represented by a single rectangle.\n\tGaps within the chains are represented by a thin line connecting the segments of the chain.<br>\n\t<br>\n\tBy default, only a first few rows are displayed.\n\tTo see more chains, use the scroll bar next to the panel.\n\tTo see the detailed list of all available PDB chains in a table\n\tclick on the link below the panel.<br>\n\t<br>\n\tTo select a chain, simply click on it.\n\tSelected chain is highlighted with a different frame color.\n\tYou can also select a chain by clicking on a row in the table.\n\tSelecting a chain reloads the PDB data for the 3D structure visualizer.\n</span>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<table class='mutation-pdb-main-container'>\n    <tr>\n        <td valign=\"top\">\n            <div class='mutation-pdb-panel-container'></div>\n        </td>\n    </tr>\n    <tr>\n        <td valign=\"top\" align=\"center\">\n            <button class='expand-collapse-pdb-panel'\n                    title='Expand/Collapse PDB Chains'></button>\n        </td>\n    </tr>\n    <tr class='pdb-table-controls'>\n        <td>\n            <span class=\"triangle triangle-right ui-icon ui-icon-triangle-1-e\"></span>\n            <span class=\"triangle triangle-down ui-icon ui-icon-triangle-1-s\"></span>\n            <a href=\"#\" class='init-pdb-table'>PDB Chain Table</a>\n        </td>\n    </tr>\n    <tr>\n        <td>\n            <div class='pdb-table-wrapper'>\n                <div class=\"mutation-pdb-table-view\"></div>\n            </div>\n        </td>\n    </tr>\n</table>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="pbd-chain-table-chain-cell">\n\t<label>'+(null==(__t=chainId)?"":__t)+'</label>\n\t<a href="#" class="pdb-table-3d-link">\n\t\t<span alt="Click to update the 3D view with this chain"\n\t\t\t  class="pdb-table-3d-icon">3D</span>\n\t</a>\n</span>';return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<a href="http://www.rcsb.org/pdb/explore/explore.do?structureId='+(null==(__t=pdbId)?"":__t)+'"\n   target="_blank"><b>'+(null==(__t=pdbId)?"":__t)+"</b></a>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<div class='pdb-chain-table-loader'>\n    <img src='"+(null==(__t=loaderImage)?"":__t)+"' alt='Loading chain table' />\n</div>\n<table>\n    <tr>\n        <td valign=\"top\" class='pdb-chain-table-container'>\n            <table class='display pdb-chain-table'\n                   cellpadding='0' cellspacing='0' border='0'>\n            </table>\n        </td>\n        <td></td>\n    </tr>\n</table>";return __p}},function(module,exports){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="<b>pdb:</b> "+(null==(__t=summary)?"":__t)+" <br>\n<b>chain:</b> "+(null==(__t=molecule)?"":__t);return __p}},function(t,e,n){t.exports=n.p+"images/ajax-loader.gif"},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_86__},function(t,e,n){(function(t){!function(t){var e={refresh:t.ui.tabs.prototype.refresh,option:t.ui.tabs.prototype.option};t.uiBackCompat!==!1&&(e=t.extend(e,{add:t.ui.tabs.prototype.add,remove:t.ui.tabs.prototype.remove})),t.extend(t.ui.tabs.prototype,{paging:function(n){function i(){l(),v=t(window).height(),_=t(window).width(),h=0,c=0,m=0,d=0,g=new Array,f=new Array,selectedTabWidths=new Array,p=y.element.width();var e=0;if(y.tabs.each(function(n){n==y.options.active?(selectedTabWidths[n]=t(this).outerWidth(!0),f[n]=y.tabs.eq(n).removeClass("ui-tabs-active").outerWidth(!0),y.tabs.eq(n).addClass("ui-tabs-active"),e=Math.min(e,Math.abs(selectedTabWidths[n]-f[n])),h+=f[n]):(f[n]=t(this).outerWidth(!0),selectedTabWidths[n]=y.tabs.eq(n).addClass("ui-tabs-active").outerWidth(!0),y.tabs.eq(n).removeClass("ui-tabs-active"),e=Math.max(e,Math.abs(selectedTabWidths[n]-f[n])),h+=f[n])}),h+=e+9,h>p){li=t("<li></li>").addClass("ui-state-default ui-tabs-paging-next").append(t('<a href="#"></a>').click(function(){return r("next"),!1}).html(u.nextButton)),y.tablist.append(li),d=li.outerWidth(!0),li=t("<li></li>").addClass("ui-state-default ui-tabs-paging-prev").append(t('<a href="#"></a>').click(function(){return r("prev"),!1}).html(u.prevButton)),y.tablist.prepend(li),d+=li.outerWidth(!0),d+=19;for(var n=0,i=0,a=0,x=0;x<f.length;x++)(0==i||selectedTabWidths[x]-f[x]>a)&&(a=selectedTabWidths[x]-f[x]),null==g[n]?g[n]={start:x}:(x>0&&x%u.tabsPerPage==0||f[x]+i+d+12>p)&&(i+a>m&&(m=i+a),n++,g[n]={start:x},i=0),g[n].end=x+1,i+=f[x],x==y.options.active&&(c=n);i+a>m&&(m=i+a),y.tabs.hide().slice(g[c].start,g[c].end).show(),c!=g.length-1||u.cycle||o("next"),0!=c||u.cycle||o("prev"),buttonPadding=p-m-d,buttonPadding>0&&t(".ui-tabs-paging-next",y.element).css({paddingRight:buttonPadding+"px"})}else l();t(window).bind("resize",s),b=!0}function r(t){c+="prev"==t?-1:1,"prev"==t&&c<0&&u.cycle||"next"==t&&c>=g.length&&!u.cycle?c=g.length-1:("prev"==t&&c<0||"next"==t&&c>=g.length&&u.cycle)&&(c=0);var e=g[c].start,n=g[c].end;y.tabs.hide().slice(e,n).show(),"prev"==t?(a("next"),u.follow&&(y.options.active<e||y.options.active>n-1)&&y.option("active",n-1),!u.cycle&&e<=0&&o("prev")):(a("prev"),u.follow&&(y.options.active<e||y.options.active>n-1)&&y.option("active",e),!u.cycle&&n>=y.tabs.length&&o("next"))}function o(e){t(".ui-tabs-paging-"+e,y.element).addClass("ui-tabs-paging-disabled")}function a(e){t(".ui-tabs-paging-"+e,y.element).removeClass("ui-tabs-paging-disabled")}function s(){x&&clearTimeout(x),v==t(window).height()&&_==t(window).width()||(x=setTimeout(i,100))}function l(){t(".ui-tabs-paging-next",y.element).remove(),t(".ui-tabs-paging-prev",y.element).remove(),y.tabs.show(),b=!1,t(window).unbind("resize",s)}var u={tabsPerPage:0,nextButton:"&#187;",prevButton:"&#171;",follow:!1,cycle:!1,activeOnAdd:!1,followOnActive:!1};u=t.extend(u,n);var c,d,p,h,f,m,g,v,_,y=this,b=!1,x=null;y.option=function(t,n){var i=e.option.apply(this,[t,n]);if("active"==t){if(!b||!u.followOnActive)return i;for(var r in g){var s=g[r].start,l=g[r].end;if(n>=s&&n<l){r!=c&&(this.tabs.hide().slice(s,l).show(),c=parseInt(r),0==c?(a("next"),!u.cycle&&s<=0&&o("prev")):(a("prev"),!u.cycle&&l>=this.tabs.length&&o("next")));break}}}return i},y.refresh=function(){b&&(l(),e.refresh.apply(this),i()),e.refresh.apply(this)},t.uiBackCompat!==!1&&(y.add=function(t,n,r){return b?(l(),e.add.apply(this,[t,n,r]),u.activeOnAdd&&(void 0==r&&(r=this.tabs.length-1),this.option("active",r)),i(),this):e.add.apply(this,[t,n,r])},y.remove=function(t){return b?(l(),e.remove.apply(this,[t]),i(),this):e.remove.apply(this,[t])}),t.extend(t.ui.tabs.prototype,{pagingDestroy:function(){return l(),this},pagingResize:function(){return i(),this}}),i()}})}(t)}).call(e,n(7))},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_88__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_89__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_90__},function(t,e){},,,,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e,n){var i=n(5),r=function(){function t(t){var n={};return i.each(i.keys(t).sort(),function(i){var r=t[i],o=null;o="pdbProxy"==i?e(r,function(t){var e=n.mutationProxy;return!(null==e||!e.hasData())&&(t.options.mutationUtil=e.getMutationUtil(),!0)}):e(r),n[i]=o}),n}function e(t,e){var n=t.instance;if(null==n){if(null!=e&&i.isFunction(e)&&!e(t))return null;var r=t.instanceClass;n=new r(t.options),n.init()}return n}return{initDataProxies:t,initDataProxy:e}}();t.exports=r},function(t,e,n){function i(t){function e(t){l=t.data}function n(t,e){var n=t.geneSymbol;if(null==n)return void e(null);if(void 0==l[n]){if(i.isFullInit())return void e(null);var r=function(t){l[n]=t,e(t)},o={type:"POST",url:s.servletName,data:t,success:r,dataType:"json"};i.requestData(o)}else e(l[n])}var i=this,o={servletName:"getPfamSequence.json"},s=a.extend(!0,{},o,t);r.call(this,s),s=i._options;var l={};i.fullInit=e,i.getPfamData=n}var r=n(109),o=n(7),a=o;i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){var e=this;e._defaultOpts={initMode:"lazy",servletName:"",data:{}},e._queryQueue=new r,e._options=a.extend(!0,{},e._defaultOpts,t),e.init=function(){e._queryQueue.init(function(t){o.ajax(t)}),e.isFullInit()?e.fullInit(e._options):e.lazyInit(e._options)},e.lazyInit=function(t){},e.fullInit=function(t){},e.isFullInit=function(){return!("lazy"===e._options.initMode.toLowerCase())},e.requestData=function(t){var n=t.complete,i={complete:function(t,i){e._queryQueue.complete(),s.isFunction(n)&&n(t,i)}},r=a.extend(!0,{},t,i);e._queryQueue.add(r)}}var r=n(20),o=n(7),a=o,s=n(5);t.exports=i},function(t,e,n){function i(t){function e(t){l=t.data}function n(t,e){var n=t.trim().split(","),r=[],a=[];if(s.each(n,function(t,e){var n=l[t];void 0==n||s.isEmpty(n)?r.push(t):a=a.concat(n)}),o.isFullInit())e(a);else{var u=function(t){s.each(t,function(t,e){i(t),t.id?l[t.id]=t:t.annotationJSON.id&&(l[t.annotationJSON.id]=t)}),a=a.concat(t),e(a)};if(r.length>0){var d=r.join(","),p={type:"POST",url:c.servletName,data:{variants:d},success:u,error:function(){console.log("[VariantDataProxy.getAnnotationData] error retrieving annotation data for variants: "+d),u([])},dataType:"json"};o.requestData(p)}else e(a)}}function i(t){if(s.isString(t.annotationJSON)){var e=JSON.parse(t.annotationJSON);s.isArray(e)&&e.length>0&&(e=e[0]),t.annotationJSON=e}}var o=this,l={},u={servletName:"variant_annotation/hgvs"},c=a.extend(!0,{},u,t);r.call(this,c),c=o._options,o.fullInit=e,o.getAnnotationData=n}var r=n(109),o=n(7),a=o,s=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){function e(t){var e=t.data,n=e;u.isArray(e)&&(n=new o(e)),v.processMutationData(n)}function n(){return y}function i(){return _}function c(){return g.geneList}function d(){return v}function p(t,e){var n=t.trim().split(/\s+/),i=[],r=[],a=v.getMutationGeneMap();if(u.each(n,function(t,e){t=t.toUpperCase();var n=a[t];void 0==n||0==n.length?i.push(t):r=r.concat(n)}),f.isFullInit())e(r);else{var l=function(t){var n=new o(t);v.processMutationData(n),r=r.concat(n.models),e(r)},c=g.paramsPromise||(new s.Deferred).resolve(g.params);c.then(function(t){if(i.length>0){t.geneList=i.join(" ");var n={type:"POST",url:g.servletName,data:t,success:l,error:function(){console.log("[MutationDataProxy.getMutationData] error retrieving mutation data for genetic profiles: "+t.geneticProfiles),l([])},dataType:"json"};f.requestData(n)}else e(r)})}}function h(){return!0}var f=this,m={servletName:"getMutationData.json",geneList:"",params:{},paramsPromise:null},g=l.extend(!0,{},m,t);r.call(this,g),g=f._options;var v=new a,_=g.geneList.trim().split(/\s+/),y=g.geneList.trim().split(/\s+/).sort();f.fullInit=e,f.getMutationData=p,f.getGeneList=n,f.getRawGeneList=c,f.getUnsortedGeneList=i,f.getMutationUtil=d,f.hasData=h}var r=n(109),o=n(112),a=n(114),s=n(7),l=s,u=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){var i=n(12),r=n(113),o=i.Collection.extend({model:r,initialize:function(t){},parse:function(t){},url:function(){}});t.exports=o},function(t,e,n){var i=n(12),r=i.Model.extend({_initialize:function(t){this.mutationId=t.mutationId,this.mutationSid=t.mutationSid,this.geneticProfileId=t.geneticProfileId,this.mutationEventId=t.mutationEventId,this.caseId=t.caseId,this.geneSymbol=t.geneSymbol,this.linkToPatientView=t.linkToPatientView,this.cancerType=t.cancerType,this.cancerStudy=t.cancerStudy,this.cancerStudyShort=t.cancerStudyShort,this.cancerStudyLink=t.cancerStudyLink,this.tumorType=t.tumorType,this.proteinChange=t.proteinChange,this.aminoAcidChange=t.aminoAcidChange,this.mutationType=t.mutationType,this.cosmic=t.cosmic,this.cosmicCount=this.calcCosmicCount(t.cosmic),this.functionalImpactScore=t.functionalImpactScore,this.fisValue=t.fisValue,this.msaLink=t.msaLink,this.xVarLink=t.xVarLink,this.pdbLink=t.pdbLink,this.pdbMatch=t.pdbMatch,this.igvLink=t.igvLink,this.mutationStatus=t.mutationStatus,this.validationStatus=t.validationStatus,this.sequencingCenter=t.sequencingCenter,this.ncbiBuildNo=t.ncbiBuildNo,this.chr=t.chr,this.startPos=t.startPos,this.endPos=t.endPos,this.referenceAllele=t.referenceAllele,this.variantAllele=t.variantAllele,this.tumorFreq=t.tumorFreq,this.normalFreq=t.normalFreq,this.tumorRefCount=t.tumorRefCount,this.tumorAltCount=t.tumorAltCount,this.normalRefCount=t.normalRefCount,this.normalAltCount=t.normalAltCount,this.canonicalTranscript=t.canonicalTranscript,this.refseqMrnaId=t.refseqMrnaId,this.codonChange=t.codonChange,this.uniprotId=t.uniprotId,this.uniprotAcc=t.uniprotAcc,this.proteinPosStart=t.proteinPosStart,this.proteinPosEnd=t.proteinPosEnd,this.mutationCount=t.mutationCount,this.specialGeneData=t.specialGeneData,this.keyword=t.keyword,this.cna=t.cna,this.myCancerGenome=t.myCancerGenome,this.isHotspot=t.isHotspot},url:function(){},getProteinStartPos:function(){var t=this.get("proteinPosStart");return(null==t||0==t.length||"NA"==t||t<0)&&(t=this.getProteinChangeLocation()),t},getProteinChangeLocation:function(){var t=null,e=null,n=this.get("proteinChange");return null!=n&&(e=n.match(/[0-9]+/)),e&&e.length>0&&(t=e[0]),t},getCosmicCount:function(){if(this.get("cosmicCount"))return this.get("cosmicCount");if(this.get("cosmic")){var t=this.calcCosmicCount(this.get("cosmic"));return this.set({cosmicCount:t}),t}return null},calcCosmicCount:function(t){var e=0;return t&&t.forEach(function(t){e+=t[2]}),e}});t.exports=r},function(t,e,n){var i=n(5),r=function(t){var e="germline",n="valid",r={},o={},a={},s={},l={},u={},c=[];this.getMutationGeneMap=function(){return r},this.getMutationCaseMap=function(){return o},this.getMutationIdMap=function(){return a},this.getProteinChangeMap=function(){return l},this.getMutations=function(){return c},this.processMutationData=function(t){r=this._updateGeneMap(t),o=this._updateCaseMap(t),a=this._updateIdMap(t),s=this._updateKeywordMap(t),l=this._updateProteinChangeMap(t),u=this._updateProteinPosStartMap(t),c=c.concat(t.models)},this.getProteinPositions=function(t){var e=r[t],n=[];if(null!=e)for(var i=0;i<e.length;i++){var o={id:e[i].get("mutationId"),start:e[i].getProteinStartPos(),end:e[i].get("proteinPosEnd")};n.push(o)}return n},this.getAllKeywords=function(){return i.keys(s)},this.getAllProteinChanges=function(){return i.keys(l)},this.getAllProteinPosStarts=function(){return i.keys(u)},this.getAllGenes=function(){return i.keys(r)},this._updateGeneMap=function(t){for(var e=r,n=0;n<t.length;n++){var i=t.at(n).get("geneSymbol");null!=i&&(i=i.toUpperCase(),void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateCaseMap=function(t){for(var e=o,n=0;n<t.length;n++){var i=t.at(n).get("caseId");null!=i&&(i=i.toLowerCase(),void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateIdMap=function(t){for(var e=a,n=0;n<t.length;n++){var i=t.at(n).get("mutationId");e[i]=t.at(n)}return e},this._updateKeywordMap=function(t){for(var e=s,n=0;n<t.length;n++){var i=t.at(n).get("keyword");null!=i&&(void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateProteinChangeMap=function(t){for(var e=l,n=0;n<t.length;n++){var i=t.at(n).get("proteinChange");null!=i&&(void 0==e[i]&&(e[i]=[]),e[i].push(t.at(n)))}return e},this._updateProteinPosStartMap=function(t){for(var e=u,n=0;n<t.length;n++){var i=t.at(n).get("geneSymbol"),r=t.at(n).get("proteinPosStart");if(null!=r&&null!=i){var o=i+"_"+r;void 0==e[o]&&(e[o]=[]),e[o].push(t.at(n))}}return e},this.generateSummary=function(t){var e,n="[",i=t.numCases;return t.numGermline>0&&(void 0!==t.numGermlineCases&&t.numGermlineCases>0&&(i=t.numGermlineCases),e=t.numGermline/i*100,n+="Germline Mutation Rate: "+e.toFixed(1)+"%, "),e=t.numSomatic/t.numCases*100,n+="Somatic Mutation Rate: "+e.toFixed(1)+"%]"},this.countMutations=function(t,n){for(var i=n.length,r=0,a=0,s=0,l=0;l<n.length;l++){var u=o[n[l].toLowerCase()];if(null!=u){for(var c=0,d=0,p=0;p<u.length;p++)u[p].get("geneSymbol").toLowerCase()==t.toLowerCase()&&(u[p].get("mutationStatus")&&u[p].get("mutationStatus").toLowerCase()===e?d=1:c=1);a+=c,s+=d,r++}}return{numCases:i,numMutated:r,numSomatic:a,numGermline:s}},this.cancerStudyAllTheSame=function(t){t=t.toUpperCase();var e=r[t];if(null!=e)for(var n=null,i=0;i<e.length;i++){var o=e[i].get("cancerStudy");if(null==n)n=o;else if(n!=o)return!1}return!0},this._contains=function(t,e){var n=!1;t=t.toUpperCase();var i=r[t];if(null!=i)for(var o=0;o<i.length&&!(n=e(i[o]));o++);return n},this.containsGermline=function(t){return this._contains(t,function(t){return t.get("mutationStatus")&&t.get("mutationStatus").toLowerCase()==e})},this.containsValidStatus=function(t){return this._contains(t,function(t){return t.get("validationStatus")&&t.get("validationStatus").toLowerCase()==n})},this.containsIgvLink=function(t){return this._contains(t,function(t){return t.get("igvLink")&&"NA"!=t.get("igvLink")})},this.containsAlleleFreqT=function(t){return this._contains(t,function(t){return t.get("tumorFreq")&&"NA"!=t.get("tumorFreq")})},this.containsCnaData=function(t){return this._contains(t,function(t){return t.get("cna")&&"NA"!=t.get("cna")&&"unknown"!=t.get("cna")})},this.containsProteinChange=function(t){return this._contains(t,function(t){return t.get("proteinChange")&&"NA"!=t.get("proteinChange")&&"unknown"!=t.get("proteinChange")})},this.containsCaseId=function(t){return this._contains(t,function(t){return t.get("caseId")&&"NA"!=t.get("caseId")})},this.containsChr=function(t){return this._contains(t,function(t){return t.get("chr")&&"NA"!=t.get("chr")})},this.containsStartPos=function(t){return this._contains(t,function(t){return t.get("startPos")&&t.get("startPos")>0})},this.containsRefAllele=function(t){return this._contains(t,function(t){return t.get("referenceAllele")&&"NA"!=t.get("referenceAllele")})},this.containsVarAllele=function(t){return this._contains(t,function(t){return t.get("variantAllele")&&"NA"!=t.get("variantAllele")})},this.containsEndPos=function(t){return this._contains(t,function(t){return t.get("endPos")&&t.get("endPos")>0})},this.containsFis=function(t){return this._contains(t,function(t){return t.get("functionalImpactScore")&&"NA"!=t.get("functionalImpactScore")})},this.containsCosmic=function(t){return this._contains(t,function(t){return t.get("cosmic")&&t.getCosmicCount()&&t.getCosmicCount()>0})},this.containsMutationType=function(t){return this._contains(t,function(t){return t.get("mutationType")&&"NA"!=t.get("mutationType")})},this.containsMutationCount=function(t){return this._contains(t,function(t){return t.get("mutationCount")&&t.get("mutationCount")>0})},this.containsKeyword=function(t){return this._contains(t,function(t){return t.get("keyword")&&"NA"!=t.get("keyword")})},this.containsMutationEventId=function(t){return this._contains(t,function(t){return t.get("mutationEventId")&&"NA"!=t.get("mutationEventId")})},this.distinctTumorTypeCount=function(t){t=t.toUpperCase();var e=r[t],n={};if(null!=e)for(var o=0;o<e.length;o++)e[o].get("tumorType")&&(n[e[o].get("tumorType")]=!0);return i.keys(n).length},this.dataFieldCount=function(t,e,n){t=t.toUpperCase();var o=r[t],a={};if(null!=o)for(var s=0;s<o.length;s++){var l=o[s].get(e);l&&!i.contains(n,l)&&(void 0===a[l]&&(a[l]=0),a[l]++)}var u=i.pairs(a);u.sort(function(t,e){return e[1]-t[1]});var c=[];return i.each(u,function(t,n){var i={count:t[1]};i[e]=t[0],c.push(i)}),c},null!=t&&this.processMutationData(t)};t.exports=r},function(t,e,n){function i(t){function e(t){u=t.data}function n(t,e){function n(){if(!r||0===s.size(o))return void e(null);var t={study_id:r,attribute_ids:["12_245_PARTC_CONSENTED"],patient_ids:o},n=[];for(var a in t)t.hasOwnProperty(a)&&n.push(a+"="+[].concat(t[a]).join(","));var u=n.join("&")||"?",c={type:"POST",url:l.servletName+"/"+l.subService.patients,data:u,dataType:"json",success:function(t){e(t)},error:function(t){e(null)}};i.requestData(c)}var r,o=[],a=null;try{a=window.QuerySession}catch(t){}a?(r=a.cancer_study_ids[0],a.getPatientSampleIdMap().then(function(e){for(var i=0;i<t.length;i++)o.push(e[t[i]]);n()})):(r=window.cancer_study_id,n())}var i=this,o={servletName:"api-legacy/clinicaldata",subService:{patients:"patients"}},l=a.extend(!0,{},o,t);r.call(this,l),l=i._options;var u={};i.fullInit=e,i.getPatientData=n}var r=n(109),o=n(7),a=o,s=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){function e(t){var e=t.data;l.each(l.keys(e.pdbData),function(t){var n=o.processPdbData(e.pdbData[t]);v[t]=n,_[t]=o.allocateChainRows(n)}),y=e.infoData,b=e.summaryData,x=e.positionData}function n(t,e,n){var r=e.alignments,o=i(t,e);if(h.isFullInit()||null!=x[o])return void n(x[o]||{});var a=g.getProteinPositions(t),s={};l.each(a,function(t,n){t.start>-1&&t.start>=e.mergedAlignment.uniprotFrom&&t.start<=e.mergedAlignment.uniprotTo&&(s[t.start]=t.start),t.end>t.start&&t.end>=e.mergedAlignment.uniprotFrom&&t.end<=e.mergedAlignment.uniprotTo&&(s[t.end]=t.end)});var u=l.values(s),c=[];r.each(function(t,e){c.push(t.alignmentId)});var d=function(e){var i={},r=g.getMutationGeneMap()[t],a=e.positionMap||e;if(null!=a&&l.size(a)>0)for(var s=0;s<r.length;s++){var u=a[r[s].getProteinStartPos()];l.isArray(u)&&l.size(u)>0&&(u=u[0]);var c=u,d=r[s].get("mutationType");null!=d&&"in_frame_del"===d.toLowerCase()&&(c=a[r[s].get("proteinPosEnd")]||c,l.isArray(c)&&l.size(c)>0&&(c=c[0])),null!=u&&null!=c&&(i[r[s].get("mutationId")]={start:u,end:c})}o&&(x[o]=i),n(i)};if(u.length>0){var p=m.servletName;m.subService&&m.subService.map&&(p=p+"/"+m.subService.map);var f={type:"POST",url:p,data:{positions:u.join(m.listJoiner),alignments:c.join(m.listJoiner)},success:d,dataType:"json"};h.requestData(f)}else n({})}function i(t,e){var n=null;return e.alignments.length>0&&(n=t+"_"+e.alignments.at(0).pdbId+"_"+e.chainId),n}function a(t,e){if(h.isFullInit())return void e(v[t]);if(void 0==v[t]){var n=function(n){var i=o.processPdbData(n);v[t]=i,e(i)},i=m.servletName;m.subService&&m.subService.alignmentByUniprot&&(i=i+"/"+m.subService.alignmentByUniprot);var r={type:"POST",url:i,data:{uniprotId:t,uniprotIds:t},success:n,dataType:"json"};h.requestData(r)}else e(v[t])}function u(t,e){h.isFullInit()||void 0!=_[t]?e(_[t]):a(t,function(n){var i=o.allocateChainRows(n);_[t]=i,e(i)})}function c(t,e){if(h.isFullInit()||void 0!=b[t])e(b[t]);else{var n=function(n){var i=n;l.isArray(i)&&l.size(i)>0&&(i=i[0]),b[t]=i,e(i)},i=m.servletName;m.subService&&m.subService.summary&&(i=i+"/"+m.subService.summary);var r={type:"POST",url:i,data:{uniprotId:t,uniprotIds:t,type:"summary"},success:n,dataType:"json"};h.requestData(r)}}function d(t,e){var n=function(t){var n=t&&t.alignmentCount>0;e(n)};c(t,n)}function p(t,e){var n=t.trim().split(/\s+/),i=[],r={};if(l.each(n,function(t,e){var n=y[t];void 0==n||0==n.length?i.push(t):r[t]=n}),h.isFullInit())return void e(r);var o={};if(i.length>0){var a=function(t){var i=t;l.isArray(t)&&(i=l.indexBy(t,"pdbId")),l.each(n,function(t,e){null!=i[t]&&(y[t]=i[t],r[t]=i[t])}),e(r)};o.pdbIds=i.join(m.listJoiner);var s=m.servletName;m.subService&&m.subService.header&&(s=s+"/"+m.subService.header);var u={type:"POST",url:s,data:o,success:a,dataType:"json"};h.requestData(u)}else e(r)}var h=this,f={servletName:"pdb_annotation",subService:{alignmentByPdb:"alignment/byPdb",alignmentByUniprot:"alignment/byUniprot",header:"header",map:"map",summary:"summary"},listJoiner:",",mutationUtil:{}},m=s.extend(!0,{},f,t);r.call(this,m),m=h._options;var g=m.mutationUtil,v={},_={},y={},b={},x={};h.fullInit=e,h.hasPdbData=d,h.getPdbData=a,h.getPdbRowData=u,h.getPdbInfo=p,h.getPositionMap=n}var r=n(109),o=n(10),a=n(7),s=a,l=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){function e(t){var e=t.data;h=e.byKeyword,f=e.byProteinChange,g=e.byGeneSymbol,m=e.byProteinPosition}function n(t,e,n){var r=t.cmd,o=t.q;if(null==r)n(null);else if("byKeywords"==r){var a=null==o?e.getAllKeywords():o.split(",");i(r,a,h,["keyword"],n)}else if("byHugos"==r){var s=null==o?e.getAllGenes():o.split(",");i(r,s,g,["hugo"],n)}else if("byProteinChanges"==r){var l=null==o?e.getAllProteinChanges():o.split(",");i(r,l,f,["protein_change"],n)}else if("byProteinPos"==r){var u=null==o?e.getAllProteinPosStarts():o.split(",");i(r,u,m,["hugo","protein_pos_start"],n)}else n(null)}function i(t,e,n,i,r){var a=l(e,n),s=u(a);if(s.length>0&&!c.isFullInit()){var d={type:"POST",url:p.servletName,data:{cmd:t,q:s.join(",")},success:function(t){o(t,a,n,i,r)},dataType:"json"};c.requestData(d)}else o([],a,n,i,r)}function o(t,e,n,i,r){s.each(t,function(t,r){var o=[];s.each(i,function(e,n){o.push(t[e])});var a=o.join("_");null==n[a]&&(n[a]=[]),null==e[a]&&(e[a]=[]),n[a].push(t),e[a].push(t)});var o=[];s.each(e,function(t){o=o.concat(t)}),r(o)}function l(t,e){var n={};return s.each(t,function(t){n[t]=e[t]}),n}function u(t){var e=[];return s.each(s.keys(t),function(n){null==t[n]&&e.push(n)}),e}var c=this,d={servletName:"pancancerMutations.json"},p=a.extend(!0,{},d,t);r.call(this,p),p=c._options;var h={},f={},m={},g={};c.fullInit=e,c.getPancanData=n}var r=n(109),o=n(7),a=o,s=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){function e(t){l=t.data}function n(t,e){var n=t.pfamAccession;if(null==n)return void e(null);if(void 0==l[n]){if(i.isFullInit())return void e(null);var r=function(t){l[n]=t,e(t)},o={type:"POST",url:s.servletName,data:t,success:r,dataType:"json"};i.requestData(o)}else e(l[n])}var i=this,o={servletName:"getMutationAligner.json"},s=a.extend(!0,{},o,t);r.call(this,s),s=i._options;var l={};i.fullInit=e,i.getMutationAlignerData=n}var r=n(109),o=n(7),a=o;i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t){function e(t){u=t.data}function n(t,e){var n={},r={};s.each(s.keys(t),function(e,i){null==u[e]?r[e]=t[e]:n[e]=u[e]});var o=function(t){s.each(s.keys(t),function(e,n){u[e]=t[e]}),s.isFunction(e)&&e(a.extend(!0,{},n,t))};if(s.isEmpty(r))o(n);else{var c={type:"POST",url:l.servletName,data:r,success:o,dataType:"json"};i.requestData(c)}}var i=this,o={servletName:"portalMetadata.json"},l=a.extend(!0,{},o,t);r.call(this,l),l=i._options;var u={};i.fullInit=e,i.getPortalData=n}var r=n(109),o=n(7),a=o,s=n(5);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(t,e,n,i){function _(){t.dispatcher.on(r.GENE_TAB_SELECTED,b),t.dispatcher.on(r.GENE_TABS_CREATED,x),t.dispatcher.on(r.VIS_3D_PANEL_INIT,y)}function y(t){var e=S.vis3d;if(e){var n={appOptions:{el:t||"#mutation_details"}},i=v.extend(!0,{},n,e),r=new d("default3dView",i);r.init(),w(r)}}function b(t){null==E[t]&&C(t,T,S)}function x(){t.$el.find(".mutation-3d-container").hide();var e=I.getGeneList();C(e[0],T,S)}function w(e){var n=t.$el.find(".mutation-3d-container");if(e){var i=new p({el:n,config:M.mutation3dVis,mut3dVis:e,pdbProxy:L,mutationProxy:I});i.render(),F=i,t.dispatcher.trigger(r.VIS_3D_PANEL_CREATED,i)}else g(n).hide()}function C(i,a,s){var l=function(l,u){var c=I.getMutationUtil(),d="";l&&(d=l.metadata.identifier);var p=new f;p.setData(u);var g={geneSymbol:i,mutationData:p,dataProxies:n,dataManager:e,uniprotId:d,sampleArray:a},v=new h({el:"#mutation_details_"+m.util.safeProperty(i),config:M.mainMutation,model:g});t.dispatcher.trigger(r.MAIN_VIEW_INIT,v),v.render(),new o(v),E[i].mainMutationView=v,e.addView(i,v),null==u||0==u.length?v.showNoDataInfo():A(v,i,c,l,s)};I.getMutationData(i,function(t){E[i]={},null==t&&(t=[]);var n=I.getMutationUtil().dataFieldCount(i,"uniprotAcc",["NA"]),r=null,o={geneSymbol:i};n.length>0&&(r=n[0].uniprotAcc),r&&(o.uniprotAcc=r),P.getPfamData(o,function(n){var i=null;null==n?console.log("[warning] no pfam data found: %o",o):i=n[0],e.getData("variantAnnotation",{mutations:t},function(t,e){l(i,t.mutations)})})})}function A(n,i,r,o,d){function p(){if(h&&o){b=n.initMutationDiagramView(h,o);var t=null;_&&(t=_.mutationTable);var e=null;g&&(e=n.initMutationInfoView(g),new s(n)),new l(n)}}var h=d.mutationDiagram,f=d.mutationTable,m=d.vis3d,g=d.infoPanel,v=d.mutationSummary,_=null;f&&(_=n.initMutationTableView(f),new a(n,t));var y=null;v&&(y=n.initSummaryView(f));var b=null;if(r.containsProteinChange(i)?p():e.getData("variantAnnotation",{mutations:n.model.mutationData},function(t,e){p()}),new u(n),m){var x=n.init3dView(null);D=new c(t,n,d,M,F,x,L,r,i),M.mutationDetails.activate3dOnInit&&D.reset3dView(M.mutationDetails.activate3dOnInit.pdbId,M.mutationDetails.activate3dOnInit.chain)}}var T=i.data.sampleList,S=i.view,M=i.render,I=n.mutationProxy,P=n.pfamProxy,L=n.pdbProxy,E={},F=null,D=null;_(),this.getMainView=function(t){return E[t]},this.get3dController=function(){return D},this.get3dVisView=function(){return F},this.getMainViews=function(){return E},this.getDataManager=function(){return e},this.getDataProxies=function(){return n}}var r=n(22),o=n(121),a=n(122),s=n(123),l=n(124),u=n(126),c=n(127),d=n(131),p=n(138),h=n(146),f=n(181),m={util:n(6)},g=n(7),v=g;t.exports=i},function(t,e,n){function i(t){function e(){t.diagramView?s(t.diagramView.mutationDiagram):t.dispatcher.on(r.DIAGRAM_INIT,s),t.tableView?i(t.tableView.mutationTable):t.dispatcher.on(r.MUTATION_TABLE_INITIALIZED,i),t.infoView?n(t.infoView):t.dispatcher.on(r.INFO_PANEL_INIT,n)}function n(t){t&&t.dispatcher.on(r.INFO_PANEL_MUTATION_TYPE_SELECTED,p)}function i(t){y=t,t.dispatcher.on(r.MUTATION_TABLE_FILTERED,m),t.dispatcher.on(r.PDB_LINK_CLICKED,v),t.dispatcher.on(r.PROTEIN_CHANGE_LINK_CLICKED,g)}function s(t){_=t,t.dispatcher.on(r.ALL_LOLLIPOPS_DESELECTED,l),
t.dispatcher.on(r.LOLLIPOP_SINGLE_SELECT,u),t.dispatcher.on(r.LOLLIPOP_MULTI_SELECT,c),t.dispatcher.on(r.LOLLIPOP_MOUSEOVER,h),t.dispatcher.on(r.LOLLIPOP_MOUSEOUT,f)}function l(){a.size(b.getState().selected)>0&&b.unSelectMutations(),a.size(b.getState().highlighted)>0&&b.unHighlightMutations()}function u(t,e){d(t,e,!1)}function c(t,e){d(t,e,!0)}function d(t,e,n){var i=[],r=a.size(a.intersection(b.getState().selected,t.mutations))===a.size(t.mutations);n?r?(b.unSelectMutations(t.mutations),b.unHighlightMutations(t.mutations)):b.selectMutations(t.mutations):r?l():(i=i.concat(t.mutations),b.updateSelectedMutations(i))}function p(e){var n=t.infoView.currentMapByType[e];0===a.size(n)&&(n=t.infoView.initialMapByType[e]),b.updateFilteredMutations(n)}function h(t,e){b.updateHighlightedMutations(t.mutations)}function f(t,e){b.unHighlightMutations()}function m(e){var n=[],i=[];try{i=o(e).DataTable().rows({filter:"applied"}).data()}catch(t){i=o(e).dataTable()._("tr",{filter:"applied"})}a.each(i,function(t,e){var i=t[0].mutation;i&&n.push(i)}),b.updateFilteredMutations(n,{view:t.tableView})}function g(t){var e=b.getDataUtil().getMutationIdMap(),n=e[t];n?b.updateHighlightedMutations([n]):b.unHighlightMutations()}function v(t){g(t)}var _=null,y=null,b=t.model.mutationData;e()}var r=n(22),o=n(7),a=n(5);t.exports=i},function(t,e,n){function i(t,e){function n(){e.dispatcher.on(r.GENE_TAB_SELECTED,u);var n=o(t.model.mutationData.dispatcher);n.on(r.MUTATION_FILTER,l),n.on(r.MUTATION_HIGHLIGHT,s),n.on(r.MUTATION_SELECT,i)}function i(e,n){var i=n.mutationData;if(t.tableView){t.tableView.clearHighlights();var r=i.getState().selected,o=i.getState().filtered;a.isEmpty(r)?a.isEmpty(o)||t.tableView.filter(o):t.tableView.filter(r)}}function s(e,n){var i=n.mutationData;if(t.tableView){t.tableView.clearHighlights();var r=i.getState().highlighted;a.isEmpty(r)||t.tableView.highlight(r)}}function l(e,n){var r=n&&n.view&&n.view!==t.tableView||n&&!n.view||!n;r&&i(e,n)}function u(e){if(t.tableView){var n=t.tableView.mutationTable.getDataTable();n.is(":visible")&&n.fnAdjustColumnSizing()}}n()}var r=n(22),o=n(7),a=n(5);t.exports=i},function(t,e,n){function i(t){function e(){var e=o(t.model.mutationData.dispatcher);e.on(r.MUTATION_FILTER,s),e.on(r.MUTATION_HIGHLIGHT,i),e.on(r.MUTATION_SELECT,n)}function n(e,n){var i=n.mutationData;if(t.infoView){var r=i.getState().selected,o=i.getState().filtered;a.isEmpty(r)?a.isEmpty(o)?t.infoView.updateView([]):t.infoView.updateView(o):t.infoView.updateView(r)}}function i(t,e){}function s(t,e){n(t,e)}e()}var r=n(22),o=n(7),a=n(5);t.exports=i},function(t,e,n){function i(t){function e(){var e=a(t.model.mutationData.dispatcher);e.on(o.MUTATION_FILTER,l),e.on(o.MUTATION_HIGHLIGHT,i),e.on(o.MUTATION_SELECT,n)}function n(e,n){var i=n.mutationData;if(t.diagramView){var r=t.diagramView.mutationDiagram,o=i.getState().selected,a=i.getState().highlighted;r.clearHighlights(),s.each(s.union(o,a),function(t){r.highlightMutation(t.get("mutationSid"))})}}function i(t,e){n(t,e)}function l(e,n){var i=n.mutationData;if(t.diagramView){var o=i.getState().filtered;t.diagramView.mutationDiagram.updatePlot(r.convertToCollection(o))}}e()}var r=n(125),o=n(22),a=n(7),s=n(5);t.exports=i},function(t,e,n){var i=n(112),r=function(){function t(t){var e=new(i.extend({model:function(t,e){return t}}));return e.add(t),e}return{convertToCollection:t}}();t.exports=r},function(t,e,n){function i(t){function e(){t.addResetCallback(l);var e=o(t.model.mutationData.dispatcher);e.on(r.MUTATION_FILTER,s),e.on(r.MUTATION_HIGHLIGHT,i),e.on(r.MUTATION_SELECT,n)}function n(e,n){var i=n.mutationData,r=i.getState().selected,o=i.getState().filtered,s=i.getData();a.isEmpty(r)&&a.size(s)===a.size(o)?t.hideFilterInfo():t.showFilterInfo()}function i(t,e){}function s(t,e){n(t,e)}function l(e){t.model.mutationData.unHighlightMutations(),t.model.mutationData.unSelectMutations(),t.model.mutationData.unfilterMutations()}e()}var r=n(22),o=n(7),a=n(5);t.exports=i},function(t,e,n){function i(t,e,n,i,u,c,d,p,h){function f(){e.diagramView&&e.diagramView.mutationDiagram?B=e.diagramView.mutationDiagram:e.dispatcher.on(r.DIAGRAM_INIT,function(t){B=t}),e.tableView&&e.tableView.mutationTable&&e.tableView.mutationTable.dispatcher.on(r.PDB_LINK_CLICKED,F),c.addInitCallback(x),t.dispatcher.on(r.GENE_TAB_SELECTED,y),u?_(u):t.dispatcher.on(r.VIS_3D_PANEL_CREATED,_);var n=s(e.model.mutationData.dispatcher);n.on(r.MUTATION_FILTER,v),n.on(r.MUTATION_HIGHLIGHT,g),n.on(r.MUTATION_SELECT,m)}function m(t,e,n){var i=e.mutationData;if(j&&j.isVisible()){var r=i.getState().selected,s=i.getState().highlighted,u=l.union(r,s);if(l.isEmpty(u))j.resetHighlight(),j.hideResidueWarning();else{var c=o.convertToPileups(a.convertToCollection(u));z(c,n)}}}function g(t,e){m(t,e,!0)}function v(t,e){j&&j.isVisible()&&j.refreshView()}function _(t){t&&(j=t,R=t.options.mut3dVis,j.dispatcher.on(r.VIEW_3D_PANEL_CLOSED,b),j.dispatcher.on(r.VIEW_3D_STRUCTURE_RELOADED,T))}function y(t){j&&(j.resetPanelPosition(),j.hideView())}function b(){O&&O.hideView()}function x(t){k(),null!=j&&(j.resetPanelPosition(),j.maximizeView())}function w(t,e,n){t>n&&O.toggleScrollBar(n)}function C(t,e,n){t<=n&&O.toggleScrollBar(-1),e!=t&&O.scrollToSelected()}function A(t){U&&O.scrollToSelected();var e=t.datum();null!=j&&(j.maximizeView(),j.updateView(h,e.pdbId,e.chain)),U||null==N||(N.resetFilters(),N.selectChain(e.pdbId,e.chain.chainId),N.scrollToSelected()),U=!1}function T(){var t=e.model.mutationData;l.isEmpty(t.getState().selected)&&l.isEmpty(t.getState().highlighted)||D()}function S(t,e){t&&e&&(O.selectChain(t,e),U=!0)}function M(){O.pdbPanel.minimizeToHighlighted()}function I(t,e){t&&e&&O.pdbPanel.minimizeToChain(O.pdbPanel.getChainGroup(t,e))}function P(t){null==O&&(O=e.initPdbPanelView(i.pdbPanel,n.pdbPanel,n.pdbTable,t),O.pdbPanel&&(O.pdbPanel.dispatcher.on(r.PANEL_CHAIN_SELECTED,A),O.pdbPanel.dispatcher.on(r.PDB_PANEL_RESIZE_STARTED,w),O.pdbPanel.dispatcher.on(r.PDB_PANEL_RESIZE_ENDED,C)),n.pdbTable?O.addInitCallback(function(e){L(t)}):O.$el.find(".pdb-table-controls").remove())}function L(t){null==N&&null!=O&&t.length>0&&(N=O.initPdbTableView(t,function(t,e){e.dispatcher.on(r.PDB_TABLE_READY,E),N=t}),N.pdbTable.dispatcher.on(r.TABLE_CHAIN_SELECTED,S),N.pdbTable.dispatcher.on(r.TABLE_CHAIN_MOUSEOUT,M),N.pdbTable.dispatcher.on(r.TABLE_CHAIN_MOUSEOVER,I)),null!=O&&null!=N&&(O.toggleTableControls(),N.toggleView())}function E(){if(null!=O){var t=O.getSelectedChain();if(null!=t){var e=t.datum();N.selectChain(e.pdbId,e.chain.chainId),N.scrollToSelected()}}}function F(t){var e=p.getMutationIdMap(),n=e[t];n&&k(n.get("pdbMatch").pdbId,n.get("pdbMatch").chainId)}function D(){m(null,{mutationData:e.model.mutationData})}function z(t,e){var n=j.highlightView(t,!0),i=t.length-n;e||(i>0?j.showResidueWarning(i,t.length):j.hideResidueWarning())}function k(e,n){var i=c.model.uniprotId;t.is3dPanelInitialized()||t.init3dPanel();var r=function(t){null==O&&P(t),null!=j&&null!=O&&t.length>0&&(V(),O.showView(),e&&n?O.selectChain(e,n):O.selectDefaultChain(),O.autoCollapse())};null!=c&&null!=j&&(j.showMainLoader(),j.showView()),d.getPdbData(i,r)}function V(){if(B){var t=function(t,e,n){return B.mutationColorMap[t]};R.updateOptions({mutationColorMapper:t})}}var O=null,N=null,j=null,R=null,B=null,U=!1;f(),this.reset3dView=k,this.highlightSelected=D}var r=n(22),o=n(128),a=n(125),s=n(7),l=n(5);t.exports=i},function(t,e,n){var i=n(129),r=n(130),o={util:n(6)},a=n(5),s=function(){function t(t){var e=t.mutations,n={};return a.each(e,function(t){var e=t.get("mutationType")||"";e=e.trim().toLowerCase(),void 0==n[e]&&(n[e]=[]),n[e].push(t)}),n}function e(e){var n=t(e),i=[];return a.each(a.keys(n),function(t){i.push({type:t,count:n[t].length})}),i.sort(function(t,e){return e.count-t.count}),i}function n(e){var n=i.getVisualStyleMaps().mutationType,r=t(e),o=[],s={};return a.each(a.keys(r),function(t){var e=void 0;null!=n[t]&&(e=n[t].mainType),void 0==e&&(e=n.other.mainType),void 0==s[e]&&(s[e]=0),s[e]+=r[t].length}),a.each(a.keys(s),function(t){o.push({type:t,count:s[t],priority:n[t].priority})}),o.sort(function(t,e){return e.count===t.count?e.priority-t.priority:e.count-t.count}),o}function l(){return g++,"pileup_"+g}function u(t){var e={};return a.each(t,function(t){a.each(t.mutations,function(n){e[n.get("mutationSid")]=t.pileupId})}),e}function c(t,e){t=p(t);for(var n={},i=0;i<t.length;i++){var o=t.at(i),s=o.getProteinStartPos(),l=o.get("mutationType")||"";l=l.trim().toLowerCase(),null!=s&&"fusion"!=l&&(null==n[s]&&(n[s]=[]),n[s].push(o))}var u=[];return a.each(a.keys(n),function(t){var i={};i=a.isFunction(e)?e(n,t):d(n,t),u.push(new r(i))}),u.sort(function(t,e){var n=e.count-t.count;return 0==n&&(n=e.location-t.location),n}),u}function d(t,e){var n={};return n.pileupId=s.nextId(),n.mutations=t[e],n.count=t[e].length,n.location=parseInt(e),n.label=h(t[e]),n.stats=a.chain(t[e]).groupBy(function(t){return t.get("cancerType")}).sortBy(function(t){return-t.length}).reduce(function(t,e){return t.push({cancerType:e[0].get("cancerType"),count:e.length}),t},[]).value(),n}function p(t){for(var e={},n=[],i=0;i<t.length;i++){var r=t.at(i),o=e[r.get("mutationSid")];null==o?e[r.get("mutationSid")]=!0:n.push(r)}return t.remove(n),t}function h(t){var e={};a.each(t,function(t){null!=t.get("proteinChange")&&t.get("proteinChange").length>0&&(e[t.get("proteinChange")]=t.get("proteinChange"))});var n=a.keys(e).sort(),i="";n.length>1&&(i=o.util.lcss(n[0],n[n.length-1]));var r=i;return a.each(n,function(t){r+=t.substring(i.length)+"/"}),r.substring(0,r.length-1)}function f(t){var e=0;return a.each(t,function(t){e+=t.count}),e}function m(t){var e=[];return a.each(t,function(t){e=e.concat(t.get("mutations")||[])}),e}var g=0;return{nextId:l,mapToMutations:u,convertToPileups:c,initPileup:d,countMutations:f,getPileupMutations:m,getMutationTypeMap:t,groupMutationsByType:e,groupMutationsByMainType:n}}();t.exports=s},function(t,e,n){var i=n(23),r=n(85),o=n(7),a=n(5),s=function(){function t(){return{mutationType:u,validationStatus:c,mutationStatus:d,omaScore:p,cna:h}}function e(){return{content:{attr:"alt"},show:{event:"mouseover"},hide:{fixed:!0,delay:100,event:"mouseout"},style:{classes:"mutation-details-tooltip qtip-shadow qtip-light qtip-rounded"},position:{my:"top left",at:"bottom right",viewport:o(window)}}}function n(t){t=t||r;var e={loaderImage:t,width:15,height:15},n=i.getTemplateFn("mutation_table_placeholder_template");return n(e)}function s(t,e,n){var i=t.fnGetData();a.each(i,function(i,r){t.fnUpdate(null,r,e[n],!1,!1)}),i.length>0&&t.fnUpdate(null,0,e[n])}var l={missense:{label:"Missense",longName:"Missense",style:"missense_mutation",mainType:"missense",priority:1},inframe:{label:"IF",longName:"In-frame",style:"inframe_mutation",mainType:"inframe",priority:2},truncating:{label:"Truncating",longName:"Truncating",style:"trunc_mutation",mainType:"truncating",priority:4},nonsense:{label:"Nonsense",longName:"Nonsense",style:"trunc_mutation",mainType:"truncating",priority:6},nonstop:{label:"Nonstop",longName:"Nonstop",style:"trunc_mutation",mainType:"truncating",priority:7},nonstart:{label:"Nonstart",longName:"Nonstart",style:"trunc_mutation",mainType:"truncating",priority:8},frameshift:{label:"FS",longName:"Frame Shift",style:"trunc_mutation",mainType:"truncating",priority:4},frame_shift_del:{label:"FS del",longName:"Frame Shift Deletion",style:"trunc_mutation",mainType:"truncating",priority:4},frame_shift_ins:{label:"FS ins",longName:"Frame Shift Insertion",style:"trunc_mutation",mainType:"truncating",priority:5},in_frame_ins:{label:"IF ins",longName:"In-frame Insertion",style:"inframe_mutation",mainType:"inframe",priority:3},in_frame_del:{label:"IF del",longName:"In-frame Deletion",style:"inframe_mutation",mainType:"inframe",priority:2},splice_site:{label:"Splice",longName:"Splice site",style:"trunc_mutation",mainType:"truncating",priority:9},fusion:{label:"Fusion",longName:"Fusion",style:"fusion",mainType:"other",priority:10},silent:{label:"Silent",longName:"Silent",style:"other_mutation",mainType:"other",priority:11},default:{label:"Other",longName:"Other",style:"other_mutation",mainType:"other",priority:11},other:{style:"other_mutation",mainType:"other",priority:11}},u={missense_mutation:l.missense,missense:l.missense,missense_variant:l.missense,frame_shift_ins:l.frame_shift_ins,frame_shift_del:l.frame_shift_del,frameshift:l.frameshift,frameshift_deletion:l.frame_shift_del,frameshift_insertion:l.frame_shift_ins,de_novo_start_outofframe:l.frameshift,frameshift_variant:l.frameshift,nonsense_mutation:l.nonsense,nonsense:l.nonsense,stopgain_snv:l.nonsense,stop_gained:l.nonsense,splice_site:l.splice_site,splice:l.splice_site,"splice site":l.splice_site,splicing:l.splice_site,splice_site_snp:l.splice_site,splice_site_del:l.splice_site,splice_site_indel:l.splice_site,splice_region_variant:l.splice_site,translation_start_site:l.nonstart,initiator_codon_variant:l.nonstart,start_codon_snp:l.nonstart,start_codon_del:l.nonstart,nonstop_mutation:l.nonstop,stop_lost:l.nonstop,in_frame_del:l.in_frame_del,in_frame_deletion:l.in_frame_del,in_frame_ins:l.in_frame_ins,in_frame_insertion:l.in_frame_ins,indel:l.in_frame_del,nonframeshift_deletion:l.inframe,nonframeshift:l.inframe,"nonframeshift insertion":l.inframe,nonframeshift_insertion:l.inframe,targeted_region:l.inframe,inframe:l.inframe,truncating:l.truncating,feature_truncation:l.truncating,fusion:l.fusion,silent:l.silent,synonymous_variant:l.silent,any:l.default,other:l.default},c={valid:{label:"V",style:"valid",tooltip:"Valid"},validated:{label:"V",style:"valid",tooltip:"Valid"},wildtype:{label:"W",style:"wildtype",tooltip:"Wildtype"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},not_tested:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},d={somatic:{label:"S",style:"somatic",tooltip:"Somatic"},germline:{label:"G",style:"germline",tooltip:"Germline"},unknown:{label:"U",style:"unknown",tooltip:"Unknown"},none:{label:"U",style:"unknown",tooltip:"Unknown"},na:{label:"U",style:"unknown",tooltip:"Unknown"}},p={h:{label:"High",style:"oma_high",tooltip:"High"},m:{label:"Medium",style:"oma_medium",tooltip:"Medium"},l:{label:"Low",style:"oma_low",tooltip:"Low"},n:{label:"Neutral",style:"oma_neutral",tooltip:"Neutral"}},h={"-2":{label:"DeepDel",style:"cna-homdel",tooltip:"Deep deletion"},"-1":{label:"ShallowDel",style:"cna-hetloss",tooltip:"Shallow deletion"},0:{label:"Diploid",style:"cna-diploid",tooltip:"Diploid / normal"},1:{label:"Gain",style:"cna-gain",tooltip:"Low-level gain"},2:{label:"AMP",style:"cna-amp",tooltip:"High-level amplification"},unknown:{label:"NA",style:"cna-unknown",tooltip:"CNA data is not available for this gene"}};return{renderTablePlaceHolder:n,refreshTableColumn:s,defaultTableTooltipOpts:e,getVisualStyleMaps:t}}();t.exports=s},function(t,e,n){var i=n(12),r=i.Model.extend({initialize:function(t){this.pileupId=t.pileupId,this.mutations=t.mutations,this.count=t.count,this.location=t.location,this.label=t.label,this.stats=t.stats}});t.exports=r},function(t,e,n){function i(t,e){function n(){R=new o,R.init(t,$.appOptions),X.setViewer(R.getViewer()),X.setPdbUri($.pdbUri)}function i(t){j=s(t);var e=j.find(".mutation-3d-vis-container");e.css("width",$.appOptions.width),e.css("height",$.appOptions.height+$.containerPadding),R.updateContainer(e)}function c(){W="ON"==W?"OFF":"ON";var t=X.spin(W);R.script(t)}function d(){var t=X.generateVisualStyleScript(U,G,$);t=t.concat(L(q)),t=t.join(" "),R.script(t)}function p(){null!=j&&j.show()}function h(){null!=j&&j.hide()}function f(){null!=j&&(j.css({overflow:"hidden",height:$.minimizedHeight}),B=!0)}function m(){null!=j&&(j.css({overflow:"",height:""}),B=!1)}function g(){null!=j&&(B?m():f())}function v(){var t=parseInt(j.css("top")),e=t==-9999||j.is(":hidden");return!e}function _(t,e,n){var i=[];if(q={},!t||!e)return i;G=e,H=t,i=b(t,e);var r=[],o=function(){r.push(a),r=r.concat(X.generateVisualStyleScript(U,G,$)),r=r.join(" "),R.script(r,n),A()},a=X.loadPdb(t,o);return"$3Dmol"!=a&&o(),i}function y(){var t=[];if(q={},null==H||null==G)return t;t=b(H,G);var e=[];return e=e.concat(X.generateVisualStyleScript(U,G,$)),e=e.join(" "),R.script(e),t}function b(t,e){var n=x(t,e,$,X);return U=n.colorMap,n.mappedMutations}function x(t,e,n,i){var r=[],o={},a=n.mutationColor;return u.each(u.keys(e.positionMap),function(s){var l=e.positionMap[s];if(u.isFunction(n.mutationColorMapper)&&(a=n.mutationColorMapper(s,t,e)),null!=a){null==o[a]&&(o[a]={});var c=i.scriptPosition(l);o[a][c]=c,r.push(s)}}),u.each(o,function(t,e,n){n[e]=u.values(t)}),{colorMap:o,mappedMutations:r}}function w(){if(1!=u.size(q))return!1;var t=[];return u.each(q,function(e){t=t.concat(E(e))}),t=t.join(" "),R.script(t),!0}function C(){var t=[];t.push(X.defaultCenter()),t=t.join(" "),R.script(t)}function A(){R.getViewer&&R.getViewer().resize()}function T(t){if(null==G)return!1;var e=t.mutations[0].get("mutationId"),n=F(e);return n.length>0?(n=n.join(" "),R.script(n),!0):(S(),!1)}function S(){var t=[];t.push(X.zoom($.defaultZoom)),t.push(X.defaultCenter()),t=t.join(" "),R.script(t)}function M(t,e){if(null==G)return 0;e&&(q={});var n=X.generateVisualStyleScript(U,G,$),i=0;return u.each(t,function(t,e){var n=t.mutations[0].get("mutationId"),r=G.positionMap[n];null!=r&&(q[n]=r,i++)}),n=n.concat(L(q)),n=n.join(" "),R.script(n),i}function I(){var t=L(q);t=t.join(" "),R.script(t)}function P(){q={};var t=X.generateVisualStyleScript(U,G,$);t=t.join(" "),R.script(t)}function L(t){return X.generateHighlightScript(t,$.highlightColor,$,G)}function E(t){var e=[];return e.push(X.center(t,G.chainId)),e}function F(t){var e=[],n=G.positionMap[t];return null!=n&&(e.push(X.zoom($.focusZoom)),e.push(X.center(n,G.chainId))),e}function D(){R.script(X.defaultZoomIn())}function z(){R.script(X.defaultZoomOut())}function k(){R.script(X.zoom($.defaultZoom))}function V(t){R.script(X.zoom(t))}function O(t){$=l.extend(!0,{},$,t)}function N(){var t=new a,e=[];return e.push(t.reinitialize()),e.push(t.bgColor($.appOptions.color)),e.push(t.loadPdb(H)),e=e.concat(t.generateVisualStyleScript(U,G,$)),e=e.concat(t.generateHighlightScript(q,$.highlightColor,$,G)),e.push(t.selectNone()),e=e.join("\n")}var j=null,R=null,B=!1,U=null,q={},G=null,H=null,W="OFF",Y={appOptions:{width:400,height:300,debug:!1,color:"white"},pdbUri:"http://www.rcsb.org/pdb/files/",frame:"jsmol_frame.html",proteinScheme:"cartoon",restrictProtein:!1,defaultColor:"#DDDDDD",structureColors:{alphaHelix:"#FFA500",betaSheet:"#0000FF",loop:"#DDDDDD"},defaultTranslucency:5,chainColor:"#888888",chainTranslucency:0,colorProteins:"uniform",colorMutations:"byMutationType",mutationColor:"#8A2BE2",highlightColor:"#FFDD00",highlightGradient:["#FFDD00","#000000"],addGlowEffect:!1,displaySideChain:"highlighted",defaultZoom:100,focusZoom:250,containerPadding:10,minimizedHeight:10,mutationColorMapper:function(t,e,n){return"#FF0000"}},$=l.extend(!0,{},Y,e),X=new r;return{init:n,show:p,hide:h,minimize:f,maximize:m,toggleSize:g,isVisible:v,reload:_,refresh:y,resizeViewer:A,focusOn:T,center:w,resetCenter:C,highlight:M,resetHighlight:P,refreshHighlight:I,zoomIn:D,zoomOut:z,zoomActual:k,zoomTo:V,resetFocus:S,updateContainer:i,toggleSpin:c,reapplyStyle:d,updateOptions:O,generatePymolScript:N}}var r=n(132),o=n(135),a=n(136),s=n(7),l=s,u=n(5);t.exports=i},function(t,e,n){function i(){function t(t,e){C.clear();var n={doAssembly:!0,pdbUri:w};return a.download("pdb:"+t,C,n,e),"$3Dmol"}function e(){return A={},""}function n(t){return T=o.extend({},M[t]),C.setStyle(A,T),""}function i(t){return S=v(t),o.each(T,function(t){t.color=S}),C.setStyle(A,T),""}function r(t){return A={chain:t},""}function s(t){return A={chain:t,ss:"h"},""}function l(t){return A={chain:t,ss:"s"},""}function u(t){for(var e=[],n=t.start.pdbPos||t.start.pdbPosition,i=t.end.pdbPos||t.end.pdbPosition,r=parseInt(n),o=parseInt(i),a=r;a<=o;a++)e.push(a);return t.start.insertion&&(e[0]+="^"+t.start.insertion),e.length>1&&t.end.insertion&&(e[e.length-1]+="^"+t.end.insertion),e}function c(t,e){return A={rescode:t,chain:e},""}function d(t,e){return A={rescode:t,chain:e},""}function p(t,e,n,i){var r=this,o=[""];r.selectPositions(t,i.chainId),r.setColor(e);var a="none"!=n.displaySideChain;return r.generateSideChainScript(t,a,n,i),o}function h(){var t=o.extend({},T,M.ballAndStick);return t.sphere.color=S,t.stick.color=S,C.setStyle(A,t),""}function f(){return""}function m(t){return A={chain:t},i("spectrum"),""}function g(t){return A={chain:t},o.each(T,function(t){delete t.color,t.colors=a.elementColors.defaultColors}),C.setStyle(A,T),""}function v(t){return t.replace("#","0x")}function _(t){C=t}function y(t){w=t}function b(){var t={resn:["asp","glu","arg","lys","his","asn","thr","cys","gln","tyr","ser","gly","ala","leu","val","ile","met","trp","phe","pro","ASP","GLU","ARG","LYS","HIS","ASN","THR","CYS","GLN","TYR","SER","GLY","ALA","LEU","VAL","ILE","MET","TRP","PHE","PRO"],invert:!0},e={sphere:{hidden:!0}};C.setStyle(t,e)}function x(t){o.each(T,function(e){e.opacity=(10-t)/10}),C.setStyle(A,T)}var w=null,C=null,A=null,T=null,S=null,M={ballAndStick:{stick:{},sphere:{scale:.25}},spaceFilling:{sphere:{scale:.6}},cartoon:{cartoon:{}},ribbon:{cartoon:{style:"ribbon"}},trace:{cartoon:{style:"trace"}}};this.setViewer=_,this.setPdbUri=y,this.loadPdb=t,this.selectAll=e,this.setScheme=n,this.setColor=i,this.selectChain=r,this.selectAlphaHelix=s,this.selectBetaSheet=l,this.scriptPosition=u,this.selectPositions=c,this.selectSideChains=d,this.highlightScript=p,this.rainbowColor=m,this.cpkColor=g,this.enableBallAndStick=h,this.disableBallAndStick=f,this.hideBoundMolecules=b,this.setTransparency=x}var r=n(133),o=n(5),a=n(134);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(){this.loadPdb=function(t){return""},this.selectAll=function(){return""},this.selectNone=function(){return""},this.setScheme=function(t){return""},this.setColor=function(t){return""},this.selectChain=function(t){return""},this.selectAlphaHelix=function(t){return""},this.selectBetaSheet=function(t){return""},this.rainbowColor=function(t){return""},this.cpkColor=function(t){return""},this.hideBoundMolecules=function(){return""},this.setTransparency=function(t){return""},this.scriptPosition=function(t){return""},this.selectPositions=function(t,e){return""},this.selectSideChains=function(t,e){return""},this.enableBallAndStick=function(){return""},this.disableBallAndStick=function(){return""},this.center=function(t,e){return""},this.zoom=function(t){return""},this.defaultZoomIn=function(){return""},this.defaultZoomOut=function(){return""},this.defaultCenter=function(){return""},this.spin=function(t){return""},this.highlightScript=function(t,e,n,i){return[]},this.generateVisualStyleScript=function(t,e,n){var i=this,o=[];return o.push(i.selectAll()),o.push(i.setScheme(n.proteinScheme)),o.push(i.setColor(n.defaultColor)),o.push(i.setTransparency(n.defaultTranslucency)),o.push(i.selectChain(e.chainId)),o.push(i.setColor(n.chainColor)),o.push(i.setTransparency(n.chainTranslucency)),o.push(i.selectChain(e.chainId)),"byAtomType"==n.colorProteins?o.push(i.cpkColor(e.chainId)):"bySecondaryStructure"==n.colorProteins?(o.push(i.selectAlphaHelix(e.chainId)),o.push(i.setColor(n.structureColors.alphaHelix)),o.push(i.selectBetaSheet(e.chainId)),o.push(i.setColor(n.structureColors.betaSheet))):"byChain"==n.colorProteins&&(o.push(i.selectChain(e.chainId)),o.push(i.rainbowColor(e.chainId))),r.each(r.keys(t),function(r){o.push(i.selectPositions(t[r],e.chainId)),"byMutationType"==n.colorMutations?o.push(i.setColor(r)):"uniform"==n.colorMutations&&o.push(i.setColor(n.mutationColor)),o=o.concat(i.generateSideChainScript(t[r],"all"==n.displaySideChain,n,e))}),n.restrictProtein&&o.push(i.hideBoundMolecules()),o},this.generateSideChainScript=function(t,e,n,i){var r=this,o=[];return"spaceFilling"!=n.proteinScheme&&(o.push(r.selectSideChains(t,i.chainId)),e?o.push(r.enableBallAndStick()):o.push(r.disableBallAndStick())),o},this.generateHighlightScript=function(t,e,n,i){var o=this,a=[];if(!r.isEmpty(t)){var s=o.highlightScriptPositions(t);a=a.concat(o.highlightScript(s,e,n,i))}return a},this.highlightScriptPositions=function(t){var e=this,n=[];return r.each(t,function(t){n.push(e.scriptPosition(t))}),n}}var r=n(5);t.exports=i},function(t,e,r){var o,o,s,l;(function(u){!function(t,n){n(e)}(this,function(t){"use strict";function e(t){function e(t){for(var e={},n=0;t>n;n++){var i=o();e[i]=o()}return e}function n(e){var n=t.subarray(a,a+e);return a+=e,n}function i(e){var n=t.subarray(a,a+e);a+=e;var i=65535;if(e>i){for(var r=[],o=0;o<n.length;o+=i)r.push(String.fromCharCode.apply(null,n.subarray(o,o+i)));return r.join("")}return String.fromCharCode.apply(null,n)}function r(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=o();return e}function o(){var o,l,u,c=t[a];if(0===(128&c))return a++,c;if(128===(240&c))return l=15&c,a++,e(l);if(144===(240&c))return l=15&c,a++,r(l);if(160===(224&c))return l=31&c,a++,i(l);if(224===(224&c))return o=s.getInt8(a),a++,o;switch(c){case 192:return a++,null;case 194:return a++,!1;case 195:return a++,!0;case 196:return l=s.getUint8(a+1),a+=2,n(l);case 197:return l=s.getUint16(a+1),a+=3,n(l);case 198:return l=s.getUint32(a+1),a+=5,n(l);case 199:return l=s.getUint8(a+1),u=s.getUint8(a+2),a+=3,[u,n(l)];case 200:return l=s.getUint16(a+1),u=s.getUint8(a+3),a+=4,[u,n(l)];case 201:return l=s.getUint32(a+1),u=s.getUint8(a+5),a+=6,[u,n(l)];case 202:return o=s.getFloat32(a+1),a+=5,o;case 203:return o=s.getFloat64(a+1),a+=9,o;case 204:return o=t[a+1],a+=2,o;case 205:return o=s.getUint16(a+1),a+=3,o;case 206:return o=s.getUint32(a+1),a+=5,o;case 207:return a+=9,0;case 208:return o=s.getInt8(a+1),a+=2,o;case 209:return o=s.getInt16(a+1),a+=3,o;case 210:return o=s.getInt32(a+1),a+=5,o;case 211:return a+=9,0;case 212:return u=s.getUint8(a+1),a+=2,[u,n(1)];case 213:return u=s.getUint8(a+1),a+=2,[u,n(2)];case 214:return u=s.getUint8(a+1),a+=2,[u,n(4)];case 215:return u=s.getUint8(a+1),a+=2,[u,n(8)];case 216:return u=s.getUint8(a+1),a+=2,[u,n(16)];case 217:return l=s.getUint8(a+1),a+=2,i(l);case 218:return l=s.getUint16(a+1),a+=3,i(l);case 219:return l=s.getUint32(a+1),a+=5,i(l);case 220:return l=s.getUint16(a+1),a+=3,r(l);case 221:return l=s.getUint32(a+1),a+=5,r(l);case 222:return l=s.getUint16(a+1),a+=3,e(l);case 223:return l=s.getUint32(a+1),a+=5,e(l)}throw new Error("Unknown type 0x"+c.toString(16))}var a=0,s=new DataView(t.buffer);return o()}function n(t){return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}function i(t){return new Int8Array(t.buffer,t.byteOffset,t.byteLength)}function r(t,e){var n,i,r,o=(t.byteOffset,t.byteLength);for(e||(e=new Int16Array(o/2)),n=0,i=0,r=o/2;r>n;++n,i+=2)e[n]=t[i]<<8^t[i+1]<<0;return e}function o(t,e){var n,i,r,o=(t.byteOffset,t.byteLength);for(e||(e=new Int32Array(o/4)),n=0,i=0,r=o/4;r>n;++n,i+=4)e[n]=t[i]<<24^t[i+1]<<16^t[i+2]<<8^t[i+3]<<0;return e}function a(t){return new Int32Array(t.buffer,t.byteOffset,t.byteLength/4)}function s(t,e,n){var i=t.length,r=1/e;n||(n=new Float32Array(i));for(var o=0;i>o;++o)n[o]=t[o]*r;return n}function l(t,e){var n,i;if(!e){var r=0;for(n=0,i=t.length;i>n;n+=2)r+=t[n+1];e=new t.constructor(r)}var o=0;for(n=0,i=t.length;i>n;n+=2)for(var a=t[n],s=t[n+1],l=0;s>l;++l)e[o]=a,o+=1;return e}function u(t){for(var e=1,n=t.length;n>e;++e)t[e]+=t[e-1];return t}function c(t,e,n){var i=t.length/2+e.length;n||(n=new Int32Array(i));for(var r=0,o=0,a=0,s=t.length;s>a;a+=2){var l=t[a],u=t[a+1];n[r]=l,0!==a&&(n[r]+=n[r-1]),r+=1;for(var c=0;u>c;++c)n[r]=n[r-1]+e[o],r+=1,o+=1}return n}function d(t,e,n,i){var l=t.length/4/2+e.length/2;i||(i=new Float32Array(l));var u=a(i),d=c(o(t),r(e),u);return s(d,n,i)}function p(t,e,n){var i=n?a(n):void 0,r=l(o(t),i);return s(r,e,n)}function h(t,e){function r(t){return!a||-1===a.indexOf(t)}e=e||{};var a=e.ignoreFields,s=(t.numBonds||0,t.numAtoms||0),c=t.groupTypeList.length/4,h=t.chainIdList.length/4,f=t.chainsPerModel.length,m={numGroups:c,numChains:h,numModels:f};["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","entityList","groupList","numBonds","numAtoms","groupsPerChain","chainsPerModel"].forEach(function(e){void 0!==t[e]&&(m[e]=t[e])});var g="bondAtomList";t[g]&&r(g)&&(m[g]=o(t[g]));var v="bondOrderList";t[v]&&r(v)&&(m[v]=n(t[v])),m.xCoordList=d(t.xCoordBig,t.xCoordSmall,1e3),m.yCoordList=d(t.yCoordBig,t.yCoordSmall,1e3),m.zCoordList=d(t.zCoordBig,t.zCoordSmall,1e3);var _="bFactorList",y="bFactorBig",b="bFactorSmall";t[y]&&t[b]&&r(_)&&(m[_]=d(t[y],t[b],100));var x="atomIdList";t[x]&&r(x)&&(m[x]=u(l(o(t[x]))));var w="altLocList";t[w]&&r(w)&&(m[w]=l(o(t[w]),new Uint8Array(s)));var C="occupancyList";t[C]&&r(C)&&(m[C]=p(t[C],100)),m.groupIdList=u(l(o(t.groupIdList))),m.groupTypeList=o(t.groupTypeList);var A="secStructList";t[A]&&r(A)&&(m[A]=i(t[A]));var T="insCodeList";t[T]&&r(T)&&(m[T]=l(o(t[T]),new Uint8Array(c)));var S="sequenceIndexList";t[S]&&r(S)&&(m[S]=u(l(o(t[S])))),m.chainIdList=n(t.chainIdList);var M="chainNameList";return t[M]&&r(M)&&(m[M]=n(t[M])),m}function f(t){return String.fromCharCode.apply(null,t).replace(/\0/g,"")}function m(t,e){var n,i,r,o,a=e.onModel,s=e.onChain,l=e.onGroup,u=e.onAtom,c=e.onBond,d=0,p=0,h=0,m=0,g=t.chainNameList,v=t.secStructList,_=t.insCodeList,y=t.sequenceIndexList,b=t.bFactorList,x=t.altLocList,w=t.occupancyList,C=t.bondAtomList,A=t.bondOrderList;if(t.chainsPerModel.forEach(function(e){for(a&&a({chainCount:e,modelIndex:d}),n=0;e>n;++n){var C=t.groupsPerChain[p];if(s){var A=f(t.chainIdList.subarray(4*p,4*p+4)),T=null;g&&(T=f(g.subarray(4*p,4*p+4))),s({groupCount:C,chainIndex:p,modelIndex:d,chainId:A,chainName:T})}for(i=0;C>i;++i){var S=t.groupList[t.groupTypeList[h]],M=S.atomNameList.length;if(l){var I=null;v&&(I=v[h]);var P=null;t.insCodeList&&(P=String.fromCharCode(_[h]));var L=null;y&&(L=y[h]),l({atomCount:M,groupIndex:h,chainIndex:p,modelIndex:d,groupId:t.groupIdList[h],groupType:t.groupTypeList[h],groupName:S.groupName,singleLetterCode:S.singleLetterCode,chemCompType:S.chemCompType,secStruct:I,insCode:P,sequenceIndex:L})}if(c){var E=S.bondAtomList;for(r=0,o=S.bondOrderList.length;o>r;++r)c({atomIndex1:m+E[2*r],atomIndex2:m+E[2*r+1],bondOrder:S.bondOrderList[r]})}for(r=0;M>r;++r){if(u){var F=null;b&&(F=b[m]);var D=null;x&&(D=String.fromCharCode(x[m]));var z=null;w&&(z=w[m]),u({atomIndex:m,groupIndex:h,chainIndex:p,modelIndex:d,atomId:t.atomIdList[m],element:S.elementList[r],atomName:S.atomNameList[r],atomCharge:S.atomChargeList[r],xCoord:t.xCoordList[m],yCoord:t.yCoordList[m],zCoord:t.zCoordList[m],bFactor:F,altLoc:D,occupancy:z})}m+=1}h+=1}p+=1}d+=1}),c&&C)for(r=0,o=C.length;o>r;r+=2)c({atomIndex1:C[r],atomIndex2:C[r+1],bondOrder:A?A[r/2]:null})}function g(t,n){t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i;return i=t instanceof Uint8Array?e(t):t,h(i,n)}var v=m;t.decode=g,t.traverse=v}),function(e){t.exports=e()}(function(){return function t(e,n,i){function r(s,l){if(!n[s]){if(!e[s]){var u="function"==typeof o&&o;if(!l&&u)return o(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return r(n?n:t)},d,d.exports,t,e,n,i)}return n[s].exports}for(var a="function"==typeof o&&o,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])}}return t},n.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,n,i,r){if(e.subarray&&t.subarray)return void t.set(e.subarray(n,n+i),r);
for(var o=0;o<i;o++)t[r+o]=e[n+o]},flattenChunks:function(t){var e,n,i,r,o,a;for(i=0,e=0,n=t.length;e<n;e++)i+=t[e].length;for(a=new Uint8Array(i),r=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,r),r+=o.length;return a}},o={arraySet:function(t,e,n,i,r){for(var o=0;o<i;o++)t[r+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],2:[function(t,e,n){"use strict";function i(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n}var r=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new r.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,n.string2buf=function(t){var e,n,i,o,a,s=t.length,l=0;for(o=0;o<s;o++)n=t.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),l+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(l),a=0,o=0;a<l;o++)n=t.charCodeAt(o),55296===(64512&n)&&o+1<s&&(i=t.charCodeAt(o+1),56320===(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),o++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},n.buf2binstring=function(t){return i(t,t.length)},n.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},n.buf2string=function(t,e){var n,r,o,a,l=e||t.length,u=new Array(2*l);for(r=0,n=0;n<l;)if(o=t[n++],o<128)u[r++]=o;else if(a=s[o],a>4)u[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&n<l;)o=o<<6|63&t[n++],a--;a>1?u[r++]=65533:o<65536?u[r++]=o:(o-=65536,u[r++]=55296|o>>10&1023,u[r++]=56320|1023&o)}return i(u,r)},n.utf8border=function(t,e){var n;for(e=e||t.length,e>t.length&&(e=t.length),n=e-1;n>=0&&128===(192&t[n]);)n--;return n<0?e:0===n?e:n+s[t[n]]>e?n:e}},{"./common":1}],3:[function(t,e,n){"use strict";function i(t,e,n,i){for(var r=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do r=r+e[i++]|0,o=o+r|0;while(--a);r%=65521,o%=65521}return r|o<<16|0}e.exports=i},{}],4:[function(t,e,n){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(t,e,n){"use strict";function i(){for(var t,e=[],n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}function r(t,e,n,i){var r=o,a=i+n;t^=-1;for(var s=i;s<a;s++)t=t>>>8^r[255&(t^e[s])];return t^-1}var o=i();e.exports=r},{}],6:[function(t,e,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=i},{}],7:[function(t,e,n){"use strict";var i=30,r=12;e.exports=function(t,e){var n,o,a,s,l,u,c,d,p,h,f,m,g,v,_,y,b,x,w,C,A,T,S,M,I;n=t.state,o=t.next_in,M=t.input,a=o+(t.avail_in-5),s=t.next_out,I=t.output,l=s-(e-t.avail_out),u=s+(t.avail_out-257),c=n.dmax,d=n.wsize,p=n.whave,h=n.wnext,f=n.window,m=n.hold,g=n.bits,v=n.lencode,_=n.distcode,y=(1<<n.lenbits)-1,b=(1<<n.distbits)-1;t:do{g<15&&(m+=M[o++]<<g,g+=8,m+=M[o++]<<g,g+=8),x=v[m&y];e:for(;;){if(w=x>>>24,m>>>=w,g-=w,w=x>>>16&255,0===w)I[s++]=65535&x;else{if(!(16&w)){if(0===(64&w)){x=v[(65535&x)+(m&(1<<w)-1)];continue e}if(32&w){n.mode=r;break t}t.msg="invalid literal/length code",n.mode=i;break t}C=65535&x,w&=15,w&&(g<w&&(m+=M[o++]<<g,g+=8),C+=m&(1<<w)-1,m>>>=w,g-=w),g<15&&(m+=M[o++]<<g,g+=8,m+=M[o++]<<g,g+=8),x=_[m&b];n:for(;;){if(w=x>>>24,m>>>=w,g-=w,w=x>>>16&255,!(16&w)){if(0===(64&w)){x=_[(65535&x)+(m&(1<<w)-1)];continue n}t.msg="invalid distance code",n.mode=i;break t}if(A=65535&x,w&=15,g<w&&(m+=M[o++]<<g,g+=8,g<w&&(m+=M[o++]<<g,g+=8)),A+=m&(1<<w)-1,A>c){t.msg="invalid distance too far back",n.mode=i;break t}if(m>>>=w,g-=w,w=s-l,A>w){if(w=A-w,w>p&&n.sane){t.msg="invalid distance too far back",n.mode=i;break t}if(T=0,S=f,0===h){if(T+=d-w,w<C){C-=w;do I[s++]=f[T++];while(--w);T=s-A,S=I}}else if(h<w){if(T+=d+h-w,w-=h,w<C){C-=w;do I[s++]=f[T++];while(--w);if(T=0,h<C){w=h,C-=w;do I[s++]=f[T++];while(--w);T=s-A,S=I}}}else if(T+=h-w,w<C){C-=w;do I[s++]=f[T++];while(--w);T=s-A,S=I}for(;C>2;)I[s++]=S[T++],I[s++]=S[T++],I[s++]=S[T++],C-=3;C&&(I[s++]=S[T++],C>1&&(I[s++]=S[T++]))}else{T=s-A;do I[s++]=I[T++],I[s++]=I[T++],I[s++]=I[T++],C-=3;while(C>2);C&&(I[s++]=I[T++],C>1&&(I[s++]=I[T++]))}break}}break}}while(o<a&&s<u);C=g>>3,o-=C,g-=C<<3,m&=(1<<g)-1,t.next_in=o,t.next_out=s,t.avail_in=o<a?5+(a-o):5-(o-a),t.avail_out=s<u?257+(u-s):257-(s-u),n.hold=m,n.bits=g}},{}],8:[function(t,e,n){"use strict";function i(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new v.Buf16(320),this.work=new v.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=V,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new v.Buf32(ft),e.distcode=e.distdyn=new v.Buf32(mt),e.sane=1,e.back=-1,I):E}function a(t){var e;return t&&t.state?(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,o(t)):E}function s(t,e){var n,i;return t&&t.state?(i=t.state,e<0?(n=0,e=-e):(n=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?E:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,a(t))):E}function l(t,e){var n,i;return t?(i=new r,t.state=i,i.window=null,n=s(t,e),n!==I&&(t.state=null),n):E}function u(t){return l(t,vt)}function c(t){if(_t){var e;for(m=new v.Buf32(512),g=new v.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(x(C,t.lens,0,288,m,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;x(A,t.lens,0,32,g,0,t.work,{bits:5}),_t=!1}t.lencode=m,t.lenbits=9,t.distcode=g,t.distbits=5}function d(t,e,n,i){var r,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new v.Buf8(o.wsize)),i>=o.wsize?(v.arraySet(o.window,e,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),v.arraySet(o.window,e,n-i,r,o.wnext),i-=r,i?(v.arraySet(o.window,e,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function p(t,e){var n,r,o,a,s,l,u,p,h,f,m,g,ft,mt,gt,vt,_t,yt,bt,xt,wt,Ct,At,Tt,St=0,Mt=new v.Buf8(4),It=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return E;n=t.state,n.mode===Y&&(n.mode=$),s=t.next_out,o=t.output,u=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,p=n.hold,h=n.bits,f=l,m=u,Ct=I;t:for(;;)switch(n.mode){case V:if(0===n.wrap){n.mode=$;break}for(;h<16;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(2&n.wrap&&35615===p){n.check=0,Mt[0]=255&p,Mt[1]=p>>>8&255,n.check=y(n.check,Mt,2,0),p=0,h=0,n.mode=O;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&p)<<8)+(p>>8))%31){t.msg="incorrect header check",n.mode=dt;break}if((15&p)!==k){t.msg="unknown compression method",n.mode=dt;break}if(p>>>=4,h-=4,wt=(15&p)+8,0===n.wbits)n.wbits=wt;else if(wt>n.wbits){t.msg="invalid window size",n.mode=dt;break}n.dmax=1<<wt,t.adler=n.check=1,n.mode=512&p?H:Y,p=0,h=0;break;case O:for(;h<16;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(n.flags=p,(255&n.flags)!==k){t.msg="unknown compression method",n.mode=dt;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=dt;break}n.head&&(n.head.text=p>>8&1),512&n.flags&&(Mt[0]=255&p,Mt[1]=p>>>8&255,n.check=y(n.check,Mt,2,0)),p=0,h=0,n.mode=N;case N:for(;h<32;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.head&&(n.head.time=p),512&n.flags&&(Mt[0]=255&p,Mt[1]=p>>>8&255,Mt[2]=p>>>16&255,Mt[3]=p>>>24&255,n.check=y(n.check,Mt,4,0)),p=0,h=0,n.mode=j;case j:for(;h<16;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.head&&(n.head.xflags=255&p,n.head.os=p>>8),512&n.flags&&(Mt[0]=255&p,Mt[1]=p>>>8&255,n.check=y(n.check,Mt,2,0)),p=0,h=0,n.mode=R;case R:if(1024&n.flags){for(;h<16;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.length=p,n.head&&(n.head.extra_len=p),512&n.flags&&(Mt[0]=255&p,Mt[1]=p>>>8&255,n.check=y(n.check,Mt,2,0)),p=0,h=0}else n.head&&(n.head.extra=null);n.mode=B;case B:if(1024&n.flags&&(g=n.length,g>l&&(g=l),g&&(n.head&&(wt=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),v.arraySet(n.head.extra,r,a,g,wt)),512&n.flags&&(n.check=y(n.check,r,g,a)),l-=g,a+=g,n.length-=g),n.length))break t;n.length=0,n.mode=U;case U:if(2048&n.flags){if(0===l)break t;g=0;do wt=r[a+g++],n.head&&wt&&n.length<65536&&(n.head.name+=String.fromCharCode(wt));while(wt&&g<l);if(512&n.flags&&(n.check=y(n.check,r,g,a)),l-=g,a+=g,wt)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=q;case q:if(4096&n.flags){if(0===l)break t;g=0;do wt=r[a+g++],n.head&&wt&&n.length<65536&&(n.head.comment+=String.fromCharCode(wt));while(wt&&g<l);if(512&n.flags&&(n.check=y(n.check,r,g,a)),l-=g,a+=g,wt)break t}else n.head&&(n.head.comment=null);n.mode=G;case G:if(512&n.flags){for(;h<16;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(p!==(65535&n.check)){t.msg="header crc mismatch",n.mode=dt;break}p=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Y;break;case H:for(;h<32;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}t.adler=n.check=i(p),p=0,h=0,n.mode=W;case W:if(0===n.havedict)return t.next_out=s,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=p,n.bits=h,L;t.adler=n.check=1,n.mode=Y;case Y:if(e===S||e===M)break t;case $:if(n.last){p>>>=7&h,h-=7&h,n.mode=lt;break}for(;h<3;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}switch(n.last=1&p,p>>>=1,h-=1,3&p){case 0:n.mode=X;break;case 1:if(c(n),n.mode=et,e===M){p>>>=2,h-=2;break t}break;case 2:n.mode=Q;break;case 3:t.msg="invalid block type",n.mode=dt}p>>>=2,h-=2;break;case X:for(p>>>=7&h,h-=7&h;h<32;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if((65535&p)!==(p>>>16^65535)){t.msg="invalid stored block lengths",n.mode=dt;break}if(n.length=65535&p,p=0,h=0,n.mode=K,e===M)break t;case K:n.mode=Z;case Z:if(g=n.length){if(g>l&&(g=l),g>u&&(g=u),0===g)break t;v.arraySet(o,r,a,g,s),l-=g,a+=g,u-=g,s+=g,n.length-=g;break}n.mode=Y;break;case Q:for(;h<14;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(n.nlen=(31&p)+257,p>>>=5,h-=5,n.ndist=(31&p)+1,p>>>=5,h-=5,n.ncode=(15&p)+4,p>>>=4,h-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=dt;break}n.have=0,n.mode=J;case J:for(;n.have<n.ncode;){for(;h<3;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.lens[It[n.have++]]=7&p,p>>>=3,h-=3}for(;n.have<19;)n.lens[It[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,At={bits:n.lenbits},Ct=x(w,n.lens,0,19,n.lencode,0,n.work,At),n.lenbits=At.bits,Ct){t.msg="invalid code lengths set",n.mode=dt;break}n.have=0,n.mode=tt;case tt:for(;n.have<n.nlen+n.ndist;){for(;St=n.lencode[p&(1<<n.lenbits)-1],gt=St>>>24,vt=St>>>16&255,_t=65535&St,!(gt<=h);){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(_t<16)p>>>=gt,h-=gt,n.lens[n.have++]=_t;else{if(16===_t){for(Tt=gt+2;h<Tt;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(p>>>=gt,h-=gt,0===n.have){t.msg="invalid bit length repeat",n.mode=dt;break}wt=n.lens[n.have-1],g=3+(3&p),p>>>=2,h-=2}else if(17===_t){for(Tt=gt+3;h<Tt;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}p>>>=gt,h-=gt,wt=0,g=3+(7&p),p>>>=3,h-=3}else{for(Tt=gt+7;h<Tt;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}p>>>=gt,h-=gt,wt=0,g=11+(127&p),p>>>=7,h-=7}if(n.have+g>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=dt;break}for(;g--;)n.lens[n.have++]=wt}}if(n.mode===dt)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=dt;break}if(n.lenbits=9,At={bits:n.lenbits},Ct=x(C,n.lens,0,n.nlen,n.lencode,0,n.work,At),n.lenbits=At.bits,Ct){t.msg="invalid literal/lengths set",n.mode=dt;break}if(n.distbits=6,n.distcode=n.distdyn,At={bits:n.distbits},Ct=x(A,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,At),n.distbits=At.bits,Ct){t.msg="invalid distances set",n.mode=dt;break}if(n.mode=et,e===M)break t;case et:n.mode=nt;case nt:if(l>=6&&u>=258){t.next_out=s,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=p,n.bits=h,b(t,m),s=t.next_out,o=t.output,u=t.avail_out,a=t.next_in,r=t.input,l=t.avail_in,p=n.hold,h=n.bits,n.mode===Y&&(n.back=-1);break}for(n.back=0;St=n.lencode[p&(1<<n.lenbits)-1],gt=St>>>24,vt=St>>>16&255,_t=65535&St,!(gt<=h);){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(vt&&0===(240&vt)){for(yt=gt,bt=vt,xt=_t;St=n.lencode[xt+((p&(1<<yt+bt)-1)>>yt)],gt=St>>>24,vt=St>>>16&255,_t=65535&St,!(yt+gt<=h);){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}p>>>=yt,h-=yt,n.back+=yt}if(p>>>=gt,h-=gt,n.back+=gt,n.length=_t,0===vt){n.mode=st;break}if(32&vt){n.back=-1,n.mode=Y;break}if(64&vt){t.msg="invalid literal/length code",n.mode=dt;break}n.extra=15&vt,n.mode=it;case it:if(n.extra){for(Tt=n.extra;h<Tt;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.length+=p&(1<<n.extra)-1,p>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=rt;case rt:for(;St=n.distcode[p&(1<<n.distbits)-1],gt=St>>>24,vt=St>>>16&255,_t=65535&St,!(gt<=h);){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(0===(240&vt)){for(yt=gt,bt=vt,xt=_t;St=n.distcode[xt+((p&(1<<yt+bt)-1)>>yt)],gt=St>>>24,vt=St>>>16&255,_t=65535&St,!(yt+gt<=h);){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}p>>>=yt,h-=yt,n.back+=yt}if(p>>>=gt,h-=gt,n.back+=gt,64&vt){t.msg="invalid distance code",n.mode=dt;break}n.offset=_t,n.extra=15&vt,n.mode=ot;case ot:if(n.extra){for(Tt=n.extra;h<Tt;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}n.offset+=p&(1<<n.extra)-1,p>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=dt;break}n.mode=at;case at:if(0===u)break t;if(g=m-u,n.offset>g){if(g=n.offset-g,g>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=dt;break}g>n.wnext?(g-=n.wnext,ft=n.wsize-g):ft=n.wnext-g,g>n.length&&(g=n.length),mt=n.window}else mt=o,ft=s-n.offset,g=n.length;g>u&&(g=u),u-=g,n.length-=g;do o[s++]=mt[ft++];while(--g);0===n.length&&(n.mode=nt);break;case st:if(0===u)break t;o[s++]=n.length,u--,n.mode=nt;break;case lt:if(n.wrap){for(;h<32;){if(0===l)break t;l--,p|=r[a++]<<h,h+=8}if(m-=u,t.total_out+=m,n.total+=m,m&&(t.adler=n.check=n.flags?y(n.check,o,m,s-m):_(n.check,o,m,s-m)),m=u,(n.flags?p:i(p))!==n.check){t.msg="incorrect data check",n.mode=dt;break}p=0,h=0}n.mode=ut;case ut:if(n.wrap&&n.flags){for(;h<32;){if(0===l)break t;l--,p+=r[a++]<<h,h+=8}if(p!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=dt;break}p=0,h=0}n.mode=ct;case ct:Ct=P;break t;case dt:Ct=F;break t;case pt:return D;case ht:default:return E}return t.next_out=s,t.avail_out=u,t.next_in=a,t.avail_in=l,n.hold=p,n.bits=h,(n.wsize||m!==t.avail_out&&n.mode<dt&&(n.mode<lt||e!==T))&&d(t,t.output,t.next_out,m-t.avail_out)?(n.mode=pt,D):(f-=t.avail_in,m-=t.avail_out,t.total_in+=f,t.total_out+=m,n.total+=m,n.wrap&&m&&(t.adler=n.check=n.flags?y(n.check,o,m,t.next_out-m):_(n.check,o,m,t.next_out-m)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Y?128:0)+(n.mode===et||n.mode===K?256:0),(0===f&&0===m||e===T)&&Ct===I&&(Ct=z),Ct)}function h(t){if(!t||!t.state)return E;var e=t.state;return e.window&&(e.window=null),t.state=null,I}function f(t,e){var n;return t&&t.state?(n=t.state,0===(2&n.wrap)?E:(n.head=e,e.done=!1,I)):E}var m,g,v=t("../utils/common"),_=t("./adler32"),y=t("./crc32"),b=t("./inffast"),x=t("./inftrees"),w=0,C=1,A=2,T=4,S=5,M=6,I=0,P=1,L=2,E=-2,F=-3,D=-4,z=-5,k=8,V=1,O=2,N=3,j=4,R=5,B=6,U=7,q=8,G=9,H=10,W=11,Y=12,$=13,X=14,K=15,Z=16,Q=17,J=18,tt=19,et=20,nt=21,it=22,rt=23,ot=24,at=25,st=26,lt=27,ut=28,ct=29,dt=30,pt=31,ht=32,ft=852,mt=592,gt=15,vt=gt,_t=!0;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=u,n.inflateInit2=l,n.inflate=p,n.inflateEnd=h,n.inflateGetHeader=f,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(t,e,n){"use strict";var i=t("../utils/common"),r=15,o=852,a=592,s=0,l=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],p=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,n,f,m,g,v,_){var y,b,x,w,C,A,T,S,M,I=_.bits,P=0,L=0,E=0,F=0,D=0,z=0,k=0,V=0,O=0,N=0,j=null,R=0,B=new i.Buf16(r+1),U=new i.Buf16(r+1),q=null,G=0;for(P=0;P<=r;P++)B[P]=0;for(L=0;L<f;L++)B[e[n+L]]++;for(D=I,F=r;F>=1&&0===B[F];F--);if(D>F&&(D=F),0===F)return m[g++]=20971520,m[g++]=20971520,_.bits=1,0;for(E=1;E<F&&0===B[E];E++);for(D<E&&(D=E),V=1,P=1;P<=r;P++)if(V<<=1,V-=B[P],V<0)return-1;if(V>0&&(t===s||1!==F))return-1;for(U[1]=0,P=1;P<r;P++)U[P+1]=U[P]+B[P];for(L=0;L<f;L++)0!==e[n+L]&&(v[U[e[n+L]]++]=L);if(t===s?(j=q=v,A=19):t===l?(j=c,R-=257,q=d,G-=257,A=256):(j=p,q=h,A=-1),N=0,L=0,P=E,C=g,z=D,k=0,x=-1,O=1<<D,w=O-1,t===l&&O>o||t===u&&O>a)return 1;for(var H=0;;){H++,T=P-k,v[L]<A?(S=0,M=v[L]):v[L]>A?(S=q[G+v[L]],M=j[R+v[L]]):(S=96,M=0),y=1<<P-k,b=1<<z,E=b;do b-=y,m[C+(N>>k)+b]=T<<24|S<<16|M|0;while(0!==b);for(y=1<<P-1;N&y;)y>>=1;if(0!==y?(N&=y-1,N+=y):N=0,L++,0===--B[P]){if(P===F)break;P=e[n+v[L]]}if(P>D&&(N&w)!==x){for(0===k&&(k=D),C+=E,z=P-k,V=1<<z;z+k<F&&(V-=B[z+k],!(V<=0));)z++,V<<=1;if(O+=1<<z,t===l&&O>o||t===u&&O>a)return 1;x=N&w,m[x]=D<<24|z<<16|C-g|0}}return 0!==N&&(m[C+N]=P-k<<24|64<<16|0),_.bits=D,0}},{"../utils/common":1}],10:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(t,e,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=i},{}],"/lib/inflate.js":[function(t,e,n){"use strict";function i(t,e){var n=new h(e);if(n.push(t,!0),n.err)throw n.msg;return n.result}function r(t,e){return e=e||{},e.raw=!0,i(t,e)}var o=t("./zlib/inflate.js"),a=t("./utils/common"),s=t("./utils/strings"),l=t("./zlib/constants"),u=t("./zlib/messages"),c=t("./zlib/zstream"),d=t("./zlib/gzheader"),p=Object.prototype.toString,h=function(t){this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=o.inflateInit2(this.strm,e.windowBits);if(n!==l.Z_OK)throw new Error(u[n]);this.header=new d,o.inflateGetHeader(this.strm,this.header)};h.prototype.push=function(t,e){var n,i,r,u,c,d=this.strm,h=this.options.chunkSize;if(this.ended)return!1;i=e===~~e?e:e===!0?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===p.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new a.Buf8(h),d.next_out=0,d.avail_out=h),n=o.inflate(d,l.Z_NO_FLUSH),n!==l.Z_STREAM_END&&n!==l.Z_OK)return this.onEnd(n),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&n!==l.Z_STREAM_END&&(0!==d.avail_in||i!==l.Z_FINISH&&i!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(r=s.utf8border(d.output,d.next_out),u=d.next_out-r,c=s.buf2string(d.output,r),d.next_out=u,d.avail_out=h-u,u&&a.arraySet(d.output,d.output,r,u,0),this.onData(c)):this.onData(a.shrinkBuf(d.output,d.next_out))))}while(d.avail_in>0&&n!==l.Z_STREAM_END);return n===l.Z_STREAM_END&&(i=l.Z_FINISH),i===l.Z_FINISH?(n=o.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===l.Z_OK):i!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),d.avail_out=0,!0)},h.prototype.onData=function(t){this.chunks.push(t)},h.prototype.onEnd=function(t){t===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=h,n.inflate=i,n.inflateRaw=r,n.ungzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate.js":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")}),c=function(t){var e=t.$3Dmol||{};return e}(window),"https:"!=document.location.protocol&&u.get("http://3dmol.csb.pitt.edu/track/report.cgi"),String.prototype.startsWith||(String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)}),String.prototype.endsWith||(String.prototype.endsWith=function(t){return this.indexOf(t,this.length-t.length)!==-1}),u.ajaxTransport("+binary",function(t,e,n){if(window.FormData&&(t.dataType&&"binary"==t.dataType||t.data&&(window.ArrayBuffer&&t.data instanceof ArrayBuffer||window.Blob&&t.data instanceof Blob)))return{send:function(e,n){var i=new XMLHttpRequest,r=t.url,o=t.type,a=t.async||!0,s=t.responseType||"blob",l=t.data||null,u=t.username||null,c=t.password||null;i.addEventListener("load",function(){var e={};e[t.dataType]=i.response,n(i.status,i.statusText,e,i.getAllResponseHeaders())}),i.open(o,r,a,u,c);for(var d in e)i.setRequestHeader(d,e[d]);i.responseType=s,i.send(l)},abort:function(){n.abort()}}}),c.createViewer=function(t,e){if("string"===u.type(t)&&(t=u("#"+t)),t){e=e||{};try{return new c.GLViewer(t,e)}catch(t){throw"error creating viewer: "+t}return null}},c.viewers={},c.download=function(t,e,n,i){var r="",o="",a=e.addModel();if("mmtf:"===t.substr(0,5)){o=n&&n.pdbUri?n.pdbUri:"http://mmtf.rcsb.org/full/",t=t.substr(5).toUpperCase();var s=o+t+".mmtf";u.ajax({url:s,type:"GET",dataType:"binary",responseType:"arraybuffer",processData:!1}).done(function(t,n,r){a.addMolData(t,"mmtf"),e.zoomTo(),e.render(),i&&i(a)}).fail(function(t,e){console.log(e)})}else{if("pdb:"===t.substr(0,4)){if(o=n&&n.pdbUri?n.pdbUri:"http://www.rcsb.org/pdb/files/",r=n&&n.format?n.format:"pdb",t=t.substr(4).toUpperCase(),!t.match(/^[1-9][A-Za-z0-9]{3}$/))return void alert("Wrong PDB ID");s=n&&n.format?o+t+"."+n.format:o+t+".pdb"}else if("cid:"==t.substr(0,4)){if(r="sdf",t=t.substr(4),!t.match(/^[0-9]+$/))return void alert("Wrong Compound ID");s="http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+t+"/SDF?record_type=3d"}u.get(s,function(t){a.addMolData(t,r,n),e.zoomTo(),e.render(),i&&i(a)})}return a},c.SurfaceType={VDW:1,MS:2,SAS:3,SES:4},c.mergeGeos=function(t,e){var n=e.geometry;void 0!==n&&t.geometryGroups.push(n.geometryGroups[0])},c.multiLineString=function(t){return t.toString().replace(/^[^\/]+\/\*!?/,"").replace(/\*\/[^\/]+$/,"")},c.syncSurface=!1,(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(c.syncSurface=!0),c.specStringToObject=function(t){if("object"==typeof t)return t;if("undefined"==typeof t||null==t)return t;t=t.replace(/%7E/,"~");var e=function(t){return u.isNumeric(t)?Math.floor(parseFloat(t))==parseInt(t)?parseFloat(t):t.indexOf(".")>=0?parseFloat(t):parseInt(t):"true"===t||"false"!==t&&t},n={};if("all"===t)return n;for(var i=t.split(";"),r=0;r<i.length;r++){var o=i[r].split(":"),a=o[0],s={},l=o[1];if(l)if(l=l.replace(/~/g,"="),l.indexOf("=")!==-1)for(var c=l.split(","),d=0;d<c.length;d++){var p=c[d].split("=",2);s[p[0]]=e(p[1])}else s=l.indexOf(",")!==-1?l.split(","):e(l);n[a]=s}return n},c.getExtent=function(t,e){var n,i,r,o,a,s,l,u,c,d,p=!e;if(n=i=r=9999,o=a=s=-9999,l=u=c=d=0,0===t.length)return[[0,0,0],[0,0,0],[0,0,0]];for(var h=0;h<t.length;h++){var f=t[h];if("undefined"!=typeof f&&isFinite(f.x)&&isFinite(f.y)&&isFinite(f.z)&&(d++,l+=f.x,u+=f.y,c+=f.z,n=n<f.x?n:f.x,i=i<f.y?i:f.y,r=r<f.z?r:f.z,o=o>f.x?o:f.x,a=a>f.y?a:f.y,s=s>f.z?s:f.z,f.symmetries&&p))for(var m=0;m<f.symmetries.length;m++)d++,l+=f.symmetries[m].x,u+=f.symmetries[m].y,c+=f.symmetries[m].z,n=n<f.symmetries[m].x?n:f.symmetries[m].x,i=i<f.symmetries[m].y?i:f.symmetries[m].y,r=r<f.symmetries[m].z?r:f.symmetries[m].z,o=o>f.symmetries[m].x?o:f.symmetries[m].x,a=a>f.symmetries[m].y?a:f.symmetries[m].y,s=s>f.symmetries[m].z?s:f.symmetries[m].z}return[[n,i,r],[o,a,s],[l/d,u/d,c/d]]},c.getAtomProperty=function(t,e){var n=null;return t.properties&&"undefined"!=typeof t.properties[e]?n=t.properties[e]:"undefined"!=typeof t[e]&&(n=t[e]),n},c.getPropertyRange=function(t,e){for(var n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=0,o=t.length;r<o;r++){var a=t[r],s=c.getAtomProperty(a,e);null!=s&&(s<n&&(n=s),s>i&&(i=s))}return isFinite(n)||isFinite(i)?isFinite(n)?isFinite(i)||(i=n):n=i:n=i=0,[n,i]},s=c,l="function"==typeof s?s.call(e,r,e,t):s,!(void 0!==l&&(t.exports=l));var c=c||{};c.Math={clamp:function(t,e,n){return Math.min(Math.max(t,e),n)},degToRad:function(){var t=Math.PI/180;return function(e){return e*t}}()},c.Quaternion=function(t,e,n,i){this.x=t||0,this.y=e||0,this.z=n||0,this.w=void 0!==i?i:1},c.Quaternion.prototype={constructor:c.Quaternion,set:function(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},inverse:function(){return this.conjugate().normalize()},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var t=this.length();return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t),this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var n=t.x,i=t.y,r=t.z,o=t.w,a=e.x,s=e.y,l=e.z,u=e.w;this.x=n*u+o*a+i*l-r*s,this.y=i*u+o*s+r*a-n*l,this.z=r*u+o*l+n*s-i*a,this.w=o*u-n*a-i*s-r*l}},c.Vector2=function(t,e){this.x=t||0,this.y=e||0},c.Vector2.prototype={constructor:c.Vector2,set:function(t,e){return this.x=t,this.y=e,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new c.Vector2(this.x,this.y)}},c.Vector3=function(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0},c.Vector3.prototype={constructor:c.Vector3,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},addVectors:function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return 0!==t?(this.x/=t,this.y/=t,this.z/=t):(this.x=0,this.y=0,this.z=0),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i},applyMatrix4:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i+r[12],this.y=r[1]*e+r[5]*n+r[9]*i+r[13],this.z=r[2]*e+r[6]*n+r[10]*i+r[14],this},applyProjection:function(t){var e=this.x,n=this.y,i=this.z,r=t.elements,o=r[3]*e+r[7]*n+r[11]*i+r[15];return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])/o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])/o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])/o,this},applyQuaternion:function(t){var e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,s=(t.w,{});s.x=2*(n*a-i*o),s.y=2*(i*r-e*a),s.z=2*(e*o-n*r);var l={};return l.x=s.y*a-s.z*o,l.y=s.z*r-s.x*a,l.z=s.x*o-s.y*r,this.x=e+t.w*s.x+l.x,this.y=n+t.w*s.y+l.y,this.z=i+t.w*s.z+l.z,this},negate:function(){return this.multiplyScalar(-1)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length())},cross:function(t){var e=this.x,n=this.y,i=this.z;return this.x=n*t.z-i*t.y,this.y=i*t.x-e*t.z,this.z=e*t.y-n*t.x,this},crossVectors:function(t,e){return this.x=t.y*e.z-t.z*e.y,this.y=t.z*e.x-t.x*e.z,this.z=t.x*e.y-t.y*e.x,this},getPositionFromMatrix:function(t){return this.x=t.elements[12],this.y=t.elements[13],this.z=t.elements[14],this},setEulerFromRotationMatrix:function(t,e){var n=t.elements,i=n[0],r=n[4],o=n[8],a=(n[1],n[5]),s=n[9],l=(n[2],n[6]),u=n[10];return void 0===e||"XYZ"===e?(this.y=Math.asin(c.Math.clamp(o,-1,1)),Math.abs(o)<.99999?(this.x=Math.atan2(-s,u),this.z=Math.atan2(-r,i)):(this.x=Math.atan2(l,a),this.z=0)):console.error("Error with vector's setEulerFromRotationMatrix: Unknown order: "+e),this},rotateAboutVector:function(t,e){t.normalize();var n=Math.cos(e),i=Math.sin(e),r=this.clone().multiplyScalar(n),o=t.clone().cross(this).multiplyScalar(i),a=t.clone().multiplyScalar(t.clone().dot(this)).multiplyScalar(1-n),s=r.add(o).add(a);return this.x=s.x,this.y=s.y,this.z=s.z,this},clone:function(){return new c.Vector3(this.x,this.y,this.z)}},c.Matrix3=function(t,e,n,i,r,o,a,s,l){this.elements=new Float32Array(9),this.set(void 0!==t?t:1,e||0,n||0,i||0,void 0!==r?r:1,o||0,a||0,s||0,void 0!==l?l:1)},c.Matrix3.prototype={constructor:c.Matrix3,set:function(t,e,n,i,r,o,a,s,l){var u=this.elements;return u[0]=t,u[3]=e,u[6]=n,u[1]=i,u[4]=r,u[7]=o,u[2]=a,u[5]=s,u[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(t){var e=t.elements;this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},getInverse:function(t,e){var n=t.elements,i=this.elements;i[0]=n[10]*n[5]-n[6]*n[9],i[1]=-n[10]*n[1]+n[2]*n[9],i[2]=n[6]*n[1]-n[2]*n[5],i[3]=-n[10]*n[4]+n[6]*n[8],i[4]=n[10]*n[0]-n[2]*n[8],i[5]=-n[6]*n[0]+n[2]*n[4],i[6]=n[9]*n[4]-n[5]*n[8],i[7]=-n[9]*n[0]+n[1]*n[8],i[8]=n[5]*n[0]-n[1]*n[4];var r=n[0]*i[0]+n[1]*i[3]+n[2]*i[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},getDeterminant:function(){var t=this.elements,e=t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-t[2]*t[4]*t[6]-t[1]*t[3]*t[8]-t[0]*t[5]*t[7];return e},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},clone:function(){var t=this.elements;return new c.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},c.Matrix4=function(t,e,n,i,r,o,a,s,l,u,c,d,p,h,f,m){if("undefined"==typeof e&&"undefined"!=typeof t)this.elements=new Float32Array(t);else{var g=this.elements=new Float32Array(16);g[0]=void 0!==t?t:1,g[4]=e||0,g[8]=n||0,g[12]=i||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=a||0,g[13]=s||0,g[2]=l||0,g[6]=u||0,g[10]=void 0!==c?c:1,g[14]=d||0,g[3]=p||0,g[7]=h||0,g[11]=f||0,g[15]=void 0!==m?m:1;
}},c.Matrix4.prototype={constructor:c.Matrix4,set:function(t,e,n,i,r,o,a,s,l,u,c,d,p,h,f,m){var g=this.elements;return g[0]=t,g[4]=e,g[8]=n,g[12]=i,g[1]=r,g[5]=o,g[9]=a,g[13]=s,g[2]=l,g[6]=u,g[10]=c,g[14]=d,g[3]=p,g[7]=h,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]),this},matrix3FromTopLeft:function(){var t=this.elements;return new c.Matrix3(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10])},setRotationFromEuler:function(t,e){var n=this.elements,i=t.x,r=t.y,o=t.z,a=Math.cos(i),s=Math.sin(i),l=Math.cos(r),u=Math.sin(r),c=Math.cos(o),d=Math.sin(o);if(void 0===e||"XYZ"===e){var p=a*c,h=a*d,f=s*c,m=s*d;n[0]=l*c,n[4]=-l*d,n[8]=u,n[1]=h+f*u,n[5]=p-m*u,n[9]=-s*l,n[2]=m-p*u,n[6]=f+h*u,n[10]=a*l}else console.error("Error with matrix4 setRotationFromEuler. Order: "+e);return this},setRotationFromQuaternion:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z,o=t.w,a=n+n,s=i+i,l=r+r,u=n*a,c=n*s,d=n*l,p=i*s,h=i*l,f=r*l,m=o*a,g=o*s,v=o*l;return e[0]=1-(p+f),e[4]=c-v,e[8]=d+g,e[1]=c+v,e[5]=1-(u+f),e[9]=h-m,e[2]=d-g,e[6]=h+m,e[10]=1-(u+p),this},lookAt:function(){var t=new c.Vector3,e=new c.Vector3,n=new c.Vector3;return function(i,r,o){var a=this.elements;return n.subVectors(i,r).normalize(),0===n.length()&&(n.z=1),t.crossVectors(o,n).normalize(),0===t.length()&&(n.x+=1e-4,t.crossVectors(o,n).normalize()),e.crossVectors(n,t),a[0]=t.x,a[4]=e.x,a[8]=n.x,a[1]=t.y,a[5]=e.y,a[9]=n.y,a[2]=t.z,a[6]=e.z,a[10]=n.z,this}}(),multiplyMatrices:function(t,e){var n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],s=n[8],l=n[12],u=n[1],c=n[5],d=n[9],p=n[13],h=n[2],f=n[6],m=n[10],g=n[14],v=n[3],_=n[7],y=n[11],b=n[15],x=i[0],w=i[4],C=i[8],A=i[12],T=i[1],S=i[5],M=i[9],I=i[13],P=i[2],L=i[6],E=i[10],F=i[14],D=i[3],z=i[7],k=i[11],V=i[15];return r[0]=o*x+a*T+s*P+l*D,r[4]=o*w+a*S+s*L+l*z,r[8]=o*C+a*M+s*E+l*k,r[12]=o*A+a*I+s*F+l*V,r[1]=u*x+c*T+d*P+p*D,r[5]=u*w+c*S+d*L+p*z,r[9]=u*C+c*M+d*E+p*k,r[13]=u*A+c*I+d*F+p*V,r[2]=h*x+f*T+m*P+g*D,r[6]=h*w+f*S+m*L+g*z,r[10]=h*C+f*M+m*E+g*k,r[14]=h*A+f*I+m*F+g*V,r[3]=v*x+_*T+y*P+b*D,r[7]=v*w+_*S+y*L+b*z,r[11]=v*C+_*M+y*E+b*k,r[15]=v*A+_*I+y*F+b*V,this},multiplyScalar:function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},getPosition:function(){var t=new c.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.getPositionFromMatrix( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(t){var e=this.elements;return e[12]=t.x,e[13]=t.y,e[14]=t.z,this},getInverse:function(t,e){var n=this.elements,i=t.elements,r=i[0],o=i[4],a=i[8],s=i[12],l=i[1],u=i[5],c=i[9],d=i[13],p=i[2],h=i[6],f=i[10],m=i[14],g=i[3],v=i[7],_=i[11],y=i[15];n[0]=c*m*v-d*f*v+d*h*_-u*m*_-c*h*y+u*f*y,n[4]=s*f*v-a*m*v-s*h*_+o*m*_+a*h*y-o*f*y,n[8]=a*d*v-s*c*v+s*u*_-o*d*_-a*u*y+o*c*y,n[12]=s*c*h-a*d*h-s*u*f+o*d*f+a*u*m-o*c*m,n[1]=d*f*g-c*m*g-d*p*_+l*m*_+c*p*y-l*f*y,n[5]=a*m*g-s*f*g+s*p*_-r*m*_-a*p*y+r*f*y,n[9]=s*c*g-a*d*g-s*l*_+r*d*_+a*l*y-r*c*y,n[13]=a*d*p-s*c*p+s*l*f-r*d*f-a*l*m+r*c*m,n[2]=u*m*g-d*h*g+d*p*v-l*m*v-u*p*y+l*h*y,n[6]=s*h*g-o*m*g-s*p*v+r*m*v+o*p*y-r*h*y,n[10]=o*d*g-s*u*g+s*l*v-r*d*v-o*l*y+r*u*y,n[14]=s*u*p-o*d*p-s*l*h+r*d*h+o*l*m-r*u*m,n[3]=c*h*g-u*f*g-c*p*v+l*f*v+u*p*_-l*h*_,n[7]=o*f*g-a*h*g+a*p*v-r*f*v-o*p*_+r*h*_,n[11]=a*u*g-o*c*g-a*l*v+r*c*v+o*l*_-r*u*_,n[15]=o*c*p-a*u*p+a*l*h-r*c*h-o*l*f+r*u*f;var b=i[0]*n[0]+i[1]*n[4]+i[2]*n[8]+i[3]*n[12];if(0===b){var x="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(e)throw new Error(x);return console.warn(x),this.identity(),this}return this.multiplyScalar(1/b),this},isReflected:function(){return this.matrix3FromTopLeft().getDeterminant()<0},compose:function(){var t=new c.Matrix4,e=new c.Matrix4;return function(n,i,r){var o=this.elements;return t.identity(),t.setRotationFromQuaternion(i),e.makeScale(r.x,r.y,r.z),this.multiplyMatrices(t,e),o[12]=n.x,o[13]=n.y,o[14]=n.z,this}}(),decompose:function(){var t=new c.Vector3,e=new c.Vector3,n=new c.Vector3,i=new c.Matrix4;return function(r,o,a){var s=this.elements;return t.set(s[0],s[1],s[2]),e.set(s[4],s[5],s[6]),n.set(s[8],s[9],s[10]),r=r instanceof c.Vector3?r:new c.Vector3,o=o instanceof c.Quaternion?o:new c.Quaternion,a=a instanceof c.Vector3?a:new c.Vector3,a.x=t.length(),a.y=e.length(),a.z=n.length(),r.x=s[12],r.y=s[13],r.z=s[14],i.copy(this),i.elements[0]/=a.x,i.elements[1]/=a.x,i.elements[2]/=a.x,i.elements[4]/=a.y,i.elements[5]/=a.y,i.elements[6]/=a.y,i.elements[8]/=a.z,i.elements[9]/=a.z,i.elements[10]/=a.z,o.setFromRotationMatrix(i),[r,o,a]}}(),scale:function(t){var e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this},getMaxScaleOnAxis:function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,Math.max(n,i)))},makeFrustum:function(t,e,n,i,r,o){var a=this.elements,s=2*r/(e-t),l=2*r/(i-n),u=(e+t)/(e-t),c=(i+n)/(i-n),d=-(o+r)/(o-r),p=-2*o*r/(o-r);return a[0]=s,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=c,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this},makePerspective:function(t,e,n,i){var r=n*Math.tan(c.Math.degToRad(.5*t)),o=-r,a=o*e,s=r*e;return this.makeFrustum(a,s,o,r,n,i)},makeOrthographic:function(t,e,n,i,r,o){var a=this.elements,s=1/(e-t),l=1/(n-i),u=1/(o-r),c=(e+t)*s,d=(n+i)*l,p=(o+r)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-c,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},isEqual:function(t){var e=t.elements,n=this.elements;return n[0]==e[0]&&n[4]==e[4]&&n[8]==e[8]&&n[12]==e[12]&&n[1]==e[1]&&n[5]==e[5]&&n[9]==e[9]&&n[13]==e[13]&&n[2]==e[2]&&n[6]==e[6]&&n[10]==e[10]&&n[14]==e[14]&&n[3]==e[3]&&n[7]==e[7]&&n[11]==e[11]&&n[15]==e[15]},clone:function(){var t=this.elements;return new c.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])},isIdentity:function(){var t=this.elements;return 1==t[0]&&0==t[4]&&0==t[8]&&0==t[12]&&0==t[1]&&1==t[5]&&0==t[9]&&0==t[13]&&0==t[2]&&0==t[6]&&1==t[10]&&0==t[14]&&0==t[3]&&0==t[7]&&0==t[11]&&1==t[15]}},c.Ray=function(t,e){this.origin=void 0!==t?t:new c.Vector3,this.direction=void 0!==e?e:new c.Vector3},c.Ray.prototype={constructor:c.Ray,set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){var n=e||new c.Vector3;return n.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new c.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,e){var n=e||new c.Vector3;n.subVectors(t,this.origin);var i=n.dot(this.direction);return n.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(t){var e=new c.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t)}}(),isIntersectionCylinder:function(){},isIntersectionSphere:function(t){return this.distanceToPoint(t.center)<=t.radius},isIntersectionPlane:function(t){var e=t.normal.dot(this.direction);return 0!==e||0===t.distanceToPoint(this.origin)},distanceToPlane:function(t){var e=t.normal.dot(this.direction);{if(0!==e){var n=-(this.origin.dot(t.normal)+t.constant)/e;return n}if(0===t.distanceToPoint(this.origin))return 0}},intersectPlane:function(t,e){var n=this.distanceToPlane(t);if(void 0!==n)return this.at(n,e)},applyMatrix4:function(t){return this.direction.add(this.origin).applyMatrix4(t),this.origin.applyMatrix4(t),this.direction.sub(this.origin),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},clone:function(){return(new c.Ray).copy(this)}},c.Sphere=function(t,e){this.center=void 0!==t?t:new c.Vector3,this.radius=void 0!==e?e:0},c.Sphere.prototype={constructor:c.Sphere,set:function(t,e){return this.center.copy(t),this.radius=e,this},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius},clone:function(){return(new c.Sphere).copy(this)}},c.Cylinder=function(t,e,n){this.c1=void 0!==t?t:new c.Vector3,this.c2=void 0!==e?e:new c.Vector3,this.direction=(new c.Vector3).subVectors(this.c2,this.c1).normalize(),this.radius=void 0!==n?n:0},c.Cylinder.prototype={constructor:c.Cylinder,copy:function(t){return this.c1.copy(t.c1),this.c2.copy(t.c2),this.direction.copy(t.direction),this.radius=t.radius,this},lengthSq:function(){var t=new c.Vector3;return function(){return t.subVectors(this.c2,this.c1).lengthSq()}}(),applyMatrix4:function(t){return this.direction.add(this.c1).applyMatrix4(t),this.c1.applyMatrix4(t),this.c2.applyMatrix4(t),this.direction.sub(this.c1).normalize(),this.radius=this.radius*t.getMaxScaleOnAxis(),this}},c.Triangle=function(t,e,n){this.a=void 0!==t?t:new c.Vector3,this.b=void 0!==e?e:new c.Vector3,this.c=void 0!==n?n:new c.Vector3},c.Triangle.prototype={constructor:c.Triangle,copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},applyMatrix4:function(t){return this.a.applyMatrix4(t),this.b.applyMatrix4(t),this.c.applyMatrix4(t),this},getNormal:function(){var t=new c.Vector3;return function(){var e=this.a.clone();return e.sub(this.b),t.subVectors(this.c,this.b),e.cross(t),e.normalize(),e}}()},c.EventDispatcher=function(){var t={};this.addEventListener=function(e,n){void 0===t[e]&&(t[e]=[]),t[e].indexOf(n)===-1&&t[e].push(n)},this.removeEventListener=function(e,n){var i=t[e].indexOf(n);i!==-1&&t[e].splice(i,1)},this.dispatchEvent=function(e){var n=t[e.type];if(void 0!==n){e.target=this;for(var i=0,r=n.length;i<r;i++)n[i].call(this,e)}}},c.Color=function(t){return arguments.length>1?(this.r=arguments[0]||0,this.g=arguments[1]||0,this.b=arguments[2]||0,this):this.set(t)},c.Color.prototype={constructor:c.Color,r:0,g:0,b:0,set:function(t){return t instanceof c.Color?t.clone():void("number"==typeof t?this.setHex(t):"object"==typeof t&&"r"in t&&"g"in t&&"b"in t&&(this.r=t.r,this.g=t.g,this.b=t.b))},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},getHex:function(){var t=Math.round(255*this.r),e=Math.round(255*this.g),n=Math.round(255*this.b);return t<<16|e<<8|n},clone:function(){return new c.Color(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},scaled:function(){var t={};return t.r=Math.round(255*this.r),t.g=Math.round(255*this.g),t.b=Math.round(255*this.b),t.a=1,t}},c.Object3D=function(){this.id=c.Object3DIDCount++,this.name="",this.parent=void 0,this.children=[],this.position=new c.Vector3,this.rotation=new c.Vector3,this.matrix=new c.Matrix4,this.matrixWorld=new c.Matrix4,this.quaternion=new c.Quaternion,this.eulerOrder="XYZ",this.up=new c.Vector3(0,1,0),this.scale=new c.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0},c.Object3D.prototype={constructor:c.Object3D,lookAt:function(t){this.matrix.lookAt(t,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?this.quaternion.copy(this.matrix.decompose()[1]):this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))},add:function(t){if(t===this)return void console.error("Can't add $3Dmol.Object3D to itself");t.parent=this,this.children.push(t);for(var e=this;void 0!==e.parent;)e=e.parent;void 0!==e&&e instanceof c.Scene&&e.__addObject(t)},remove:function(t){var e=this.children.indexOf(t);if(e!==-1){t.parent=void 0,this.children.splice(e,1);for(var n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof c.Scene&&n.__removeObject(t)}},updateMatrix:function(){this.matrix.setPosition(this.position),this.useQuaternion===!1?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),1===this.scale.x&&1===this.scale.y&&1===this.scale.z||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate===!0&&this.updateMatrix(),this.matrixWorldNeedsUpdate!==!0&&t!==!0||(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var e=0;e<this.children.length;e++)this.children[e].updateMatrixWorld(!0)},clone:function(t){void 0===t&&(t=new c.Object3D),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.rotation.copy(this.rotation),t.eulerOrder=this.eulerOrder,t.scale.copy(this.scale),t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.quaternion.copy(this.quaternion),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.useQuaternion=this.useQuaternion,t.visible=this.visible;for(var e=0;e<this.children.length;e++){var n=this.children[e];t.add(n.clone())}return t},setVisible:function(t){this.visible=t;for(var e=0;e<this.children.length;e++){var n=this.children[e];n.setVisible(t)}}},c.Object3DIDCount=0,c.Geometry=function(){var t=65535,e=function(t){this.id=t||0,this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.faceArray=null,this.radiusArray=null,this.lineArray=null,this.vertices=0,this.faceidx=0,this.lineidx=0};e.prototype.getNumVertices=function(){return this.vertices},e.prototype.getVertices=function(){return this.vertexArray},e.prototype.getCentroid=function(){for(var t,e,n,i,r=new c.Vector3,o=0;o<this.vertices;++o)t=3*o,e=this.vertexArray[t],n=this.vertexArray[t+1],i=this.vertexArray[t+2],r.x+=e,r.y+=n,r.z+=i;return r.divideScalar(this.vertices),r},e.prototype.setNormals=function(){var t=this.faceArray,e=this.vertexArray,n=this.normalArray;if(this.vertices&&this.faceidx)for(var i,r,o,a,s,l,u,d=0;d<t.length/3;++d)i=3*t[3*d],r=3*t[3*d+1],o=3*t[3*d+2],a=new c.Vector3(e[i],e[i+1],e[i+2]),s=new c.Vector3(e[r],e[r+1],e[r+2]),l=new c.Vector3(e[o],e[o+1],e[o+2]),a.subVectors(a,s),l.subVectors(l,s),l.cross(a),u=l,u.normalize(),n[i]+=u.x,n[r]+=u.x,n[o]+=u.x,n[i+1]+=u.y,n[r+1]+=u.y,n[o+1]+=u.y,n[i+2]+=u.z,n[r+2]+=u.z,n[o+2]+=u.z},e.prototype.setLineIndices=function(){if(this.faceidx){var t=this.faceArray,e=this.lineArray=new Uint16Array(2*this.faceidx);this.lineidx=2*this.faceidx;for(var n,i=0;i<this.faceidx/3;++i){n=3*i,lineoffset=2*n;var r=t[n],o=t[n+1],a=t[n+2];e[lineoffset]=r,e[lineoffset+1]=o,e[lineoffset+2]=r,e[lineoffset+3]=a,e[lineoffset+4]=o,e[lineoffset+5]=a}}},e.prototype.truncateArrayBuffers=function(t,e){t=t===!0;var n=this.vertexArray,i=this.colorArray,r=this.normalArray,o=this.faceArray,a=this.lineArray,s=this.radiusArray;this.vertexArray=n.subarray(0,3*this.vertices),this.colorArray=i.subarray(0,3*this.vertices),t?(this.normalArray=r.subarray(0,3*this.vertices),this.faceArray=o.subarray(0,this.faceidx),this.lineidx>0?this.lineArray=a.subarray(0,this.lineidx):this.lineArray=new Uint16Array):(this.normalArray=new Float32Array,this.faceArray=new Uint16Array,this.lineArray=new Uint16Array),s&&(this.radiusArray=s.subarray(0,this.vertices)),e&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0};var n=function(n){var i=new e(n.geometryGroups.length);return n.geometryGroups.push(i),n.groups=n.geometryGroups.length,i.vertexArray=new Float32Array(3*t),i.colorArray=new Float32Array(3*t),n.mesh&&(i.normalArray=new Float32Array(3*t),i.faceArray=new Uint16Array(6*t),i.lineArray=new Uint16Array(6*t)),n.radii&&(i.radiusArray=new Float32Array(t)),i.useOffset=n.offset,i},i=function(t,e,n){c.EventDispatcher.call(this),this.id=c.GeometryIDCount++,this.name="",this.hasTangents=!1,this.dynamic=!0,this.mesh=t===!0,this.radii=e||!1,this.offset=n||!1,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.geometryGroups=[],this.groups=0};return i.prototype={constructor:i,updateGeoGroup:function(t){t=t||0;var e=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!e||e.vertices+t>e.vertexArray.length/3)&&(e=n(this)),e},addGeoGroup:function(){return n(this)},setUpNormals:function(t){t=t||!1;for(var e=0;e<this.groups;e++){var n=this.geometryGroups[e];n.setNormals(t)}},setUpWireframe:function(){for(var t=0;t<this.groups;t++){var e=this.geometryGroups[t];e.setLineIndices()}},initTypedArrays:function(){for(var t=0;t<this.groups;t++){var e=this.geometryGroups[t];e.__inittedArrays!==!0&&e.truncateArrayBuffers(this.mesh,!1)}},dispose:function(){this.dispatchEvent({type:"dispose"})}},i}(),Object.defineProperty(c.Geometry.prototype,"vertices",{get:function(){for(var t=0,e=0;e<this.groups;e++)t+=this.geometryGroups[e].vertices;return t}}),c.GeometryIDCount=0,c.Raycaster=function(){var t=function(t,e,n,i){this.ray=new c.Ray(t,e),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=i||0,this.far=n||1/0},e=new c.Sphere,n=new c.Cylinder,i=new c.Triangle,r=new c.Vector3,o=new c.Vector3,a=new c.Vector3,s=new c.Vector3,l=(new c.Ray,new c.Vector3,new c.Vector3),u=(new c.Matrix4,function(t,e){return t.distance-e.distance}),d=function(t){return Math.min(Math.max(t,-1),1)},p=function(t,u,p,h){if(l.getPositionFromMatrix(t.matrixWorld),u.clickable!==!0||void 0===u.intersectionShape)return h;var f=u.intersectionShape,m=p.linePrecision;m*=t.matrixWorld.getMaxScaleOnAxis();var g=m*m;if(void 0!==u.boundingSphere&&u.boundingSphere instanceof c.Sphere&&(e.copy(u.boundingSphere),e.applyMatrix4(t.matrixWorld),!p.ray.isIntersectionSphere(e)))return h;var v,_,y,b,x,w,C,A,T,S,M,I,P,L;for(v=0,_=f.triangle.length;v<_;v++)if(f.triangle[v]instanceof c.Triangle){if(i.copy(f.triangle[v]),i.applyMatrix4(t.matrixWorld),y=i.getNormal(),b=p.ray.direction.dot(y),b>=0)continue;if(r.subVectors(i.a,p.ray.origin),C=y.dot(r)/b,C<0)continue;o.copy(p.ray.direction).multiplyScalar(C).add(p.ray.origin),o.sub(i.a),a.copy(i.b).sub(i.a),s.copy(i.c).sub(i.a);var E=a.dot(s),F=a.lengthSq(),D=s.lengthSq();if(I=(F*o.dot(s)-E*o.dot(a))/(F*D-E*E),I<0||I>1)continue;if(M=(o.dot(a)-I*E)/F,M<0||M>1||M+I>1)continue;h.push({clickable:u,distance:C})}for(v=0,_=f.cylinder.length;v<_;v++)if(f.cylinder[v]instanceof c.Cylinder){if(n.copy(f.cylinder[v]),n.applyMatrix4(t.matrixWorld),r.subVectors(n.c1,p.ray.origin),x=r.dot(n.direction),w=r.dot(p.ray.direction),b=d(p.ray.direction.dot(n.direction)),T=1-b*b,0===T)continue;P=(b*w-x)/T,L=(w-b*x)/T,o.copy(n.direction).multiplyScalar(P).add(n.c1),a.copy(p.ray.direction).multiplyScalar(L).add(p.ray.origin),A=s.subVectors(o,a).lengthSq();var z=n.radius*n.radius;if(A<=z){if(S=(b*x-w)*(b*x-w)-T*(r.lengthSq()-x*x-z),I=C=S<=0?Math.sqrt(A):(w-b*x-Math.sqrt(S))/T,M=b*I-x,M<0||M*M>n.lengthSq()||I<0)continue;h.push({clickable:u,distance:C})}}for(v=0,_=f.line.length;v<_;v+=2){o.copy(f.line[v]),o.applyMatrix4(t.matrixWorld),a.copy(f.line[v+1]),a.applyMatrix4(t.matrixWorld),s.subVectors(a,o);var k=s.lengthSq();s.normalize(),r.subVectors(o,p.ray.origin),lineProj=r.dot(s),w=r.dot(p.ray.direction),b=d(p.ray.direction.dot(s)),T=1-b*b,0!==T&&(P=(b*w-lineProj)/T,L=(w-b*lineProj)/T,o.add(s.multiplyScalar(P)),a.copy(p.ray.direction).multiplyScalar(L).add(p.ray.origin),A=s.subVectors(a,o).lengthSq(),A<g&&P*P<k&&h.push({clickable:u,distance:L}))}for(v=0,_=f.sphere.length;v<_;v++)if(f.sphere[v]instanceof c.Sphere&&(e.copy(f.sphere[v]),e.applyMatrix4(t.matrixWorld),p.ray.isIntersectionSphere(e))){o.subVectors(e.center,p.ray.origin);var V=o.dot(p.ray.direction);return S=V*V-(o.lengthSq()-e.radius*e.radius),V<0?h:(C=S<=0?V:V-Math.sqrt(S),h.push({clickable:u,distance:C}),h)}};return t.prototype.precision=1e-4,t.prototype.linePrecision=.2,t.prototype.set=function(t,e){this.ray.set(t,e)},t.prototype.intersectObjects=function(t,e){for(var n=[],i=0,r=e.length;i<r;i++)p(t,e[i],this,n);return n.sort(u),n},t}(),c.Projector=function(){var t=(new c.Matrix4,new c.Matrix4);this.projectVector=function(e,n){return n.matrixWorldInverse.getInverse(n.matrixWorld),t.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),e.applyProjection(t)},this.unprojectVector=function(e,n){return n.projectionMatrixInverse.getInverse(n.projectionMatrix),t.multiplyMatrices(n.matrixWorld,n.projectionMatrixInverse),e.applyProjection(t)}},c.Camera=function(t,e,n,i,r){c.Object3D.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==e?e:1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.projectionMatrix=new c.Matrix4,this.projectionMatrixInverse=new c.Matrix4,this.matrixWorldInverse=new c.Matrix4;var o=this.position.z;this.right=o*Math.tan(Math.PI/180*t),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!r,this.updateProjectionMatrix()},c.Camera.prototype=Object.create(c.Object3D.prototype),c.Camera.prototype.lookAt=function(t){this.matrix.lookAt(this.position,t,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):this.quaternion.copy(this.matrix.decompose()[1]))},c.Camera.prototype.updateProjectionMatrix=function(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},c.SpritePlugin=function(){function t(t,e){var i=n.createProgram(),r=n.createShader(n.FRAGMENT_SHADER),o=n.createShader(n.VERTEX_SHADER),a="precision "+e+" float;\n";return n.shaderSource(r,a+t.fragmentShader),n.shaderSource(o,a+t.vertexShader),n.compileShader(r),n.compileShader(o),n.getShaderParameter(r,n.COMPILE_STATUS)&&n.getShaderParameter(o,n.COMPILE_STATUS)?(n.attachShader(i,r),n.attachShader(i,o),n.linkProgram(i),n.getProgramParameter(i,n.LINK_STATUS)||console.error("Could not initialize shader"),i):(console.error(n.getShaderInfoLog(r)),console.error("could not initialize shader"),null)}function e(t,e){return t.z!==e.z?e.z-t.z:e.id-t.id}var n,i,r,o={};this.init=function(e){n=e.context,i=e,r=e.getPrecision(),o.vertices=new Float32Array(16),o.faces=new Uint16Array(6);var a=0;o.vertices[a++]=-1,o.vertices[a++]=-1,o.vertices[a++]=0,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=1,o.vertices[a++]=-1,o.vertices[a++]=1,o.vertices[a++]=0,o.vertices[a++]=1,a=0,o.faces[a++]=0,o.faces[a++]=1,o.faces[a++]=2,o.faces[a++]=0,o.faces[a++]=2,o.faces[a++]=3,o.vertexBuffer=n.createBuffer(),o.elementBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,o.vertexBuffer),n.bufferData(n.ARRAY_BUFFER,o.vertices,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.elementBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,o.faces,n.STATIC_DRAW),o.program=t(c.ShaderLib.sprite,r),o.attributes={},o.uniforms={},o.attributes.position=n.getAttribLocation(o.program,"position"),o.attributes.uv=n.getAttribLocation(o.program,"uv"),o.uniforms.uvOffset=n.getUniformLocation(o.program,"uvOffset"),o.uniforms.uvScale=n.getUniformLocation(o.program,"uvScale"),o.uniforms.rotation=n.getUniformLocation(o.program,"rotation"),o.uniforms.scale=n.getUniformLocation(o.program,"scale"),o.uniforms.alignment=n.getUniformLocation(o.program,"alignment"),o.uniforms.color=n.getUniformLocation(o.program,"color"),o.uniforms.map=n.getUniformLocation(o.program,"map"),o.uniforms.opacity=n.getUniformLocation(o.program,"opacity"),o.uniforms.useScreenCoordinates=n.getUniformLocation(o.program,"useScreenCoordinates"),o.uniforms.screenPosition=n.getUniformLocation(o.program,"screenPosition"),o.uniforms.modelViewMatrix=n.getUniformLocation(o.program,"modelViewMatrix"),o.uniforms.projectionMatrix=n.getUniformLocation(o.program,"projectionMatrix"),o.uniforms.fogType=n.getUniformLocation(o.program,"fogType"),o.uniforms.fogDensity=n.getUniformLocation(o.program,"fogDensity"),o.uniforms.fogNear=n.getUniformLocation(o.program,"fogNear"),o.uniforms.fogFar=n.getUniformLocation(o.program,"fogFar"),o.uniforms.fogColor=n.getUniformLocation(o.program,"fogColor"),o.uniforms.alphaTest=n.getUniformLocation(o.program,"alphaTest")},this.render=function(t,r,a,s){var l=t.__webglSprites,u=l.length;if(u){var c=o.attributes,d=o.uniforms,p=.5*a,h=.5*s;n.useProgram(o.program),n.enableVertexAttribArray(c.position),n.enableVertexAttribArray(c.uv),n.disable(n.CULL_FACE),n.enable(n.BLEND),n.bindBuffer(n.ARRAY_BUFFER,o.vertexBuffer),n.vertexAttribPointer(c.position,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(c.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o.elementBuffer),n.uniformMatrix4fv(d.projectionMatrix,!1,r.projectionMatrix.elements),n.activeTexture(n.TEXTURE0),n.uniform1i(d.map,0);var f=0,m=0,g=t.fog;g?(n.uniform3f(d.fogColor,g.color.r,g.color.g,g.color.b),n.uniform1f(d.fogNear,g.near),n.uniform1f(d.fogFar,g.far),n.uniform1i(d.fogType,1),f=1,m=1):(n.uniform1i(d.fogType,0),f=0,m=0);var v,_,y,b,x,w=[];for(v=0;v<u;v++)_=l[v],y=_.material,_.visible&&0!==y.opacity&&(y.useScreenCoordinates?_.z=-_.position.z:(_._modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,_.matrixWorld),_.z=-_._modelViewMatrix.elements[14]));for(l.sort(e),v=0;v<u;v++)if(_=l[v],y=_.material,_.visible&&0!==y.opacity&&y.map&&y.map.image&&y.map.image.width){n.uniform1f(d.alphaTest,y.alphaTest);var C=y.map.image.width,A=y.map.image.height;w[0]=C*i.devicePixelRatio/a,w[1]=A*i.devicePixelRatio/s,y.useScreenCoordinates===!0?(n.uniform1i(d.useScreenCoordinates,1),n.uniform3f(d.screenPosition,(_.position.x*i.devicePixelRatio-p)/p,(h-_.position.y*i.devicePixelRatio)/h,Math.max(0,Math.min(1,_.position.z)))):(n.uniform1i(d.useScreenCoordinates,0),n.uniformMatrix4fv(d.modelViewMatrix,!1,_._modelViewMatrix.elements)),x=t.fog&&y.fog?m:0,f!==x&&(n.uniform1i(d.fogType,x),f=x),b=1/(y.scaleByViewport?s:1),w[0]*=b*_.scale.x,w[1]*=b*_.scale.y,n.uniform2f(d.uvScale,y.uvScale.x,y.uvScale.y),n.uniform2f(d.uvOffset,y.uvOffset.x,y.uvOffset.y),n.uniform2f(d.alignment,y.alignment.x,y.alignment.y),n.uniform1f(d.opacity,y.opacity),n.uniform3f(d.color,y.color.r,y.color.g,y.color.b),n.uniform1f(d.rotation,_.rotation),n.uniform2fv(d.scale,w),i.setDepthTest(y.depthTest),i.setDepthWrite(y.depthWrite),i.setTexture(y.map,0),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0)}n.enable(n.CULL_FACE)}}},c.Light=function(t,e){c.Object3D.call(this),this.color=new c.Color(t),this.position=new c.Vector3(0,1,0),this.target=new c.Object3D,this.intensity=void 0!==e?e:1,this.castShadow=!1,this.onlyShadow=!1},c.Light.prototype=Object.create(c.Object3D.prototype),c.Material=function(){c.EventDispatcher.call(this),this.id=c.MaterialIdCount++,this.name="",this.side=c.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.stencilTest=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0},c.Material.prototype.setValues=function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n){if(e in this){var i=this[e];i instanceof c.Color&&n instanceof c.Color?i.copy(n):i instanceof c.Color?i.set(n):i instanceof c.Vector3&&n instanceof c.Vector3?i.copy(n):this[e]=n}}else console.warn("$3Dmol.Material: '"+e+"' parameter is undefined.")}},c.Material.prototype.clone=function(t){return void 0===t&&(t=new c.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.stencilTest=this.stencilTest,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},c.Material.prototype.dispose=function(){this.dispatchEvent({type:"dispose"})},c.MaterialIdCount=0,c.LineBasicMaterial=function(t){c.Material.call(this),this.color=new c.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(t)},c.LineBasicMaterial.prototype=Object.create(c.Material.prototype),c.LineBasicMaterial.prototype.clone=function(){var t=new c.LineBasicMaterial;return c.Material.prototype.clone.call(this,t),t.color.copy(this.color),t},c.MeshLambertMaterial=function(t){c.Material.call(this),this.color=new c.Color(16777215),this.ambient=new c.Color(1048575),this.emissive=new c.Color(0),this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=c.SmoothShading,this.shaderID="lambert",this.vertexColors=c.NoColors,this.skinning=!1,this.setValues(t)},c.MeshLambertMaterial.prototype=Object.create(c.Material.prototype),c.MeshLambertMaterial.prototype.clone=function(t){return"undefined"==typeof t&&(t=new c.MeshLambertMaterial),c.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.shaderID=this.shaderID,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},c.MeshDoubleLambertMaterial=function(t){c.MeshLambertMaterial.call(this,t),this.shaderID="lambertdouble",this.side=c.DoubleSide},c.MeshDoubleLambertMaterial.prototype=Object.create(c.MeshLambertMaterial.prototype),c.MeshDoubleLambertMaterial.prototype.clone=function(){var t=new c.MeshDoubleLambertMaterial;return c.MeshLambertMaterial.prototype.clone.call(this,t),t},c.MeshOutlineMaterial=function(t){c.Material.call(this),t=t||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=t.color||new c.Color(0,0,0),this.outlineWidth=t.width||.1,this.outlinePushback=t.pushback||1},c.MeshOutlineMaterial.prototype=Object.create(c.Material.prototype),c.MeshOutlineMaterial.prototype.clone=function(t){return"undefined"==typeof t&&(t=new c.MeshOutlineMaterial),c.Material.prototype.clone.call(this,t),t.fog=this.fog,t.shaderID=this.shaderID,t.wireframe=this.wireframe,t},c.ImposterMaterial=function(t){c.Material.call(this),this.color=new c.Color(16777215),this.ambient=new c.Color(1048575),this.emissive=new c.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",
this.wireframeLinejoin="round",this.shading=c.SmoothShading,this.shaderID=null,this.vertexColors=c.NoColors,this.skinning=!1,this.setValues(t)},c.ImposterMaterial.prototype=Object.create(c.Material.prototype),c.ImposterMaterial.prototype.clone=function(){var t=new c.ImposterMaterial;return c.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.shaderID=this.shaderID,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},c.SphereImposterMaterial=function(t){c.ImposterMaterial.call(this),this.shaderID="sphereimposter",this.setValues(t)},c.SphereImposterMaterial.prototype=Object.create(c.ImposterMaterial.prototype),c.SphereImposterMaterial.prototype.clone=function(){var t=new c.SphereImposterMaterial;return c.ImposterMaterial.prototype.clone.call(this,t),t},c.SphereImposterOutlineMaterial=function(t){c.ImposterMaterial.call(this),this.shaderID="sphereimposteroutline",this.outlineColor=t.color||new c.Color(0,0,0),this.outlineWidth=t.width||.1,this.outlinePushback=t.pushback||1,this.setValues(t)},c.SphereImposterOutlineMaterial.prototype=Object.create(c.ImposterMaterial.prototype),c.SphereImposterOutlineMaterial.prototype.clone=function(){var t=new c.SphereImposterOutlineMaterial;return c.ImposterMaterial.prototype.clone.call(this,t),t.outlineColor=this.outlineColor,t.outlineWidth=this.outlineWidth,t.outlinePushback=this.outlinePushback,t},c.StickImposterMaterial=function(t){c.ImposterMaterial.call(this),this.shaderID="stickimposter",this.setValues(t)},c.StickImposterMaterial.prototype=Object.create(c.ImposterMaterial.prototype),c.StickImposterMaterial.prototype.clone=function(){var t=new c.StickImposterOutlineMaterial;return c.ImposterMaterial.prototype.clone.call(this,t),t},c.StickImposterOutlineMaterial=function(t){c.ImposterMaterial.call(this),this.shaderID="stickimposteroutline",this.outlineColor=t.color||new c.Color(0,0,0),this.outlineWidth=t.width||.1,this.outlinePushback=t.pushback||1,this.setValues(t)},c.StickImposterOutlineMaterial.prototype=Object.create(c.ImposterMaterial.prototype),c.StickImposterOutlineMaterial.prototype.clone=function(){var t=new c.StickImposterOutlineMaterial;return c.ImposterMaterial.prototype.clone.call(this,t),t.outlineColor=this.outlineColor,t.outlineWidth=this.outlineWidth,t.outlinePushback=this.outlinePushback,t},c.InstancedMaterial=function(t){c.Material.call(this),this.color=new c.Color(16777215),this.ambient=new c.Color(1048575),this.emissive=new c.Color(0),this.wrapAround=!1,this.wrapRGB=new c.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=c.SmoothShading,this.shaderID="instanced",this.vertexColors=c.NoColors,this.skinning=!1,this.sphere=null,this.setValues(t)},c.InstancedMaterial.prototype=Object.create(c.Material.prototype),c.InstancedMaterial.prototype.clone=function(){var t=new c.InstancedMaterial;return c.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.shaderID=this.shaderID,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t.sphere=this.sphere,t},c.SpriteMaterial=function(t){c.Material.call(this),this.color=new c.Color(16777215),this.map=new c.Texture,this.useScreenCoordinates=!0,this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=c.SpriteAlignment.center.clone(),this.fog=!1,this.uvOffset=new c.Vector2(0,0),this.uvScale=new c.Vector2(1,1),this.setValues(t),t=t||{},void 0===t.depthTest&&(this.depthTest=!this.useScreenCoordinates),void 0===t.sizeAttenuation&&(this.sizeAttenuation=!this.useScreenCoordinates),void 0===t.scaleByViewPort&&(this.scaleByViewPort=!this.sizeAttenuation)},c.SpriteMaterial.prototype=Object.create(c.Material.prototype),c.SpriteMaterial.prototype.clone=function(){var t=new c.SpriteMaterial;return c.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.useScreenCoordinates=useScreenCoordinates,t.sizeAttenuation=this.sizeAttenuation,t.scaleByViewport=this.scaleByViewPort,t.alignment.copy(this.alignment),t.uvOffset.copy(this.uvOffset),t},c.SpriteAlignment={},c.SpriteAlignment.topLeft=new c.Vector2(1,-1),c.SpriteAlignment.topCenter=new c.Vector2(0,-1),c.SpriteAlignment.topRight=new c.Vector2(-1,-1),c.SpriteAlignment.centerLeft=new c.Vector2(1,0),c.SpriteAlignment.center=new c.Vector2(0,0),c.SpriteAlignment.centerRight=new c.Vector2(-1,0),c.SpriteAlignment.bottomLeft=new c.Vector2(1,1),c.SpriteAlignment.bottomCenter=new c.Vector2(0,1),c.SpriteAlignment.bottomRight=new c.Vector2(-1,1),c.Texture=function(t){c.EventDispatcher.call(this),this.id=c.TextureIdCount++,this.name="",this.image=t,this.mipmaps=[],this.mapping=new c.UVMapping,this.wrapS=c.ClampToEdgeWrapping,this.wrapT=c.ClampToEdgeWrapping,this.magFilter=c.LinearFilter,this.minFilter=c.LinearMipMapLinearFilter,this.anisotropy=1,this.format=c.RGBAFormat,this.type=c.UnsignedByteType,this.offset=new c.Vector2(0,0),this.repeat=new c.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},c.Texture.prototype={constructor:c.Texture,clone:function(t){return void 0===t&&(t=new c.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},c.TextureIdCount=0,c.FrontSide=0,c.BackSide=1,c.DoubleSide=2,c.NoShading=0,c.FlatShading=1,c.SmoothShading=2,c.NoColors=0,c.FaceColors=1,c.VertexColors=2,c.MultiplyOperation=0,c.MixOperation=1,c.AddOperation=2,c.UVMapping=function(){},c.ClampToEdgeWrapping=1001,c.LinearFilter=1006,c.LinearMipMapLinearFilter=1008,c.UnsignedByteType=1009,c.RGBAFormat=1021,c.Line=function(t,e,n){c.Object3D.call(this),this.geometry=t,this.material=void 0!==e?e:new c.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:c.LineStrip},c.LineStrip=0,c.LinePieces=1,c.Line.prototype=Object.create(c.Object3D.prototype),c.Line.prototype.clone=function(t){return void 0===t&&(t=new c.Line(this.geometry,this.material,this.type)),c.Object3D.prototype.clone.call(this,t),t},c.Mesh=function(t,e){c.Object3D.call(this),this.geometry=t,this.material=void 0!==e?e:new c.MeshBasicMaterial({color:16777215*Math.random(),wireframe:!0})},c.Mesh.prototype=Object.create(c.Object3D.prototype),c.Mesh.prototype.clone=function(t){return void 0===t&&(t=new c.Mesh(this.geometry,this.material)),c.Object3D.prototype.clone.call(this,t),t},c.Sprite=function(t){c.Object3D.call(this),this.material=void 0!==t?t:new c.SpriteMaterial,this.rotation3d=this.rotation,this.rotation=0},c.Sprite.prototype=Object.create(c.Object3D.prototype),c.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),1===this.scale.x&&1===this.scale.y||this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0},c.Sprite.prototype.clone=function(t){return void 0===t&&(t=new c.Sprite(this.material)),c.Object3D.prototype.clone.call(this,t),t},c.Renderer=function(t){function e(t){at[t]||(R.enableVertexAttribArray(t),at[t]=!0)}function n(){for(var t in at)at[t]&&(R.disableVertexAttribArray(t),at[t]=!1)}function i(t,e,n){tt!==t&&(t?R.enable(R.POLYGON_OFFSET_FILL):R.disable(R.POLYGON_OFFSET_FILL))}function r(t){t!==et&&(R.lineWidth(t),et=t)}function o(t,e){var n;return"fragment"===t?n=R.createShader(R.FRAGMENT_SHADER):"vertex"===t&&(n=R.createShader(R.VERTEX_SHADER)),R.shaderSource(n,e),R.compileShader(n),R.getShaderParameter(n,R.COMPILE_STATUS)?n:(console.error(R.getShaderInfoLog(n)),console.error("could not initialize shader"),null)}function a(t,e,n,i){var r,a,s,l,u=[];u.push(t),u.push(e);for(r in i)u.push(r),u.push(i[r]);for(l=u.join(),r=0,a=U.length;r<a;r++){var c=U[r];if(c.code===l)return c.usedTimes++,c.program}s=R.createProgram();var d=E,p="precision "+d+" float;",h=[p].join("\n"),f=[i.fragdepth?"#extension GL_EXT_frag_depth: enable":"",i.wireframe?"#define WIREFRAME 1":"",p].join("\n"),m=o("fragment",f+t),g=o("vertex",h+e);R.attachShader(s,g),R.attachShader(s,m),R.linkProgram(s),R.getProgramParameter(s,R.LINK_STATUS)||console.error("Could not initialize shader"),s.uniforms={},s.attributes={};var v,_,y;v=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix"];for(_ in n)v.push(_);for(y=0;y<v.length;y++){var b=v[y];s.uniforms[b]=R.getUniformLocation(s,b)}for(v=["position","normal","color","lineDistance","offset","radius"],y=0;y<v.length;y++){var x=v[y];s.attributes[x]=R.getAttribLocation(s,x)}return s.id=q++,U.push({program:s,code:l,usedTimes:1}),B.info.memory.programs=U.length,s}function s(t,e,n,i,r){i.needsUpdate&&(i.program&&_t(i),B.initMaterial(i,e,n,r),i.needsUpdate=!1);var o=!1,a=i.program,s=a.uniforms,u=i.uniforms;return a!=G&&(R.useProgram(a),G=a,o=!0),i.id!=H&&(H=i.id,o=!0),t!=Y&&(Y=t,o=!0),R.uniformMatrix4fv(s.projectionMatrix,!1,t.projectionMatrix.elements),R.uniformMatrix4fv(s.modelViewMatrix,!1,r._modelViewMatrix.elements),R.uniformMatrix3fv(s.normalMatrix,!1,r._normalMatrix.elements),o&&(u.fogColor.value=n.color,u.fogNear.value=n.near,u.fogFar.value=n.far,i.shaderID.startsWith("lambert")||"instanced"===i.shaderID||i.shaderID.endsWith("imposter")?(R.uniformMatrix4fv(s.viewMatrix,!1,t.matrixWorldInverse.elements),ct&&(M(a,e),ct=!1),u.directionalLightColor.value=dt.directional.colors,u.directionalLightDirection.value=dt.directional.positions):i.shaderID.endsWith("outline")?(u.outlineColor.value=i.outlineColor,u.outlineWidth.value=i.outlineWidth,u.outlinePushback.value=i.outlinePushback):"sphereimposter"===i.shaderID&&(R.uniformMatrix4fv(s.viewMatrix,!1,t.matrixWorldInverse.elements),R.uniformMatrix3fv(s.normalMatrix,!1,r._normalMatrix.elements),u.directionalLightColor.value=dt.directional.colors,u.directionalLightDirection.value=dt.directional.positions),u.opacity.value=i.opacity,l(s,u)),a}function l(t,e){var n,i,r,o;for(n in e)t[n]&&(i=e[n].type,r=e[n].value,o=t[n],"f"===i?R.uniform1f(o,r):"fv"===i?R.uniform3fv(o,r):"c"===i?R.uniform3f(o,r.r,r.g,r.b):"f4"===i&&R.uniform4f(o,r[0],r[1],r[2],r[3]))}function u(t,e,n,r,o,a,s,l){var u,c,d,p,h,f,m;e?(h=t.length-1,f=-1,m=-1):(h=0,f=t.length,m=1);for(var g=h;g!==f;g+=m)if(u=t[g],u.render){if(c=u.object,d=u.buffer,p=u[n],!p)continue;s&&B.setBlending(!0),B.setDepthTest(p.depthTest),B.setDepthWrite(p.depthWrite),i(p.polygonOffset,p.polygonOffsetFactor,p.polygonOffsetUnits);var v=c._modelViewMatrix.isReflected();B.setMaterialFaces(p,v),B.renderBuffer(r,o,a,p,d,c),j&&("sphereimposter"==p.shaderID?B.renderBuffer(r,o,a,_outlineSphereImposterMaterial,d,c):"stickimposter"==p.shaderID?B.renderBuffer(r,o,a,_outlineStickImposterMaterial,d,c):p.wireframe||"basic"===p.shaderID||0===p.opacity||B.renderBuffer(r,o,a,j,d,c))}}function d(t,e,n){if(W=-1,G=null,Y=null,Z=-1,J=-1,Q=-1,X=-1,H=-1,K=-1,t.length)for(var i=0,r=t.length;i<r;i++)ct=!0,t[i].render(e,n,rt,ot),W=-1,G=null,Y=null,Z=-1,J=-1,Q=-1,X=-1,H=-1,K=-1}function p(t,e){var n,i,r,o,a;if(!t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new c.Matrix4,t._normalMatrix=new c.Matrix3,void 0!==t.geometry&&void 0===t.geometry.__webglInit&&(t.geometry.__webglInit=!0,t.geometry.addEventListener("dispose",ft)),t instanceof c.Mesh||t instanceof c.Line))for(r=t.geometry,o=t.material,n=0,i=r.geometryGroups.length;n<i;n++)a=r.geometryGroups[n],a.id=$++,a.__webglVertexBuffer||(t instanceof c.Mesh?(y(a),r.elementsNeedUpdate=!0,r.normalsNeedUpdate=!0):t instanceof c.Line&&b(a),r.verticesNeedUpdate=!0,r.colorsNeedUpdate=!0);if(!t.__webglActive){if(t instanceof c.Mesh||t instanceof c.Line)for(r=t.geometry,n=0,i=r.geometryGroups.length;n<i;n++)a=r.geometryGroups[n],x(e.__webglObjects,a,t);else t instanceof c.Sprite&&e.__webglSprites.push(t);t.__webglActive=!0}}function h(t){var e,n=t.geometry;t.material;if(t instanceof c.Mesh||t instanceof c.Line){for(var i=0,r=n.geometryGroups.length;i<r;i++)e=n.geometryGroups[i],(n.verticesNeedUpdate||n.elementsNeedUpdate||n.colorsNeedUpdate||n.normalsNeedUpdate)&&_(e,R.STATIC_DRAW);n.verticesNeedUpdate=!1,n.elementsNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.buffersNeedUpdate=!1}}function f(t,e){t instanceof c.Mesh||t instanceof c.Line?m(e.__webglObjects,t):t instanceof c.Sprite&&g(e.__webglSprites,t),t.__webglActive=!1}function m(t,e){for(var n=t.length-1;n>=0;--n)t[n].object===e&&t.splice(n,1)}function g(t,e){for(var n=t.length-1;n>=0;--n)t[n]===e&&t.splice(n,1)}function v(t){var e=t.object,n=e.material;if(n.transparent){if(t.opaque=null,t.transparent=n,!n.wireframe){var i=n.clone();i.opacity=0,t.blank=i}}else t.opaque=n,t.transparent=null}function _(t,e,n){var i=t.vertexArray,r=t.colorArray;if(void 0!==t.__webglOffsetBuffer?(R.bindBuffer(R.ARRAY_BUFFER,t.__webglOffsetBuffer),R.bufferData(R.ARRAY_BUFFER,i,e)):(R.bindBuffer(R.ARRAY_BUFFER,t.__webglVertexBuffer),R.bufferData(R.ARRAY_BUFFER,i,e)),R.bindBuffer(R.ARRAY_BUFFER,t.__webglColorBuffer),R.bufferData(R.ARRAY_BUFFER,r,e),t.normalArray&&void 0!==t.__webglNormalBuffer){var o=t.normalArray;R.bindBuffer(R.ARRAY_BUFFER,t.__webglNormalBuffer),R.bufferData(R.ARRAY_BUFFER,o,e)}if(t.radiusArray&&void 0!==t.__webglRadiusBuffer&&(R.bindBuffer(R.ARRAY_BUFFER,t.__webglRadiusBuffer),R.bufferData(R.ARRAY_BUFFER,t.radiusArray,e)),t.faceArray&&void 0!==t.__webglFaceBuffer){var a=t.faceArray;R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,t.__webglFaceBuffer),R.bufferData(R.ELEMENT_ARRAY_BUFFER,a,e)}if(t.lineArray&&void 0!==t.__webglLineBuffer){var s=t.lineArray;R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,t.__webglLineBuffer),R.bufferData(R.ELEMENT_ARRAY_BUFFER,s,e)}}function y(t){t.radiusArray&&(t.__webglRadiusBuffer=R.createBuffer()),t.useOffset&&(t.__webglOffsetBuffer=R.createBuffer()),t.__webglVertexBuffer=R.createBuffer(),t.__webglNormalBuffer=R.createBuffer(),t.__webglColorBuffer=R.createBuffer(),t.__webglFaceBuffer=R.createBuffer(),t.__webglLineBuffer=R.createBuffer(),B.info.memory.geometries++}function b(t){t.__webglVertexBuffer=R.createBuffer(),t.__webglColorBuffer=R.createBuffer(),B.info.memory.geometries++}function x(t,e,n){t.push({buffer:e,object:n,opaque:null,transparent:null})}function w(t,e){t._modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld),t._normalMatrix.getInverse(t._modelViewMatrix),t._normalMatrix.transpose()}function C(t){return 0===(t&t-1)}function A(t){return R.LINEAR}function T(t,e,n){n?(R.texParameteri(t,R.TEXTURE_WRAP_S,S(e.wrapS)),R.texParameteri(t,R.TEXTURE_WRAP_T,S(e.wrapT)),R.texParameteri(t,R.TEXTURE_MAG_FILTER,S(e.magFilter)),R.texParameteri(t,R.TEXTURE_MIN_FILTER,S(e.minFilter))):(R.texParameteri(t,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(t,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(t,R.TEXTURE_MAG_FILTER,A(e.magFilter)),R.texParameteri(t,R.TEXTURE_MIN_FILTER,A(e.minFilter)))}function S(t){return t===c.UnsignedByteType?R.UNSIGNED_BYTE:t===c.RGBAFormat?R.RGBA:0}function M(t,e){var n,i,r,o,a,s,l=0,u=0,d=0,p=dt,h=p.directional.colors,f=p.directional.positions,m=0,g=0,v=0;for(n=0,i=e.length;n<i;n++)if(r=e[n],o=r.color,a=r.intensity,s=r.distance,r instanceof c.Light){if(m++,ut.getPositionFromMatrix(r.matrixWorld),lt.getPositionFromMatrix(r.target.matrixWorld),ut.sub(lt),ut.normalize(),0===ut.x&&0===ut.y&&0===ut.z)continue;f[v]=ut.x,f[v+1]=ut.y,f[v+2]=ut.z,h[v]=o.r*a,h[v+1]=o.g*a,h[v+2]=o.b*a,v+=3,g++}p.ambient[0]=l,p.ambient[1]=u,p.ambient[2]=d,p.directional.length=g}function I(){try{if(!(R=L.getContext("experimental-webgl",{alpha:F,premultipliedAlpha:D,antialias:z,stencil:k,preserveDrawingBuffer:V}))&&!(R=L.getContext("webgl",{alpha:F,premultipliedAlpha:D,antialias:z,stencil:k,preserveDrawingBuffer:V})))throw"Error creating WebGL context."}catch(t){console.error(t)}}function P(){R.clearColor(0,0,0,1),R.clearDepth(1),R.clearStencil(0),R.enable(R.DEPTH_TEST),R.depthFunc(R.LEQUAL),R.frontFace(R.CCW),R.cullFace(R.BACK),R.enable(R.CULL_FACE),R.enable(R.BLEND),R.blendEquation(R.FUNC_ADD),R.blendFunc(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA),R.clearColor(O.r,O.g,O.b,N)}t=t||{};var L=void 0!==t.canvas?t.canvas:document.createElement("canvas"),E=void 0!==t.precision?t.precision:"highp",F=void 0===t.alpha||t.alpha,D=void 0===t.premultipliedAlpha||t.premultipliedAlpha,z=void 0!==t.antialias&&t.antialias,k=void 0===t.stencil||t.stencil,V=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,O=void 0!==t.clearColor?new c.Color(t.clearColor):new c.Color(0),N=void 0!==t.clearAlpha?t.clearAlpha:0,j=void 0!==t.outline?new c.MeshOutlineMaterial(t.outline):null;this.domElement=L,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var R,B=this,U=[],q=0,G=null,H=-1,W=null,Y=null,$=0,X=-1,K=-1,Z=-1,Q=-1,J=-1,tt=null,et=null,nt=0,it=0,rt=0,ot=0,at={},st=new c.Matrix4,lt=new c.Vector3,ut=new c.Vector3,ct=!0,dt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};I(),P(),this.context=R;var pt=R.getExtension("ANGLE_instanced_arrays"),ht=R.getExtension("EXT_frag_depth");this.supportedExtensions=function(){return{supportsAIA:Boolean(pt),supportsImposters:Boolean(ht)}},this.getContext=function(){return R},this.getPrecision=function(){return E},this.setClearColorHex=function(t,e){O.setHex(t),N=e,R.clearColor(O.r,O.g,O.b,N)},this.enableOutline=function(t){j=new c.MeshOutlineMaterial(t),_outlineSphereImposterMaterial=new c.SphereImposterOutlineMaterial(t),_outlineStickImposterMaterial=new c.StickImposterOutlineMaterial(t)},this.disableOutline=function(){j=null,_outlineSphereImposterMaterial=null,_outlineStickImposterMaterial=null},this.setSize=function(t,e){nt=L.width=t*this.devicePixelRatio,it=L.height=e*this.devicePixelRatio,L.style.width=t+"px",L.style.height=e+"px",R.viewport(0,0,R.drawingBufferWidth,R.drawingBufferHeight)},this.clear=function(t,e,n){var i=0;(void 0===t||t)&&(i|=R.COLOR_BUFFER_BIT),(void 0===e||e)&&(i|=R.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=R.STENCIL_BUFFER_BIT),R.clear(i)},this.clearTarget=function(t,e,n){this.clear(t,e,n)},this.setMaterialFaces=function(t,e){var n=t.side===c.DoubleSide,i=t.side===c.BackSide;i=e?!i:i,X!==n&&(n?R.disable(R.CULL_FACE):R.enable(R.CULL_FACE),X=n),K!==i&&(i?R.frontFace(R.CW):R.frontFace(R.CCW),K=i)},this.setDepthTest=function(t){Q!==t&&(t?R.enable(R.DEPTH_TEST):R.disable(R.DEPTH_TEST),Q=t)},this.setDepthWrite=function(t){J!==t&&(R.depthMask(t),J=t)},this.setBlending=function(t){t?(R.enable(R.BLEND),R.blendEquationSeparate(R.FUNC_ADD,R.FUNC_ADD),R.blendFuncSeparate(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA,R.ONE,R.ONE_MINUS_SRC_ALPHA)):R.disable(R.BLEND),Z=t},this.addPostPlugin=function(t){t.init(this),this.renderPluginsPost.push(t)};var ft=function(t){var e=t.target;e.removeEventListener("dispose",ft),vt(e),B.info.memory.geometries--},mt=function(t){var e=t.target;e.removeEventListener("dispose",mt),yt(e),B.info.memory.textures--},gt=function(t){var e=t.target;e.removeEventListener("dispose",gt),_t(e)},vt=function(t){if(t.__webglInit=void 0,void 0!==t.__webglVertexBuffer&&R.deleteBuffer(t.__webglVertexBuffer),void 0!==t.__webglColorBuffer&&R.deleteBuffer(t.__webglColorBuffer),void 0!==t.geometryGroups)for(var e=0,n=t.groups;e<n;e++){var i=t.geometryGroups[e];void 0!==i.__webglVertexBuffer&&R.deleteBuffer(i.__webglVertexBuffer),void 0!==i.__webglColorBuffer&&R.deleteBuffer(i.__webglColorBuffer),void 0!==i.__webglNormalBuffer&&R.deleteBuffer(i.__webglNormalBuffer),void 0!==i.__webglFaceBuffer&&R.deleteBuffer(i.__webglFaceBuffer),void 0!==i.__webglLineBuffer&&R.deleteBuffer(i.__webglLineBuffer)}},_t=function(t){var e=t.program;if(void 0!==e){t.program=void 0;var n,i,r,o=!1;for(n=0,i=U.length;n<i;n++)if(r=U[n],r.program===e){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(o===!0){var a=[];for(n=0,i=U.length;n<i;n++)r=U[n],r.program!==e&&a.push(r);U=a,R.deleteProgram(e),B.info.memory.programs--}}},yt=function(t){if(t.image&&t.image.__webglTextureCube)R.deleteTexture(t.image.__webglTextureCube);else{if(!t.__webglInit)return;t.__webglInit=!1,R.deleteTexture(t.__webglTexture)}};this.initMaterial=function(t,e,n,i){t.addEventListener("dispose",gt);var r,o;if(o=t.shaderID){var s=c.ShaderLib[o];t.vertexShader=s.vertexShader,t.fragmentShader=s.fragmentShader,t.uniforms=c.ShaderUtils.clone(s.uniforms)}r={wireframe:t.wireframe,fragdepth:t.imposter},t.program=a(t.fragmentShader,t.vertexShader,t.uniforms,r)},this.renderBuffer=function(t,i,o,a,l,u){if(a.visible){var d,p;d=s(t,i,o,a,u),p=d.attributes;var h=!1,f=a.wireframe?1:0,m=16777215*l.id+2*d.id+f;m!==W&&(W=m,h=!0),h&&(n(),p.position>=0&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglVertexBuffer),e(p.position),R.vertexAttribPointer(p.position,3,R.FLOAT,!1,0,0)),p.color>=0&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglColorBuffer),e(p.color),R.vertexAttribPointer(p.color,3,R.FLOAT,!1,0,0)),p.normal>=0&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglNormalBuffer),e(p.normal),R.vertexAttribPointer(p.normal,3,R.FLOAT,!1,0,0)),p.offset>=0&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglOffsetBuffer),e(p.offset),R.vertexAttribPointer(p.offset,3,R.FLOAT,!1,0,0)),p.radius>=0&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglRadiusBuffer),e(p.radius),R.vertexAttribPointer(p.radius,1,R.FLOAT,!1,0,0)));var g,v;if(u instanceof c.Mesh){if("instanced"===a.shaderID){var _=a.sphere.geometryGroups[0];h&&(R.bindBuffer(R.ARRAY_BUFFER,l.__webglVertexBuffer),R.bufferData(R.ARRAY_BUFFER,_.vertexArray,R.STATIC_DRAW),R.bindBuffer(R.ARRAY_BUFFER,l.__webglNormalBuffer),R.bufferData(R.ARRAY_BUFFER,_.normalArray,R.STATIC_DRAW),R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,l.__webglFaceBuffer),R.bufferData(R.ELEMENT_ARRAY_BUFFER,_.faceArray,R.STATIC_DRAW)),g=_.faceidx,pt.vertexAttribDivisorANGLE(p.offset,1),pt.vertexAttribDivisorANGLE(p.radius,1),pt.vertexAttribDivisorANGLE(p.color,1),pt.drawElementsInstancedANGLE(R.TRIANGLES,g,R.UNSIGNED_SHORT,0,l.radiusArray.length),pt.vertexAttribDivisorANGLE(p.offset,0),pt.vertexAttribDivisorANGLE(p.radius,0),pt.vertexAttribDivisorANGLE(p.color,0)}else a.wireframe?(v=l.lineidx,r(a.wireframeLinewidth),h&&R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,l.__webglLineBuffer),R.drawElements(R.LINES,v,R.UNSIGNED_SHORT,0)):(g=l.faceidx,h&&R.bindBuffer(R.ELEMENT_ARRAY_BUFFER,l.__webglFaceBuffer),R.drawElements(R.TRIANGLES,g,R.UNSIGNED_SHORT,0));B.info.render.calls++,B.info.render.vertices+=g,B.info.render.faces+=g/3}else u instanceof c.Line&&(v=l.vertices,r(a.linewidth),R.drawArrays(R.LINES,0,v),B.info.render.calls++)}},this.render=function(t,e,n){if(e instanceof c.Camera==!1)return void console.error("$3Dmol.Renderer.render: camera is not an instance of $3Dmol.Camera.");var i,r,o,a,s,l=t.__lights,p=t.fog;for(H=-1,ct=!0,this.autoUpdateScene&&t.updateMatrixWorld(),void 0===e.parent&&e.updateMatrixWorld(),e.matrixWorldInverse.getInverse(e.matrixWorld),st.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.autoUpdateObjects&&this.initWebGLObjects(t),B.info.render.calls=0,B.info.render.vertices=0,B.info.render.faces=0,B.info.render.points=0,rt=nt,ot=it,(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),s=t.__webglObjects,i=0,r=s.length;i<r;i++)o=s[i],a=o.object,o.render=!1,a.visible&&(w(a,e),v(o),o.render=!0);var h=null;this.setBlending(!1),u(t.__webglObjects,!0,"opaque",e,l,p,!1,h),u(t.__webglObjects,!0,"blank",e,l,p,!0,h),u(t.__webglObjects,!1,"transparent",e,l,p,!0,h),d(this.renderPluginsPost,t,e),this.setDepthTest(!0),this.setDepthWrite(!0)},this.initWebGLObjects=function(t){if(t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]),t.__objectsAdded.length){for(;t.__objectsAdded.length;)p(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);W=-1}for(;t.__objectsRemoved.length;)f(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var e=0,n=t.__webglObjects.length;e<n;e++)h(t.__webglObjects[e].object)},this.setTexture=function(t,e){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",mt),t.__webglTexture=R.createTexture(),B.info.memory.textures++),R.activeTexture(R.TEXTURE0+e),R.bindTexture(R.TEXTURE_2D,t.__webglTexture),R.pixelStorei(R.UNPACK_FLIP_Y_WEBGL,t.flipY),R.pixelStorei(R.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),R.pixelStorei(R.UNPACK_ALIGNMENT,t.unpackAlignment);var n=t.image,i=C(n.width)&&C(n.height),r=S(t.format),o=S(t.type);T(R.TEXTURE_2D,t,i);var a,s=t.mipmaps;if(s.length>0&&i){for(var l=0,u=s.length;l<u;l++)a=s[l],R.texImage2D(R.TEXTURE_2D,l,r,r,o,a);t.generateMipmaps=!1}else R.texImage2D(R.TEXTURE_2D,0,r,r,o,t.image);t.generateMipmaps&&i&&R.generateMipmap(R.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else R.activeTexture(R.TEXTURE0+e),R.bindTexture(R.TEXTURE_2D,t.__webglTexture)},this.addPostPlugin(new c.SpritePlugin)},c.Scene=function(){c.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},c.Scene.prototype=Object.create(c.Object3D.prototype),c.Scene.prototype.__addObject=function(t){if(t instanceof c.Light)this.__lights.indexOf(t)===-1&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(this.__objects.indexOf(t)===-1){this.__objects.push(t),this.__objectsAdded.push(t);var e=this.__objectsRemoved.indexOf(t);e!==-1&&this.__objectsRemoved.splice(n,1)}for(var n=0;n<t.children.length;n++)this.__addObject(t.children[n])},c.Scene.prototype.__removeObject=function(t){var e;if(t instanceof c.Light)e=this.__lights.indexOf(t),e!==-1&&this.__lights.splice(e,1);else if(e=this.__objects.indexOf(t),e!==-1){this.__objects.splice(e,1),this.__objectsRemoved.push(t);var n=this.__objectsAdded.indexOf(t);n!==-1&&this.__objectsAdded.splice(e,1)}for(var i=0;i<t.children.length;i++)this.__removeObject(t.children[i])},c.Fog=function(t,e,n){this.name="",this.color=new c.Color(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3},c.Fog.prototype.clone=function(){return new c.Fog(this.color.getHex(),this.near,this.far)},c.ShaderUtils={clone:function(t){var e,n={};for(e in t){n[e]={},n[e].type=t[e].type;var i=t[e].value;i instanceof c.Color?n[e].value=i.clone():"number"==typeof i?n[e].value=i:i instanceof Array?n[e].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return n},stickimposterFragmentShader:["uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLight;","varying vec3 vColor;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vec3 color = abs(vColor);","    vec3 pos = cposition;","    vec3 p = pos;","    vec3 v = normalize(pos);","    vec3 pa = p1;","    vec3 va = normalize(p2-p1);","    vec3 tmp1 = v-(dot(v,va)*va);","    vec3 deltap = p-pa;","    float A = dot(tmp1,tmp1);","    if(A == 0.0) discard;","    vec3 tmp2 = deltap-(dot(deltap,va)*va);","    float B = 2.0*dot(tmp1, tmp2);","    float C = dot(tmp2,tmp2)-r*r;","    float det = (B*B) - (4.0*A*C);","    if(det < 0.0) discard;","    float sqrtDet = sqrt(det);","    float posT = (-B+sqrtDet)/(2.0*A);","    float negT = (-B-sqrtDet)/(2.0*A);","    float intersectionT = min(posT,negT);","    vec3 qi = p+v*intersectionT;","    float dotp1 = dot(va,qi-p1);","    float dotp2 = dot(va,qi-p2);","    vec3 norm;","    if( dotp1 < 0.0 || dotp2 > 0.0) {","       vec3 cp;","       if( dotp1 < 0.0) {        cp = p1;","       } else {","          cp = p2;","       }","       vec3 diff = p-cp;","       A = dot(v,v);","       B = dot(diff,v)*2.0;","       C = dot(diff,diff)-r*r;","       det = (B*B) - (4.0*C);","       if(det < 0.0) discard;","       sqrtDet = sqrt(det);","       posT = (-B+sqrtDet)/(2.0);","       negT = (-B-sqrtDet)/(2.0);","       float t = min(posT,negT);","       qi = p+v*t;","       norm = normalize(qi-cp);","    } else {","       norm = normalize(qi-(dotp1*va + p1));","    }","    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragDepthEXT = depth;"].join("\n")},c.ShaderLib={basic:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","attribute vec3 position;","attribute vec3 color;","varying vec3 vColor;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}},sphereimposter:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform mat4 projectionMatrix;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform float uDepth;","uniform vec3 directionalLightColor[ 1 ];","varying vec3 vColor;","varying vec2 mapping;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));","    float dotProduct = dot( norm, vLight );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_FragColor = vec4(vLight*vColor, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, gl_FragDepthEXT/gl_FragCoord.w );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),
vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying vec3 vColor;","varying float rval;","varying vec3 vLight;","varying vec3 center;","void main() {","    vColor = color;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz );","    mapping = normal.xy;","    rval = abs(normal.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},lambert:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},instanced:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    gl_FragColor.xyz *= vLightFront;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 offset;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLightFront;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );","    vLightFront = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},outline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","void main() {","    gl_FragColor = vec4( outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","void main() {","    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    mvPosition.xy += norm.xy*outlineWidth;","    gl_Position = projectionMatrix * mvPosition;","    mvPosition.z -= outlinePushback;","    vec4 pushpos = projectionMatrix*mvPosition;","    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new c.Color(0,0,0)},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},sphereimposteroutline:{fragmentShader:["uniform float opacity;","uniform vec3 outlineColor;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","uniform mat4 projectionMatrix;","varying vec2 mapping;","varying float rval;","varying vec3 center;","uniform float outlinePushback;","void main() {","    float lensqr = dot(mapping,mapping);","    float rsqr = rval*rval;","    if(lensqr > rsqr)","       discard;","    float z = sqrt(rsqr-lensqr);","    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);","    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);","    float ndcDepth = clipPos.z / clipPos.w;","    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;","    gl_FragColor = vec4(outlineColor, 1 );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec2 mapping;","varying float rval;","varying vec3 center;","void main() {","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    center = mvPosition.xyz;","    vec4 projPosition = projectionMatrix * mvPosition;","    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);","    vec4 adjust = projectionMatrix* vec4(norm,normal.z,0.0); adjust.z = 0.0; adjust.w = 0.0;","    mapping = norm.xy;","    rval = abs(norm.x);","    gl_Position = projPosition+adjust;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},outlineColor:{type:"c",value:new c.Color(0,0,0)},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},stickimposter:{fragmentShader:[c.ShaderUtils.stickimposterFragmentShader,"    float dotProduct = dot( norm, vLight );","    vec3 light = vec3( max( dotProduct, 0.0 ) );","    gl_FragColor = vec4(light*color, opacity*opacity );","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = color; vColor.z = abs(vColor.z);","    r = abs(radius);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vLight = normalize( lDirection.xyz )*directionalLightColor[0];","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},stickimposteroutline:{fragmentShader:c.ShaderUtils.stickimposterFragmentShader+"gl_FragColor = vec4(color,1.0);}",vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","uniform vec3 outlineColor;","uniform float outlineWidth;","uniform float outlinePushback;","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","attribute float radius;","varying vec3 vColor;","varying vec3 vLight;","varying vec3 cposition;","varying vec3 p1;","varying vec3 p2;","varying float r;","void main() {","    vColor = outlineColor;","    float rad = radius+sign(radius)*outlineWidth;","    r = abs(rad);","    vec4 to = modelViewMatrix*vec4(normal, 1.0);","    vec4 pt = modelViewMatrix*vec4(position, 1.0);","    to.xyz += normalize(to.xyz)*outlinePushback;","    pt.xyz += normalize(pt.xyz)*outlinePushback;","    vec4 mvPosition = pt;","    p1 = pt.xyz; p2 = to.xyz;","    vec3 norm = to.xyz-pt.xyz;","    float mult = 1.1;","    if(length(p1) > length(p2)) {","       mvPosition = to;","    }","    vec3 n = normalize(mvPosition.xyz);","    if(color.z >= 0.0) {","       vec3 pnorm = normalize(p1);","       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);","       mvPosition.xyz = p1+t*pnorm;","    } else {","       vec3 pnorm = normalize(p2);","       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);","       mvPosition.xyz = p2+t*pnorm;","       mult *= -1.0;","    }","    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;","    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;","    mvPosition.xy +=  mult*(cr + doublecr).xy;","    cposition = mvPosition.xyz;","    gl_Position = projectionMatrix * mvPosition;","    vLight = vec3(1.0,1.0,1.0);","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new c.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1}}},lambertdouble:{fragmentShader:["uniform mat4 viewMatrix;","uniform float opacity;","uniform vec3 fogColor;","uniform float fogNear;","uniform float fogFar;","varying vec3 vLightFront;","varying vec3 vLightBack;","varying vec3 vColor;","void main() {","    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","    #ifndef WIREFRAME","    if ( gl_FrontFacing )","       gl_FragColor.xyz *= vLightFront;","    else","       gl_FragColor.xyz *= vLightBack;","    #endif","    gl_FragColor = gl_FragColor * vec4( vColor, opacity );","    float depth = gl_FragCoord.z / gl_FragCoord.w;","    float fogFactor = smoothstep( fogNear, fogFar, depth );","    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}"].join("\n"),vertexShader:["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 directionalLightColor[ 1 ];","uniform vec3 directionalLightDirection[ 1 ];","attribute vec3 position;","attribute vec3 normal;","attribute vec3 color;","varying vec3 vColor;","varying vec3 vLightFront;","varying vec3 vLightBack;","void main() {","    vColor = color;","    vec3 objectNormal = normal;","    vec3 transformedNormal = normalMatrix * objectNormal;","    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","    vLightFront = vec3( 0.0 );","    vLightBack = vec3( 0.0 );","    transformedNormal = normalize( transformedNormal );","    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );","    vec3 dirVector = normalize( lDirection.xyz );","    float dotProduct = dot( transformedNormal, dirVector );","    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;","    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;","    gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),uniforms:{opacity:{type:"f",value:1},fogColor:{type:"c",value:new c.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}},sprite:{fragmentShader:["uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","    vec4 texture = texture2D(map, vUV);","    if (texture.a < alphaTest) discard;","    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);","    if (fogType > 0) {","        float depth = gl_FragCoord.z / gl_FragCoord.w;","        float fogFactor = 0.0;","        if (fogType == 1) {","            fogFactor = smoothstep(fogNear, fogFar, depth);","        }","        else {","            const float LOG2 = 1.442695;","            float fogFactor = exp2(- fogDensity * fogDensity * depth * depth * LOG2);","            fogFactor = 1.0 - clamp(fogFactor, 0.0, 1.0);","        }","        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);","    }","}"].join("\n"),vertexShader:["uniform int useScreenCoordinates;","uniform vec3 screenPosition;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 alignment;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","    vUV = uvOffset + uv * uvScale;","    vec2 alignedPosition = position + alignment;","    vec2 rotatedPosition;","    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;","    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;","    vec4 finalPosition;","    if(useScreenCoordinates != 0) {","        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);","    }","    else {","        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;","        finalPosition.xy += rotatedPosition; ","    }","    gl_Position = finalPosition;","}"].join("\n"),uniforms:{}}},"undefined"==typeof console&&(console={log:function(){}}),c.ProteinSurface=function(){var t,e,n,r=1,o=2,a=4,s=0,l=0,u=0,d=1.4,p=2,h=p,f=0,m=0,g=0,v=0,_=null,y=null,b=null,x=0,w=0,C=0,A=0,T=0,S=0,M={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},I=function(t){return t.elem&&"undefined"!=typeof M[t.elem]?t.elem:"X"},P={},L={},E=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];this.getFacesAndVertices=function(n){var i,r,o={};for(i=0,r=n.length;i<r;i++)o[n[i]]=!0;var a=e;for(i=0,r=a.length;i<r;i++)a[i].x=a[i].x/h-s,a[i].y=a[i].y/h-l,a[i].z=a[i].z/h-u;var c=[];for(i=0,r=t.length;i<r;i+=3){var d=t[i],p=t[i+1],f=t[i+2],m=a[d].atomid,g=a[p].atomid,v=a[f].atomid,x=m;if(g<x&&(x=g),v<x&&(x=v),o[x]){a[t[i]],a[t[i+1]],a[t[i+2]];d!==p&&p!==f&&d!==f&&(c.push(d),c.push(p),c.push(f))}}return _=null,y=null,b=null,{vertices:a,faces:c}},this.initparm=function(t,e,i){i>1e6&&(h=p/2);var r=1/h*5.5;n=t,x=t[0][0],A=t[1][0],w=t[0][1],T=t[1][1],C=t[0][2],S=t[1][2],e?(x-=d+r,w-=d+r,C-=d+r,A+=d+r,T+=d+r,S+=d+r):(x-=r,w-=r,C-=r,A+=r,T+=r,S+=r),x=Math.floor(x*h)/h,w=Math.floor(w*h)/h,C=Math.floor(C*h)/h,A=Math.ceil(A*h)/h,T=Math.ceil(T*h)/h,S=Math.ceil(S*h)/h,s=-x,l=-w,u=-C,g=Math.ceil(h*(A-x))+1,m=Math.ceil(h*(T-w))+1,f=Math.ceil(h*(S-C))+1,this.boundingatom(e),v=d*h,_=new Uint8Array(g*m*f),y=new Float64Array(g*m*f),b=new Int32Array(g*m*f)},this.boundingatom=function(t){var e,n,i,r=[];flagradius=t;for(var o in M)if(M.hasOwnProperty(o)){var a=M[o];for(t?r[o]=(a+d)*h+.5:r[o]=a*h+.5,i=r[o]*r[o],L[o]=Math.floor(r[o])+1,P[o]=new Int32Array(L[o]*L[o]),indx=0,j=0;j<L[o];j++)for(k=0;k<L[o];k++)e=j*j+k*k,e>i?P[o][indx]=-1:(n=Math.sqrt(i-e),P[o][indx]=Math.floor(n)),indx++}},this.fillvoxels=function(t,e){var n,i;for(n=0,i=_.length;n<i;n++)_[n]=0,y[n]=-1,b[n]=-1;for(n in e){var a=t[e[n]];void 0!==a&&this.fillAtom(a,t)}for(n=0,i=_.length;n<i;n++)_[n]&r&&(_[n]|=o)},this.fillAtom=function(t,e){var n,i,o,a,c,d,p,v,y,x,w,C,A,T,S,M,E,F,D;n=Math.floor(.5+h*(t.x+s)),i=Math.floor(.5+h*(t.y+l)),o=Math.floor(.5+h*(t.z+u));var z=I(t),k=0,V=m*f;for(x=0,D=L[z];x<D;x++)for(w=0;w<D;w++){if(P[z][k]!=-1)for(M=-1;M<2;M++)for(E=-1;E<2;E++)for(F=-1;F<2;F++)if(0!==M&&0!==E&&0!==F)for(p=M*x,y=F*w,C=0;C<=P[z][k];C++)if(v=C*E,A=n+p,T=i+v,S=o+y,!(A<0||T<0||S<0||A>=g||T>=m||S>=f)){var O=A*V+T*f+S;if(_[O]&r){var N=e[b[O]];N.serial!=t.serial&&(a=n+p-Math.floor(.5+h*(N.x+s)),c=i+v-Math.floor(.5+h*(N.y+l)),d=o+y-Math.floor(.5+h*(N.z+u)),p*p+v*v+y*y<a*a+c*c+d*d&&(b[O]=t.serial))}else _[O]|=r,b[O]=t.serial}k++}},this.fillvoxelswaals=function(t,e){var n,i;for(n=0,i=_.length;n<i;n++)_[n]&=-3;for(n in e){var r=t[e[n]];void 0!==r&&this.fillAtomWaals(r,t)}},this.fillAtomWaals=function(t,e){var n,i,r,a,c,d,p,v,y,x,w,C,A,T,S,M,E,F,D,z=0;n=Math.floor(.5+h*(t.x+s)),i=Math.floor(.5+h*(t.y+l)),r=Math.floor(.5+h*(t.z+u));var k=I(t),V=m*f;for(A=0,D=L[k];A<D;A++)for(T=0;T<D;T++){if(P[k][z]!=-1)for(M=-1;M<2;M++)for(E=-1;E<2;E++)for(F=-1;F<2;F++)if(0!==M&&0!==E&&0!==F)for(p=M*A,y=F*T,S=0;S<=P[k][z];S++)if(v=S*E,x=n+p,w=i+v,C=r+y,!(x<0||w<0||C<0||x>=g||w>=m||C>=f)){var O=x*V+w*f+C;if(_[O]&o){var N=e[b[O]];N.serial!=t.serial&&(a=n+p-Math.floor(.5+h*(N.x+s)),c=i+v-Math.floor(.5+h*(N.y+l)),d=r+y-Math.floor(.5+h*(N.z+u)),p*p+v*v+y*y<a*a+c*c+d*d&&(b[O]=t.serial))}else _[O]|=o,b[O]=t.serial}z++}},this.buildboundary=function(){var t=m*f;for(i=0;i<g;i++)for(j=0;j<f;j++)for(k=0;k<m;k++){var e=i*t+k*f+j;if(_[e]&r)for(var n=0;n<26;){var o=i+E[n][0],s=j+E[n][2],l=k+E[n][1];if(o>-1&&o<g&&l>-1&&l<m&&s>-1&&s<f&&!(_[o*t+l*f+s]&r)){_[e]|=a;break}n++}}};var F=function(t,e,n){var i=new Int32Array(t*e*n*3);this.set=function(t,r,o,a){var s=3*((t*e+r)*n+o);i[s]=a.ix,i[s+1]=a.iy,i[s+2]=a.iz},this.get=function(t,r,o){var a=3*((t*e+r)*n+o);return{ix:i[a],iy:i[a+1],iz:i[a+2]}}};this.fastdistancemap=function(){var t,e,n,i,s,l=new F(g,m,f),u=m*f,c=v*v,d=[],p=[];for(t=0;t<g;t++)for(e=0;e<m;e++)for(n=0;n<f;n++)if(s=t*u+e*f+n,_[s]&=-3,_[s]&r&&_[s]&a){var b={ix:t,iy:e,iz:n};l.set(t,e,n,b),d.push(b),y[s]=0,_[s]|=o,_[s]&=-5}do for(p=this.fastoneshell(d,l),d=[],t=0,i=p.length;t<i;t++)s=u*p[t].ix+f*p[t].iy+p[t].iz,_[s]&=-5,y[s]<=1.0404*c&&d.push({ix:p[t].ix,iy:p[t].iy,iz:p[t].iz});while(0!==d.length);d=[],p=[],l=null;var x=h-.5;x<0&&(x=0);var w=c-.5/(.1+x);for(t=0;t<g;t++)for(e=0;e<m;e++)for(n=0;n<f;n++)s=t*u+e*f+n,_[s]&=-5,_[s]&r&&(_[s]&o&&!(_[s]&o&&y[s]>=w)||(_[s]|=a))},this.fastoneshell=function(t,e){var n,i,s,l,u,c,d,p,h,v,b,x,w=[];if(0===t.length)return w;tnv={ix:-1,iy:-1,iz:-1};var C=m*f;for(d=0,h=t.length;d<h;d++)for(n=t[d].ix,i=t[d].iy,s=t[d].iz,b=e.get(n,i,s),p=0;p<6;p++)tnv.ix=n+E[p][0],tnv.iy=i+E[p][1],tnv.iz=s+E[p][2],tnv.ix<g&&tnv.ix>-1&&tnv.iy<m&&tnv.iy>-1&&tnv.iz<f&&tnv.iz>-1&&(x=tnv.ix*C+f*tnv.iy+tnv.iz,_[x]&r&&!(_[x]&o)?(e.set(tnv.ix,tnv.iy,s+E[p][2],b),l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,y[x]=v,_[x]|=o,_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):_[x]&r&&_[x]&o&&(l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,v<y[x]&&(e.set(tnv.ix,tnv.iy,tnv.iz,b),y[x]=v,_[x]&a||(_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(d=0,h=t.length;d<h;d++)for(n=t[d].ix,i=t[d].iy,s=t[d].iz,b=e.get(n,i,s),p=6;p<18;p++)tnv.ix=n+E[p][0],tnv.iy=i+E[p][1],tnv.iz=s+E[p][2],tnv.ix<g&&tnv.ix>-1&&tnv.iy<m&&tnv.iy>-1&&tnv.iz<f&&tnv.iz>-1&&(x=tnv.ix*C+f*tnv.iy+tnv.iz,_[x]&r&&!(_[x]&o)?(e.set(tnv.ix,tnv.iy,s+E[p][2],b),l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,y[x]=v,_[x]|=o,_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):_[x]&r&&_[x]&o&&(l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,v<y[x]&&(e.set(tnv.ix,tnv.iy,tnv.iz,b),y[x]=v,_[x]&a||(_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));for(d=0,h=t.length;d<h;d++)for(n=t[d].ix,i=t[d].iy,s=t[d].iz,b=e.get(n,i,s),p=18;p<26;p++)tnv.ix=n+E[p][0],tnv.iy=i+E[p][1],tnv.iz=s+E[p][2],tnv.ix<g&&tnv.ix>-1&&tnv.iy<m&&tnv.iy>-1&&tnv.iz<f&&tnv.iz>-1&&(x=tnv.ix*C+f*tnv.iy+tnv.iz,_[x]&r&&!(_[x]&o)?(e.set(tnv.ix,tnv.iy,s+E[p][2],b),l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,y[x]=v,_[x]|=o,_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})):_[x]&r&&_[x]&o&&(l=tnv.ix-b.ix,u=tnv.iy-b.iy,c=tnv.iz-b.iz,v=l*l+u*u+c*c,v<y[x]&&(e.set(tnv.ix,tnv.iy,tnv.iz,b),y[x]=v,_[x]&a||(_[x]|=a,w.push({ix:tnv.ix,iy:tnv.iy,iz:tnv.iz})))));return w},this.marchingcubeinit=function(t){for(var e=0,n=_.length;e<n;e++)1==t?_[e]&=-5:4==t?(_[e]&=-3,_[e]&a&&(_[e]|=o),_[e]&=-5):2==t?_[e]&a&&_[e]&o?_[e]&=-5:_[e]&a&&!(_[e]&o)&&(_[e]|=o):3==t&&(_[e]&=-5)};this.marchingcube=function(n){this.marchingcubeinit(n),e=[],t=[],c.MarchingCube.march(_,e,t,{smooth:1,nX:g,nY:m,nZ:f});for(var i=m*f,r=0,o=e.length;r<o;r++)e[r].atomid=b[e[r].x*i+f*e[r].y+e[r].z];c.MarchingCube.laplacianSmooth(1,e,t)}},u(document).ready(function(){if(void 0!==u(".viewer_3Dmoljs")[0]&&(c.autoinit=!0),c.autoinit){c.viewers={};var t=0;u(".viewer_3Dmoljs").each(function(){var e=u(this),n=null;"static"==e.css("position")&&e.css("position","relative");var i="function"==typeof window[e.data("callback")]?window[e.data("callback")]:null,r=null;e.data("pdb")?(n="http://www.rcsb.org/pdb/files/"+e.data("pdb")+".pdb",r="pdb"):e.data("cid")?(r="sdf",n="http://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+e.data("cid")+"/SDF?record_type=3d"):e.data("href")&&(n=e.data("href"));var o=c.CC.color(e.data("backgroundcolor")),a={line:{}};e.data("style")&&(a=c.specStringToObject(e.data("style")));var s={};e.data("select")&&(s=c.specStringToObject(e.data("select")));var l=[],d=[],p=[],h=e.data(),f=/style(.+)/,m=/surface(.*)/,g=/labelres(.*)/,v=[];for(var _ in h)h.hasOwnProperty(_)&&v.push(_);v.sort();for(var y=0;y<v.length;y++){var _=v[y],b=f.exec(_);if(b){var x="select"+b[1],w=c.specStringToObject(h[x]),C=c.specStringToObject(h[_]);l.push([w,C])}if(b=m.exec(_)){var x="select"+b[1],w=c.specStringToObject(h[x]),C=c.specStringToObject(h[_]);d.push([w,C])}if(b=g.exec(_)){var x="select"+b[1],w=c.specStringToObject(h[x]),C=c.specStringToObject(h[_]);p.push([w,C])}}var A=function(t){t.setStyle(s,a);for(var e=0;e<l.length;e++){var n=l[e][0]||{},i=l[e][1]||{line:{}};t.setStyle(n,i)}for(var e=0;e<d.length;e++){var n=d[e][0]||{},i=d[e][1]||{};t.addSurface(c.SurfaceType.VDW,i,n,n)}for(var e=0;e<p.length;e++){var n=p[e][0]||{},i=p[e][1]||{};t.addResLabels(n,i)}t.zoomTo(),t.render()},T=null;try{T=c.viewers[this.id||t++]=c.createViewer(e,{defaultcolors:c.rasmolElementColors}),T.setBackgroundColor(o)}catch(t){window.location="http://get.webgl.org"}if(n)r=e.data("type")||e.data("datatype")||r,r||(r=n.substr(n.lastIndexOf(".")+1)),u.get(n,function(t){T.addModel(t,r),A(T),i&&i(T)},"text");else{if(e.data("element")){var S=u("#"+e.data("element")).val()||"",r=e.data("type")||e.data("datatype");r||(console.log("Warning: No type specified for embedded viewer with moldata from "+e.data("element")+"\n assuming type 'pdb'"),r="pdb"),T.addModel(S,r)}A(T),i&&i(T)}})}}),c.CC={cache:{0:new c.Color(0)},color:function t(e){if(!e)return this.cache[0];if("undefined"!=typeof this.cache[e])return this.cache[e];if(e&&e.constructor===Array)return e.map(t,this);if(e=this.getHex(e),"number"==typeof e){var n=new c.Color(e);return this.cache[e]=n,n}return e},colorTab:{white:16777215,silver:12632256,gray:8421504,grey:8421504,black:0,red:16711680,maroon:8388608,yellow:16776960,orange:16737792,olive:8421376,lime:65280,green:32768,aqua:65535,cyan:65535,teal:32896,blue:255,navy:128,fuchsia:16711935,magenta:16711935,purple:8388736},getHex:function(t){return isNaN(parseInt(t))?"string"==typeof t?this.colorTab[t.trim().toLowerCase()]||0:t:parseInt(t)}},c.CC=c.CC,c.CC.color=c.CC.color,c.getColorFromStyle=function(t,e){var n=t.color;if("undefined"!=typeof e.color&&"spectrum"!=e.color&&(n=e.color),"undefined"!=typeof e.colorscheme){if("undefined"!=typeof c.elementColors[e.colorscheme]){var i=c.elementColors[e.colorscheme];"undefined"!=typeof i[t.elem]&&(n=i[t.elem])}else if("undefined"!=typeof e.colorscheme[t.elem])n=e.colorscheme[t.elem];else if("undefined"!=typeof e.colorscheme.prop&&"undefined"!=typeof e.colorscheme.gradient){var r=e.colorscheme.prop,i=e.colorscheme.gradient,o=i.range()||[-1,1],a=c.getAtomProperty(t,r);null!=a&&(n=i.valueToHex(a,o))}else if("undefined"!=typeof e.colorscheme.prop&&"undefined"!=typeof e.colorscheme.map){var r=e.colorscheme.prop,a=c.getAtomProperty(t,r);"undefined"!=typeof e.colorscheme.map[a]&&(n=e.colorscheme.map[a])}}else"undefined"!=typeof e.colorfunc&&(n=e.colorfunc(t));var s=c.CC.color(n);return s},c.ssColors=c.ssColors||{},c.ssColors.pyMOL={h:16711680,s:16776960,c:65280},c.ssColors.Jmol={h:16711808,s:16762880,c:16777215},c.elementColors=c.elementColors||{},c.elementColors.defaultColor=16716947,c.elementColors.Jmol={H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ca:4062976,CA:4062976,Ti:12567239,TI:12567239,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Br:10889513,BR:10889513,Ag:12632256,AG:12632256,I:9699476,Ba:51456,BA:51456,Au:16765219,AU:16765219},c.elementColors.rasmol={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},c.elementColors.defaultColors=c.elementColors.rasmol,c.elementColors.greenCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.greenCarbon.C=65280,c.elementColors.cyanCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.cyanCarbon.C=65535,c.elementColors.magentaCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.magentaCarbon.C=16711935,c.elementColors.yellowCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.yellowCarbon.C=16776960,c.elementColors.whiteCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.whiteCarbon.C=16777215,c.elementColors.orangeCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.orangeCarbon.C=16737792,c.elementColors.purpleCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.purpleCarbon.C=8388736,c.elementColors.blueCarbon=u.extend({},c.elementColors.defaultColors),c.elementColors.blueCarbon.C=255;var c=c||{};c.drawCartoon=function(){var t=5,e=5,n=.5,i=1.3,r=.8,o=.4,a=function(t,e){var n=[],i=t;i=[],i.push(t[0]);var r,o,a,s,l,u,d,p,h;for(r=1,o=t.length-1;r<o;r++)l=t[r],u=t[r+1],l.smoothen?i.push(new c.Vector3((l.x+u.x)/2,(l.y+u.y)/2,(l.z+u.z)/2)):i.push(l);for(i.push(t[t.length-1]),r=-1,a=i.length;r<=a-3;r++)if(s=i[r===-1?0:r],l=i[r+1],u=i[r+2],d=i[r===a-3?a-1:r+3],p=(new c.Vector3).subVectors(u,s).multiplyScalar(.5),h=(new c.Vector3).subVectors(d,l).multiplyScalar(.5),!u.skip)for(var f=0;f<e;f++){var m=1/e*f,g=l.x+m*p.x+m*m*(-3*l.x+3*u.x-2*p.x-h.x)+m*m*m*(2*l.x-2*u.x+p.x+h.x),v=l.y+m*p.y+m*m*(-3*l.y+3*u.y-2*p.y-h.y)+m*m*m*(2*l.y-2*u.y+p.y+h.y),_=l.z+m*p.z+m*m*(-3*l.z+3*u.z-2*p.z-h.z)+m*m*m*(2*l.z-2*u.z+p.z+h.z),y=new c.Vector3(g,v,_),b=Math.floor((n.length+2)/e);void 0!==t[b]&&void 0!==t[b].atom&&(y.atom=t[b].atom),n.push(y)}return n.push(i[i.length-1]),n},s=function(t,e,n,i,r,o){for(var a,s,l,u,d=new c.Geometry(!0),p=0,h=e.length;p<h;p++){u=Math.round(p*(i.length-1)/h),l=c.CC.color(i[u]),geoGroup=d.updateGeoGroup(2);var f=geoGroup.vertexArray,m=geoGroup.colorArray,g=geoGroup.faceArray;a=geoGroup.vertices,s=3*a,f[s]=e[p].x,f[s+1]=e[p].y,f[s+2]=e[p].z,f[s+3]=n[p].x,f[s+4]=n[p].y,f[s+5]=n[p].z;for(var v=0;v<6;++v)m[s+3*v]=l.r,m[s+1+3*v]=l.g,m[s+2+3*v]=l.b;if(p>0){var _=[a,a+1,a-1,a-2],y=geoGroup.faceidx;g[y]=_[0],g[y+1]=_[1],g[y+2]=_[3],g[y+3]=_[1],g[y+4]=_[2],g[y+5]=_[3],geoGroup.faceidx+=6}geoGroup.vertices+=2}d.initTypedArrays(),d.setUpNormals();var b=new c.MeshDoubleLambertMaterial;"number"==typeof o&&o>=0&&o<1&&(b.transparent=!0,b.opacity=o),b.vertexColors=c.FaceColors;var x=new c.Mesh(d,b);t.add(x)},l=function(t,e,n,i,r,o,l){var u,d,p,h;if(p=e.length,!(p<2||e[0].length<2)){for(i=i||axisDIV,u=0;u<p;u++)e[u]=a(e[u],i);if(h=e[0].length,!r)return s(t,e[0],e[p-1],n,i,o);var f,m,g,v,_,y,b=new c.Geometry(!0),x=[],w=[],C=[];for(d=0;d<p;d++)x.push(.25+1.5*Math.sqrt((p-1)*d-Math.pow(d,2))/(p-1)),w.push(.5),C.push(2*(Math.pow(d/p,2)-d/p)+.6);var A=[];for(d=0;d<2*p-1;d++)A[d]=[d,d+1,d+1-2*p,d-2*p];A[2*p-1]=[d,d+1-2*p,d+1-4*p,d-2*p];
var T,S,M,I,P,L,E,F=b.updateGeoGroup(2*p*h);for(u=0;u<h;u++){E=Math.round(u*(n.length-1)/h),L=c.CC.color(n[E]),_=g,y=v,g=[],v=[],f=[],void 0!==e[0][u].atom&&(I=e[0][u].atom,"oval"===l?m=x:"rectangle"===l?m=w:"parabola"===l&&(m=C)),m||(m=w);var D,z;for(d=0;d<p;d++)D=u<h-1?e[d][u+1].clone().sub(e[d][u]):e[d][u-1].clone().sub(e[d][u]).negate(),z=d<p-1?e[d+1][u].clone().sub(e[d][u]):e[d-1][u].clone().sub(e[d][u]).negate(),f[d]=z.cross(D).normalize().multiplyScalar(r*m[d]);for(d=0;d<p;d++)g[d]=e[d][u].clone().add(f[d].clone().negate());for(d=0;d<p;d++)v[d]=e[d][u].clone().add(f[d]);var k=F.vertexArray,V=F.colorArray,O=F.faceArray;for(T=F.vertices,S=3*T,d=0;d<p;d++)k[S+3*d+0]=g[d].x,k[S+3*d+1]=g[d].y,k[S+3*d+2]=g[d].z;for(d=0;d<p;d++)k[S+3*d+0+3*p]=v[p-1-d].x,k[S+3*d+1+3*p]=v[p-1-d].y,k[S+3*d+2+3*p]=v[p-1-d].z;for(d=0;d<2*p;++d)V[S+3*d+0]=L.r,V[S+3*d+1]=L.g,V[S+3*d+2]=L.b;if(u>0){for(d=0;d<2*p;d++){var N=[T+A[d][0],T+A[d][1],T+A[d][2],T+A[d][3]];M=F.faceidx,O[M]=N[0],O[M+1]=N[1],O[M+2]=N[3],O[M+3]=N[1],O[M+4]=N[2],O[M+5]=N[3],F.faceidx+=6}if(I.clickable){var j=[];j.push(new c.Triangle(_[0],g[0],g[p-1])),j.push(new c.Triangle(_[0],g[p-1],_[p-1])),j.push(new c.Triangle(_[p-1],g[p-1],v[p-1])),j.push(new c.Triangle(_[p-1],v[p-1],y[p-1])),j.push(new c.Triangle(v[0],y[0],y[p-1])),j.push(new c.Triangle(v[p-1],v[0],y[p-1])),j.push(new c.Triangle(g[0],_[0],y[0])),j.push(new c.Triangle(v[0],g[0],y[0]));for(d in j)I.intersectionShape.triangle.push(j[d])}}F.vertices+=2*p,P=I}var k=F.vertexArray,V=F.colorArray,O=F.faceArray;for(T=F.vertices,S=3*T,M=F.faceidx,u=0;u<p-1;u++){var N=[u,u+1,2*p-2-u,2*p-1-u];M=F.faceidx,O[M]=N[0],O[M+1]=N[1],O[M+2]=N[3],O[M+3]=N[1],O[M+4]=N[2],O[M+5]=N[3],F.faceidx+=6}for(u=0;u<p-1;u++){var N=[T-1-u,T-2-u,T-2*p+u+1,T-2*p+u];M=F.faceidx,O[M]=N[0],O[M+1]=N[1],O[M+2]=N[3],O[M+3]=N[1],O[M+4]=N[2],O[M+5]=N[3],F.faceidx+=6}b.initTypedArrays(),b.setUpNormals();var R=new c.MeshDoubleLambertMaterial;R.vertexColors=c.FaceColors,"number"==typeof o&&o>=0&&o<1&&(R.transparent=!0,R.opacity=o);var B=new c.Mesh(b,R);t.add(B)}},d=function(t,e,n,i,r,o){if(!(e.length<2)){var l,u;if(l=e[0],u=e[e.length-1],i=i||axisDIV,l=a(l,i),u=a(u,i),!r)return s(t,l,u,n,i,o);var d,p,h,f,m,g,v,_,y,b,x,w,C,A,T,S,M,I,P,L=new c.Geometry(!0),E=[],F=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]];for(C=0,A=l.length;C<A;C++){if(b=Math.round(C*(n.length-1)/A),y=c.CC.color(n[b]),E.push(p=l[C]),E.push(p),E.push(h=u[C]),E.push(h),C<A-1){var D=l[C+1].clone().sub(l[C]),z=u[C].clone().sub(l[C]);d=z.cross(D).normalize().multiplyScalar(r)}E.push(f=l[C].clone().add(d)),E.push(f),E.push(m=u[C].clone().add(d)),E.push(m),void 0!==p.atom&&(x=p.atom),P=L.updateGeoGroup(8);var k=P.vertexArray,V=P.colorArray,O=P.faceArray;for(g=P.vertices,v=3*g,k[v]=p.x,k[v+1]=p.y,k[v+2]=p.z,k[v+3]=p.x,k[v+4]=p.y,k[v+5]=p.z,k[v+6]=h.x,k[v+7]=h.y,k[v+8]=h.z,k[v+9]=h.x,k[v+10]=h.y,k[v+11]=h.z,k[v+12]=f.x,k[v+13]=f.y,k[v+14]=f.z,k[v+15]=f.x,k[v+16]=f.y,k[v+17]=f.z,k[v+18]=m.x,k[v+19]=m.y,k[v+20]=m.z,k[v+21]=m.x,k[v+22]=m.y,k[v+23]=m.z,T=0;T<8;++T)V[v+3*T]=y.r,V[v+1+3*T]=y.g,V[v+2+3*T]=y.b;if(C>0){var N=void 0!==w&&void 0!==x&&w.serial!==x.serial;for(T=0;T<4;T++){var j=[g+F[T][0],g+F[T][1],g+F[T][2],g+F[T][3]];if(_=P.faceidx,O[_]=j[0],O[_+1]=j[1],O[_+2]=j[3],O[_+3]=j[1],O[_+4]=j[2],O[_+5]=j[3],P.faceidx+=6,x.clickable||w.clickable){var R=E[j[3]].clone(),B=E[j[0]].clone(),U=E[j[2]].clone(),q=E[j[1]].clone();if(R.atom=E[j[3]].atom||null,U.atom=E[j[2]].atom||null,B.atom=E[j[0]].atom||null,q.atom=E[j[1]].atom||null,N){var G=R.clone().add(B).multiplyScalar(.5),H=U.clone().add(q).multiplyScalar(.5),W=R.clone().add(q).multiplyScalar(.5);T%2===0?(w.clickable&&(S=new c.Triangle(G,W,R),M=new c.Triangle(H,U,W),I=new c.Triangle(W,U,R),w.intersectionShape.triangle.push(S),w.intersectionShape.triangle.push(M),w.intersectionShape.triangle.push(I)),x.clickable&&(S=new c.Triangle(B,q,W),M=new c.Triangle(q,H,W),I=new c.Triangle(B,W,G),x.intersectionShape.triangle.push(S),x.intersectionShape.triangle.push(M),x.intersectionShape.triangle.push(I))):(x.clickable&&(S=new c.Triangle(G,W,R),M=new c.Triangle(H,U,W),I=new c.Triangle(W,U,R),x.intersectionShape.triangle.push(S),x.intersectionShape.triangle.push(M),x.intersectionShape.triangle.push(I)),w.clickable&&(S=new c.Triangle(B,q,W),M=new c.Triangle(q,H,W),I=new c.Triangle(B,W,G),w.intersectionShape.triangle.push(S),w.intersectionShape.triangle.push(M),w.intersectionShape.triangle.push(I)))}else x.clickable&&(S=new c.Triangle(B,q,R),M=new c.Triangle(q,U,R),x.intersectionShape.triangle.push(S),x.intersectionShape.triangle.push(M))}}}P.vertices+=8,w=x}var Y=E.length-8;P=L.updateGeoGroup(8);var k=P.vertexArray,V=P.colorArray,O=P.faceArray;for(g=P.vertices,v=3*g,_=P.faceidx,C=0;C<4;C++){E.push(E[2*C]),E.push(E[Y+2*C]);var $=E[2*C],X=E[Y+2*C];k[v+6*C]=$.x,k[v+1+6*C]=$.y,k[v+2+6*C]=$.z,k[v+3+6*C]=X.x,k[v+4+6*C]=X.y,k[v+5+6*C]=X.z,V[v+6*C]=y.r,V[v+1+6*C]=y.g,V[v+2+6*C]=y.b,V[v+3+6*C]=y.r,V[v+4+6*C]=y.g,V[v+5+6*C]=y.b}Y+=8,S=[g,g+2,g+6,g+4],M=[g+1,g+5,g+7,g+3],O[_]=S[0],O[_+1]=S[1],O[_+2]=S[3],O[_+3]=S[1],O[_+4]=S[2],O[_+5]=S[3],O[_+6]=M[0],O[_+7]=M[1],O[_+8]=M[3],O[_+9]=M[1],O[_+10]=M[2],O[_+11]=M[3],P.faceidx+=12,P.vertices+=8,L.initTypedArrays(),L.setUpNormals();var K=new c.MeshDoubleLambertMaterial;K.vertexColors=c.FaceColors,"number"==typeof o&&o>=0&&o<1&&(K.transparent=!0,K.opacity=o);var Z=new c.Mesh(L,K);t.add(Z)}},p=function(t,e,n,i,r){if(0!==e.length){r=void 0===r?5:r;var o=new c.Geometry,s=(a(e,r),new c.LineBasicMaterial({linewidth:n}));s.vertexColors=!0;var l=new c.Line(o,s);l.type=c.LineStrip,t.add(l)}},h=function(t,e,n,i,r,o,a){a&&"default"!==a||(a="rectangle"),"edged"===a?d(t,e,n,i,r,o):"rectangle"!==a&&"oval"!==a&&"parabola"!==a||l(t,e,n,i,r,o,a)},f=function(t){return t&&"C"===t.elem&&"CA"===t.atom},m=function(t,e){if(t&&e&&t.chain===e.chain){if(t.reschain===e.reschain&&(t.resi===e.resi||t.resi===e.resi-1))return!0;if(t.resi<e.resi){var n=new c.Vector3(t.x,t.y,t.z),i=new c.Vector3(e.x,e.y,e.z),r=n.distanceToSquared(i);if(r<16)return!0}}return!1},g=function(n,i,r,a,s,l,d){l=l||t,d=d||e;for(var g,_,y,b,x,w,C,A,T,S,M,I,P,L,E,F,D,z,k,V,O=["CA","O","P","OP2","O2P","O5'","O3'","C5'","C2'","O5*","O3*","C5*","C2*","N1","N3"],N=["DA","DG","A","G"],j=["DT","DC","U","C","T"],R=N.concat(j),B=null,U=[],q=[],T=0;T<l;T++)q[T]=[];var G=!1,H=!1;T=0;for(T in i)if(x=i[T],"C"===x.elem&&"CA"===x.atom){var W=m(b,x);W&&"s"===x.ss?G=!0:G&&(b&&y&&b.style.cartoon.arrows&&y.style.cartoon.arrows&&(b.ss="arrow end",y.ss="arrow start"),G=!1),W&&"h"===b.ss?(!H&&x.style.cartoon.tubes&&(x.ss="tube start"),H=!0):H&&"tube start"!==b.ss&&(y&&y.style.cartoon.tubes&&(y.ss="tube end"),H=!1),y=b,b=x}b=void 0;for(T in i)if(x=i[T],void 0!==x&&u.inArray(x.atom,O)!==-1){var Y=u.inArray(x.resn.trim(),R)!=-1;if(_=x.style.cartoon,"trace"===_.style){if(B||(B=new c.Geometry(!0)),"C"===x.elem&&"CA"===x.atom||Y&&"P"===x.atom){if(C=r&&"spectrum"===_.color?r.valueToHex(x.resi,r.range()):c.getColorFromStyle(x,_).getHex(),U.push(C),A=u.isNumeric(_.thickness)?_.thickness:o,m(b,x))if(C==w){var $=c.CC.color(C);c.GLDraw.drawCylinder(B,b,x,A,$,2,2)}else{var X=(new c.Vector3).addVectors(b,x).multiplyScalar(.5),K=c.CC.color(w),Z=c.CC.color(C);c.GLDraw.drawCylinder(B,b,X,A,K,2,0),c.GLDraw.drawCylinder(B,X,x,A,Z,0,2)}if(b&&B&&(b.style.cartoon&&"trace"!=b.style.cartoon.style||b.chain!=x.chain)){var Q=new c.MeshDoubleLambertMaterial;Q.vertexColors=c.FaceColors,"number"==typeof B.opacity&&B.opacity>=0&&B.opacity<1&&(Q.transparent=!0,Q.opacity=B.opacity,delete B.opacity);var J=new c.Mesh(B,Q);n.add(J),B=null}else b&&(B.opacity&&b.style.cartoon.opacity?B.opacity!=b.style.cartoon.opacity&&(console.log("Warning: a trace-style chain's opacity is ambiguous"),B.opacity=1):B.opacity=parseFloat(b.style.cartoon.opacity)||1);b=x,w=C}}else{if(g||(g=new c.Geometry(!0)),f(x)||Y&&("P"===x.atom||0==x.atom.indexOf("O5"))){if(V){if("tube end"!==x.ss)continue;V=!1,k=new c.Vector3(x.x,x.y,x.z),c.GLDraw.drawCylinder(g,z,k,2,c.CC.color(w),1,1),x.ss="h"}if(b&&(!m(b,x)||b.style.cartoon.style!==x.style.cartoon.style||"tube start"===b.ss)){for("tube start"===b.ss&&(V=!0,z=new c.Vector3(b.x,b.y,b.z),b.ss="h"),D&&(F=L?(new c.Vector3).addVectors(b,L).multiplyScalar(.5):new c.Vector3(b.x,b.y,b.z),c.GLDraw.drawCylinder(g,F,D,.4,c.CC.color(D.color),0,2),S=v(q,l,!s,L,E,P,b,i,T),U.push(C),S&&U.push(C),F=null,D=null),T=0;!A&&T<l;T++)p(n,q[T],1,U,d,q.opacity);if(a&&q[0].length>0&&h(n,q,U,d,A,q.opacity,q.style),null!=g&&g.vertices>0){var tt=new c.MeshDoubleLambertMaterial;tt.vertexColors=c.FaceColors,"number"==typeof q.opacity&&q.opacity>=0&&q.opacity<1&&(tt.transparent=!0,tt.opacity=q.opacity);var et=new c.Mesh(g,tt);n.add(et),g=null}for(q=[],T=0;T<l;T++)q[T]=[];U=[]}if(void 0===b||b.rescode!=x.rescode||b.resi!=x.resi){if(D){F=(new c.Vector3).addVectors(b,x).multiplyScalar(.5);var nt=F.clone().sub(D).multiplyScalar(.02);F.add(nt),c.GLDraw.drawCylinder(g,F,D,.4,c.CC.color(D.color),0,2),F=null,D=null}C=r&&"spectrum"===_.color?r.valueToHex(x.resi,r.range()):c.getColorFromStyle(x,_).getHex(),U.push(C),A=u.isNumeric(_.thickness)?_.thickness:o,b=x,M=new c.Vector3(b.x,b.y,b.z),M.resi=b.resi,w=C}x.clickable!==!0||void 0!==x.intersectionShape&&void 0!==x.intersectionShape.triangle||(x.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else f(b)&&"O"===x.atom||Y&&"P"===b.atom&&("OP2"===x.atom||"O2P"===x.atom)||Y&&0==b.atom.indexOf("O5")&&0==x.atom.indexOf("C5")?(I=new c.Vector3(x.x,x.y,x.z),I.resi=x.resi,"OP2"!==x.atom&&"O2P"!==x.atom||(E=new c.Vector3(x.x,x.y,x.z))):Y&&0==x.atom.indexOf("O3")?L=new c.Vector3(x.x,x.y,x.z):("N1"===x.atom&&u.inArray(x.resn.trim(),N)!=-1||"N3"===x.atom&&u.inArray(x.resn.trim(),j)!=-1)&&(D=new c.Vector3(x.x,x.y,x.z),D.color=c.getColorFromStyle(x,_).getHex());I&&M&&I.resi===M.resi&&(S=v(q,l,!s,M,I,P,b,i,T),P=I,M=null,I=null,U.push(C),S&&U.push(C))}}for(D&&(F=L?(new c.Vector3).addVectors(b,L).multiplyScalar(.5):new c.Vector3(b.x,b.y,b.z),c.GLDraw.drawCylinder(g,F,D,.4,c.CC.color(D.color),0,2),S=v(q,l,!s,L,E,P,b,i,T),U.push(C),S&&U.push(C)),T=0;!A&&T<l;T++)p(n,q[T],1,U,d,q.opacity);if(a&&q[0].length>0&&h(n,q,U,d,A,q.opacity,q.style),null!=g&&g.vertices>0){var tt=new c.MeshDoubleLambertMaterial;tt.vertexColors=c.FaceColors,"number"==typeof q.opacity&&q.opacity>=0&&q.opacity<1&&(tt.transparent=!0,tt.opacity=q.opacity);var et=new c.Mesh(g,tt);n.add(et),g=null}if(null!=B&&B.vertices>0){var Q=new c.MeshDoubleLambertMaterial;Q.vertexColors=c.FaceColors,"number"==typeof B.opacity&&B.opacity>=0&&B.opacity<1&&(Q.transparent=!0,Q.opacity=B.opacity,delete B.opacity);var J=new c.Mesh(B,Q);n.add(J)}},v=function(t,e,a,s,l,u,d,p,h){var f,m,g,v,_,y,b,x={ALA:5,ARG:11,ASN:8,ASP:8,CYS:6,GLN:9,GLU:9,GLY:4,HIS:10,ILE:8,LEU:8,LYS:9,MET:8,PHE:11,PRO:7,SER:6,THR:7,TRP:14,TYR:12,VAL:7};if(s&&l&&d){var w=l.sub(s);w.normalize();var C=p[parseInt(h)+x[d.resn]];if(C=C?new c.Vector3(C.x,C.y,C.z):new c.Vector3(0,0,0),C.sub(s),"arrow start"===d.ss){var A=C.clone().multiplyScalar(.3).cross(l);s.add(A);var T=C.clone().cross(w).normalize();w.rotateAboutVector(T,.43)}for(d.style.cartoon.ribbon?f=d.style.cartoon.thickness||o:d.style.cartoon.width?f=d.style.cartoon.width:"c"===d.ss?f="P"===d.atom?r:n:"arrow start"===d.ss?(f=i,_=!0):f="arrow end"===d.ss?n:"h"===d.ss&&d.style.cartoon.tubes||"tube start"===d.ss?n:i,null!=u&&w.dot(u)<0&&w.negate(),w.multiplyScalar(f),m=0;m<e;m++)g=-1+2*m/(e-1),v=new c.Vector3(s.x+g*w.x,s.y+g*w.y,s.z+g*w.z),v.atom=d,a&&"s"===d.ss&&(v.smoothen=!0),t[m].push(v);if(_)for(w.multiplyScalar(2),m=0;m<e;m++)g=-1+2*m/(e-1),v=new c.Vector3(s.x+g*w.x,s.y+g*w.y,s.z+g*w.z),v.atom=d,v.smoothen=!1,v.skip=!0,t[m].push(v);return y=parseFloat(d.style.cartoon.opacity)||1,t.opacity?t.opacity!=y&&(console.log("Warning: a cartoon-style chain's opacity is ambiguous"),t.opacity=1):t.opacity=y,b=d.style.cartoon.style||"default",t.style?t.style!=b&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),t.style="default"):t.style=b,"arrow start"!==d.ss&&"arrow end"!==d.ss||(d.ss="s"),_}},_=function(t,e,n,i){i=parseInt(5*parseFloat(i))||5,g(t,e,n,fill=!0,doNotSmoothen=!1,num=i,div=i)};return _}();var c=c||{};c.GLDraw=function(){var t={},e=function(){var t=new c.Vector3;return function(e){t.set(e[0],e[1],e[2]);var n,i,r,o,a,s=t.x,l=t.y,u=t.z,c=Math.sqrt(s*s+l*l);c<1e-4?(i=0,r=1):(i=-s/c,r=l/c),l=-i*s+r*l,n=Math.sqrt(l*l+u*u),n<1e-4?(o=0,a=1):(o=u/n,a=l/n);var d=new Float32Array(9);return d[0]=r,d[1]=i,d[2]=0,d[3]=-i*a,d[4]=r*a,d[5]=o,d[6]=i*o,d[7]=-r*o,d[8]=a,d}}(),n=function(){var t,e=[],n=4,i=Math.pow(2,n),r=2,o=Math.pow(2,r),a=i/o;for(e[0]=new c.Vector3(-1,0,0),e[a]=new c.Vector3(0,0,1),e[2*a]=new c.Vector3(1,0,0),e[3*a]=new c.Vector3(0,0,-1),r=3;r<=n;r++){for(o=Math.pow(2,r-1),a=i/o,t=0;t<o-1;t++)e[a/2+t*a]=e[t*a].clone().add(e[(t+1)*a]).normalize();t=o-1,e[a/2+t*a]=e[t*a].clone().add(e[0]).normalize()}return e}(),i={cache:{false:{},true:{}},getVerticesForRadius:function(t,e){if(void 0!==this.cache[e][t])return this.cache[e][t];for(var i,r=(new c.Vector3(0,1,0),n.length),o=[],a=[],s=0;s<r;s++)o.push(n[s].clone().multiplyScalar(t)),o.push(n[s].clone().multiplyScalar(t)),i=n[s].clone().normalize(),a.push(i),a.push(i);var l=[],u=10,d=r;if(u%2!==0||!u)return console.error("heightSegments must be even"),null;var p,h,f=0,m=2*Math.PI,g=0,v=Math.PI,_=!1,y=!1;for(h=0;h<=u;h++){_=0===h||h===u,y=h===u/2;var b=[],x=[];for(p=0;p<=d;p++)if(y){var w=p<d?2*p:0;x.push(w+1),b.push(w)}else{var C=p/d,A=h/u;if(_&&0!==p)_&&b.push(o.length-1);else if(p<d){var T=new c.Vector3;T.x=-t*Math.cos(f+C*m)*Math.sin(g+A*v),T.y=e?0:t*Math.cos(g+A*v),T.z=t*Math.sin(f+C*m)*Math.sin(g+A*v),Math.abs(T.x)<1e-5&&(T.x=0),Math.abs(T.y)<1e-5&&(T.y=0),Math.abs(T.z)<1e-5&&(T.z=0),e?(i=new c.Vector3(0,Math.cos(g+A*v),0),i.normalize()):(i=new c.Vector3(T.x,T.y,T.z),i.normalize()),o.push(T),a.push(i),b.push(o.length-1)}else b.push(o.length-d)}y&&l.push(x),l.push(b)}var S={vertices:o,normals:a,verticesRows:l,w:d,h:u};return this.cache[e][t]=S,S}},r=0;t.drawCylinder=function(t,n,o,a,s,l,u){if(n&&o){r++;var c=l||u,d=!1;1==l&&1==u&&(d=!0),s=s||{r:0,g:0,b:0};var p=[o.x,o.y,o.z];p[0]-=n.x,p[1]-=n.y,p[2]-=n.z;var h,f,m,g,v,_,y=e(p),b=i.getVerticesForRadius(a,d),x=b.w,w=b.h,C=c?w*x+2:2*x,A=t.updateGeoGroup(C),T=b.vertices,S=b.normals,M=b.verticesRows,I=M[w/2],P=M[w/2+1],L=A.vertices,E=A.vertexArray,F=A.normalArray,D=A.colorArray,z=A.faceArray;for(m=0;m<x;++m){var k=2*m;g=y[0]*T[k].x+y[3]*T[k].y+y[6]*T[k].z,v=y[1]*T[k].x+y[4]*T[k].y+y[7]*T[k].z,_=y[5]*T[k].y+y[8]*T[k].z,h=3*(L+k),f=A.faceidx,E[h]=g+n.x,E[h+1]=v+n.y,E[h+2]=_+n.z,E[h+3]=g+o.x,E[h+4]=v+o.y,E[h+5]=_+o.z,F[h]=g,F[h+3]=g,F[h+1]=v,F[h+4]=v,F[h+2]=_,F[h+5]=_,D[h]=s.r,D[h+3]=s.r,D[h+1]=s.g,D[h+4]=s.g,D[h+2]=s.b,D[h+5]=s.b,z[f]=P[m]+L,z[f+1]=P[m+1]+L,z[f+2]=I[m]+L,z[f+3]=I[m]+L,z[f+4]=P[m+1]+L,z[f+5]=I[m+1]+L,A.faceidx+=6}if(c){var V,O,N,j,R,B,U,q,G,H,W,Y,$,X,K,Z,Q,J,tt,et,nt,it,rt,ot,at,st,lt,ut,ct,dt,pt,ht,ft=u?0:w/2,mt=l?w+1:w/2+1;for(v=ft;v<mt;v++)if(v!==w/2){var gt=v<=w/2?o:n;for(g=0;g<x;g++)f=A.faceidx,V=M[v][g+1],ct=3*(V+L),O=M[v][g],dt=3*(O+L),N=M[v+1][g],pt=3*(N+L),j=M[v+1][g+1],ht=3*(j+L),R=y[0]*T[V].x+y[3]*T[V].y+y[6]*T[V].z,B=y[0]*T[O].x+y[3]*T[O].y+y[6]*T[O].z,U=y[0]*T[N].x+y[3]*T[N].y+y[6]*T[N].z,q=y[0]*T[j].x+y[3]*T[j].y+y[6]*T[j].z,G=y[1]*T[V].x+y[4]*T[V].y+y[7]*T[V].z,H=y[1]*T[O].x+y[4]*T[O].y+y[7]*T[O].z,W=y[1]*T[N].x+y[4]*T[N].y+y[7]*T[N].z,Y=y[1]*T[j].x+y[4]*T[j].y+y[7]*T[j].z,$=y[5]*T[V].y+y[8]*T[V].z,X=y[5]*T[O].y+y[8]*T[O].z,K=y[5]*T[N].y+y[8]*T[N].z,Z=y[5]*T[j].y+y[8]*T[j].z,E[ct]=R+gt.x,E[dt]=B+gt.x,E[pt]=U+gt.x,E[ht]=q+gt.x,E[ct+1]=G+gt.y,E[dt+1]=H+gt.y,E[pt+1]=W+gt.y,E[ht+1]=Y+gt.y,E[ct+2]=$+gt.z,E[dt+2]=X+gt.z,E[pt+2]=K+gt.z,E[ht+2]=Z+gt.z,D[ct]=s.r,D[dt]=s.r,D[pt]=s.r,D[ht]=s.r,D[ct+1]=s.g,D[dt+1]=s.g,D[pt+1]=s.g,D[ht+1]=s.g,D[ct+2]=s.b,D[dt+2]=s.b,D[pt+2]=s.b,D[ht+2]=s.b,Q=y[0]*S[V].x+y[3]*S[V].y+y[6]*S[V].z,J=y[0]*S[O].x+y[3]*S[O].y+y[6]*S[O].z,tt=y[0]*S[N].x+y[3]*S[N].y+y[6]*S[N].z,et=y[0]*S[j].x+y[3]*S[j].y+y[6]*S[j].z,nt=y[1]*S[V].x+y[4]*S[V].y+y[7]*S[V].z,it=y[1]*S[O].x+y[4]*S[O].y+y[7]*S[O].z,rt=y[1]*S[N].x+y[4]*S[N].y+y[7]*S[N].z,ot=y[1]*S[j].x+y[4]*S[j].y+y[7]*S[j].z,at=y[5]*S[V].y+y[8]*S[V].z,st=y[5]*S[O].y+y[8]*S[O].z,lt=y[5]*S[N].y+y[8]*S[N].z,ut=y[5]*S[j].y+y[8]*S[j].z,0===v?(F[ct]=Q,F[pt]=tt,F[ht]=et,F[ct+1]=nt,F[pt+1]=rt,F[ht+1]=ot,F[ct+2]=at,F[pt+2]=lt,F[ht+2]=ut,z[f]=V+L,z[f+1]=N+L,z[f+2]=j+L,A.faceidx+=3):v===mt-1?(F[ct]=Q,F[dt]=J,F[pt]=tt,F[ct+1]=nt,F[dt+1]=it,F[pt+1]=rt,F[ct+2]=at,F[dt+2]=st,F[pt+2]=lt,z[f]=V+L,z[f+1]=O+L,z[f+2]=N+L,A.faceidx+=3):(F[ct]=Q,F[dt]=J,F[ht]=et,F[ct+1]=nt,F[dt+1]=it,F[ht+1]=ot,F[ct+2]=at,F[dt+2]=st,F[ht+2]=ut,F[dt]=J,F[pt]=tt,F[ht]=et,F[dt+1]=it,F[pt+1]=rt,F[ht+1]=ot,F[dt+2]=st,F[pt+2]=lt,F[ht+2]=ut,z[f]=V+L,z[f+1]=O+L,z[f+2]=j+L,z[f+3]=O+L,z[f+4]=N+L,z[f+5]=j+L,A.faceidx+=6)}}A.vertices+=C}},t.drawCone=function(t,i,r,o,a){if(i&&r){a=a||{r:0,g:0,b:0};var s=[r.x,r.y,r.z];s.x-=i.x,s.y-=i.y,s.z-=i.z;var l,u,d,p,h,f,m=e(s),g=n.length,v=n,_=g+2,y=t.updateGeoGroup(_),b=y.vertices,x=y.vertexArray,w=y.normalArray,C=y.colorArray,A=y.faceArray,l=3*b,T=new c.Vector3(s[0],s[1],s[2]).normalize();for(x[l]=i.x,x[l+1]=i.y,x[l+2]=i.z,w[l]=-T.x,w[l+1]=-T.y,w[l+2]=-T.z,C[l]=a.r,C[l+1]=a.g,C[l+2]=a.b,x[l+3]=r.x,x[l+4]=r.y,x[l+5]=r.z,w[l+3]=T.x,w[l+4]=T.y,w[l+5]=T.z,C[l+3]=a.r,C[l+4]=a.g,C[l+5]=a.b,l+=6,d=0;d<g;++d){var S=v[d].clone();S.multiplyScalar(o),p=m[0]*S.x+m[3]*S.y+m[6]*S.z,h=m[1]*S.x+m[4]*S.y+m[7]*S.z,f=m[5]*S.y+m[8]*S.z,x[l]=p+i.x,x[l+1]=h+i.y,x[l+2]=f+i.z,w[l]=p,w[l+1]=h,w[l+2]=f,C[l]=a.r,C[l+1]=a.g,C[l+2]=a.b,l+=3}y.vertices+=g+2;var u=y.faceidx;for(d=0;d<g;d++){var M=b+2+d,I=b+2+(d+1)%g;A[u]=M,A[u+1]=I,A[u+2]=b,u+=3,A[u]=M,A[u+1]=I,A[u+2]=b+1,u+=3}y.faceidx+=6*g}};var o={cache:{},getVerticesForRadius:function(t){if("undefined"!=typeof this.cache[t])return this.cache[t];var e={vertices:[],verticesRows:[],normals:[]},n=1,i=16*n,r=10*n;t<1&&(i=10*n,r=8*n);var o,a,s=0,l=2*Math.PI,u=0,d=Math.PI;for(a=0;a<=r;a++){var p=[];for(o=0;o<=i;o++){var h=o/i,f=a/r,m={};m.x=-t*Math.cos(s+h*l)*Math.sin(u+f*d),m.y=t*Math.cos(u+f*d),m.z=t*Math.sin(s+h*l)*Math.sin(u+f*d);var g=new c.Vector3(m.x,m.y,m.z);g.normalize(),e.vertices.push(m),e.normals.push(g),p.push(e.vertices.length-1)}e.verticesRows.push(p)}return this.cache[t]=e,e}};return t.drawSphere=function(t,e,n,i){for(var r,a,s=(new c.Vector3(e.x,e.y,e.z),o.getVerticesForRadius(n)),l=s.vertices,u=s.normals,d=t.updateGeoGroup(l.length),p=d.vertices,h=d.vertexArray,f=d.colorArray,m=d.faceArray,g=d.lineArray,v=d.normalArray,_=0,y=l.length;_<y;++_){var b=3*(p+_),x=l[_];h[b]=x.x+e.x,h[b+1]=x.y+e.y,h[b+2]=x.z+e.z,f[b]=i.r,f[b+1]=i.g,f[b+2]=i.b}d.vertices+=l.length;var w=s.verticesRows,C=w.length-1;for(a=0;a<C;a++){var A=w[a].length-1;for(r=0;r<A;r++){var T=d.faceidx,S=d.lineidx,M=w[a][r+1]+p,I=3*M,P=w[a][r]+p,L=3*P,E=w[a+1][r]+p,F=3*E,D=w[a+1][r+1]+p,z=3*D,k=u[M-p],V=u[P-p],O=u[E-p],N=u[D-p];Math.abs(l[M-p].y)===n?(v[I]=k.x,v[F]=O.x,v[z]=N.x,v[I+1]=k.y,v[F+1]=O.y,v[z+1]=N.y,v[I+2]=k.z,v[F+2]=O.z,v[z+2]=N.z,m[T]=M,m[T+1]=E,m[T+2]=D,g[S]=M,g[S+1]=E,g[S+2]=M,g[S+3]=D,g[S+4]=E,g[S+5]=D,d.faceidx+=3,d.lineidx+=6):Math.abs(l[E-p].y)===n?(v[I]=k.x,v[L]=V.x,v[F]=O.x,v[I+1]=k.y,v[L+1]=V.y,v[F+1]=O.y,v[I+2]=k.z,v[L+2]=V.z,v[F+2]=O.z,m[T]=M,m[T+1]=P,m[T+2]=E,g[S]=M,g[S+1]=P,g[S+2]=M,g[S+3]=E,g[S+4]=P,g[S+5]=E,d.faceidx+=3,d.lineidx+=6):(v[I]=k.x,v[L]=V.x,v[z]=N.x,v[I+1]=k.y,v[L+1]=V.y,v[z+1]=N.y,v[I+2]=k.z,v[L+2]=V.z,v[z+2]=N.z,v[L]=V.x,v[F]=O.x,v[z]=N.x,v[L+1]=V.y,v[F+1]=O.y,v[z+1]=N.y,v[L+2]=V.z,v[F+2]=O.z,v[z+2]=N.z,m[T]=M,m[T+1]=P,m[T+2]=D,m[T+3]=P,m[T+4]=E,m[T+5]=D,g[S]=M,g[S+1]=P,g[S+2]=M,g[S+3]=D,g[S+4]=P,g[S+5]=E,g[S+6]=E,g[S+7]=D,d.faceidx+=6,d.lineidx+=8)}}},t}();var c=c||{};c.GLModel=function(){function t(t,o){var p,h=[],f=[],m=t,g=!1,v=null,_=null,y=null,b={},x=new c.Matrix4,w=c.elementColors.defaultColor,C=o?o:c.elementColors.defaultColors,A=1.5,T=function(t,e){var n=A;return"undefined"!=typeof e.radius?n=e.radius:r[t.elem]&&(n=r[t.elem]),"undefined"!=typeof e.scale&&(n*=e.scale),n},S=function(t,e){if(t.style.cross){var i=t.style.cross;if(!i.hidden){var r=i.linewidth||n;e[r]||(e[r]=new c.Geometry);var o=e[r].updateGeoGroup(6),a=T(t,i),s=[[a,0,0],[-a,0,0],[0,a,0],[0,-a,0],[0,0,a],[0,0,-a]],l=t.clickable;l&&void 0===t.intersectionShape&&(t.intersectionShape={sphere:[],cylinder:[],line:[]});for(var u=c.getColorFromStyle(t,i),d=o.vertexArray,p=o.colorArray,h=0;h<6;h++){var f=3*o.vertices;if(o.vertices++,d[f]=t.x+s[h][0],d[f+1]=t.y+s[h][1],d[f+2]=t.z+s[h][2],p[f]=u.r,p[f+1]=u.g,p[f+2]=u.b,l){var m=new c.Vector3(s[h][0],s[h][1],s[h][2]);m.multiplyScalar(.1),m.set(m.x+t.x,m.y+t.y,m.z+t.z),t.intersectionShape.line.push(m)}}}}},M=function(t,e,n){var i=new c.Vector3(t.x,t.y,t.z),r=new c.Vector3(e.x,e.y,e.z),o=r.clone(),a=null;o.sub(i);var s,l,u,d,p;return 1===t.bonds.length?1===e.bonds.length?(a=o.clone(),Math.abs(a.x)>1e-4?a.y+=1:a.x+=1):(s=(n+1)%e.bonds.length,l=e.bonds[s],u=h[l],d=new c.Vector3(u.x,u.y,u.z),p=d.clone(),p.sub(i),a=p.clone(),a.cross(o)):(s=(n+1)%t.bonds.length,l=t.bonds[s],u=h[l],d=new c.Vector3(u.x,u.y,u.z),p=d.clone(),p.sub(i),a=p.clone(),a.cross(o)),a.lengthSq()<.01&&(a=o.clone(),Math.abs(a.x)>1e-4?a.y+=1:a.x+=1),a.cross(o),a.normalize(),a},I=function(t,e,n,i,r,o){t[n]=i.x,t[n+1]=i.y,t[n+2]=i.z,e[n]=o.r,e[n+1]=o.g,e[n+2]=o.b,t[n+3]=r.x,t[n+4]=r.y,t[n+5]=r.z,e[n+3]=o.r,e[n+4]=o.g,e[n+5]=o.b},P=function(t,e,i){if(t.style.line){var r=t.style.line;if(!r.hidden){var o=r.linewidth||n;i[o]||(i[o]=new c.Geometry);for(var a=i[o].updateGeoGroup(6*t.bonds.length),s=a.vertexArray,l=a.colorArray,u=0;u<t.bonds.length;u++){var d=t.bonds[u],p=e[d];if(p.style.line&&!(t.serial>=p.serial)){var h=new c.Vector3(t.x,t.y,t.z),f=new c.Vector3(p.x,p.y,p.z),m=h.clone().add(f).multiplyScalar(.5),g=!1;t.clickable&&(void 0===t.intersectionShape&&(t.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),t.intersectionShape.line.push(h),t.intersectionShape.line.push(f));var v=c.getColorFromStyle(t,t.style.line),_=c.getColorFromStyle(p,p.style.line);if(t.bondStyles&&t.bondStyles[u]){var y=t.bondStyles[u];if(!y.iswire)continue;y.radius&&(bondR=y.radius),y.singleBond&&(g=!0),"undefined"!=typeof y.color1&&(v=c.CC.color(y.color1)),"undefined"!=typeof y.color2&&(_=c.CC.color(y.color2))}var b=3*a.vertices;if(t.bondOrder[u]>1&&t.bondOrder[u]<4&&!g){var x=M(t,p,u),w=f.clone();if(w.sub(h),2==t.bondOrder[u])if(x.multiplyScalar(.1),p1a=h.clone(),p1a.add(x),p1b=h.clone(),p1b.sub(x),p2a=p1a.clone(),p2a.add(w),p2b=p1b.clone(),p2b.add(w),v==_)a.vertices+=4,I(s,l,b,p1a,p2a,v),I(s,l,b+6,p1b,p2b,v);else{a.vertices+=8,w.multiplyScalar(.5);var C=p1a.clone();C.add(w);var A=p1b.clone();A.add(w),I(s,l,b,p1a,C,v),I(s,l,b+6,C,p2a,_),I(s,l,b+12,p1b,A,v),I(s,l,b+18,A,p2b,_)}else if(3==t.bondOrder[u])if(x.multiplyScalar(.1),p1a=h.clone(),p1a.add(x),p1b=h.clone(),p1b.sub(x),p2a=p1a.clone(),p2a.add(w),p2b=p1b.clone(),p2b.add(w),v==_)a.vertices+=6,I(s,l,b,h,f,v),I(s,l,b+6,p1a,p2a,v),I(s,l,b+12,p1b,p2b,v);else{a.vertices+=12,w.multiplyScalar(.5);var C=p1a.clone();C.add(w);var A=p1b.clone();A.add(w),I(s,l,b,h,m,v),I(s,l,b+6,m,f,_),I(s,l,b+12,p1a,C,v),I(s,l,b+18,C,p2a,_),I(s,l,b+24,p1b,A,v),I(s,l,b+30,A,p2b,_)}}else v==_?(a.vertices+=2,I(s,l,b,h,f,v)):(a.vertices+=4,I(s,l,b,h,m,v),I(s,l,b+6,m,f,_))}}}}},L=.25,E=function(t,e){if(t.style.sphere){var n=t.style.sphere;if(!n.hidden){var i=c.getColorFromStyle(t,n),r=T(t,n);if(t.clickable===!0&&void 0!==t.intersectionShape){var o=new c.Vector3(t.x,t.y,t.z);t.intersectionShape.sphere.push(new c.Sphere(o,r))}c.GLDraw.drawSphere(e,t,r,i)}}},F=function(t,e){if(t.style.sphere){var n=t.style.sphere;if(!n.hidden){var i=T(t,n),r=c.getColorFromStyle(t,n),o=e.updateGeoGroup(1),a=o.vertices,s=3*a,l=o.vertexArray,u=o.colorArray,d=o.radiusArray;l[s]=t.x,l[s+1]=t.y,l[s+2]=t.z;var u=(o.normalArray,o.colorArray);u[s]=r.r,u[s+1]=r.g,u[s+2]=r.b,d[a]=i,o.vertices+=1}}},D=function(t,e,n,i){for(var r=t.updateGeoGroup(4),o=r.vertices,a=3*o,s=r.vertexArray,l=r.colorArray,u=0;u<4;u++)s[a+3*u]=e.x,s[a+3*u+1]=e.y,s[a+3*u+2]=e.z;for(var c=r.normalArray,l=r.colorArray,u=0;u<4;u++)l[a+3*u]=i.r,l[a+3*u+1]=i.g,l[a+3*u+2]=i.b;c[a+0]=-n,c[a+1]=n,c[a+2]=0,c[a+3]=-n,c[a+4]=-n,c[a+5]=0,c[a+6]=n,c[a+7]=-n,c[a+8]=0,c[a+9]=n,c[a+10]=n,c[a+11]=0,r.vertices+=4;var d=r.faceArray,p=r.faceidx;d[p+0]=o,d[p+1]=o+1,d[p+2]=o+2,d[p+3]=o+2,d[p+4]=o+3,d[p+5]=o,r.faceidx+=6},z=function(t,e){if(t.style.sphere){var n=t.style.sphere;if(!n.hidden){var i=T(t,n),r=c.getColorFromStyle(t,n);D(e,t,i,r)}}},k=function(t,e,n,i,r,o,a){for(var s=t.updateGeoGroup(4),l=s.vertices,u=3*l,c=s.vertexArray,d=s.colorArray,p=s.radiusArray,h=s.normalArray,f=r.r,m=r.g,g=r.b,v=function(t){var e=-t;return 0==e&&(e=-1e-4),e},_=u,y=0;y<4;y++)c[_]=e.x,h[_]=n.x,d[_]=f,_++,c[_]=e.y,h[_]=n.y,d[_]=m,_++,c[_]=e.z,h[_]=n.z,y<2?d[_]=g:d[_]=v(g),_++;s.vertices+=4,p[l]=-i,p[l+1]=i,p[l+2]=-i,p[l+3]=i;var b=s.faceArray,x=s.faceidx;b[x+0]=l,b[x+1]=l+1,b[x+2]=l+2,b[x+3]=l+2,b[x+4]=l+3,b[x+5]=l,s.faceidx+=6},V=function(t,e,n){if(t.style.stick){var i=t.style.stick;if(!i.hidden){var r,o,a=i.radius||L,s=a,l=i.singleBonds||!1,u=0,d=0,p=c.getColorFromStyle(t,i);!t.capDrawn&&t.bonds.length<4&&(u=2);var h=c.GLDraw.drawCylinder;n.imposter&&(h=k);for(var f=0;f<t.bonds.length;f++){var m=t.bonds[f],g=e[m];if(t.serial<g.serial){var v=g.style;if(!v.stick)continue;var _=c.getColorFromStyle(g,v.stick);s=a;var y=l;if(t.bondStyles&&t.bondStyles[f]){var b=t.bondStyles[f];if(b.iswire)continue;b.radius&&(s=b.radius),b.singleBond&&(y=!0),"undefined"!=typeof b.color1&&(p=c.CC.color(b.color1)),"undefined"!=typeof b.color2&&(_=c.CC.color(b.color2))}var x=new c.Vector3(t.x,t.y,t.z),w=new c.Vector3(g.x,g.y,g.z);if(1===t.bondOrder[f]||y){if(!g.capDrawn&&g.bonds.length<4&&(d=2),p!=_?(r=(new c.Vector3).addVectors(x,w).multiplyScalar(.5),h(n,x,r,s,p,u,0),h(n,r,w,s,_,0,d)):h(n,x,w,s,p,u,d),t.clickable||g.clickable){if(r=(new c.Vector3).addVectors(x,w).multiplyScalar(.5),t.clickable){var C=new c.Cylinder(x,r,s),A=new c.Sphere(x,s);t.intersectionShape.cylinder.push(C),t.intersectionShape.sphere.push(A)}if(g.clickable){var T=new c.Cylinder(w,r,s),S=new c.Sphere(w,s);g.intersectionShape.cylinder.push(T),g.intersectionShape.sphere.push(S)}}}else if(t.bondOrder[f]>1){var I=0;mtoCap=0,s!=a&&(I=2,mtoCap=2);var P=w.clone(),E=null;P.sub(x);var F,z,V,O,N,E=M(t,g,f);if(2==t.bondOrder[f]){var F=s/2.5,E=M(t,g,f);E.multiplyScalar(1.5*F),z=x.clone(),z.add(E),V=x.clone(),V.sub(E),O=z.clone(),O.add(P),N=V.clone(),N.add(P),p!=_?(r=(new c.Vector3).addVectors(z,O).multiplyScalar(.5),o=(new c.Vector3).addVectors(V,N).multiplyScalar(.5),h(n,z,r,F,p,I,0),h(n,r,O,F,_,0,mtoCap),h(n,V,o,F,p,I,0),h(n,o,N,F,_,0,mtoCap)):(h(n,z,O,F,p,I,mtoCap),h(n,V,N,F,p,I,mtoCap)),(t.clickable||g.clickable)&&(r=(new c.Vector3).addVectors(z,O).multiplyScalar(.5),o=(new c.Vector3).addVectors(V,N).multiplyScalar(.5),t.clickable&&(cylinder1a=new c.Cylinder(z,r,F),cylinder1b=new c.Cylinder(V,o,F),t.intersectionShape.cylinder.push(cylinder1a),t.intersectionShape.cylinder.push(cylinder1b)),g.clickable&&(cylinder2a=new c.Cylinder(O,r,F),cylinder2b=new c.Cylinder(N,o,F),g.intersectionShape.cylinder.push(cylinder2a),g.intersectionShape.cylinder.push(cylinder2b)))}else 3==t.bondOrder[f]&&(F=s/4,E.cross(P),E.normalize(),E.multiplyScalar(3*F),z=x.clone(),z.add(E),V=x.clone(),V.sub(E),O=z.clone(),O.add(P),N=V.clone(),N.add(P),p!=_?(r=(new c.Vector3).addVectors(z,O).multiplyScalar(.5),o=(new c.Vector3).addVectors(V,N).multiplyScalar(.5),mp3=(new c.Vector3).addVectors(x,w).multiplyScalar(.5),h(n,z,r,F,p,I,0),h(n,r,O,F,_,0,mtoCap),h(n,x,mp3,F,p,u,0),h(n,mp3,w,F,_,0,d),h(n,V,o,F,p,I,0),h(n,o,N,F,_,0,mtoCap)):(h(n,z,O,F,p,I,mtoCap),h(n,x,w,F,p,u,d),h(n,V,N,F,p,I,mtoCap)),(t.clickable||g.clickable)&&(r=(new c.Vector3).addVectors(z,O).multiplyScalar(.5),o=(new c.Vector3).addVectors(V,N).multiplyScalar(.5),mp3=(new c.Vector3).addVectors(x,w).multiplyScalar(.5),t.clickable&&(cylinder1a=new c.Cylinder(z.clone(),r.clone(),F),cylinder1b=new c.Cylinder(V.clone(),o.clone(),F),cylinder1c=new c.Cylinder(x.clone(),mp3.clone(),F),t.intersectionShape.cylinder.push(cylinder1a),t.intersectionShape.cylinder.push(cylinder1b),t.intersectionShape.cylinder.push(cylinder1c)),g.clickable&&(cylinder2a=new c.Cylinder(O.clone(),r.clone(),F),cylinder2b=new c.Cylinder(N.clone(),o.clone(),F),cylinder2c=new c.Cylinder(w.clone(),mp3.clone(),F),g.intersectionShape.cylinder.push(cylinder2a),g.intersectionShape.cylinder.push(cylinder2b),g.intersectionShape.cylinder.push(cylinder2c))))}}}for(var j=!1,R=0,B=!1,f=0;f<t.bonds.length;f++){var y=l;if(t.bondStyles&&t.bondStyles[f]){var b=t.bondStyles[f];b.singleBond&&(y=!0),b.radius&&b.radius!=a&&(B=!0)}(y||1==t.bondOrder[f])&&R++}if(B?R>0&&(j=!0):0==R&&t.bonds.length>0&&(j=!0),j){t.style;s=a,n.imposter?D(n.sphereGeometry,t,s,p):c.GLDraw.drawSphere(n,t,s,p)}}}},O=function(t,e){e=e||{};var n=new c.Object3D,i=[],r={},o={},a=E,s=null,l=null;e.supportsImposters?(a=z,s=new c.Geometry(!0),s.imposter=!0,l=new c.Geometry(!0,!0),l.imposter=!0,l.sphereGeometry=s,l.drawnCaps={}):e.supportsAIA?(a=F,s=new c.Geometry(!1,!0,!0),s.instanced=!0,l=new c.Geometry(!0)):(s=new c.Geometry(!0),l=new c.Geometry(!0));var u,d,h,f,m={},g=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(u=0,h=t.length;u<h;u++){var v=t[u];if(v&&v.style){v.clickable&&void 0===v.intersectionShape&&(v.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),f={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(d in f)v.style[d]?v.style[d].opacity?f[d]=parseFloat(v.style[d].opacity):f[d]=1:f[d]=void 0,m[d]?void 0!=f[d]&&m[d]!=f[d]&&(console.log("Warning: "+d+" opacity is ambiguous"),m[d]=1):m[d]=f[d];a(v,s),S(v,o),P(v,t,r),V(v,t,l),"undefined"==typeof v.style.cartoon||v.style.cartoon.hidden||("spectrum"!==v.style.cartoon.color||"number"!=typeof v.resi||v.hetflag||(v.resi<g[0]&&(g[0]=v.resi),v.resi>g[1]&&(g[1]=v.resi)),i.push(v))}}if(i.length>0){var _=null;g[0]<g[1]&&(_=new c.Gradient.Sinebow(g[0],g[1])),c.drawCartoon(n,i,_)}if(s&&s.vertices>0){s.initTypedArrays();var y=null;if(s.imposter)y=new c.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});else if(s.instanced){var x=new c.Geometry(!0);c.GLDraw.drawSphere(x,{x:0,y:0,z:0},1,new c.Color(.5,.5,.5)),x.initTypedArrays(),y=new c.InstancedMaterial({sphereMaterial:new c.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:x})}else var y=new c.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0});m.sphere<1&&m.sphere>=0&&(y.transparent=!0,y.opacity=m.sphere);var x=new c.Mesh(s,y);n.add(x)}if(l.vertices>0)if(l.imposter){var w=new c.StickImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0});l.initTypedArrays();var C=new c.Mesh(l,w);n.add(C)}else{var A=new c.MeshLambertMaterial({vertexColors:!0,ambient:0,reflectivity:0});m.stick<1&&m.stick>=0&&(A.transparent=!0,A.opacity=m.stick),l.initTypedArrays(),A.wireframe&&l.setUpWireframe();var C=new c.Mesh(l,A);n.add(C)}for(u in r)if(r.hasOwnProperty(u)){var T=u,M=new c.LineBasicMaterial({linewidth:T,vertexColors:!0});m.line<1&&m.line>=0&&(M.transparent=!0,M.opacity=m.line),r[u].initTypedArrays();var I=new c.Line(r[u],M,c.LinePieces);n.add(I)}for(u in o)if(o.hasOwnProperty(u)){var T=u,L=new c.LineBasicMaterial({linewidth:T,vertexColors:!0});m.cross<1&&m.cross>=0&&(L.transparent=!0,L.opacity=m.cross),o[u].initTypedArrays();var D=new c.Line(o[u],L,c.LinePieces);n.add(D)}if(p&&b.symmetries&&b.symmetries.length>0){var k,O=new c.Object3D;for(k=0;k<b.symmetries.length;k++){var N=new c.Object3D;N=n.clone(),N.matrix.copy(b.symmetries[k]),N.matrixAutoUpdate=!1,O.add(N)}return O}return n};this.getCrystData=function(){return b.cryst?b.cryst:null},this.getSymmetries=function(){return"undefined"==typeof b.symmetries&&(b.symmetries=[x]),b.symmetries},this.setSymmetries=function(t){"undefined"==typeof t?b.symmetries=[x]:b.symmetries=t},this.getID=function(){return m},this.getFrames=function(){return f},this.setFrame=function(t){0!=f.length&&(h=t>=0&&t<f.length?f[t]:f[f.length-1],v=null)},this.addFrame=function(t){f.push(t)},this.vibrate=function(t,e){for(var n=[],e=e||1,t=t||10,i=0;i<h.length;i++){
var r=new c.Vector3(h[i].dx,h[i].dy,h[i].dz);n.push(r)}t--;for(var i=1;i<=t;i++){for(var o=[],a=0;a<h.length;a++){var s=new c.Vector3(h[a].dx,h[a].dy,h[a].dz),l=new c.Vector3(h[a].x,h[a].y,h[a].z);s.sub(l),s.multiplyScalar(i*e/t),l.add(s);var u={};for(var d in h[a])u[d]=h[a][d];u.x=l.x,u.y=l.y,u.z=l.z,o.push(u)}f.push(o)}f.unshift(h)},this.setAtomDefaults=function(t){for(var n=0;n<t.length;n++){var i=t[n];i&&(i.style=i.style||e,i.color=i.color||C[i.elem]||w,i.model=m,i.clickable&&(i.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},this.addMolData=function(t,e,n){n=n||{};var i=c.GLModel.parseMolData(t,e,n);p=!n.duplicateAssemblyAtoms;var r=i.modelData;if(r&&(b=Array.isArray(r)?r[0]:r),0==f.length){for(var o=0;o<i.length;o++)0!=i[o].length&&f.push(i[o]);f[0]&&(h=f[0])}else if(n.frames)for(var o=0;o<i.length;o++)f.push(i[o]);else for(var o=0;o<i.length;o++)this.addAtoms(i[o]);for(var o=0;o<f.length;o++)this.setAtomDefaults(f[o],m);n.vibrate&&n.vibrate.frames&&n.vibrate.amplitude&&this.vibrate(n.vibrate.frames,n.vibrate.amplitude)},this.setDontDuplicateAtoms=function(t){p=t},this.setModelData=function(t){b=t},this.atomIsSelected=function(t,e){if("undefined"==typeof e)return!0;var n=!!e.invert,i=!0;for(var r in e)if("predicate"===r){if(!e.predicate(t)){i=!1;break}}else if("properties"==r&&t[r])for(var o in e.properties){if("undefined"==typeof t.properties[o]){i=!1;break}if(t.properties[o]!=e.properties[o]){i=!1;break}}else if(e.hasOwnProperty(r)&&"props"!=r&&"invert"!=r&&"model"!=r&&"byres"!=r&&"expand"!=r&&"within"!=r){if("undefined"==typeof t[r]){i=!1;break}var a=!1;if("bonds"===r){var s=e[r];if(s!=t.bonds.length){i=!1;break}}else if(u.isArray(e[r])){for(var l=e[r],c=0;c<l.length;c++)if(t[r]==l[c]){a=!0;break}if(!a){i=!1;break}}else{var s=e[r];if(t[r]!=s){i=!1;break}}}return n?!i:i},this.selectedAtoms=function(t,e){var n=[];t=t||{},e||(e=h);for(var i=e.length,r=0;r<i;r++){var o=e[r];o&&this.atomIsSelected(o,t)&&n.push(o)}if(t.hasOwnProperty("expand"))for(var a=j(n,parseFloat(t.expand)),s=n.length,r=0;r<a.length;r++)for(var l=0;l<s;l++){var u=N(a[r],n[l]),c=Math.pow(t.expand,2);u<c&&u>0&&n.push(a[r])}if(t.hasOwnProperty("within")&&t.within.hasOwnProperty("sel")&&t.within.hasOwnProperty("distance")){for(var d=this.selectedAtoms(t.within.sel,h),p=[],r=0;r<d.length;r++)for(var l=0;l<n.length;l++){var u=N(d[r],n[l]),c=Math.pow(parseFloat(t.within.distance),2);u<c&&u>0&&p.push(n[l])}n=p}if(t.hasOwnProperty("byres"))for(var f={},m=[],g=[],r=0;r<n.length;r++){var o=n[r],v=o.chain,_=o.resi;if(void 0===f[v]&&(f[v]={}),o.hasOwnProperty("resi")&&void 0===f[v][_])for(f[v][_]=!0,g.push(o);g.length>0;)if(o=g.pop(),v=o.chain,_=o.resi,void 0===m[o.index]){m[o.index]=!0;for(var l=0;l<o.bonds.length;l++){var y=h[o.bonds[l]];void 0===m[y.index]&&y.hasOwnProperty("resi")&&y.chain==v&&y.resi==_&&(g.push(y),n.push(y))}}}return n};var N=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.pow(n,2)+Math.pow(i,2)+Math.pow(r,2)},j=function(t,e){if(e<=0)return t;for(var n=c.getExtent(t),i=[[],[],[]],r=0;r<3;r++)i[0][r]=n[0][r]-e,i[1][r]=n[1][r]+e,i[2][r]=n[2][r];for(var o=[],r=0;r<h.length;r++){var a=h[r].x,s=h[r].y,l=h[r].z;a>=i[0][0]&&a<=i[1][0]&&s>=i[0][1]&&s<=i[1][1]&&l>=i[0][2]&&l<=i[1][2]&&(a>=n[0][0]&&a<=n[1][0]&&s>=n[0][1]&&s<=n[1][1]&&l>=n[0][2]&&l<=n[1][2]||o.push(h[r]))}return o};this.addAtoms=function(t){v=null;var n,i=h.length,r=[];for(n=0;n<t.length;n++)"undefined"==typeof t[n].index&&(t[n].index=n),"undefined"==typeof t[n].serial&&(t[n].serial=n),r[t[n].index]=i+n;for(n=0;n<t.length;n++){var o=t[n],a=r[o.index],s=u.extend(!1,{},o);s.index=a,s.bonds=[],s.bondOrder=[],s.model=m,s.style=s.style||e,"undefined"==typeof s.color&&(s.color=C[s.elem]||w);for(var l=o.bonds?o.bonds.length:0,c=0;c<l;c++){var d=r[o.bonds[c]];"undefined"!=typeof d&&(s.bonds.push(d),s.bondOrder.push(o.bondOrder?o.bondOrder[c]:1))}h.push(s)}},this.removeAtoms=function(t){v=null;var e,n=[];for(e=0;e<t.length;e++)n[t[e].index]=!0;var i=[];for(e=0;e<h.length;e++){var r=h[e];n[r.index]||i.push(r)}h=[],this.addAtoms(i)},this.setStyle=function(t,e,n){"undefined"==typeof e&&"undefined"==typeof n&&(e=t,t={});var i;for(i in t)s.indexOf(i)===-1&&console.log("Unknown selector "+i);for(i in e)l.indexOf(i)===-1&&console.log("Unknown style "+i);var r=!1,o=function(o){for(var s=a.selectedAtoms(t,o),l=0;l<o.length;l++)o[l]&&(o[l].capDrawn=!1);for(var l=0;l<s.length;l++){r=!0,s[l].clickable&&(s[l].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),n||(s[l].style={});for(i in e)if(e.hasOwnProperty(i)){s[l].style[i]=s[l].style[i]||{};for(var u in e[i])s[l].style[i][u]=e[i][u]}}},a=this;o(h);for(var u=0;u<f.length;u++)o(f[u]);r&&(v=null)},this.setClickable=function(t,e,n){var i;for(i in t)s.indexOf(i)===-1&&console.log("Unknown selector "+i);if(e=!!e,n&&"function"!=typeof n)return void console.log("Callback is not a function");var r,o=this.selectedAtoms(t,h),a=o.length;for(r=0;r<a;r++)o[r].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},o[r].clickable=e,n&&(o[r].callback=n);a>0&&(v=null)},this.setColorByElement=function(t,e){if(null===v||!d(e,y)){y=e;var n=this.selectedAtoms(t,n);n.length>0&&(v=null);for(var i=0;i<n.length;i++){var r=n[i];"undefined"!=typeof e[r.elem]&&(r.color=e[r.elem])}}},this.setColorByProperty=function(t,e,n,i){var r=this.selectedAtoms(t,r);y=null,r.length>0&&(v=null);var o,a;Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY;for(i||(i=n.range()),i||(i=c.getPropertyRange(r,e)),o=0;o<r.length;o++){a=r[o];var s=c.getAtomProperty(a,e);null!=s&&(a.color=n.valueToHex(parseFloat(a.properties[e]),[i[0],i[1]]))}},this.setColorByFunction=function(t,e){var n=this.selectedAtoms(t,n);for(y=null,n.length>0&&(v=null),i=0;i<n.length;i++)a=n[i],a.color=e(a)},this.toCDObject=function(t){var e={a:[],b:[]};t&&(e.s=[]);for(var n=0;n<h.length;n++){var i={},r=h[n];if(i.x=r.x,i.y=r.y,i.z=r.z,"C"!=r.elem&&(i.l=r.elem),t){for(var o=0;o<e.s.length&&JSON.stringify(r.style)!==JSON.stringify(e.s[o]);)o++;o===e.s.length&&e.s.push(r.style),0!==o&&(i.s=o)}e.a.push(i);for(var a=0;a<r.bonds.length;a++){var s=n,l=r.bonds[a];if(!(s>=l)){var u={b:s,e:l},c=r.bondOrder[a];1!=c&&(u.o=c),e.b.push(u)}}}return e},this.globj=function(t,e){new Date;if(null===v){v=O(h,e);new Date;_&&(t.remove(_),_=null),_=v.clone(),g&&(_.setVisible(!1),v.setVisible(!1)),t.add(_)}},this.removegl=function(t){_&&(void 0!==_.geometry&&_.geometry.dispose(),void 0!==_.material&&_.material.dispose(),t.remove(_),_=null),v=null},this.hide=function(){g=!0,_&&_.setVisible(!1),v&&v.setVisible(!1)},this.show=function(){g=!1,_&&_.setVisible(!0),v&&v.setVisible(!0)},this.addResLabels=function(t,e,n){for(var i=this.selectedAtoms(t,i),r={},o=0;o<i.length;o++){var a=i[o],s=a.chain,l=a.resn,d=a.resi,p=l+""+d;r[s]||(r[s]={}),r[s][p]||(r[s][p]=[]),r[s][p].push(a)}var h=u.extend(!0,{},n);for(var s in r)if(r.hasOwnProperty(s)){var f=r[s];for(var p in f)if(f.hasOwnProperty(p)){for(var i=f[p],m=new c.Vector3(0,0,0),o=0;o<i.length;o++){var a=i[o];m.x+=a.x,m.y+=a.y,m.z+=a.z}m.divideScalar(i.length),h.position=m,e.addLabel(p,h)}}}}var e={line:{}},n=1,r={H:1.2,Li:1.82,LI:1.82,Na:2.27,NA:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,Cl:1.75,BR:1.85,Br:1.85,SE:1.9,Se:1.9,ZN:1.39,Zn:1.39,CU:1.4,Cu:1.4,NI:1.63,Ni:1.63},o=["resn","x","y","z","color","surfaceColor","elem","hetflag","chain","resi","icode","rescode","serial","atom","bonds","ss","singleBonds","bondOrder","properties","b","pdbline","clickable","callback","invert"],s=o.concat(["model","bonds","predicate","invert","byres","expand","within"]),l=["line","cross","stick","sphere","cartoon"],d=function(t,e){return t&&e?JSON.stringify(t)==JSON.stringify(e):t==e};return t.parseMolData=function(t,e,n){if(e=e||"",!t)return[];if(/\.gz$/.test(e)){e=e.replace(/\.gz$/,"");try{t=pako.inflate(t,{to:"string"})}catch(t){console.log(t)}}"undefined"==typeof c.Parsers[e]&&(e=e.split(".").pop(),"undefined"==typeof c.Parsers[e]&&(console.log("Unknown format: "+e),e=t.match(/^@<TRIPOS>MOLECULE/gm)?"mol2":t.match(/^HETATM/gm)||t.match(/^ATOM/gm)?"pdb":t.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?"sdf":"xyz",console.log("Best guess: "+e)));var i=c.Parsers[e],r=i(t,n);return r},t.setAtomDefaults=function(t,n){for(var i=0;i<t.length;i++){var r=t[i];r&&(r.style=r.style||e,r.color=r.color||ElementColors[r.elem]||defaultColor,r.model=n,r.clickable&&(r.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}},t}(),c.GLShape=function(){function t(t){t=t||{},c.ShapeIDCount++,this.boundingSphere=new c.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},l(this,t);var o=[],u=null,d=null,p=new c.Geometry(!0),h=new c.Geometry(!0);this.updateStyle=function(e){for(var n in e)t[n]=e[n];l(this,t)},this.addCustom=function(t){t.vertexArr=t.vertexArr||[],t.faceArr=t.faceArr||[],t.normalArr=t.normalArr||[];p.geometryGroups.length;a(this,p,t)},this.addSphere=function(t){t.center=t.center||{x:0,y:0,z:0},t.radius=t.radius?c.Math.clamp(t.radius,0,1/0):1.5,t.color=c.CC.color(t.color),this.intersectionShape.sphere.push(new c.Sphere(t.center,t.radius)),c.GLDraw.drawSphere(p,t.center,t.radius,t.color),o.push({centroid:new c.Vector3(t.center.x,t.center.y,t.center.z)});var e=p.updateGeoGroup(0);s(this.boundingSphere,o,e.vertexArray)},this.addCylinder=function(t){t.start=t.start||{},t.end=t.end||{};var e=new c.Vector3(t.start.x||0,t.start.y||0,t.start.z||0),n=new c.Vector3(t.end.x,t.end.y||0,t.end.z||0);"undefined"==typeof n.x&&(n.x=3);var i=t.radius||.1,r=c.CC.color(t.color);this.intersectionShape.cylinder.push(new c.Cylinder(e,n,i)),c.GLDraw.drawCylinder(p,e,n,i,r,t.fromCap,t.toCap);var a=new c.Vector3;o.push({centroid:a.addVectors(e,n).multiplyScalar(.5)});var l=p.updateGeoGroup(0);s(this.boundingSphere,o,l.vertexArray)},this.addLine=function(t){t.start=t.start||{},t.end=t.end||{};var e=new c.Vector3(t.start.x||0,t.start.y||0,t.start.z||0),n=new c.Vector3(t.end.x,t.end.y||0,t.end.z||0);"undefined"==typeof n.x&&(n.x=3);var i=p.updateGeoGroup(2),r=i.vertices,o=3*r,a=i.vertexArray;a[o]=e.x,a[o+1]=e.y,a[o+2]=e.z,a[o+3]=n.x,a[o+4]=n.y,a[o+5]=n.z,i.vertices+=2;var s=i.lineArray,l=i.lineidx;s[l]=r,s[l+1]=r+1,i.lineidx+=2},this.addArrow=function(t){if(t.start=t.start||{},t.end=t.end||{},t.start=new c.Vector3(t.start.x||0,t.start.y||0,t.start.z||0),t.dir instanceof c.Vector3&&t.length instanceof number){var e=t.dir.clone().multiplyScalar(t.length).add(start);t.end=e}else t.end=new c.Vector3(t.end.x,t.end.y||0,t.end.z||0),"undefined"==typeof t.end.x&&(t.end.x=3);t.radius=t.radius||.1,t.radiusRatio=t.radiusRatio||1.618034,t.mid=0<t.mid&&t.mid<1?t.mid:.618034,r(this,p,t);var n=new c.Vector3;o.push({centroid:n.addVectors(t.start,t.end).multiplyScalar(.5)});var i=p.updateGeoGroup(0);s(this.boundingSphere,o,i.vertexArray)},this.addIsosurface=function(t,n){var i,r,o=void 0!==n.isoval&&"number"==typeof n.isoval?n.isoval:0,s=!!n.voxel,l=void 0===n.smoothness?1:n.smoothness,u=t.size.x,d=t.size.y,h=t.size.z,f=new Int16Array(u*d*h),m=t.data;for(i=0,r=f.length;i<r;++i)f[i]=-1;var g=new Uint8Array(u*d*h);for(i=0,r=m.length;i<r;++i){var v=o>=0?m[i]-o:o-m[i];v>0&&(g[i]|=e)}var _=[],y=[];c.MarchingCube.march(g,_,y,{fulltable:!0,voxel:s,unitCube:t.unit,origin:t.origin,matrix:t.matrix,nX:u,nY:d,nZ:h}),!s&&l>0&&c.MarchingCube.laplacianSmooth(l,_,y),a(this,p,{vertexArr:_,faceArr:y,normalArr:[],clickable:n.clickable}),this.updateStyle(n);for(var b=new c.Vector3(t.origin.x,t.origin.y,t.origin.z),x=new c.Vector3(t.size.x*t.unit.x,t.size.y*t.unit.y,t.size.z*t.unit.z),w=new c.Vector3(0,0,0),C=b.clone(),A=b.clone().add(x),i=0;i<_.length;i++)w.add(_[i]),C.max(_[i]),A.min(_[i]);w.divideScalar(_.length);var T=w.distanceTo(A),S=w.distanceTo(C);this.boundingSphere.center=w,this.boundingSphere.radius=Math.max(T,S)},this.addVolumetricData=function(t,e,n){var t=new c.VolumeData(t,e);this.addIsosurface(t,n)},this.globj=function(t){if(d&&(t.remove(d),d=null),!this.hidden){n(p),p.initTypedArrays(),"undefined"!=typeof this.color&&i(p,this.color),u=new c.Object3D;var e=null;if(this.side==c.DoubleSide)var e=new c.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth});else var e=new c.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth});var r=new c.Mesh(p,e);u.add(r);var o=new c.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),a=new c.Line(h,o,c.LinePieces);u.add(a),d=u.clone(),t.add(d)}},this.removegl=function(t){d&&(void 0!==d.geometry&&d.geometry.dispose(),void 0!==d.material&&d.material.dispose(),t.remove(d),d=null),u=null}}var e=2,n=function(t){var e=t.updateGeoGroup(0);e.vertices>0&&e.truncateArrayBuffers(!0,!0)},i=function(t,e){e||c.CC.color(e);t.colorsNeedUpdate=!0;var n,i,r;e.constructor!==Array&&(n=e.r,i=e.g,r=e.b);for(var o in t.geometryGroups)for(var a=t.geometryGroups[o],s=a.colorArray,l=0,u=a.vertices;l<u;++l){if(e.constructor===Array){var d=e[l];n=d.r,i=d.g,r=d.b}s[3*l]=n,s[3*l+1]=i,s[3*l+2]=r}},r=function(t,e,n){var i=n.start,r=n.end,o=n.radius,a=n.radiusRatio,s=n.mid;if(i&&r){var l=e.updateGeoGroup(51),u=r.clone();u.sub(i).multiplyScalar(s);var d=i.clone().add(u),p=u.clone().negate();t.intersectionShape.cylinder.push(new c.Cylinder(i.clone(),d.clone(),o)),t.intersectionShape.sphere.push(new c.Sphere(i.clone(),o));var h=[];h[0]=u.clone(),Math.abs(h[0].x)>1e-4?h[0].y+=1:h[0].x+=1,h[0].cross(u),h[0].normalize(),h[0]=h[0],h[4]=h[0].clone(),h[4].crossVectors(h[0],u),h[4].normalize(),h[8]=h[0].clone().negate(),h[12]=h[4].clone().negate(),h[2]=h[0].clone().add(h[4]).normalize(),h[6]=h[4].clone().add(h[8]).normalize(),h[10]=h[8].clone().add(h[12]).normalize(),h[14]=h[12].clone().add(h[0]).normalize(),h[1]=h[0].clone().add(h[2]).normalize(),h[3]=h[2].clone().add(h[4]).normalize(),h[5]=h[4].clone().add(h[6]).normalize(),h[7]=h[6].clone().add(h[8]).normalize(),h[9]=h[8].clone().add(h[10]).normalize(),h[11]=h[10].clone().add(h[12]).normalize(),h[13]=h[12].clone().add(h[14]).normalize(),h[15]=h[14].clone().add(h[0]).normalize();var f,m,g,v=l.vertices,_=l.vertexArray,y=(l.colorArray,l.faceArray),b=l.normalArray,x=l.lineArray;for(m=0,g=h.length;m<g;++m){f=3*(v+3*m);var w=h[m].clone().multiplyScalar(o).add(i),C=h[m].clone().multiplyScalar(o).add(d),A=h[m].clone().multiplyScalar(o*a).add(d);if(_[f]=w.x,_[f+1]=w.y,_[f+2]=w.z,_[f+3]=C.x,_[f+4]=C.y,_[f+5]=C.z,_[f+6]=A.x,_[f+7]=A.y,_[f+8]=A.z,m>0){var T=_[f-3],S=_[f-2],M=_[f-1],I=new c.Vector3(T,S,M),P=r.clone(),L=d.clone(),E=new c.Vector3(A.x,A.y,A.z);t.intersectionShape.triangle.push(new c.Triangle(E,P,I)),t.intersectionShape.triangle.push(new c.Triangle(I.clone(),L,E.clone()))}}l.vertices+=48,f=3*l.vertices,_[f]=i.x,_[f+1]=i.y,_[f+2]=i.z,_[f+3]=d.x,_[f+4]=d.y,_[f+5]=d.z,_[f+6]=r.x,_[f+7]=r.y,_[f+8]=r.z,l.vertices+=3;var F,D,z,k,V,O,N,j,R,B,U,q,G,H,W,Y,$,X,K,Z,Q=l.vertices-3,J=l.vertices-2,tt=l.vertices-1,et=3*Q,nt=3*J,it=3*tt;for(m=0,g=h.length-1;m<g;++m){var rt=v+3*m;f=3*rt,z=l.faceidx,k=l.lineidx,V=rt,U=3*V,O=rt+1,q=3*O,N=rt+2,G=3*N,j=rt+4,H=3*j,R=rt+5,W=3*R,B=rt+3,Y=3*B,D=[h[m],h[m],h[m+1],h[m+1]],$=X=h[m],K=Z=h[m+1],b[U]=$.x,b[q]=X.x,b[Y]=Z.x,b[U+1]=$.y,b[q+1]=X.y,b[Y+1]=Z.y,b[U+2]=$.z,b[q+2]=X.z,b[Y+2]=Z.z,b[q]=X.x,b[H]=K.x,b[Y]=Z.x,b[q+1]=X.y,b[H+1]=K.y,b[Y+1]=Z.y,b[q+2]=X.z,b[H+2]=K.z,b[Y+2]=Z.z,b[G]=X.x,b[W]=K.x,b[G+1]=X.y,b[W+1]=K.y,b[G+2]=X.z,b[W+2]=K.z,y[z]=V,y[z+1]=O,y[z+2]=B,y[z+3]=O,y[z+4]=j,y[z+5]=B,y[z+6]=V,y[z+7]=B,y[z+8]=Q,y[z+9]=N,y[z+10]=J,y[z+11]=R,y[z+12]=N,y[z+13]=tt,y[z+14]=R,x[k]=V,x[k+1]=O,x[k+2]=V,x[k+3]=B,x[k+4]=j,x[k+5]=B,x[k+6]=V,x[k+7]=B,x[k+8]=N,x[k+9]=O,x[k+10]=N,x[k+11]=R,x[k+12]=j,x[k+13]=R,x[k+14]=N,x[k+15]=tt,x[k+16]=N,x[k+17]=R,x[k+18]=tt,x[k+19]=R,l.faceidx+=15,l.lineidx+=20}F=[v+45,v+46,v+1,v,v+47,v+2],D=[h[15],h[15],h[0],h[0]],z=l.faceidx,k=l.lineidx,V=F[0],U=3*V,O=F[1],q=3*O,N=F[4],G=3*N,j=F[2],H=3*j,R=F[5],W=3*R,B=F[3],Y=3*B,$=X=h[15],K=Z=h[0],b[U]=$.x,b[q]=X.x,b[Y]=Z.x,b[U+1]=$.y,b[q+1]=X.y,b[Y+1]=Z.y,b[U+2]=$.z,b[q+2]=X.z,b[Y+2]=Z.z,b[q]=X.x,b[H]=K.x,b[Y]=Z.x,b[q+1]=X.y,b[H+1]=K.y,b[Y+1]=Z.y,b[q+2]=X.z,b[H+2]=K.z,b[Y+2]=Z.z,b[G]=X.x,b[W]=K.x,b[G+1]=X.y,b[W+1]=K.y,b[G+2]=X.z,b[W+2]=K.z,u.normalize(),p.normalize(),b[et]=p.x,b[nt]=b[it]=u.x,b[et+1]=p.y,b[nt+1]=b[it+1]=u.y,b[et+2]=p.z,b[nt+2]=b[it+2]=u.z,y[z]=V,y[z+1]=O,y[z+2]=B,y[z+3]=O,y[z+4]=j,y[z+5]=B,y[z+6]=V,y[z+7]=B,y[z+8]=Q,y[z+9]=N,y[z+10]=J,y[z+11]=R,y[z+12]=N,y[z+13]=tt,y[z+14]=R,x[k]=V,x[k+1]=O,x[k+2]=V,x[k+3]=B,x[k+4]=j,x[k+5]=B,x[k+6]=V,x[k+7]=B,x[k+8]=N,x[k+9]=O,x[k+10]=N,x[k+11]=R,x[k+12]=j,x[k+13]=R,x[k+14]=N,x[k+15]=tt,x[k+16]=N,x[k+17]=R,x[k+18]=tt,x[k+19]=R,l.faceidx+=15,l.lineidx+=20}},o=function(t,e,n,i,r){var o=e.addGeoGroup(),a=n.vertexArr,l=n.normalArr,u=n.faceArr;o.vertices=a.length,o.faceidx=u.length;var d,p,h,f,m,g,v,_=o.vertexArray,y=o.colorArray;if(i.constructor!==Array)var b=i.r,x=i.g,f=i.b;for(g=0,v=o.vertices;g<v;++g){if(d=3*g,p=a[g],_[d]=p.x,_[d+1]=p.y,_[d+2]=p.z,i.constructor===Array)var m=i[g],b=m.r,x=m.g,f=m.b;y[d]=b,y[d+1]=x,y[d+2]=f}if(r)for(g=0,v=o.faceidx/3;g<v;++g){d=3*g,h=u[d],f=u[d+1],m=u[d+2];var w=new c.Vector3,C=new c.Vector3,A=new c.Vector3;t.intersectionShape.triangle.push(new c.Triangle(w.copy(a[h]),C.copy(a[f]),A.copy(a[m])))}if(r){for(var T=new c.Vector3(0,0,0),S=0,x=0;x<e.geometryGroups.length;x++)T.add(e.geometryGroups[x].getCentroid()),S++;T.divideScalar(S),s(t.boundingSphere,{centroid:T},_)}if(o.faceArray=new Uint16Array(u),o.truncateArrayBuffers(!0,!0),l.length<o.vertices)o.setNormals();else{var M,I=o.normalArray=new Float32Array(3*o.vertices);for(g=0,v=o.vertices;g<v;++g)d=3*g,M=l[g],I[d]=M.x,I[d+1]=M.y,I[d+2]=M.z}o.setLineIndices(),o.lineidx=o.lineArray.length},a=function(t,e,n){var i=n,r=i.vertexArr,a=(i.normalArr,i.faceArr);0!==r.length&&0!==a.length||console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var s=n.color;"undefined"==typeof s&&(s=t.color),s=c.CC.color(s);for(var l=c.splitMesh(i),u=0,d=l.length;u<d;u++)o(t,e,l[u],l[u].colorArr?l[u].colorArr:s,n.clickable)},s=function(t,e,n){t.center.set(0,0,0);var i,r;if(e.length>0){for(i=0,r=e.length;i<r;++i){var o=e[i].centroid;t.center.add(o)}t.center.divideScalar(e.length)}var a=t.radius*t.radius;for(i=0,r=n.length/3;i<r;i++){var s=n[3*i],l=n[3*i+1],u=n[3*i+2],c=t.center.distanceToSquared({x:s,y:l,z:u});a=Math.max(a,c)}t.radius=Math.sqrt(a)},l=function(t,e){"undefined"!=typeof e.color&&(t.color=e.color||new c.Color,e.color instanceof c.Color||(t.color=c.CC.color(e.color))),t.wireframe=!!e.wireframe,t.opacity=e.alpha?c.Math.clamp(e.alpha,0,1):1,"undefined"!=typeof e.opacity&&(t.opacity=c.Math.clamp(e.opacity,0,1)),t.side=void 0!==e.side?e.side:c.DoubleSide,t.linewidth="undefined"==typeof e.linewidth?1:e.linewidth,t.clickable=!!e.clickable,t.callback="function"==typeof e.callback?e.callback:null,t.hidden=e.hidden};return Object.defineProperty(t.prototype,"position",{get:function(){return this.boundingSphere.center}}),Object.defineProperty(t.prototype,"x",{get:function(){return this.boundingSphere.center.x}}),Object.defineProperty(t.prototype,"y",{get:function(){return this.boundingSphere.center.y}}),Object.defineProperty(t.prototype,"z",{get:function(){return this.boundingSphere.center.z}}),t}(),c.ShapeIDCount=0,c.splitMesh=function(t){var e=64e3;if(t.vertexArr.length<e)return[t];var n=(t.vertexArr.length,[{vertexArr:[],normalArr:[],faceArr:[]}]);t.colorArr&&(n.colorArr=[]);for(var i=[],r=[],o=0,a=t.faceArr,s=0,l=a.length;s<l;s+=3){for(var u=n[o],c=0;c<3;c++){var d=a[s+c];i[d]!==o&&(i[d]=o,r[d]=u.vertexArr.length,u.vertexArr.push(t.vertexArr[d]),t.normalArr&&t.normalArr[d]&&u.normalArr.push(t.normalArr[d]),t.colorArr&&t.colorArr[d]&&u.colorArr.push(t.colorArr[d])),u.faceArr.push(r[d])}u.vertexArr.length>=e&&(n.push({vertexArr:[],normalArr:[],faceArr:[]}),t.colorArr&&(n.colorArr=[]),o++)}return n},c.GLViewer=function(){function t(t,o){function a(t){var e=[];"undefined"==typeof t&&(t={});var n,i=[];if("undefined"==typeof t.model)for(n=0;n<x.length;n++)x[n]&&i.push(x[n]);else i=t.model,u.isArray(i)||(i=[i]);for(n=0;n<i.length;n++)e=e.concat(i[n].selectedAtoms(t));return e}function s(t,e){"undefined"==typeof e&&(e={});var n,i=[];if("undefined"==typeof e.model)for(n=0;n<x.length;n++)x[n]&&i.push(x[n]);else i=e.model,u.isArray(i)||(i=[i]);for(n=0;n<i.length;n++)if(i[n].atomIsSelected(t,e))return!0;return!1}function l(t,e){t.dashLength=t.dashLength||.5,t.gapLength=t.gapLength||.5,t.start=t.start||{},t.end=t.end||{};var n,i,r,o=new c.Vector3(t.start.x||0,t.start.y||0,t.start.z||0),a=new c.Vector3(t.end.x,t.end.y||0,t.end.z||0),s=new c.Vector3,l=new c.Vector3,u=new c.Vector3,d=o.clone(),p=0;for(s.subVectors(a,o),n=s.length(),s.normalize(),l=s.clone(),u=s.clone(),l.multiplyScalar(t.dashLength),u.multiplyScalar(t.gapLength),i=l.length(),r=u.length();p<n;){if(p+i>n){t.start=o,t.end=a,e.addLine(t);break}d.addVectors(o,l),t.start=o,t.end=d,e.addLine(t),o=d.clone(),p+=i,d.addVectors(o,u),o=d.clone(),p+=r}return e}function d(t,e,n,i){var r=[];if("undefined"==typeof e.model)for(o=0;o<x.length;o++)x[o]&&r.push(x[o]);else r=e.model,u.isArray(r)||(r=[r]);for(var o=0;o<r.length;o++)r[o]&&r[o][t](e,n,i)}function p(t){var e=new c.MeshLambertMaterial;e.vertexColors=c.VertexColors;for(var n in t)"color"===n||"map"===n||t.hasOwnProperty(n)&&(e[n]=t[n]);return void 0!==t.opacity&&(1===t.opacity?e.transparent=!1:e.transparent=!0),e}o=o||{};var h=o.callback,f=o.defaultcolors;f||(f=c.elementColors.defaultColors);var m=o.nomouse,g=0;void 0!=typeof o.backgroundColor&&(g=c.CC.color(o.backgroundColor).getHex());var v=0;void 0!=typeof o.camerax&&(v=parseFloat(o.camerax));var _=this,y=t,b=(y.id,null),x=[],w={},C=[],A=[],T=[],S=y.width(),M=y.height(),I=S/M,P=1,L=800,E=150,F=20,D=[],z=new c.Renderer({antialias:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1});z.domElement.style.width="100%",z.domElement.style.height="100%",z.domElement.style.padding="0",z.domElement.style.position="absolute",z.domElement.style.top="0px",z.domElement.style.left="0px",z.domElement.style.zIndex="0";var k=new c.Camera(F,I,P,L,o.orthographic);k.position=new c.Vector3(v,0,E);var V=new c.Vector3;k.lookAt(V);var O=new c.Raycaster(new c.Vector3(0,0,0),new c.Vector3(0,0,0)),N=new c.Projector,j=new c.Vector3(0,0,0),R=null,B=null,U=null,q=.4,G=-50,H=50,W=new c.Quaternion(0,0,0,1),Y=new c.Quaternion(0,0,0,1),$=!1,X=!1,K=0,Z=0,Q=0,J=0,tt=0,et=0,nt=0,it=function(){var t=0;for(i in w)w.hasOwnProperty(i)&&i>t&&(t=i);return t+1},rt=function(){var t=k.position.z-B.position.z;t<1&&(t=1),k.near=t+G,k.near<1&&(k.near=1),k.far=t+H,k.near+1>k.far&&(k.far=k.near+1),k.fov=F,k.right=t*Math.tan(Math.PI/180*F),k.left=-k.right,k.top=k.right/I,k.bottom=-k.top,k.updateProjectionMatrix(),R.fog.near=k.near+q*(k.far-k.near),R.fog.far=k.far},ot=function(t){if(R&&(rt(),z.render(R,k),!t&&D.length>0))for(var e=_.getView(),n=0;n<D.length;n++){var i=D[n];i.setView(e,!0)}},at=function(){R=new c.Scene,R.fog=new c.Fog(g,100,200),U=new c.Object3D,B=new c.Object3D,B.useQuaternion=!0,B.quaternion=new c.Quaternion(0,0,0,1),B.add(U),R.add(B);var t=new c.Light(16777215);t.position=new c.Vector3(.2,.2,1).normalize(),t.intensity=1,R.add(t)};at(),z.setClearColorHex(g,1),R.fog.color=c.CC.color(g);var st=null,lt=function(){T.splice(0,T.length);var t,e;for(t=0,e=x.length;t<e;t++){var n=x[t];if(n){var i=n.selectedAtoms({clickable:!0});Array.prototype.push.apply(T,i)}}for(t=0,e=C.length;t<e;t++){var r=C[t];r&&r.clickable&&T.push(r)}},ut=function(t,e,n){if(0!=T.length){var i={x:t,y:e,z:-1};j.set(i.x,i.y,i.z),N.unprojectVector(j,k),j.sub(k.position).normalize(),O.set(k.position,j);var r=[];if(r=O.intersectObjects(U,T),r.length){var o=r[0].clickable;void 0!==o.callback&&"function"==typeof o.callback&&o.callback(o,_,n,y)}}},ct=function(t){var e=t.originalEvent.targetTouches[0].pageX-t.originalEvent.targetTouches[1].pageX,n=t.originalEvent.targetTouches[0].pageY-t.originalEvent.targetTouches[1].pageY;return Math.sqrt(e*e+n*n)},dt=function(t){var e=t.pageX,n=t.pageY;return t.originalEvent.targetTouches&&t.originalEvent.targetTouches[0]?(e=t.originalEvent.targetTouches[0].pageX,n=t.originalEvent.targetTouches[0].pageY):t.originalEvent.changedTouches&&t.originalEvent.changedTouches[0]&&(e=t.originalEvent.changedTouches[0].pageX,n=t.originalEvent.changedTouches[0].pageY),[e,n]},pt=function(t,e){var n=t/S,i=e/M,r=B.position.z,o=B.quaternion,a=new c.Vector3(0,0,r);return N.projectVector(a,k),a.x+=2*n,a.y-=2*i,N.unprojectVector(a,k),a.z=0,a.applyQuaternion(o),a};u("body").bind("mouseup touchend",function(t){if(X&&R){var e=dt(t),n=e[0],i=e[1];if(n==K&&i==Z){var r=u("canvas",y).offset(),o=(n-r.left)/S*2-1,a=2*-((i-r.top)/M)+1;ut(o,a,t,y)}}X=!1});var ht=this._handleMouseDown=function(t){if(t.preventDefault(),R){var e=dt(t),n=e[0],i=e[1];void 0!==n&&(X=!0,st=null,mouseButton=t.which,K=n,Z=i,Q=0,t.originalEvent.targetTouches&&2==t.originalEvent.targetTouches.length&&(Q=ct(t)),W=B.quaternion,tt=B.position.z,J=U.position.clone(),et=G,nt=H)}},ft=this._handleMouseScroll=function(t){if(t.preventDefault(),R){var e=.85*(E-B.position.z),n=1;t.originalEvent.ctrlKey&&(n=-1),t.originalEvent.detail?B.position.z+=n*e*t.originalEvent.detail/10:t.originalEvent.wheelDelta&&(B.position.z-=n*e*t.originalEvent.wheelDelta/400),B.position.z>E&&(B.position.z=.999*E),ot()}},mt=this._handleMouseMove=function(t){if(S=y.width(),M=y.height(),t.preventDefault(),R&&X){var e=0,n=dt(t),i=n[0],r=n[1];if(void 0!==i){var o=(i-K)/S,a=(r-Z)/M;if(0!=Q&&t.originalEvent.targetTouches&&2==t.originalEvent.targetTouches.length){var s=ct(t);e=2,a=2*(s-Q)/(S+M),console.log("pinch "+Q+" dy "+a)}else t.originalEvent.targetTouches&&3==t.originalEvent.targetTouches.length&&(e=1);var l,u=Math.sqrt(o*o+a*a);if(3==e||3==mouseButton&&t.ctrlKey)G=et+100*o,H=nt+100*a;else if(2==e||3==mouseButton||t.shiftKey)l=.85*(E-B.position.z),l<80&&(l=80),B.position.z=tt+a*l,B.position.z>E&&(B.position.z=.999*E);else if(1==e||2==mouseButton||t.ctrlKey){var d=pt(i-K,r-Z);U.position.addVectors(J,d)}else if((0===e||1==mouseButton)&&0!==u){var p=Math.sin(u*Math.PI)/u;Y.x=Math.cos(u*Math.PI),Y.y=0,Y.z=p*o,Y.w=-p*a,B.quaternion=new c.Quaternion(1,0,0,0),B.quaternion.multiply(Y),B.quaternion.multiply(W)}ot()}}},gt=function(t){y=t,S=y.width(),M=y.height(),I=S/M,z.setSize(S,M),y.append(z.domElement),b=u(z.domElement),m||(b.bind("mousedown touchstart",ht),b.bind("DOMMouseScroll mousewheel",ft),b.bind("mousemove touchmove",mt),b.bind("contextmenu",function(t){t.preventDefault()}))};gt(y),this.setContainer=function(t){return"string"===u.type(t)&&(t=u("#"+t)),t||(t=y),gt(t),this},this.setBackgroundColor=function(t,e){"undefined"==typeof e?e=1:(e<0||e>1)&&(e=1);var n=c.CC.color(t);return R.fog.color=n,g=n.getHex(),z.setClearColorHex(n.getHex(),e),ot(),this},this.setProjection=function(t){k.ortho="orthographic"===t,rt()},this.setViewStyle=function(t){if("outline"===t.style){var e={};t.color&&(e.color=c.CC.color(t.color)),t.width&&(e.width=t.width),z.enableOutline(e)}else z.disableOutline();return this},o.style&&this.setViewStyle(o),this.setWidth=function(t){return S=t||S,z.setSize(S,M),this},this.setHeight=function(t){return M=t||M,z.setSize(S,M),this},this.resize=function(){return S=y.width(),M=y.height(),I=S/M,z.setSize(S,M),k.aspect=I,k.updateProjectionMatrix(),ot(),this},u(window).resize(this.resize),this.getModel=function(t){return t=t||x.length-1,x[t]},this.rotate=function(t,e){"undefined"==typeof e&&(e="y");var n=0,i=0,r=0,o=Math.PI*t/180,a=Math.sin(o/2),s=Math.cos(o/2);"x"==e&&(n=a),"y"==e&&(i=a),"z"==e&&(r=a);var l=new c.Quaternion(n,i,r,s).normalize();return B.quaternion.multiply(l),ot(),this},this.getView=function(){if(!U)return[0,0,0,0,0,0,0,1];var t=U.position,e=B.quaternion;return[t.x,t.y,t.z,B.position.z,e.x,e.y,e.z,e.w]},this.setView=function(t,e){return void 0!==t&&(t instanceof Array||8!==t.length)&&U&&B?(U.position.x=t[0],U.position.y=t[1],U.position.z=t[2],B.position.z=t[3],B.quaternion.x=t[4],B.quaternion.y=t[5],B.quaternion.z=t[6],B.quaternion.w=t[7],"undefined"!=typeof t[8]&&(B.position.x=t[8],B.position.y=t[9]),ot(e),this):this},this.render=function(){lt();var t,e,n=(new Date,this.getView()),i=z.supportedExtensions();for(t=0;t<x.length;t++)x[t]&&x[t].globj(U,i);for(t=0;t<C.length;t++)C[t]&&C[t].globj(U,i);for(t in w)if(w.hasOwnProperty(t)){var r=w[t];for(e=0;e<r.length;e++)if(r.hasOwnProperty(e)){var o=r[e].geo;if(!r[e].finished){o.verticesNeedUpdate=!0,o.elementsNeedUpdate=!0,o.normalsNeedUpdate=!0,o.colorsNeedUpdate=!0,o.buffersNeedUpdate=!0,o.boundingSphere=null,r[e].done&&(r[e].finished=!0),r[e].lastGL&&U.remove(r[e].lastGL);var a=null;if(a=r[e].mat instanceof c.LineBasicMaterial?new c.Line(o,r[e].mat):new c.Mesh(o,r[e].mat),r[e].mat.transparent&&0==r[e].mat.opacity?a.visible=!1:a.visible=!0,r[e].symmetries.length>1||1==r[e].symmetries.length&&!r[e].symmetries[e].isIdentity()){var s,l=new c.Object3D;for(s=0;s<r[e].symmetries.length;s++){var u=a.clone();u.matrix=r[e].symmetries[s],u.matrixAutoUpdate=!1,l.add(u)}r[e].lastGL=l,U.add(l)}else r[e].lastGL=a,U.add(a)}}}this.setView(n);new Date;return this},this.selectedAtoms=function(t){return a(t)},this.pdbData=function(t){for(var e=a(t),n="",i=0,r=e.length;i<r;++i)n+=e[i].pdbline+"\n";return n},this.zoom=function(t){var t=t||2,e=(E-B.position.z)/t;return B.position.z=E-e,ot(),this},this.translate=function(t,e){var n=t/S,i=e/M,r=new c.Vector3(0,0,-E);return N.projectVector(r,k),r.x-=n,r.y-=i,N.unprojectVector(r,k),r.z=0,V.add(r),k.lookAt(V),ot(),this},this.zoomTo=function(t){var e,n;t=t||{};var i=a(t),r=c.getExtent(i);u.isEmptyObject(t)?(u.each(C,function(t,e){if(e&&e.boundingSphere&&e.boundingSphere.center)var n=e.boundingSphere.center;var r=e.boundingSphere.radius;r>0?(i.push(new c.Vector3(n.x+r,n.y,n.z)),i.push(new c.Vector3(n.x-r,n.y,n.z)),i.push(new c.Vector3(n.x,n.y+r,n.z)),i.push(new c.Vector3(n.x,n.y-r,n.z)),i.push(new c.Vector3(n.x,n.y,n.z+r)),i.push(new c.Vector3(n.x,n.y,n.z-r))):i.push(n)}),r=c.getExtent(i),e=i,n=r):(e=a({}),n=c.getExtent(e));var o=new c.Vector3(r[2][0],r[2][1],r[2][2]);U.position=o.clone().multiplyScalar(-1);var s=n[1][0]-n[0][0],l=n[1][1]-n[0][1],d=n[1][2]-n[0][2],p=Math.sqrt(s*s+l*l+d*d);p<5&&(p=5),G=-p/1.9,H=p/2,s=r[1][0]-r[0][0],l=r[1][1]-r[0][1],d=r[1][2]-r[0][2],p=Math.sqrt(s*s+l*l+d*d),p<5&&(p=5);for(var h=25,f=0;f<i.length;f++)if(i[f]){var m=o.distanceToSquared(i[f]);m>h&&(h=m)}var p=2*Math.sqrt(h);return B.position.z=-(.5*p/Math.tan(Math.PI/180*k.fov/2)-E),ot(),this},this.setSlab=function(t,e){G=t,H=e},this.getSlab=function(t){return{near:G,far:H}},this.addLabel=function(t,e){var n=new c.Label(t,e);return n.setContext(),U.add(n.sprite),A.push(n),ot(),n},this.addResLabels=function(t,e){return d("addResLabels",t,this,e),this},this.removeLabel=function(t){for(var e=0;e<A.length;e++)if(A[e]==t){A.splice(e,1),t.dispose(),U.remove(t.sprite);break}return this},this.removeAllLabels=function(){for(var t=0;t<A.length;t++)U.remove(A[t].sprite);return A.splice(0,A.length),this},this.setLabelStyle=function(t,e){return U.remove(t.sprite),t.dispose(),t.stylespec=e,t.setContext(),U.add(t.sprite),ot(),t},this.setLabelText=function(t,e){return U.remove(t.sprite),t.dispose(),t.text=e,t.setContext(),U.add(t.sprite),ot(),t},this.addShape=function(t){t=t||{};var e=new c.GLShape(t);return e.shapePosition=C.length,C.push(e),e},this.removeShape=function(t){if(!t)return this;for(t.removegl(U),delete C[t.shapePosition];C.length>0&&"undefined"==typeof C[C.length-1];)C.pop();return this},this.removeAllShapes=function(){for(var t=0;t<C.length;t++){var e=C[t];e.removegl(U)}return C.splice(0,C.length),this},this.addSphere=function(t){t=t||{};var e=new c.GLShape(t);return e.shapePosition=C.length,e.addSphere(t),C.push(e),e},this.addArrow=function(t){t=t||{};var e=new c.GLShape(t);return e.shapePosition=C.length,e.addArrow(t),C.push(e),e},this.addCylinder=function(t){t=t||{};var e=new c.GLShape(t);return e.shapePosition=C.length,e.addCylinder(t),C.push(e),e},this.addLine=function(t){t=t||{},t.wireframe=!0;var e=new c.GLShape(t);
return e.shapePosition=C.length,t.dashed?e=l(t,e):e.addLine(t),C.push(e),e},this.addUnitCell=function(t){var e=new c.GLShape({wireframe:!0});e.shapePosition=C.length;var n=t.getCrystData();if(n){var i=n.a,r=n.b,o=n.c,a=n.alpha,s=n.beta,l=n.gamma;a=a*Math.PI/180,s=s*Math.PI/180,l=l*Math.PI/180;var u,d,p;u=Math.cos(s),d=(Math.cos(a)-Math.cos(s)*Math.cos(l))/Math.sin(l),p=Math.sqrt(Math.max(0,1-u*u-d*d));for(var h=new c.Matrix4(i,r*Math.cos(l),o*u,0,0,r*Math.sin(l),o*d,0,0,0,o*p,0,0,0,0,1),f=[new c.Vector3(0,0,0),new c.Vector3(1,0,0),new c.Vector3(0,1,0),new c.Vector3(0,0,1),new c.Vector3(1,1,0),new c.Vector3(0,1,1),new c.Vector3(1,0,1),new c.Vector3(1,1,1)],m=0;m<f.length;m++)f[m]=f[m].applyMatrix4(h);e.addLine({start:f[0],end:f[1]}),e.addLine({start:f[0],end:f[2]}),e.addLine({start:f[1],end:f[4]}),e.addLine({start:f[2],end:f[4]}),e.addLine({start:f[0],end:f[3]}),e.addLine({start:f[3],end:f[5]}),e.addLine({start:f[2],end:f[5]}),e.addLine({start:f[1],end:f[6]}),e.addLine({start:f[4],end:f[7]}),e.addLine({start:f[6],end:f[7]}),e.addLine({start:f[3],end:f[6]}),e.addLine({start:f[5],end:f[7]})}return C.push(e),e},this.addCustom=function(t){t=t||{};var e=new c.GLShape(t);return e.shapePosition=C.length,e.addCustom(t),C.push(e),e},this.addVolumetricData=function(t,e,n){n=n||{};var i=new c.GLShape(n);return i.shapePosition=C.length,i.addVolumetricData(t,e,n),C.push(i),i},this.addIsosurface=function(t,e){e=e||{};var n=new c.GLShape(e);return n.shapePosition=C.length,n.addIsosurface(t,e),C.push(n),n},this.setFrame=function(t){for(var e=0;e<x.length;e++)x[e].setFrame(t);return this},this.getFrames=function(){for(var t=0,e=0,n=0;n<x.length;n++)x[n].getFrames().length>t&&(e=n,t=x[n].getFrames().length);return t},this.animate=function(t){$=!0;var e=100,n="forward",i=0;t=t||{},t.interval&&(e=t.interval),t.loop&&(n=t.loop),t.reps&&(i=t.reps);var r=this.getFrames(),o=this,a=0,s=1,l=0,u=r*i,c=function(t){"forward"==t?(o.setFrame(a),a=(a+s)%r):"backward"==t?(o.setFrame(r-1-a),a=(a+s)%r):(o.setFrame(a),a+=s,s*=a%(r-1)==0?-1:1),o.render(),++l!=u&&o.isAnimated()||clearInterval(d)},d=setInterval(function(){c(n)},e);return this},this.stopAnimate=function(){return $=!1,this},this.isAnimated=function(){return $},this.addModel=function(t,e,n){var i=new c.GLModel(x.length,f);return i.addMolData(t,e,n),x.push(i),i},this.addModels=function(t,e,n){n=n||{},n.multimodel=!0,n.frames=!0;for(var i=c.GLModel.parseMolData(t,e,n),r=0;r<i.length;r++){var o=new c.GLModel(x.length,f);o.setAtomDefaults(i[r]),o.addFrame(i[r]),o.setFrame(0),o.setModelData(i.modelData[r]),o.setDontDuplicateAtoms(!n.duplicateAssemblyAtoms),x.push(o)}return x},this.addModelsAsFrames=function(t,e,n){n=n||{},n.multimodel=!0,n.frames=!0;var i=new c.GLModel(x.length,f);return i.addMolData(t,e,n),x.push(i),i},this.addAsOneMolecule=function(t,e,n){n=n||{},n.multimodel=!0,n.onemol=!0;var i=new c.GLModel(x.length,f);return i.addMolData(t,e,n),x.push(i),i},this.removeModel=function(t){if(t){for(t.removegl(U),delete x[t.getID()];x.length>0&&"undefined"==typeof x[x.length-1];)x.pop();return this}},this.removeAllModels=function(){for(var t=0;t<x.length;t++){var e=x[t];e.removegl(U)}return x.splice(0,x.length),this},this.exportJSON=function(t,e){var n={};return void 0===e?n.m=x.map(function(e){return e.toCDObject(t)}):n.m=[model[e].toCDObject()],JSON.stringify(n)},this.createModelFrom=function(t,e){for(var n=new c.GLModel(x.length,f),i=0;i<x.length;i++)if(x[i]){var r=x[i].selectedAtoms(t);n.addAtoms(r),e&&x[i].removeAtoms(r)}return x.push(n),n},this.setStyle=function(t,e){return"undefined"==typeof e&&(e=t,t={}),d("setStyle",t,e,!1),this},this.addStyle=function(t,e){return"undefined"==typeof e&&(e=t,t={}),d("setStyle",t,e,!0),this},this.setClickable=function(t,e,n){return d("setClickable",t,e,n),this},this.setColorByProperty=function(t,e,n){return d("setColorByProperty",t,e,n),this},this.setColorByElement=function(t,e){return d("setColorByElement",t,e),this};var vt=function(t,e){for(var n=[],i=0;i<t.length;i++){var r=t[i];"undefined"!=typeof r&&(r.x<e[0][0]||r.x>e[1][0]||r.y<e[0][1]||r.y>e[1][1]||r.z<e[0][2]||r.z>e[1][2]||n.push(i))}return n},_t=function(t){var e=t[1][0]-t[0][0],n=t[1][1]-t[0][1],i=t[1][2]-t[0][2];return e*n*i},yt=function(t,e,n){for(var i=[],o=function(t){var e=[];return e[0]=[t[0][0],t[0][1],t[0][2]],e[1]=[t[1][0],t[1][1],t[1][2]],e},a=function(t){if(_t(t)<r)return[t];var e,n=t[1][0]-t[0][0],i=t[1][1]-t[0][1],s=t[1][2]-t[0][2];e=n>i&&n>s?0:i>n&&i>s?1:2;var l=o(t),u=o(t),c=(t[1][e]-t[0][e])/2+t[0][e];l[1][e]=c,u[0][e]=c;var d=a(l),p=a(u);return d.concat(p)},s=a(t),l=6,u=0,c=s.length;u<c;u++){var d=o(s[u]);d[0][0]-=l,d[0][1]-=l,d[0][2]-=l,d[1][0]+=l,d[1][1]+=l,d[1][2]+=l;var p=vt(e,d),h=vt(n,s[u]);i.push({extent:s[u],atoms:p,toshow:h})}return i},bt=function(t,e,n){var i=new c.Geometry(!0),r=i.updateGeoGroup(0),o=[];for(l=0,u=t.length;l<u;l++){var a=t[l];a&&("undefined"!=typeof a.surfaceColor?o[l]=a.surfaceColor:a.color&&(o[l]=c.CC.color(a.color)))}var s,l,u,d=r.vertexArray,p=e.vertices;for(l=0,u=p.length;l<u;l++)s=3*r.vertices,d[s]=p[l].x,d[s+1]=p[l].y,d[s+2]=p[l].z,r.vertices++;var h=r.colorArray;if(n.voldata&&n.volscheme){var f=n.volscheme,m=n.voldata,g=f.range()||[-1,1];for(l=0,u=p.length;l<u;l++){var v=m.getVal(p[l].x,p[l].y,p[l].z),_=c.CC.color(f.valueToHex(v,g)),s=3*l;h[s]=_.r,h[s+1]=_.g,h[s+2]=_.b}}else if(o.length>0)for(l=0,u=p.length;l<u;l++){var y=p[l].atomid,b=3*l;h[b]=o[y].r,h[b+1]=o[y].g,h[b+2]=o[y].b}var x=e.faces;r.faceidx=x.length,i.initTypedArrays();var w,C,A,T,S=r.vertexArray,M=r.normalArray;for(l=0,u=x.length;l<u;l+=3){var I=x[l],P=x[l+1],L=x[l+2],y=p[I].atomid,b=(p[P].atomid,p[L].atomid,3*I),E=3*P,F=3*L;w=new c.Vector3(S[b],S[b+1],S[b+2]),C=new c.Vector3(S[E],S[E+1],S[E+2]),A=new c.Vector3(S[F],S[F+1],S[F+2]),A.subVectors(A,C),w.subVectors(w,C),A.cross(w),T=A,T.normalize(),M[b]+=T.x,M[E]+=T.x,M[F]+=T.x,M[b+1]+=T.y,M[E+1]+=T.y,M[F+1]+=T.y,M[b+2]+=T.z,M[E+2]+=T.z,M[F+2]+=T.z}r.faceArray=new Uint16Array(x);var D=new c.Mesh(i,n);return D.doubleSided=!0,D},xt=function(t,e,n,i,r,o){var a=(new Date,new c.ProteinSurface);a.initparm(e,1!==t,o);new Date;a.fillvoxels(r,n);new Date;a.buildboundary(),t==c.SurfaceType.SES&&(a.fastdistancemap(),a.boundingatom(!1),a.fillvoxelswaals(r,n));new Date;a.marchingcube(t);new Date;return a.getFacesAndVertices(i)};this.addMesh=function(t){var e={geo:t.geometry,mat:t.material,done:!0,finished:!1},n=it();return w[n]=e,n};var wt=function(t){var e=[];return u.each(t,function(t,n){e[t]=u.extend({},n)}),e};this.addSurface=function(t,n,i,r,o){var s=null,l=null,u=wt(a(i));s=r?wt(a(r)):u;var d,h=!1;for(d=0;d<x.length;d++)if(x[d]){var f=x[d].getSymmetries();if(f.length>1||1==f.length&&!f[0].isIdentity()){h=!0;break}}var m=function(i,r,s){l=o?wt(a(o)):s;var u,d,p,h=(new Date,c.getExtent(s,!0));if(n.map&&n.map.prop){var f=n.map.prop,m=n.map.scheme||n.map.gradient||new c.Gradient.RWB,v=m.range();v||(v=c.getPropertyRange(s,f)),n.colorscheme={prop:f,gradient:m}}for(d=0,p=r.length;d<p;d++)u=r[d],u.surfaceColor=c.getColorFromStyle(u,n);var y=_t(h),b=yt(h,r,s);if(l&&l.length&&l.length>0){var x=c.getExtent(l,!0),w=function(t,e){var n=function(t,e){var n=t.extent,i=n[1][0]-n[0][0],r=n[1][1]-n[0][1],o=n[1][2]-n[0][2],a=i-e[2][0];a*=a;var s=r-e[2][1];s*=s;var l=o-e[2][2];return l*=l,a+s+l},i=n(t,x),r=n(e,x);return i-r};b.sort(w)}var C=[];for(d=0,p=r.length;d<p;d++)u=r[d],C[d]={x:u.x,y:u.y,z:u.z,serial:d,elem:u.elem};var A=!!c.syncSurface;if(A){var T=function e(n){if(!(n>=b.length)){var o=xt(t,b[n].extent,b[n].atoms,b[n].toshow,C,y),a=bt(r,o,g);c.mergeGeos(i.geo,a),_.render(),setTimeout(e,1,n+1)}};setTimeout(T,1,0)}else{var S=[];for(t<0&&(t=0),d=0,p=e;d<p;d++){var M=new Worker(c.SurfaceWorker);S.push(M),M.postMessage({type:-1,atoms:C,volume:y})}var I=0,P=function(t){for(var e=c.splitMesh({vertexArr:t.data.vertices,faceArr:t.data.faces}),n=0,o=e.length;n<o;n++){var a={vertices:e[n].vertexArr,faces:e[n].faceArr},s=bt(r,a,g);c.mergeGeos(i.geo,s),_.render()}I++,I==b.length&&(i.done=!0)},L=function(t){console.log(t.message+" ("+t.filename+":"+t.lineno+")")};for(d=0;d<b.length;d++){var E=S[d%S.length];E.onmessage=P,E.onerror=L,E.postMessage({type:t,expandedExtent:b[d].extent,extendedAtoms:b[d].atoms,atomsToShow:b[d].toshow})}}};n=n||{};var g=p(n),v=[];if(h){var y={},b={};for(d=0;d<x.length;d++)y[d]=[],b[d]=[];for(d=0;d<s.length;d++)y[s[d].model].push(s[d]);for(d=0;d<u.length;d++)b[u[d].model].push(u[d]);for(d=0;d<x.length;d++)v.push({geo:new c.Geometry(!0),mat:g,done:!1,finished:!1,symmetries:x[d].getSymmetries()}),m(v[d],y[d],b[d])}else v.push({geo:new c.Geometry(!0),mat:g,done:!1,finished:!1,symmetries:[new c.Matrix4]}),m(v[v.length-1],s,u);var C=it();return w[C]=v,C},this.setSurfaceMaterialStyle=function(t,e){if(w[t]){surfArr=w[t];for(var n=0;n<surfArr.length;n++)surfArr[n].mat=p(e),surfArr[n].mat.side=c.FrontSide,surfArr[n].finished=!1}return this},this.removeSurface=function(t){for(var e=w[t],n=0;n<e.length;n++)e[n]&&e[n].lastGL&&(void 0!==e[n].geo&&e[n].geo.dispose(),void 0!==e[n].mat&&e[n].mat.dispose(),U.remove(e[n].lastGL));return delete w[t],ot(),this},this.removeAllSurfaces=function(){for(n in w)if(w.hasOwnProperty(n)){for(var t=w[n],e=0;e<t.length;e++)t[e]&&t[e].lastGL&&(void 0!==t[e].geo&&t[e].geo.dispose(),void 0!==t[e].mat&&t[e].mat.dispose(),U.remove(t[e].lastGL));delete w[n]}return ot(),this},this.jmolMoveTo=function(){var t=U.position,e="center { "+-t.x+" "+-t.y+" "+-t.z+" }; ",n=B.quaternion;return e+="moveto .5 quaternion { "+n.x+" "+n.y+" "+n.z+" "+n.w+" };"},this.clear=function(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),ot(),this},this.mapAtomProperties=function(t,e){e=e||{};var n=a(e);if("function"==typeof t)for(var i=0,r=n.length;i<r;i++){var o=n[i];t(o)}else for(var i=0,r=n.length;i<r;i++)for(var o=n[i],l=0,u=t.length;l<u;l++){var c=t[l];if(c.props)for(var d in c.props)c.props.hasOwnProperty(d)&&s(o,c)&&(o.properties||(o.properties={}),o.properties[d]=c.props[d])}return this},this.linkViewer=function(t){return D.push(t),this};try{"function"==typeof h&&h(this)}catch(t){console.log("error with glviewer callback: "+t)}}var e=4,r=64e3;return t}(),c.glmolViewer=c.GLViewer;var c=c||{};c.Gradient=function(t,e){},c.Gradient.valueToHex=function(t,e){},c.Gradient.range=function(){},c.Gradient.RWB=function(t,e,n){var i=1;"undefined"==typeof e&&u.isArray(t)&&t.length>=2&&(e=t[1],t=t[0]),e<t&&(i=-1,t*=-1,e*=-1),this.valueToHex=function(r,o){var a,s;if(r*=i,o?(a=o[0],s=o[1]):(a=t,s=e),void 0===r)return 16777215;r<a&&(r=a),r>s&&(r=s);var l=(s+a)/2;"undefined"!=typeof n&&(l=n);var u,c;return r<=l?(u=Math.floor(255*Math.sqrt((r-a)/(l-a))),c=16711680+256*u+u):(u=Math.floor(255*Math.sqrt(1-(r-l)/(s-l))),c=65536*u+256*u+255)},this.range=function(){return"undefined"!=typeof t&&"undefined"!=typeof e?[t,e]:null}},c.Gradient.ROYGB=function(t,e){var n=1;"undefined"==typeof e&&u.isArray(t)&&t.length>=2&&(e=t[1],t=t[0]),e<t&&(n=-1,t*=-1,e*=-1),this.valueToHex=function(i,r){var o,a;if(i*=n,r?(o=r[0],a=r[1]):(o=t,a=e),"undefined"==typeof i)return 16777215;i<o&&(i=o),i>a&&(i=a);var s,l,u=(o+a)/2,c=(o+u)/2,d=(u+a)/2;return i<c?(s=Math.floor(255*Math.sqrt((i-o)/(c-o))),l=16711680+256*s+0):i<u?(s=Math.floor(255*Math.sqrt(1-(i-c)/(u-c))),l=65536*s+65280+0):i<d?(s=Math.floor(255*Math.sqrt((i-u)/(d-u))),l=65280+1*s):(s=Math.floor(255*Math.sqrt(1-(i-d)/(a-d))),l=0+256*s+255)},this.range=function(){return"undefined"!=typeof t&&"undefined"!=typeof e?[t,e]:null}},c.Gradient.Sinebow=function(t,e){var n=1;"undefined"==typeof e&&u.isArray(t)&&t.length>=2&&(e=t[1],t=t[0]),e<t&&(n=-1,t*=-1,e*=-1),this.valueToHex=function(i,r){var o,a;if(i*=n,r?(o=r[0],a=r[1]):(o=t,a=e),"undefined"==typeof i)return 16777215;i<o&&(i=o),i>a&&(i=a);var s=(i-o)/(a-o),l=5*s/6+.5,u=Math.sin(Math.PI*l);u*=255*u;var c=Math.sin(Math.PI*(l+1/3));c*=255*c;var d=Math.sin(Math.PI*(l+2/3));return d*=255*d,65536*Math.floor(u)+256*Math.floor(d)+1*Math.floor(c)},this.range=function(){return"undefined"!=typeof t&&"undefined"!=typeof e?[t,e]:null}},c.LabelCount=0,c.Label=function(t,e){this.id=c.LabelCount++,this.stylespec=e||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new c.Sprite,this.text=t},c.Label.prototype={constructor:c.Label,getStyle:function(){return this.stylespec},setContext:function(){var t=function(t,e,n,i,r,o,a){t.beginPath(),t.moveTo(e+o,n),t.lineTo(e+i-o,n),t.quadraticCurveTo(e+i,n,e+i,n+o),t.lineTo(e+i,n+r-o),t.quadraticCurveTo(e+i,n+r,e+i-o,n+r),t.lineTo(e+o,n+r),t.quadraticCurveTo(e,n+r,e,n+r-o),t.lineTo(e,n+o),t.quadraticCurveTo(e,n,e+o,n),t.closePath(),t.fill(),a&&t.stroke()},e=function(t,e,n){var i=n;return"undefined"!=typeof t&&(i=t instanceof c.Color?t.scaled():c.CC.color(t).scaled()),"undefined"!=typeof e&&(i.a=parseFloat(e)),i};return function(){var n=this.stylespec,i="undefined"!=typeof n.useScreen&&n.useScreen,r=n.showBackground;"0"!==r&&"false"!==r||(r=!1),"undefined"==typeof r&&(r=!0);var o=n.font?n.font:"sans-serif",a=parseInt(n.fontSize)?parseInt(n.fontSize):18,s=e(n.fontColor,n.fontOpacity,{r:255,g:255,b:255,a:1}),l=n.padding?n.padding:4,u=n.borderThickness?n.borderThickness:0,d=e(n.backgroundColor,n.backgroundOpacity,{r:0,g:0,b:0,a:1}),p=e(n.borderColor,n.borderOpacity,d),h=n.position?n.position:{x:-10,y:1,z:1},f=void 0===n.inFront||n.inFront;"false"!==f&&"0"!==f||(f=!1);var m=n.alignment||c.SpriteAlignment.topLeft,g="";n.bold&&(g="bold "),this.context.font=g+a+"px  "+o;var v=this.context.measureText(this.text),_=v.width;r||(u=0);var y=_+2.5*u+2*l,b=1.25*a+2*u+2*l;if(n.backgroundImage){var x=n.backgroundImage,w=n.backgroundWidth?n.backgroundWidth:x.width,C=n.backgroundHeight?n.backgroundHeight:x.height;w>y&&(y=w),C>b&&(b=C)}this.canvas.width=y,this.canvas.height=b,this.context.clearRect(0,0,this.canvas.width,this.canvas.height);var g="";if(n.bold&&(g="bold "),this.context.font=g+a+"px  "+o,this.context.fillStyle="rgba("+d.r+","+d.g+","+d.b+","+d.a+")",this.context.strokeStyle="rgba("+p.r+","+p.g+","+p.b+","+p.a+")",this.context.lineWidth=u,r&&t(this.context,u,u,y-2*u,b-2*u,6,u>0),n.backgroundImage){var x=n.backgroundImage,w=n.backgroundWidth?n.backgroundWidth:x.width,C=n.backgroundHeight?n.backgroundHeight:x.height;this.context.drawImage(x,0,0,w,C)}this.context.fillStyle="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",this.context.fillText(this.text,u+l,a+u+l,_);var A=new c.Texture(this.canvas);A.needsUpdate=!0,this.sprite.material=new c.SpriteMaterial({map:A,useScreenCoordinates:i,alignment:m,depthTest:!f}),this.sprite.scale.set(1,1,1),this.sprite.position.set(h.x,h.y,h.z)}}(),dispose:function(){void 0!==this.sprite.material.map&&this.sprite.material.map.dispose(),void 0!==this.sprite.material&&this.sprite.material.dispose()}},c=c||{},c.MarchingCubeInitializer=function(){var t=2,e={};e.march=function(e,a,s,l){var u=!!l.fulltable,d=l.hasOwnProperty("origin")&&l.origin.hasOwnProperty("x")?l.origin:{x:0,y:0,z:0},p=!!l.voxel,h=l.matrix,f=l.nX||0,m=l.nY||0,g=l.nZ||0,v=l.scale||1,_=null;_=l.unitCube?l.unitCube:{x:v,y:v,z:v};var y,b,x=new Int32Array(f*m*g);for(y=0,b=x.length;y<b;++y)x[y]=-1;var w=function(t,e,n,i,r,o){var s={x:0,y:0,z:0},l=!!(i&1<<r),u=!!(i&1<<o),f=r;!l&&u&&(f=o),1&f&&n++,2&f&&e++,4&f&&t++,h?(s=new c.Vector3(t,e,n),s=s.applyMatrix4(h),s={x:s.x,y:s.y,z:s.z}):(s.x=d.x+_.x*t,s.y=d.y+_.y*e,s.z=d.z+_.z*n);var v=(m*t+e)*g+n;return p?(a.push(s),a.length-1):(x[v]<0&&(x[v]=a.length,a.push(s)),x[v])},C=new Int32Array(12),A=u?r:n,T=u?o:i;for(y=0;y<f-1;++y)for(var S=0;S<m-1;++S)for(var M=0;M<g-1;++M){for(var I=0,P=0;P<8;++P){var L=(m*(y+((4&P)>>2))+S+((2&P)>>1))*g+M+(1&P),E=!!(e[L]&t);I|=E<<P}if(0!==I&&255!==I){var F=A[I];if(0!==F){var D=T[I];1&F&&(C[0]=w(y,S,M,I,0,1)),2&F&&(C[1]=w(y,S,M,I,1,3)),4&F&&(C[2]=w(y,S,M,I,3,2)),8&F&&(C[3]=w(y,S,M,I,2,0)),16&F&&(C[4]=w(y,S,M,I,4,5)),32&F&&(C[5]=w(y,S,M,I,5,7)),64&F&&(C[6]=w(y,S,M,I,7,6)),128&F&&(C[7]=w(y,S,M,I,6,4)),256&F&&(C[8]=w(y,S,M,I,0,4)),512&F&&(C[9]=w(y,S,M,I,1,5)),1024&F&&(C[10]=w(y,S,M,I,3,7)),2048&F&&(C[11]=w(y,S,M,I,2,6));for(var z=0;z<D.length;z+=3){var k=C[D[z]],V=C[D[z+1]],O=C[D[z+2]];p&&z>=3&&(a.push(a[k]),k=a.length-1,a.push(a[V]),V=a.length-1,a.push(a[O]),O=a.length-1),s.push(k),s.push(V),s.push(O)}}}}},e.laplacianSmooth=function(t,e,n){var i,r,o,a,s,l=new Array(e.length);for(i=0,r=e.length;i<r;i++)l[i]={x:0,y:0,z:0};var u,c=new Array(20);for(i=0;i<20;i++)c[i]=new Array(e.length);for(i=0,r=e.length;i<r;i++)c[0][i]=0;for(i=0,r=n.length/3;i<r;i++){var d=3*i,p=3*i+1,h=3*i+2;for(u=!0,o=0,a=c[0][n[d]];o<a;o++)if(n[p]==c[o+1][n[d]]){u=!1;break}for(u&&(c[0][n[d]]++,c[c[0][n[d]]][n[d]]=n[p]),u=!0,o=0,a=c[0][n[d]];o<a;o++)if(n[h]==c[o+1][n[d]]){u=!1;break}for(u&&(c[0][n[d]]++,c[c[0][n[d]]][n[d]]=n[h]),u=!0,o=0,a=c[0][n[p]];o<a;o++)if(n[d]==c[o+1][n[p]]){u=!1;break}for(u&&(c[0][n[p]]++,c[c[0][n[p]]][n[p]]=n[d]),u=!0,o=0,a=c[0][n[p]];o<a;o++)if(n[h]==c[o+1][n[p]]){u=!1;break}for(u&&(c[0][n[p]]++,c[c[0][n[p]]][n[p]]=n[h]),u=!0,o=0;o<c[0][n[h]];o++)if(n[d]==c[o+1][n[h]]){u=!1;break}for(u&&(c[0][n[h]]++,c[c[0][n[h]]][n[h]]=n[d]),u=!0,o=0,a=c[0][n[h]];o<a;o++)if(n[p]==c[o+1][n[h]]){u=!1;break}u&&(c[0][n[h]]++,c[c[0][n[h]]][n[h]]=n[p])}var f=1,m=.5;for(s=0;s<t;s++){for(i=0,r=e.length;i<r;i++)if(c[0][i]<3)l[i].x=e[i].x,l[i].y=e[i].y,l[i].z=e[i].z;else if(3==c[0][i]||4==c[0][i]){for(l[i].x=0,l[i].y=0,l[i].z=0,o=0,a=c[0][i];o<a;o++)l[i].x+=e[c[o+1][i]].x,l[i].y+=e[c[o+1][i]].y,l[i].z+=e[c[o+1][i]].z;l[i].x+=m*e[i].x,l[i].y+=m*e[i].y,l[i].z+=m*e[i].z,l[i].x/=m+c[0][i],l[i].y/=m+c[0][i],l[i].z/=m+c[0][i]}else{for(l[i].x=0,l[i].y=0,l[i].z=0,o=0,a=c[0][i];o<a;o++)l[i].x+=e[c[o+1][i]].x,l[i].y+=e[c[o+1][i]].y,l[i].z+=e[c[o+1][i]].z;l[i].x+=f*e[i].x,l[i].y+=f*e[i].y,l[i].z+=f*e[i].z,l[i].x/=f+c[0][i],l[i].y/=f+c[0][i],l[i].z/=f+c[0][i]}for(i=0,r=e.length;i<r;i++)e[i].x=l[i].x,e[i].y=l[i].y,e[i].z=l[i].z}},e.edgeTable=[0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0];var n=new Uint32Array(e.edgeTable),i=e.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],r=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],o=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]];return e},c.MarchingCube=c.MarchingCubeInitializer(),c.Parsers=function(){var t={},e=function(t){for(var e=0,n=t.length;e<n;e++)t[e].index||(t[e].index=e);for(var i={},r=4.95,o=0;o<t.length;o++){var a=t[o],l=Math.floor(a.x/r),u=Math.floor(a.y/r),c=Math.floor(a.z/r);i[l]||(i[l]={}),i[l][u]||(i[l][u]={}),i[l][u][c]||(i[l][u][c]=[]),i[l][u][c].push(a)}var d=function(t,e){for(var n=0;n<t.length;n++)for(var i=t[n],r=0;r<e.length;r++){var o=e[r];s(i,o)&&i.bonds.indexOf(o.index)==-1&&(i.bonds.push(o.index),i.bondOrder.push(1),o.bonds.push(i.index),o.bondOrder.push(1))}},p=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}];for(var l in i){l=parseInt(l);for(var u in i[l]){u=parseInt(u);for(var c in i[l][u]){c=parseInt(c);for(var h=i[l][u][c],e=0;e<h.length;e++)for(var f=h[e],m=e+1;m<h.length;m++){var g=h[m];s(f,g)&&f.bonds.indexOf(g.index)==-1&&(f.bonds.push(g.index),f.bondOrder.push(1),g.bonds.push(f.index),g.bondOrder.push(1))}for(var v=0;v<p.length;v++){var _=p[v];if(i[l+_.x]&&i[l+_.x][u+_.y]&&i[l+_.x][u+_.y][c+_.z]){var y=i[l+_.x][u+_.y][c+_.z];d(h,y)}}}}}},n=function(t){var n,i,r=[],o=[];for(n=0,i=t.length;n<i;n++){var a=t[n];a.index=n,a.hetflag?o.push(a):r.push(a)}e(o),r.sort(function(t,e){return t.chain!=e.chain?t.chain<e.chain?-1:1:t.resi-e.resi});var l,u=-1,c=-1;for(n=0,i=r.length;n<i;n++){var d=r[n];d.resi!==u&&(u=d.resi,l||c++,l=!1),d.reschain=c;for(var p=n+1;p<r.length;p++){var h=r[p];if(h.chain!=d.chain)break;if(h.resi-d.resi>1)break;s(d,h)&&(d.bonds.indexOf(h.index)===-1&&(d.bonds.push(h.index),d.bondOrder.push(1),h.bonds.push(d.index),h.bondOrder.push(1)),d.resi!==h.resi&&(l=!0))}}},i=function(t){var e,n,i,r=3.2,o=10.24,a=[];for(e=0,i=t.length;e<i;e++){t[e].index=e;var s=t[e];s.hetflag||"N"!==s.atom&&"O"!==s.atom||(a.push(s),s.hbondOther=null,s.hbondDistanceSq=Number.POSITIVE_INFINITY)}for(a.sort(function(t,e){return t.z-e.z}),e=0,i=a.length;e<i;e++){var l=a[e];for(n=e+1;n<i;n++){var u=a[n],c=u.z-l.z;if(c>r)break;if(u.atom!=l.atom){var d=Math.abs(u.y-l.y);if(!(d>r)){var p=Math.abs(u.x-l.x);if(!(p>r)){var h=p*p+d*d+c*c;h>o||u.chain==l.chain&&Math.abs(u.resi-l.resi)<4||(h<l.hbondDistanceSq&&(l.hbondOther=u,l.hbondDistanceSq=h),h<u.hbondDistanceSq&&(u.hbondOther=l,u.hbondDistanceSq=h))}}}}}},r=function(t){i(t);var e,n,r,o,a,s,l={};for(e=0,n=t.length;e<n;e++)if(a=t[e],"undefined"==typeof l[a.chain]&&(l[a.chain]=[]),isFinite(a.hbondDistanceSq)){var u=a.hbondOther;"undefined"==typeof l[u.chain]&&(l[u.chain]=[]),4===Math.abs(u.resi-a.resi)&&(l[a.chain][a.resi]="h")}for(r in l)for(o=1;o<l[r].length-1;o++){var c=l[r][o-1],d=l[r][o+1];s=l[r][o],"h"==c&&c==d&&s!=c&&(l[r][o]=c)}for(e=0,n=t.length;e<n;e++)a=t[e],isFinite(a.hbondDistanceSq)&&"h"!=l[a.chain][a.resi]&&"h"!=a.ss&&(l[a.chain][a.resi]="maybesheet");for(e=0,n=t.length;e<n;e++)if(a=t[e],isFinite(a.hbondDistanceSq)&&"maybesheet"==l[a.chain][a.resi]){var u=a.hbondOther,p=l[u.chain][u.resi];"maybesheet"!=p&&"s"!=p||(l[a.chain][a.resi]="s",l[u.chain][u.resi]="s")}for(r in l){for(o=1;o<l[r].length-1;o++){var c=l[r][o-1],d=l[r][o+1];s=l[r][o],"s"==c&&c==d&&s!=c&&(l[r][o]=c)}for(o=0;o<l[r].length;o++)s=l[r][o],"h"!=s&&"s"!=s||l[r][o-1]!=s&&l[r][o+1]!=s&&delete l[r][o]}for(e=0,n=t.length;e<n;e++)a=t[e],s=l[a.chain][a.resi],"undefined"!=typeof s&&"maybesheet"!=s&&(a.ss=s,l[a.chain][a.resi-1]!=s&&(a.ssbegin=!0),l[a.chain][a.resi+1]!=s&&(a.ssend=!0))};t.vasp=t.VASP=function(t,e){var n=[[]],i={},r=t.replace(/^\s+/,"").split(/[\n\r]/);if(r.length<3)return n;if(!r[1].match(/\d+/))return console.log("Warning: second line of the vasp structure file must be a number"),
n;if(i.length=parseFloat(r[1]),i.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),n;i.xVec=new Float32Array(r[2].replace(/^\s+/,"").split(/\s+/)),i.yVec=new Float32Array(r[3].replace(/^\s+/,"").split(/\s+/)),i.zVec=new Float32Array(r[4].replace(/^\s+/,"").split(/\s+/));var o=r[5].replace(/\s+/,"").replace(/\s+$/,"").split(/\s+/),a=new Int16Array(r[6].replace(/^\s+/,"").split(/\s+/)),s=r[7].replace(/\s+/,"");if(s.match(/C/))s="cartesian";else{if(!s.match(/D/))return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),n;s="direct"}if(o.length!=a.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(o),console.log(a),n;r.splice(0,8);for(var l=0,u=0,c=o.length;u<c;u++){for(var d=o[u],p=0,h=a[u];p<h;p++){var f=new Float32Array(r[l+p].replace(/^\s+/,"").split(/\s+/));atom={},atom.elem=d,"cartesian"==s?(atom.x=i.length*f[0],atom.y=i.length*f[1],atom.z=i.length*f[2]):(atom.x=i.length*(f[0]*i.xVec[0]+f[1]*i.yVec[0]+f[2]*i.zVec[0]),atom.y=i.length*(f[0]*i.xVec[1]+f[1]*i.yVec[1]+f[2]*i.zVec[1]),atom.z=i.length*(f[0]*i.xVec[2]+f[1]*i.yVec[2]+f[2]*i.zVec[2])),atom.bonds=[],n[0].push(atom)}l+=a[u]}return n},t.cube=t.CUBE=function(t,n){var i=[[]],r=t.replace(/^\s+/,"").split(/\n\r|\r+/);if(r.length<6)return i;var o=r[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),a=Math.abs(parseFloat(o[0]));o=r[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var s=parseFloat(o[0])>0?.529177:1;r=r.splice(6,a);for(var l=i[i.length-1].length,u=l+r.length,c=l;c<u;++c){var d={};d.serial=c;var p=r[c-l],h=p.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");6==h[0]?d.elem="C":1==h[0]?d.elem="H":8==h[0]?d.elem="O":17==h[0]&&(d.elem="Cl"),d.x=parseFloat(h[2])*s,d.y=parseFloat(h[3])*s,d.z=parseFloat(h[4])*s,d.hetflag=!0,d.bonds=[],d.bondOrder=[],d.properties={},i[i.length-1].push(d)}for(var c=0;c<i.length;c++)e(i[c]);return i},t.xyz=t.XYZ=function(t,n){for(var i=[[]],r=t.split(/\r?\n|\r/);r.length>0&&!(r.length<3);){var o=parseInt(r[0]);if(isNaN(o)||o<=0)break;if(r.length<o+2)break;for(var a=2,s=i[i.length-1].length,l=s+o,u=s;u<l;u++){var c=r[a++],d=c.replace(/^\s+/,"").replace(/\s+/g," ").split(" "),p={};p.serial=u;var h=d[0];p.atom=p.elem=h[0].toUpperCase()+h.substr(1).toLowerCase(),p.x=parseFloat(d[1]),p.y=parseFloat(d[2]),p.z=parseFloat(d[3]),p.hetflag=!0,p.bonds=[],p.bondOrder=[],p.properties={},i[i.length-1][u]=p,d.length>=7&&(p.dx=parseFloat(d[4]),p.dy=parseFloat(d[5]),p.dz=parseFloat(d[6]))}if(!n.multimodel)break;i.push([]),r.splice(0,a)}for(var u=0;u<i.length;u++)e(i[u]);if(n.onemol){var f=i;i=[],i.push(f[0]);for(var u=1;u<f.length;u++)for(var a=i[0].length,m=0;m<f[u].length;m++){for(var g=f[u][m],v=0;v<g.bonds.length;v++)g.bonds[v]=g.bonds[v]+a;g.index=i[0].length,g.serial=i[0].length,i[0].push(g)}}return i},t.sdf=t.SDF=function(t,e){var n=[[]],i=!1;"undefined"!=typeof e.keepH&&(i=!e.keepH);for(var r=t.split(/\r?\n|\r/);r.length>0&&!(r.length<4);){var o=parseInt(r[3].substr(0,3));if(isNaN(o)||o<=0)break;var a=parseInt(r[3].substr(3,3)),s=4;if(r.length<4+o+a)break;var l,u,c=[],d=n[n.length-1].length,p=d+o;for(l=d;l<p;l++,s++){u=r[s];var h={},f=u.substr(31,3).replace(/ /g,"");h.atom=h.elem=f[0].toUpperCase()+f.substr(1).toLowerCase(),"H"==h.elem&&i||(h.serial=l,c[l]=n[n.length-1].length,h.x=parseFloat(u.substr(0,10)),h.y=parseFloat(u.substr(10,10)),h.z=parseFloat(u.substr(20,10)),h.hetflag=!0,h.bonds=[],h.bondOrder=[],h.properties={},h.index=n[n.length-1].length,n[n.length-1].push(h))}for(l=0;l<a;l++,s++){u=r[s];var m=c[parseInt(u.substr(0,3))-1+d],g=c[parseInt(u.substr(3,3))-1+d],v=parseInt(u.substr(6,3));"undefined"!=typeof m&&"undefined"!=typeof g&&(n[n.length-1][m].bonds.push(g),n[n.length-1][m].bondOrder.push(v),n[n.length-1][g].bonds.push(m),n[n.length-1][g].bondOrder.push(v))}if(!e.multimodel)break;for(e.onemol||n.push([]);"$$$$"!=r[s];)s++;r.splice(0,++s)}return n},t.cdjson=t.json=function(t,e){var n=[[]];"string"==typeof t&&(t=JSON.parse(t));for(var i=t.m,r=i[0].a,o=i[0].b,a=i[0].s,s=void 0!==e&&void 0!==e.parseStyle?e.parseStyle:void 0!==a,l=n[n.length-1].length,u=0;u<r.length;u++){var c=r[u],d={};d.id=c.i,d.x=c.x,d.y=c.y,d.z=c.z||0,d.bonds=[],d.bondOrder=[];var p=c.l||"C";d.elem=p[0].toUpperCase()+p.substr(1).toLowerCase(),d.serial=n[n.length-1].length,s&&(d.style=a[c.s||0]),n[n.length-1].push(d)}for(var u=0;u<o.length;u++){var h=o[u],f=h.b+l,m=h.e+l,g=h.o||1,v=n[n.length-1][f],_=n[n.length-1][m];v.bonds.push(m),v.bondOrder.push(g),_.bonds.push(f),_.bondOrder.push(g)}return n},t.mcif=t.cif=function(t,n){function i(t,e){for(var n=[],i=0,r=0;r<t.length;){for(;t.substr(r,e.length)!==e&&r<t.length;){if("'"===t[r])for(r++;r<t.length&&"'"!==t[r];)r++;else if('"'===t[r])for(r++;r<t.length&&'"'!==t[r];)r++;r++}n.push(t.substr(i,r-i)),i=r+=e.length}return n}function o(t){return t*t}function a(t,e,n){var i=I[0][0]*t+I[0][1]*e+I[0][2]*n,r=I[1][0]*t+I[1][1]*e+I[1][2]*n,o=I[2][0]*t+I[2][1]*e+I[2][2]*n;return{x:i,y:r,z:o}}function s(t){var e=t.match("-");t=t.replace(/[-xyz]/g,"");var n,i,r=t.split("/");return i=void 0===r[1]?1:parseInt(r[1]),n=""===r[0]?1:parseInt(r[0]),n/i*(e?-1:1)}for(var u=[],d=!n.doAssembly,p=!n.duplicateAssemblyAtoms,h=u.modelData=[],f=t.split(/\r?\n|\r/),m=[],g=!1,v=0;v<f.length;v++){var _=f[v].split("#")[0];if(g?";"===_[0]&&(g=!1):";"===_[0]&&(g=!0),g||""!==_){if(!g&&(_=_.trim(),"_"===_[0])){var y=_.split(/\s/)[0].indexOf(".");y>-1&&(_[y]="_",_=_.substr(0,y)+"_"+_.substr(y+1))}m.push(_)}}for(var v=0;v<m.length;){for(;!m[v].startsWith("data_")||"data_global"===m[v];)v++;v++;for(var b={};v<m.length&&!m[v].startsWith("data_");)if(void 0===m[v][0])v++;else if("_"===m[v][0]){var x=m[v].split(/\s/)[0].toLowerCase(),w=b[x]=b[x]||[],C=m[v].substr(m[v].indexOf(x)+x.length);if(""===C)if(v++,";"===m[v][0]){var A=m[v].substr(1);for(v++;";"!==m[v];)A=A+"\n"+m[v],v++;w.push(A)}else w.push(m[v]);else w.push(C.trim());v++}else if("loop_"===m[v].substr(0,5)){v++;for(var T=[];""===m[v]||"_"===m[v][0];){if(""!==m[v]){var x=m[v].split(/\s/)[0].toLowerCase(),w=b[x]=b[x]||[];T.push(w)}v++}for(var S=0;v<m.length&&"_"!==m[v][0]&&!m[v].startsWith("loop_")&&!m[v].startsWith("data_");){for(var _=i(m[v]," "),M=0;M<_.length;M++)""!==_[M]&&(T[S].push(_[M]),S=(S+1)%T.length);v++}}else v++;h.push({symmetries:[]}),u.push([]);var I,P=void 0!==b._atom_site_id?b._atom_site_id.length:b._atom_site_label.length;if(void 0!==b._cell_length_a){var L=parseFloat(b._cell_length_a),E=parseFloat(b._cell_length_b),F=parseFloat(b._cell_length_c),D=parseFloat(b._cell_angle_alpha)||90,z=parseFloat(b._cell_angle_beta)||90,k=parseFloat(b._cell_angle_gamma)||90,V=D*Math.PI/180,O=z*Math.PI/180,N=k*Math.PI/180,j=Math.cos(V),R=Math.cos(O),B=Math.cos(N),U=Math.sin(N);I=[[L,E*B,F*R],[0,E*U,F*(j-R*B)/U],[0,0,F*Math.sqrt(1-o(j)-o(R)-o(B)+2*j*R*B)/U]],h[h.length-1].cryst={a:L,b:E,c:F,alpha:D,beta:z,gamma:k}}for(var q=0;q<P;q++)if(void 0===b._atom_site_group_pdb||"TER"!==b._atom_site_group_pdb[q]){var G={};if(void 0!==b._atom_site_cartn_x)G.x=parseFloat(b._atom_site_cartn_x[q]),G.y=parseFloat(b._atom_site_cartn_y[q]),G.z=parseFloat(b._atom_site_cartn_z[q]);else{var H=a(parseFloat(b._atom_site_fract_x[q]),parseFloat(b._atom_site_fract_y[q]),parseFloat(b._atom_site_fract_z[q]));G.x=H.x,G.y=H.y,G.z=H.z}G.chain=b._atom_site_auth_asym_id?b._atom_site_auth_asym_id[q]:void 0,G.resi=b._atom_site_auth_seq_id?parseInt(b._atom_site_auth_seq_id[q]):void 0,G.resn=b._atom_site_auth_comp_id?b._atom_site_auth_comp_id[q].trim():void 0,G.atom=b._atom_site_auth_atom_id?b._atom_site_auth_atom_id[q].replace(/"/gm,""):void 0,G.hetflag=!b._atom_site_group_pdb||"HETA"===b._atom_site_group_pdb[q]||"HETATM"===b._atom_site_group_pdb[q];var W=b._atom_site_type_symbol[q];G.elem=W[0].toUpperCase()+W.substr(1).toLowerCase(),G.bonds=[],G.ss="c",G.serial=q,G.bondOrder=[],G.properties={},u[u.length-1].push(G)}if(void 0!==b._pdbx_struct_oper_list_id&&!d){for(var q=0;q<b._pdbx_struct_oper_list_id.length;q++){var Y=parseFloat(b["_pdbx_struct_oper_list_matrix[1][1]"][q]),$=parseFloat(b["_pdbx_struct_oper_list_matrix[1][2]"][q]),X=parseFloat(b["_pdbx_struct_oper_list_matrix[1][3]"][q]),K=parseFloat(b["_pdbx_struct_oper_list_vector[1]"][q]),Z=parseFloat(b["_pdbx_struct_oper_list_matrix[2][1]"][q]),Q=parseFloat(b["_pdbx_struct_oper_list_matrix[2][2]"][q]),J=parseFloat(b["_pdbx_struct_oper_list_matrix[2][3]"][q]),tt=parseFloat(b["_pdbx_struct_oper_list_vector[2]"][q]),et=parseFloat(b["_pdbx_struct_oper_list_matrix[3][1]"][q]),nt=parseFloat(b["_pdbx_struct_oper_list_matrix[3][2]"][q]),it=parseFloat(b["_pdbx_struct_oper_list_matrix[3][3]"][q]),rt=parseFloat(b["_pdbx_struct_oper_list_vector[3]"][q]),ot=new c.Matrix4(Y,$,X,K,Z,Q,J,tt,et,nt,it,rt);h[h.length-1].symmetries.push(ot)}for(var q=0;q<u.length;q++)l(h[h.length-1].symmetries,p,u[q])}if(void 0!==b._symmetry_equiv_pos_as_xyz)for(var at=0;at<b._symmetry_equiv_pos_as_xyz.length;at++){for(var st=b._symmetry_equiv_pos_as_xyz[at].replace(/["' ]/g,""),lt=st.split(",").map(function(t){return t.replace(/-/g,"+-")}),ot=new c.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),ut=0;ut<3;ut++)for(var ct=lt[ut].split("+"),dt=0;dt<ct.length;dt++){var pt=ct[dt];if(""!==pt){var ht=s(pt);pt.match("x")?ot.elements[ut+0]=ht:pt.match("y")?ot.elements[ut+4]=ht:pt.match("z")?ot.elements[ut+8]=ht:ot.elements[ut+12]=ht}}var ft=new c.Matrix4(I[0][0],I[0][1],I[0][2],0,I[1][0],I[1][1],I[1][2],0,I[2][0],I[2][1],I[2][2],0),mt=(new c.Matrix4).getInverse(ft,!0);ot=(new c.Matrix4).multiplyMatrices(ot,mt),ot=(new c.Matrix4).multiplyMatrices(ft,ot),h[h.length-1].symmetries.push(ot)}}for(var q=0;q<u.length;q++)e(u[q]),r(u[q]),l(h[q].symmetries,p,u[q]);return u},t.mol2=t.MOL2=function(t,e){var n=[[]],i=!1;"undefined"!=typeof e.keepH&&(i=!e.keepH);for(var r=t.substr(o,t.length).split(/\r?\n|\r/);r.length>0;){var o=t.search(/@<TRIPOS>MOLECULE/),a=t.search(/@<TRIPOS>ATOM/);if(o==-1||a==-1)break;var s=[],l=r[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),u=parseInt(l[0]),c=0;l.length>1&&(c=parseInt(l[1]));var d,p=4;for(d=3;d<r.length;d++)if("@<TRIPOS>ATOM"==r[d]){p=d+1;break}var h,f=n[n.length-1].length,m=f+u;for(d=f;d<m;d++){h=r[p++],l=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var g={},v=l[5].split(".")[0];if(g.atom=g.elem=v[0].toUpperCase()+v.substr(1).toLowerCase(),"H"==g.elem&&i);else{var _=n[n.length-1].length,y=parseInt(l[0]);g.serial=y,g.x=parseFloat(l[2]),g.y=parseFloat(l[3]),g.z=parseFloat(l[4]),g.atom=l[5];var b=parseFloat(l[8]);g.index=_,g.bonds=[],g.bondOrder=[],g.properties={charge:b,partialCharge:b},s[y]=_,n[n.length-1].push(g)}}for(var x=!1;p<r.length;)if("@<TRIPOS>BOND"==r[p++]){x=!0;break}if(x&&c)for(d=0;d<c;d++){h=r[p++],l=h.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var w=parseInt(l[1]);fromAtom=n[n.length-1][s[w]];var C=parseInt(l[2]);toAtom=n[n.length-1][s[C]];var A=parseInt(l[3]);isNaN(A)&&(A=1),void 0!==fromAtom&&void 0!==toAtom&&(fromAtom.bonds.push(s[C]),fromAtom.bondOrder.push(A),toAtom.bonds.push(s[w]),toAtom.bondOrder.push(A))}if(!e.multimodel)break;e.onemol||n.push([]),r.splice(0,p),t=r.join("\n")}return n};var o={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45},a=function(t){return o[t]||1.6},s=function(t,e){var n=a(t.elem)+a(e.elem);n+=.25,n*=n;var i=t.x-e.x;if(i*=i,i>n)return!1;var r=t.y-e.y;if(r*=r,r>n)return!1;var o=t.z-e.z;if(o*=o,o>n)return!1;var s=i+r+o;return!isNaN(s)&&(!(s<.5)&&!(s>n))},l=function(t,e,n){var i,r,o,a=n.length,s=a;if(e){if(t.length>1)for(i=0;i<n.length;i++){var l=[];for(r=0;r<t.length;r++)if(!t[r].isIdentity()){var u=new c.Vector3;u.set(n[i].x,n[i].y,n[i].z),u.applyMatrix4(t[r]),l.push(u)}n[i].symmetries=l}}else for(i=0;i<t.length;i++)if(!t[i].isIdentity()){var d=new c.Vector3;for(o=0;o<a;o++){var p=[];for(r=0;r<n[o].bonds.length;r++)p.push(n[o].bonds[r]+s);d.set(n[o].x,n[o].y,n[o].z),d.applyMatrix4(t[i]);var h={};for(var f in n[o])h[f]=n[o][f];h.x=d.x,h.y=d.y,h.z=d.z,h.bonds=p,n.push(h)}s=n.length}};t.pdb=t.PDB=t.pdbqt=t.PDBQT=function(t,e){var i,a,s,u,d=[[]],p=!e.keepH,h=!e.noSecondaryStructure,f=!e.doAssembly,m=!e.duplicateAssemblyAtoms,g=d.modelData=[{symmetries:[]}],v=d[d.length-1].length,_={sheet:[],helix:[]},y=!1,b=[],x=t.split(/\r?\n|\r/),w={};for(a=0;a<x.length;a++){u=x[a].replace(/^\s*/,"");var C,A,T,S,M=u.substr(0,6);if(0==M.indexOf("END")){if(e.multimodel){e.onemol||(d.push([]),g.push({symmetries:[]}));continue}break}if("ATOM  "==M||"HETATM"==M){var I,P,L,E,F,D,z,k,V,O,N,j;if(N=u.substr(16,1)," "!=N&&"A"!=N)continue;if(O=parseInt(u.substr(6,5)),i=u.substr(12,4).replace(/ /g,""),I=u.substr(17,3).replace(/ /g,""),P=u.substr(21,1),L=parseInt(u.substr(22,4)),E=u.substr(26,1),F=parseFloat(u.substr(30,8)),D=parseFloat(u.substr(38,8)),z=parseFloat(u.substr(46,8)),j=parseFloat(u.substr(60,8)),V=u.substr(76,2).replace(/ /g,""),""===V||"undefined"==typeof o[V]?(V=u.substr(12,2).replace(/ /g,""),V.length>0&&"H"==V[0]&&"Hg"!=V&&(V="H"),V.length>1&&(V=V[0].toUpperCase()+V.substr(1).toLowerCase(),"undefined"==typeof o[V]?V=V[0]:"A"==u[0]&&"Ca"==V&&(V="C"))):V=V[0].toUpperCase()+V.substr(1).toLowerCase(),"H"==V&&p)continue;k="H"==u[0],b[O]=d[d.length-1].length,d[d.length-1].push({resn:I,x:F,y:D,z:z,elem:V,hetflag:k,chain:P,resi:L,icode:E,rescode:L+(" "!=E?"^"+E:""),serial:O,atom:i,bonds:[],ss:"c",bondOrder:[],properties:{},b:j,pdbline:u})}else if("SHEET "==M)y=!0,C=u.substr(21,1),A=parseInt(u.substr(22,4)),T=u.substr(32,1),S=parseInt(u.substr(33,4)),_.sheet.push([C,A,T,S]);else if("CONECT"==M){var R=parseInt(u.substr(6,5)),B=b[R],U=d[d.length-1][B];for(s=0;s<4;s++){var q=parseInt(u.substr([11,16,21,26][s],5)),G=b[q],H=d[d.length-1][G];if(void 0!==U&&void 0!==H)if(w[[B,G]]){w[[B,G]]+=1;for(var W=0;W<U.bonds.length;W++)if(U.bonds[W]==G){var Y=w[[B,G]];Y>=4?U.bondOrder[W]=1:U.bondOrder[W]=Y}}else w[[B,G]]=1,0!=U.bonds.length&&U.bonds[U.bonds.length-1]==G||(U.bonds.push(G),U.bondOrder.push(1))}}else if("HELIX "==M)y=!0,C=u.substr(19,1),A=parseInt(u.substr(21,4)),T=u.substr(31,1),S=parseInt(u.substr(33,4)),_.helix.push([C,A,T,S]);else if(f||"REMARK"!=M||"BIOMT"!=u.substr(13,5)){if("CRYST1"==M){var $,j,X,K,Z,Q;$=parseFloat(u.substr(7,8)),j=parseFloat(u.substr(16,8)),X=parseFloat(u.substr(25,8)),K=parseFloat(u.substr(34,6)),Z=parseFloat(u.substr(41,6)),Q=parseFloat(u.substr(48,6)),g[g.length-1].cryst={a:$,b:j,c:X,alpha:K,beta:Z,gamma:Q}}}else{var J,tt=new c.Matrix4;for(J=1;J<=3;J++)if(u=x[a].replace(/^\s*/,""),parseInt(u.substr(18,1))==J)tt.elements[J-1]=parseFloat(u.substr(23,10)),tt.elements[J-1+4]=parseFloat(u.substr(33,10)),tt.elements[J-1+8]=parseFloat(u.substr(43,10)),tt.elements[J-1+12]=parseFloat(u.substr(53)),a++;else for(;"BIOMT"==u.substr(13,5);)a++,u=x[a].replace(/^\s*/,"");tt.elements[3]=0,tt.elements[7]=0,tt.elements[11]=0,tt.elements[15]=1,g[g.length-1].symmetries.push(tt),a--}}for(var et=(new Date).getTime(),J=0;J<d.length;J++)for(n(d[J]),f||l(g[J].symmetries,m,d[J]),!h&&y||(et=(new Date).getTime(),r(d[J])),a=v;a<d[J].length;a++)if(i=d[J][a],void 0!==i){for(s=0;s<_.sheet.length;s++)i.chain==_.sheet[s][0]&&(i.resi<_.sheet[s][1]||i.resi>_.sheet[s][3]||(i.ss="s",i.resi==_.sheet[s][1]&&(i.ssbegin=!0),i.resi==_.sheet[s][3]&&(i.ssend=!0)));for(s=0;s<_.helix.length;s++)i.chain==_.helix[s][0]&&(i.resi<_.helix[s][1]||i.resi>_.helix[s][3]||(i.ss="h",i.resi==_.helix[s][1]?i.ssbegin=!0:i.resi==_.helix[s][3]&&(i.ssend=!0)))}return d},t.pqr=t.PQR=function(t,e){var i,o,a,s,l=[[]],u=(l[l.length-1].length,!e.noSecondaryStructure),c=(!e.doAssembly,!e.duplicateAssemblyAtoms,l.modelData=[{symmetries:[]}],[]),d=t.split(/\r?\n|\r/);for(o=0;o<d.length;o++){s=d[o].replace(/^\s*/,"");var p=s.substr(0,6);if(0==p.indexOf("END")){if(e.multimodel){e.onemol||l.push([]);continue}break}if("ATOM  "==p||"HETATM"==p){var h=parseInt(s.substr(6,5)),i=s.substr(12,4).replace(/ /g,""),f=s.substr(17,3),m=s.substr(21,1),g=parseInt(s.substr(22,4)),v=s.substr(30).trim().split(/\s+/),_=parseFloat(v[0]),y=parseFloat(v[1]),b=parseFloat(v[2]),x=parseFloat(v[3]),w=parseFloat(v[4]),C=i[0];i.length>1&&i[1].toUpperCase()!=i[1]&&(C=i.substr(0,2)),"H"==s[0]?hetflag=!0:hetflag=!1,c[h]=l[l.length-1].length,l[l.length-1].push({resn:f,x:_,y:y,z:b,elem:C,hetflag:hetflag,chain:m,resi:g,serial:h,atom:i,bonds:[],ss:"c",bondOrder:[],properties:{charge:x,partialCharge:x,radius:w},pdbline:s})}else if("CONECT"==p){var A=parseInt(s.substr(6,5)),T=l[l.length-1][c[A]];for(a=0;a<4;a++){var S=parseInt(s.substr([11,16,21,26][a],5)),M=l[l.length-1][c[S]];void 0!==T&&void 0!==M&&(T.bonds.push(c[S]),T.bondOrder.push(1))}}}for(var o=0;o<l.length;o++)n(l[o]),u&&r(l[o]);return l};var u=function(t){return String.fromCharCode.apply(null,t).replace(/\0/g,"")},d=function(t){return 2==t?"h":3==t?"s":"c"};return t.mmtf=t.MMTF=function(t,e){var n=!e.keepH,i=MMTF.decode(t),r=[[]],o=r.modelData=[],a=0,s=0,p=0,h=0,f=(i.chainNameList,i.secStructList),m=i.insCodeList,g=i.sequenceIndexList,v=i.bFactorList,_=i.altLocList,y=i.occupancyList,b=i.bondAtomList,x=i.bondOrderList,w=i.numModels;if(0==w)return r;e.multimodel||(w=1);var C,A,T,S,M,I,P=!e.doAssembly,L=!e.duplicateAssemblyAtoms,E=e.assemblyIndex?e.assemblyIndex:0,F=[];if(i.bioAssemblyList&&i.bioAssemblyList.length>0){var D=i.bioAssemblyList[E].transformList;for(C=0,I=D.length;C<I;C++){var z=new c.Matrix4(D[C].matrix);z.transpose(),F.push(z)}}var k=0;for(M=0;M<w;M++){var V=i.chainsPerModel[M],O=r[r.length-1],N=[];for(o.push({symmetries:F}),C=0;C<V;++C){var j=i.groupsPerChain[s],R=u(i.chainIdList.subarray(4*s,4*s+4)),B=p;for(A=0;A<j;++A){var U=i.groupList[i.groupTypeList[p]],q=U.atomNameList.length,G=0;f&&(G=f[p]);var H=null;i.insCodeList&&(H=String.fromCharCode(m[p]));var W=null;g&&(W=g[p]);var Y=i.groupIdList[p],$=U.groupName,X=h;for(T=0;T<q;++T){var K=U.elementList[T];if(n&&"H"==K)h+=1;else{var Z="";v&&(Z=v[h]);var Q=" ";_&&(Q=String.fromCharCode(_[h]));var J="";y&&(J=y[h]);var tt=i.atomIdList[h],et=U.atomNameList[T],nt=U.atomChargeList[T],it=i.xCoordList[h],rt=i.yCoordList[h],ot=i.zCoordList[h];N[h]=O.length,O.push({resn:$,x:it,y:rt,z:ot,elem:K,hetflag:G<0,chain:R,resi:Y,icode:Q,rescode:Y+(" "!=Q?"^"+Q:""),serial:tt,atom:et,bonds:[],ss:d(G),bondOrder:[],properties:{charge:nt,occupancy:J},b:Z}),h+=1}}var at=U.bondAtomList;for(T=0,S=U.bondOrderList.length;T<S;++T){var st=X+at[2*T],lt=X+at[2*T+1],ut=U.bondOrderList[T],ct=N[st],dt=N[lt],pt=O[ct],ht=O[dt];pt&&ht&&(pt.bonds.push(dt),pt.bondOrder.push(ut),ht.bonds.push(ct),ht.bondOrder.push(ut))}p+=1}for(p=B,A=0;A<j;++A)p+=1;s+=1}if(b)for(T=k,S=b.length;T<S;T+=2){var st=b[T],lt=b[T+1],ut=x?x[T/2]:1;if(st>=h){k=T;break}var ct=N[st],dt=N[lt],pt=O[ct],ht=O[dt];pt&&ht&&(pt.bonds.push(dt),pt.bondOrder.push(ut),ht.bonds.push(ct),ht.bondOrder.push(ut))}e.multimodel&&(e.onemol||r.push([])),a+=1}for(var I=0;I<r.length;I++)P||l(o[I].symmetries,L,r[I]);return r},t}();var c=c||{};c.partialCharges={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55},c.applyPartialCharges=function(t,e){if((!e||"undefined"==typeof t.partialCharge)&&t.resn&&t.atom){var n=t.resn+":"+t.atom;t.properties.partialCharge=c.partialCharges[n]}},c.VolumeData=function(t,e,n){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,e=e.toLowerCase(),/\.gz$/.test(e)){e=e.replace(/\.gz$/,"");try{t=pako.inflate(t)}catch(t){console.log(t)}}if(this[e]&&this[e](t),n){if(n.negate)for(var i=0,r=this.data.length;i<r;i++)this.data[i]=-this.data[i];if(n.normalize){for(var o=0,i=0,r=this.data.length;i<r;i++)o+=this.data[i];var a=o/this.data.length;console.log("computed mean: "+a),o=0;for(var i=0,r=this.data.length;i<r;i++){var s=this.data[i]-a;o+=s*s}var l=o/this.data.length;console.log("Computed variance: "+l);for(var i=0,r=this.data.length;i<r;i++)this.data[i]=(this.data[i]-a)/l}}},c.VolumeData.prototype.getVal=function(t,e,n){return t-=this.origin.x,e-=this.origin.y,n-=this.origin.z,t/=this.unit.x,e/=this.unit.y,n/=this.unit.z,t=Math.round(t),e=Math.round(e),n=Math.round(n),t<0||t>=this.size.x?0:e<0||e>=this.size.y?0:n<0||n>=this.size.z?0:this.data[t*this.size.y*this.size.z+e*this.size.z+n]},c.VolumeData.prototype.vasp=function(t){var e=t.replace(/^\s+/,"").split(/[\n\r]/),n=c.Parsers.vasp(t)[0],i=n.length;if(0==i)return console.log("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),void(this.data=[]);var r,o=1.889725992,a=.036749309,s=parseFloat(e[1]);r=e[2].replace(/^\s+/,"").split(/\s+/);var l=new c.Vector3(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])).multiplyScalar(s*o);r=e[3].replace(/^\s+/,"").split(/\s+/);var u=new c.Vector3(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])).multiplyScalar(s*o);r=e[4].replace(/^\s+/,"").split(/\s+/);var d=new c.Vector3(parseFloat(r[0]),parseFloat(r[1]),parseFloat(r[2])).multiplyScalar(s*o),p=l.x*(u.y*d.z-d.y*u.z)-u.x*(l.y*d.z-d.y*l.z)+d.x*(l.y*u.z-u.y*l.z);p=Math.abs(p)/Math.pow(o,3);var h=1/p;e.splice(0,8+i+1);var f=e[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),m=Math.abs(f[0]),g=Math.abs(f[1]),v=Math.abs(f[2]),_=this.origin=new c.Vector3(0,0,0);this.size={x:m,y:g,z:v},this.unit=new c.Vector3(l.x,u.y,d.z),l=l.multiplyScalar(1/(o*m)),u=u.multiplyScalar(1/(o*g)),d=d.multiplyScalar(1/(o*v)),0==l.y&&0==l.z&&0==u.x&&0==u.z&&0==d.x&&0==d.y||(this.matrix=new c.Matrix4(l.x,u.x,d.x,0,l.y,u.y,d.y,0,l.z,u.z,d.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new c.Matrix4).makeTranslation(_.x,_.y,_.z)),this.origin=new c.Vector3(0,0,0),this.unit=new c.Vector3(1,1,1)),e.splice(0,1);var y=e.join(" ");y=y.replace(/^\s+/,""),y=y.split(/[\s\r]+/),y.splice(m*g*v+1);for(var b=new Float32Array(y),x=0;x<b.length;x++)b[x]=b[x]*h*a;this.data=b},c.VolumeData.prototype.cube=function(t){var e=t.replace(/^\s+/,"").split(/[\n\r]+/);if(!(e.length<6)){var n=e[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),i=parseFloat(n[0]),r=Math.abs(i),o=this.origin=new c.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]));n=e[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var a=n[0]>0?.529177:1;o.multiplyScalar(a);var s=Math.abs(n[0]),l=new c.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])).multiplyScalar(a);n=e[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var u=Math.abs(n[0]),d=new c.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])).multiplyScalar(a);n=e[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var p=Math.abs(n[0]),h=new c.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3])).multiplyScalar(a);this.size={x:s,y:u,z:p},this.unit=new c.Vector3(l.x,d.y,h.z),0==l.y&&0==l.z&&0==d.x&&0==d.z&&0==h.x&&0==h.y||(this.matrix=new c.Matrix4(l.x,d.x,h.x,0,l.y,d.y,h.y,0,l.z,d.z,h.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new c.Matrix4).makeTranslation(o.x,o.y,o.z)),this.origin=new c.Vector3(0,0,0),this.unit=new c.Vector3(1,1,1));var f=6;i<0&&f++;var m=e.splice(r+f).join(" ");m=m.replace(/^\s+/,""),m=m.split(/[\s\r]+/),this.data=new Float32Array(m)}},c.VolumeData.prototype.ccp4=function(t){var e={};t=new Int8Array(t);var n=new Int32Array(t.buffer,0,56),i=new Float32Array(t.buffer,0,56),r=new DataView(t.buffer);if(e.MAP=String.fromCharCode(r.getUint8(208),r.getUint8(209),r.getUint8(210),r.getUint8(211)),e.MACHST=[r.getUint8(212),r.getUint8(213)],17===e.MACHST[0]&&17===e.MACHST[1])for(var o=t.byteLength,a=0;a<o;a+=4)r.setFloat32(a,r.getFloat32(a),!0);e.NX=n[0],e.NY=n[1],e.NZ=n[2],e.MODE=n[3],e.NXSTART=n[4],e.NYSTART=n[5],e.NZSTART=n[6],e.MX=n[7],e.MY=n[8],e.MZ=n[9],e.xlen=i[10],e.ylen=i[11],e.zlen=i[12],e.alpha=i[13],e.beta=i[14],e.gamma=i[15],e.MAPC=n[16],e.MAPR=n[17],e.MAPS=n[18],e.DMIN=i[19],e.DMAX=i[20],e.DMEAN=i[21],e.ISPG=n[22],e.NSYMBT=n[23],e.LSKFLG=n[24],e.originX=i[49],e.originY=i[50],e.originZ=i[51],e.ARMS=i[54],console.log("Map has min,mean,average,rmsddv: "+e.DMIN+","+e.DMAX+","+e.DMEAN+","+e.ARMS);var s=e,l=[s.xlen,0,0],u=[s.ylen*Math.cos(Math.PI/180*s.gamma),s.ylen*Math.sin(Math.PI/180*s.gamma),0],d=[s.zlen*Math.cos(Math.PI/180*s.beta),s.zlen*(Math.cos(Math.PI/180*s.alpha)-Math.cos(Math.PI/180*s.gamma)*Math.cos(Math.PI/180*s.beta))/Math.sin(Math.PI/180*s.gamma),0];d[2]=Math.sqrt(s.zlen*s.zlen*Math.sin(Math.PI/180*s.beta)*Math.sin(Math.PI/180*s.beta)-d[1]*d[1]);var p=[0,l,u,d],h=[0,s.MX,s.MY,s.MZ],f=[0,s.MAPC,s.MAPR,s.MAPS];this.matrix=new c.Matrix4,this.matrix.set(p[f[1]][0]/h[f[1]],p[f[2]][0]/h[f[2]],p[f[3]][0]/h[f[3]],0,p[f[1]][1]/h[f[1]],p[f[2]][1]/h[f[2]],p[f[3]][1]/h[f[3]],0,p[f[1]][2]/h[f[1]],p[f[2]][2]/h[f[2]],p[f[3]][2]/h[f[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,(new c.Matrix4).makeTranslation(s.NXSTART+s.originX,s.NYSTART+s.originY,s.NZSTART+s.originZ)),this.origin=new c.Vector3(0,0,0),this.unit=new c.Vector3(1,1,1),this.size={x:e.NX,y:e.NY,z:e.NZ};var m=new Float32Array(t.buffer,1024+e.NSYMBT),g=e.NX,v=e.NY,_=e.NZ;this.data=new Float32Array(g*v*_);for(var a=0;a<g;a++)for(var y=0;y<v;y++)for(var b=0;b<_;b++)this.data[(a*v+y)*_+b]=m[(b*v+y)*g+a]},c.workerString=function(){self.onmessage=function(t){var e=t.data,n=e.type;if(n<0)self.atomData=e.atoms,self.volume=e.volume,self.ps=new ProteinSurface;else{var i=self.ps;i.initparm(e.expandedExtent,1!=n,self.volume),i.fillvoxels(self.atomData,e.extendedAtoms),i.buildboundary(),4!==n&&2!==n||(i.fastdistancemap(),i.boundingatom(!1),i.fillvoxelswaals(self.atomData,e.extendedAtoms)),i.marchingcube(n);var r=i.getFacesAndVertices(e.atomsToShow);self.postMessage(r)}}}.toString().replace(/(^.*?\{|\}$)/g,""),c.workerString+="; var ProteinSurface="+c.ProteinSurface.toString().replace(/\$3Dmol.MarchingCube./g,"MarchingCube."),c.workerString+=",MarchingCube=("+c.MarchingCubeInitializer.toString()+")();",c.SurfaceWorker=window.URL.createObjectURL(new Blob([c.workerString],{type:"text/javascript"})),c.workerString=c.workerString,c.SurfaceWorker=c.SurfaceWorker}).call(e,r(7))},function(t,e,n){function i(){function t(t,e){u=o.extend(!0,{},l,e),r(e.el).append("<div id='"+t+"' style='width: "+u.width+"px; height: "+u.height+"px; margin: 0; padding: 0; border: 0;'></div>");var n=r("#"+t);n.hide();var i=s.createViewer(n,{defaultcolors:s.elementColors.rasmol});i.setBackgroundColor(16777215),c=i}function e(t){null!=c&&c.setContainer(t)}function n(t,e){null!=t&&null!=c&&c.render(),a.isFunction(e)&&e()}function i(){return c}var l={},u=null,c=null;return{init:t,updateContainer:e,getViewer:i,script:n}}var r=n(7),o=r,a=n(5),s=n(134);t.exports=i},function(t,e,n){function i(){function t(){return"reinitialize;"}function e(t){return"bg_color "+g(t)+";"}function n(t){return"fetch "+t+", async=0;"}function i(t){return v[t]}function r(t){return"color "+g(t)+", sele;"}function o(t){return"select chain "+t+";"}function a(t){return"select (chain "+t+") and (ss h);"}function s(t){return"select (chain "+t+") and (ss s);"}function l(t,e){return"select (resi "+t.join(",")+") and (chain "+e+");"}function u(t,e){return"select ((resi "+t.join(",")+") and (chain "+e+") and (not name c+n+o));"}function c(t){return"set transparency, "+t/10+", sele;\nset cartoon_transparency, "+t/10+", sele;\nset sphere_transparency, "+t/10+", sele;\nset stick_transparency, "+t/10+", sele;"}function d(){return"show spheres, sele; show sticks, sele; alter sele, vdw=0.50;"}function p(){return"hide spheres, sele; hide sticks, sele;"}function h(t){return"spectrum count, rainbow_rev, sele"}function f(t){return"util.cbaw sele;"}function m(){return"hide everything,not resn asp+glu+arg+lys+his+asn+thr+cys+gln+tyr+ser+gly+ala+leu+val+ile+met+trp+phe+pro"}function g(t){return t.replace("#","0x")}var v={ballAndStick:"hide everything; show spheres; show sticks; alter all, vdw=0.50",spaceFilling:"hide everything; show spheres;",ribbon:"hide everything; show ribbon;",cartoon:"hide everything; show cartoon;",trace:"hide everything; show ribbon;"};this.loadPdb=n,this.setScheme=i,this.setColor=r,this.selectChain=o,this.selectAlphaHelix=a,this.selectBetaSheet=s,this.rainbowColor=h,this.cpkColor=f,this.hideBoundMolecules=m,this.setTransparency=c,this.selectPositions=l,this.selectSideChains=u,this.enableBallAndStick=d,this.disableBallAndStick=p,this.reinitialize=t,this.bgColor=e}var r=n(137);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){function i(){function t(t){return"load="+t+";"}function e(){return"select all;"}function n(){return"select none;"}function i(t){return A[t]}function r(t){return"color ["+C(t)+"];"}function o(t){return"select :"+t+";"}function a(t){return"select :"+t+" and helix;"}function s(t){return"select :"+t+" and sheet;"}function l(t){var e="@{{:"+t+"}.atomNo.min}",n="@{{:"+t+"}.atomNo.max}";return'color atoms property atomNo "roygb" range '+e+" "+n+";"}function u(t){return"color atoms CPK;"}function c(){return"restrict protein;"}function d(t){return t>0?"color translucent;":"color opaque;"}function p(t){var e=function(t){var e="";return null!=t&&t.length>0&&(e+="^"+t),e},n=t.start.pdbPos||t.start.pdbPosition,i=t.end.pdbPos||t.end.pdbPosition,r=n+e(t.start.insertion);return i>n&&(r+="-"+i+e(t.end.insertion)),r}function h(t,e){return"select ("+t.join(", ")+") and :"+e+";"}function f(t,e){return"select (("+t.join(", ")+") and :"+e+" and sidechain) or (("+t.join(", ")+") and :"+e+" and *.CA);"}function m(){return"wireframe 0.15; spacefill 25%;"}function g(){return"wireframe OFF; spacefill OFF;"}function v(t,e){var n=this,i=n.scriptPosition(t);return"center "+i+":"+e+";"}function _(){return"center;"}function y(){return"zoom in;"}function b(){return"zoom out;"}function x(t){return"spin "+t+";"}function w(t,e,n,i){var r=this,o=[];o.push(r.selectPositions(t,i.chainId)),o.push(r.setColor(e));var a="none"!=n.displaySideChain;
return o=o.concat(r.generateSideChainScript(t,a,n,i))}function C(t){return t.replace("#","x")}var A={ballAndStick:"wireframe ONLY; wireframe 0.15; spacefill 20%;",spaceFilling:"spacefill ONLY; spacefill 100%;",ribbon:"ribbon ONLY;",cartoon:"cartoon ONLY;",trace:"trace ONLY;"};this.loadPdb=t,this.selectAll=e,this.selectNone=n,this.setScheme=i,this.setColor=r,this.selectChain=o,this.selectAlphaHelix=a,this.selectBetaSheet=s,this.rainbowColor=l,this.cpkColor=u,this.hideBoundMolecules=c,this.setTransparency=d,this.scriptPosition=p,this.selectPositions=h,this.selectSideChains=f,this.enableBallAndStick=m,this.disableBallAndStick=g,this.highlightScript=w,this.center=v,this.defaultZoomIn=y,this.defaultZoomOut=b,this.defaultCenter=_,this.spin=x}var r=n(133);i.prototype=new r,i.prototype.constructor=i,t.exports=i},function(t,e,n){var i=n(139),r=n(22),o=n(10),a=n(23),s={download:n(141)},l=n(85),u=n(143),c=n(12),d=n(5),p=n(7),h=p;n(144),n(145),n(8),n(9);var f=c.View.extend({initialize:function(t){var e={config:{loaderImage:l,helpImage:u,border:{top:0,left:0}}};this.options=h.extend(!0,{},e,t),this.dispatcher={},d.extend(this.dispatcher,c.Events)},render:function(){var t=this,e=a.getTemplateFn("mutation_3d_vis_template"),n=e({loaderImage:t.options.config.loaderImage,helpImage:t.options.config.helpImage});t.$el.html(n),t.format()},format:function(){var t=this,e=t.options.mut3dVis,n=t.$el;t.hideResidueWarning(),t.hideNoMapWarning();var i=t.$el.find(".mutation-3d-vis-help-content"),r=a.getTemplateFn("3Dmol_basic_interaction");i.html(r({})),i.hide(),null!=e&&(e.updateContainer(n),e.show()),t.$el.find(".mutation-3d-close").click(function(){t.hideView()}),t.$el.find(".mutation-3d-minimize").click(function(){null!=e&&e.toggleSize()}),t._initMutationControls(),t._initProteinControls(),t._initButtons(),t.showMainLoader(),n.draggable({handle:".mutation-3d-info-title",stop:function(e,i){var r=parseInt(n.css("top")),o=parseInt(n.css("left"));r<parseInt(t.options.config.border.top)&&n.css("top",t.options.config.border.top),o<parseInt(t.options.config.border.left)&&n.css("left",t.options.config.border.left)}}),n.resizable({alsoResize:".mutation-3d-vis-container,.mutation-3d-vis-container div:eq(0)",handles:"sw, s, w",minWidth:400,minHeight:300,start:function(t,e){n.find(".mutation-3d-vis-help-content").css("width","auto"),n.css("position","fixed")},stop:function(t,e){n.css("height","auto"),n.css("position","fixed")},resize:function(t,n){t.stopPropagation(),e.resizeViewer()}}).on("resize",function(t){t.stopPropagation()})},_initButtons:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-vis-help-content"),i=t.$el.find(".mutation-3d-vis-help-init"),r=t.$el.find(".mutation-3d-vis-help-open"),o=t.$el.find(".mutation-3d-vis-help-close"),a=t.$el.find(".mutation-3d-pymol-dload");r.click(function(t){t.preventDefault(),n.slideToggle(),i.slideToggle()}),o.click(function(t){t.preventDefault(),n.slideToggle(),i.slideToggle()}),a.click(function(n){n.preventDefault();var i=e.generatePymolScript(),r=t.$el.find(".mutation-3d-pdb-id").text().trim()+"_"+t.$el.find(".mutation-3d-chain-id").text().trim()+".pml",o={filename:r,contentType:"text/plain;charset=utf-8",preProcess:!1};s.download.initDownload(i,o)}),a.qtip(t._generateTooltipOpts("Download PyMOL script"))},_initMutationControls:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-side-chain-select");n.change(function(){var t=p(this).val();e&&(e.updateOptions({displaySideChain:t}),e.reapplyStyle())});var i=t.$el.find(".mutation-3d-mutation-color-select");i.change(function(){var t=p(this).val();e&&(e.updateOptions({colorMutations:t}),e.reapplyStyle())}),t._initMutationColorInfo(),t._initSideChainInfo()},_initProteinControls:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-display-non-protein");n.change(function(){var t=n.is(":checked");e&&(e.updateOptions({restrictProtein:!t}),e.reapplyStyle())}),t._initHideNonProteinInfo(),t._initProteinSchemeSelector(),t._initProteinColorSelector()},_initProteinColorSelector:function(){var t=this,e=t.$el.find(".mutation-3d-protein-color-select"),n=t.options.mut3dVis;e.change(function(){var t=p(this).val();n.updateOptions({colorProteins:t}),n.reapplyStyle()})},_initProteinSchemeSelector:function(){var t=this,e=t.options.mut3dVis,n=t.$el.find(".mutation-3d-protein-style-select"),i=t.$el.find(".mutation-3d-protein-color-select");t._initProteinColorInfo(),n.change(function(){var t=p(this).val(),n=!1;i.find("option").removeAttr("disabled");var r=[];if("spaceFilling"==t?(r.push(i.find("option[value='bySecondaryStructure']")),r.push(i.find("option[value='byChain']"))):r.push(i.find("option[value='byAtomType']")),d.each(r,function(t,e){t.is(":selected")&&(t.removeAttr("selected"),i.find("option[value='uniform']").attr("selected","selected"),n="uniform"),t.attr("disabled","disabled")}),e){var o={};o.proteinScheme=t,n&&(o.colorProteins=n),e.updateOptions(o),e.reapplyStyle()}})},updateView:function(t,e,n){var r=this,a=r.options.mut3dVis,s=r.options.pdbProxy,l=function(t){n.positionMap=t,r.refreshView(e,n),r.pdbId=e,r.chain=n},u=function(a){var u={pdbId:e,chainId:n.chainId,pdbInfo:"",molInfo:""};if(a&&a[e]){var c=o.generatePdbInfoSummary(a[e],n.chainId);u.pdbInfo=c.title,u.molInfo=c.molecule}r.hideMainLoader();var d=new i({el:r.$el.find(".mutation-3d-info"),model:u});d.render(),s.getPositionMap(t,n,l)};r.showMainLoader(),a.show(),s.getPdbInfo(e,u)},refreshView:function(t,e){var n=this,i=n.options.mut3dVis;n.hideResidueWarning(),n.hideNoMapWarning();var o=function(t){0==t.length?n.showNoMapWarning():n.hideNoMapWarning()};if(null==t&&null==e||t==n.pdbId&&e==n.chain){var a=i.refresh();o(a),n.dispatcher.trigger(r.VIEW_3D_STRUCTURE_RELOADED)}else n.showLoader(),setTimeout(function(){var a=i.reload(t,e,function(){n.hideLoader(),n.dispatcher.trigger(r.VIEW_3D_STRUCTURE_RELOADED)});o(a)},50)},_initMutationColorInfo:function(){var t=this,e=t.$el.find(".mutation-type-color-help"),n=a.getTemplateFn("mutation_3d_type_color_tip_template"),i=n({}),r=t._generateTooltipOpts(i);r.style.classes+=" qtip-wide",e.qtip(r)},_initProteinColorInfo:function(){var t=this,e=t.$el.find(".protein-struct-color-help"),n=a.getTemplateFn("mutation_3d_structure_color_tip_template"),i=n({}),r=t._generateTooltipOpts(i);r.style.classes+=" qtip-wide",e.qtip(r)},_initSideChainInfo:function(){var t=this,e=t.$el.find(".display-side-chain-help"),n=a.getTemplateFn("mutation_3d_side_chain_tip_template"),i=n({}),r=t._generateTooltipOpts(i);e.qtip(r)},_initHideNonProteinInfo:function(){var t=this,e=t.$el.find(".display-non-protein-help"),n=a.getTemplateFn("mutation_3d_non_protein_tip_template"),i=n({}),r=t._generateTooltipOpts(i);e.qtip(r)},_generateTooltipOpts:function(t){return{content:{text:t},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow"},position:{my:"top right",at:"bottom center",viewport:p(window)}}},minimizeView:function(){var t=this,e=t.options.mut3dVis;e&&e.minimize()},maximizeView:function(){var t=this,e=t.options.mut3dVis;e&&e.maximize()},resetPanelPosition:function(){var t=this,e=t.$el;e.css({left:"",position:"",top:t.options.config.border.top})},hideView:function(){var t=this,e=t.options.mut3dVis;null!=e&&e.hide(),t.dispatcher.trigger(r.VIEW_3D_PANEL_CLOSED)},showView:function(){var t=this,e=t.options.mut3dVis;null!=e&&e.show()},isVisible:function(){var t=this,e=t.options.mut3dVis;return e.isVisible()},focusView:function(t){var e=this,n=e.options.mut3dVis;return t?n.focusOn(t):(n.resetFocus(),!0)},highlightView:function(t,e){var n=this,i=n.options.mut3dVis;return i.highlight(t,e)},resetHighlight:function(){var t=this,e=t.options.mut3dVis;e.resetHighlight()},showLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-loader"),n=t.$el.find(".mutation-3d-vis-container"),i=n.css("height");0!==i&&"0px"!==i&&(t._actualHeight=i,n.css("height",0)),e.show()},hideLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-loader"),n=t.$el.find(".mutation-3d-vis-container");e.hide(),n.css("height",t._actualHeight)},showMainLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-main-loader"),n=t.$el.find(".mutation-3d-vis-body");e.show(),n.hide()},hideMainLoader:function(){var t=this,e=t.$el.find(".mutation-3d-vis-main-loader"),n=t.$el.find(".mutation-3d-vis-body");e.hide(),n.show()},showResidueWarning:function(t,e){var n=this,i=n.$el.find(".mutation-3d-residue-warning"),r=n.$el.find(".mutation-3d-unmapped-info");n.$el.find(".mutation-3d-nomap-warning").is(":visible")||(e>1?r.text(t+" of the selections"):r.text("Selected mutation"),i.show())},hideResidueWarning:function(){var t=this,e=t.$el.find(".mutation-3d-residue-warning");e.hide()},showNoMapWarning:function(){var t=this,e=t.$el.find(".mutation-3d-nomap-warning");e.show()},hideNoMapWarning:function(){var t=this,e=t.$el.find(".mutation-3d-nomap-warning");e.hide()}});t.exports=f},function(t,e,n){var i=n(23),r=n(12);n(7);n(140);var o=r.View.extend({render:function(){var t=this,e=i.getTemplateFn("mutation_3d_vis_info_template"),n=e(t.model);t.$el.html(n),t.format()},format:function(){var t=this,e=t.model.pdbInfo,n=t.model.molInfo;null==e||0==e.length?t.$el.find(".mutation-3d-pdb-info").hide():t._addExpander(".mutation-3d-pdb-info"),null==n||0==n.length?t.$el.find(".mutation-3d-mol-info").hide():t._addExpander(".mutation-3d-mol-info")},_addExpander:function(t){var e=this,n={slicePoint:40,widow:2,expandPrefix:" ",expandText:"[...]",userCollapseText:"[^]",moreClass:"expander-read-more",lessClass:"expander-read-less",detailClass:"expander-details",expandEffect:"fadeIn",collapseEffect:"fadeOut"};e.$el.find(t).expander(n)}});t.exports=o},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_140__},function(t,e,n){if(void 0===i)var i={};var r=n(7),o=r,a=n(5);i.util=n(6);var s=n(142).saveAs;i.download=function(){function t(t,e,n){r(n).find("input").remove();for(var i in e){var o=e[i];r(n).append('<input type="hidden" name="'+i+'">'),r(n).find('input[name="'+i+'"]').val(o)}r(n).attr("action",t),r(n).submit()}function e(e,r){return i.util.browser.msie?(l(),void t(e,r,"#global_file_download_form")):void n(function(){var t=i.util.getTargetWindow("global_file_download_frame");t.postMessage({servletName:e,servletParams:r},getOrigin())})}function n(t){var e='<iframe id="global_file_download_frame" src="file_download_frame.jsp" seamless="seamless" width="0" height="0" frameBorder="0" scrolling="no"></iframe>';0===r("#global_file_download_frame").length?(r(document.body).append(e),setTimeout(t,500)):t()}function l(){var t='<form id="global_file_download_form"style="display:inline-block"action="" method="post" target="_blank"></form>';0===r("#global_file_download_form").length&&r(document.body).append(t)}function u(t,e,n){null==n&&(n="text/plain;charset=utf-8"),null==e&&(e="download.txt");var i=new Blob(t,{type:n});s(i,e)}function c(t){var e=new XMLSerializer;return e.serializeToString(t)}function d(t){var e=t,n="<?xml version='1.0'?>",i="<?xml version=";return e.indexOf(i)==-1&&(e=n+t),e.indexOf("svg xmlns")==-1&&(e=e.replace("<svg","<svg xmlns='http://www.w3.org/2000/svg' version='1.1'")),e}function p(t,e){e=o.extend(!0,{},h,e),a.isString(t)||(t=c(t)),a.isFunction(e.preProcess)&&(t=e.preProcess(t)),e.contentType.toLowerCase().indexOf("pdf")!=-1&&(e.servletParams=e.servletParams||{filetype:"pdf_data",svgelement:t}),null!=e.servletName?r.ajax({url:e.servletName,type:"POST",data:e.servletParams,dataType:e.dataType,success:function(t){var n=t;a.isFunction(e.postProcess)&&(n=e.postProcess(t)),u(n,e.filename,e.contentType)}}):u([t],e.filename,e.contentType)}var h={filename:"download.svg",contentType:"application/svg+xml",dataType:null,servletName:null,servletParams:null,preProcess:d,postProcess:i.util.b64ToByteArrays};return{submitDownload:t,requestDownload:e,clientSideDownload:u,initDownload:p,serializeHtml:c,addSvgHeader:d}}(),t.exports=i.download},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_142__},function(t,e,n){t.exports=n.p+"images/help.png"},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_144__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_145__},function(t,e,n){var i=n(147),r=n(164),o=n(165),a=n(166),s=n(174),l=n(180),u=n(22),c=n(23),d=n(85),p=n(12),h=n(5),f=n(7),m=f,g=p.View.extend({initialize:function(t){var e={config:{loaderImage:d}};this.options=m.extend(!0,{},e,t),this.dispatcher={},h.extend(this.dispatcher,p.Events)},render:function(){var t=this,e={geneSymbol:t.model.geneSymbol,uniprotId:t.model.uniprotId},n=c.getTemplateFn("mutation_view_template"),i=n(e);t.$el.html(i),t.format()},format:function(){var t=this;t.$el.find(".mutation-details-filter-info").hide(),t.$el.find(".mutation-details-no-data-info").hide(),t.$el.find(".mutation-3d-initializer").hide(),t.$el.find(".mutation-info-panel-container").hide(),t.$el.find(".mutation-summary-view").hide(),t.$el.find(".mutation-table-container").hide(),t.$el.find(".mutation-diagram-view").hide()},initPdbPanelView:function(t,e,n,r){var o=this,a=null;o.diagramView&&o.diagramView.mutationDiagram&&(a=o.diagramView.mutationDiagram),t.loaderImage=o.options.config.loaderImage;var s={el:o.$el.find(".mutation-pdb-panel-view"),config:t,model:{geneSymbol:o.model.geneSymbol,pdbColl:r,pdbProxy:o.model.dataProxies.pdbProxy,pdbPanelOpts:e,pdbTableOpts:n},diagram:a},l=new i(s);return l.render(),o._pdbPanelView=l,l},initSummaryView:function(){var t=this,e=t.$el.find(".mutation-summary-view");e.show();var n={el:e,model:{mutationProxy:t.model.dataProxies.mutationProxy,clinicalProxy:t.model.dataProxies.clinicalProxy,geneSymbol:t.model.geneSymbol,sampleArray:t.model.sampleArray}},i=new r(n);return i.render(),t.summaryView=i,i},init3dView:function(t){var e=this;return e._init3dView(e.model.geneSymbol,e.model.uniprotId,e.model.dataProxies.pdbProxy,t)},_init3dView:function(t,e,n,i){var r=this,a=r.$el.find(".mutation-3d-initializer");a.show();var s=new o({el:a,model:{uniprotId:e,geneSymbol:t,pdbProxy:n}});return s.render(),i&&i.isVisible()&&s.resetView(),s},initMutationDiagramView:function(t,e){var n=this;return n.diagramView=n._initMutationDiagramView(n.model.geneSymbol,n.model.mutationData,e,n.model.dataProxies,t),n.diagramView?n.dispatcher.trigger(u.DIAGRAM_INIT,n.diagramView.mutationDiagram):console.log("Error initializing mutation diagram: %s",n.model.geneSymbol),n.diagramView},_initMutationDiagramView:function(t,e,n,i,r){var o=this,s=o.$el.find(".mutation-diagram-view");s.show();var l={mutations:e,sequence:n,geneSymbol:t,dataProxies:i,diagramOpts:r},u=new a({el:s,model:l});return u.render(),u},initMutationTableView:function(t){var e=this;return e.tableView=e._initMutationTableView(e.model.geneSymbol,e.model.mutationData,e.model.dataProxies,e.model.dataManager,t),e.tableView?e.dispatcher.trigger(u.MUTATION_TABLE_INITIALIZED,e.tableView.mutationTable):console.log("Error initializing mutation table: %s",e.model.geneSymbol),e.tableView},_initMutationTableView:function(t,e,n,i,r){var o=this,a=o.$el.find(".mutation-table-container");a.show();var l=new s({el:a,config:{loaderImage:o.options.config.loaderImage},model:{geneSymbol:t,mutations:e,dataProxies:n,dataManager:i,tableOpts:r}});return l.render(),l},initMutationInfoView:function(t){var e=this,n=e.$el.find(".mutation-info-panel-container");n.show();var i={mutations:e.model.mutationData,infoPanelOpts:t},r=new l({el:n,model:i});return r.render(),e.infoView=r,e.dispatcher.trigger(u.INFO_PANEL_INIT,e.infoView),r},addResetCallback:function(t){var e=this,n=e.$el.find(".mutation-details-filter-reset");n.click(t)},showFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideDown()},hideFilterInfo:function(){this.$el.find(".mutation-details-filter-info").slideUp()},showNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideDown()},hideNoDataInfo:function(){this.$el.find(".mutation-details-no-data-info").slideUp()}});t.exports=g},function(t,e,n){var i=n(148),r=n(151),o=n(23),a=n(85),s=n(12),l=n(7),u=l;n(163);var c=s.View.extend({initialize:function(t){var e={config:{loaderImage:a,autoExpand:!0}};this.options=u.extend(!0,{},e,t),this.collapseTimer=null,this.expandTimer=null},render:function(){var t=this,e=o.getTemplateFn("pdb_panel_view_template"),n=e({});t.$el.html(n),t.pdbPanel=t._initPdbPanel(),t.format()},format:function(){var t=this;t.$el.hide();var e=t.$el.find(".expand-collapse-pdb-panel"),n=t.$el.find(".init-pdb-table"),i=t.$el.find(".pdb-table-controls"),r=t.$el.find(".triangle-down"),o=t.$el.find(".triangle");t.pdbPanel.hasMoreChains()&&(e.button({icons:{primary:"ui-icon-triangle-2-n-s"},text:!1}),e.css({width:"300px",height:"12px"}),e.click(function(){t.pdbPanel.toggleHeight()})),e.hide(),i.hide(),r.hide(),o.click(function(t){n.click()}),t.options.config.autoExpand&&(t.$el.find(".mutation-pdb-main-container").mouseenter(function(e){t.autoExpand()}),t.$el.find(".mutation-pdb-main-container").mouseleave(function(e){t.autoCollapse()}))},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},initPdbTableView:function(t,e){var n=this,i={el:n.$el.find(".mutation-pdb-table-view"),config:{loaderImage:n.options.config.loaderImage},model:{geneSymbol:n.model.geneSymbol,pdbColl:t,pdbProxy:n.model.pdbProxy}};i=u.extend(!0,{},n.model.pdbTableOpts,i);var o=new r(i);return n.pdbTableView=o,o.render(e),o},addInitCallback:function(t){var e=this,n=e.$el.find(".init-pdb-table");n.click(function(e){e.preventDefault(),t(e)})},toggleTableControls:function(){var t=this;t.$el.find(".triangle").toggle()},selectDefaultChain:function(){var t=this,e=t.pdbPanel,n=e.getDefaultChainGroup();t.clearTimers(),e.restoreChainPositions(function(){e.highlight(n)})},selectChain:function(t,e){var n=this,i=n.pdbPanel;n.clearTimers(),i.restoreChainPositions(function(){i.expandToChainLevel(t,e);var n=i.getChainGroup(t,e);n&&i.highlight(n)})},getSelectedChain:function(){var t=this,e=t.pdbPanel;return e.getHighlighted()},autoCollapse:function(t){null==t&&(t=2e3);var e=this,n=e.$el.find(".expand-collapse-pdb-panel"),i=e.$el.find(".pdb-table-controls"),r=e.$el.find(".pdb-table-wrapper");e.clearTimers(),e.collapseTimer=setTimeout(function(){e.pdbPanel.minimizeToHighlighted(),n.slideUp(),i.slideUp(),r.slideUp()},t)},autoExpand:function(t){null==t&&(t=400);var e=this,n=e.$el.find(".expand-collapse-pdb-panel"),i=e.$el.find(".pdb-table-controls"),r=e.$el.find(".pdb-table-wrapper");e.clearTimers(),e.expandTimer=setTimeout(function(){e.pdbPanel.restoreToFull(),e.pdbPanel.hasMoreChains()&&n.slideDown(),i.slideDown(),r.slideDown(),null!=e.pdbTableView&&e.pdbTableView.refreshView()},t)},toggleScrollBar:function(t){var e=this,n=e.$el.find(".mutation-pdb-panel-container");t>0?(n.css("max-height",t),n.css("overflow",""),n.css("overflow-y","scroll")):(n.css("max-height",""),n.css("overflow-y",""),n.css("overflow","hidden"))},scrollToSelected:function(){var t=this,e=t.$el.find(".mutation-pdb-panel-container");e.scrollTo(l(".pdb-selection-rectangle-group"),{axis:"y",duration:800,offset:-150})},clearTimers:function(){var t=this;null!=t.collapseTimer&&clearTimeout(t.collapseTimer),null!=t.expandTimer&&clearTimeout(t.expandTimer)},_initPdbPanel:function(){var t=this,e=t.model.pdbColl,n=t.model.pdbProxy,r=t.options.diagram,o={el:t.$el.find(".mutation-pdb-panel-container"),maxHeight:200},a=null;null!=r&&(a=r.xScale,o.marginLeft=r.options.marginLeft,o.marginRight=r.options.marginRight),o=u.extend(!0,{},t.model.pdbPanelOpts,o);var s=new i(o,e,n,a);return s.init(),s}});t.exports=c},function(t,e,n){function i(t,e,n,i){function g(t,e,n,i,o){var a=pt;h.each(n,function(n,s){h.each(n,function(n,l){var u=n.chain;if(u.alignments.length>0){var c=e.colors[l%e.colors.length],d=e.marginTop+(o+s)*(e.chainHeight+e.chainPadding),p=_(t,u,c,e,i,d);p.datum(n),ft[r.chainKey(n.pdbId,n.chain.chainId)]=p,null==ut&&(ut=p),a++}})}),pt=a,v(n,e)}function v(t,e){var i=[],o=[];h.each(t,function(t,e){h.each(t,function(t,e){i.push(t.pdbId),o.push(ft[r.chainKey(t.pdbId,t.chain.chainId)])})}),n.getPdbInfo(i.join(" "),function(t){h.each(o,function(t,n){var i=e.chainTipFn;i(t)})})}function _(t,e,n,i,o,s){for(var l=t.append("g").attr("class","pdb-chain-group").attr("opacity",1),u=i.chainHeight,c=new a(e.mergedAlignment);c.hasNextSegment();){var d=c.getNextSegment(),p=Math.abs(o(d.start)-o(d.end)),h=o(d.start);if(d.type==r.ALIGNMENT_GAP){var f=l.append("line").attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x1",h).attr("y1",s+u/2).attr("x2",h+p).attr("y2",s+u/2);f.datum({initPos:{x:h,y:s+u/2}})}else{var m=l.append("rect").attr("fill",n).attr("opacity",e.mergedAlignment.identityPerc).attr("stroke",i.chainBorderColor).attr("stroke-width",i.chainBorderWidth).attr("x",h).attr("y",s).attr("width",p).attr("height",u);m.datum({initPos:{x:h,y:s}})}}return l}function y(t,e){var n=e.marginLeft-e.labelYPaddingRightV,i=e.marginTop+e.labelYPaddingTopV,r="middle",o="rotate(270, "+n+","+i+")",a="vertical";lt.length<e.labelAlignThreshold&&(n=e.marginLeft-e.labelYPaddingRightH,i=e.marginTop+e.labelYPaddingTopH,r="start",o="rotate(0, "+n+","+i+")",a="horizontal");var s=t.append("g").attr("class","pdb-panel-y-axis-label-group").attr("opacity",1),l=s.append("text").attr("fill",e.labelYFontColor).attr("text-anchor",r).attr("x",n).attr("y",i).attr("class","pdb-panel-y-axis-label").attr("transform",o).style("font-family",e.labelYFont).style("font-size",e.labelYFontSize).style("font-weight",e.labelYFontWeight);h.isArray(e.labelY)?h.each(e.labelY,function(t,e){var i=0==e?0:10,r=0==e&&"vertical"==a?-5:0;l.append("tspan").attr("x",n+r).attr("dy",i).text(t)}):l.text(e.labelY);var u=b(s,n,i,a,e),c=e.yHelpTipFn;return c(u),l}function b(t,e,n,i,r){var o=12,a=12,s=e-o+2,l=r.marginTop;return"horizontal"==i&&(s=r.marginLeft-o-5,l=n-a+2),t.append("svg:image").attr("xlink:href",u).attr("class","pdb-panel-y-axis-help").attr("x",s).attr("y",l).attr("width",o).attr("height",a)}function x(){return ut}function w(t,e){return ft[t+":"+e]}function C(t,e){for(var n=-1,i=0;i<e.length;i++)if(e[i]>t){n=i;break}return n==-1&&(n=e.length-1),n}function A(t){var e=0,n=lt.length;return e="auto"!=t?t:at.marginTop+at.marginBottom+n*(at.chainHeight+at.chainPadding)-at.chainPadding/2}function T(t){var e=0,n=lt.length;return e=t<n?at.marginTop+t*(at.chainHeight+at.chainPadding)-at.chainPadding/2:A("auto")}function S(t,e,n){var i=t.append("svg");return i.attr("width",e),i.attr("height",n),i}function M(t){var e=at.elWidth-(at.marginLeft+at.marginRight),n=at.marginLeft;return m.scale.linear().domain([0,I(t)]).range([n,n+e])}function I(t){var e=[];return h.each(t,function(t){h.each(t,function(t){e.push(t.chain.mergedAlignment.uniprotTo)})}),h.max(e)}function P(){lt=r.allocateChainRows(e),dt=C(lt.length,at.numRows),null==i&&(i=M(lt));var t=d(at.el)[0],n=m.select(t),o=at.numRows[0];gt=T(o);var a=S(n,at.elWidth,gt);st=a,g(a,at,lt.slice(0,o),i,0),ht[0]=!0,0!=at.labelY&&y(a,at),mt=L(lt),D()}function L(t){var e={};return h.each(t,function(t,n){h.each(t,function(t,i){e[r.chainKey(t.pdbId,t.chain.chainId)]=n})}),e}function E(t,e,n){st.selectAll(t).on(e,n),null==rt[t]&&(rt[t]={}),rt[t][e]=n}function F(t,e){st.selectAll(t).on(e,null),rt[t]&&rt[t][e]&&delete rt[t][e]}function D(){E(".pdb-chain-group","click",function(t,e){q(m.select(this))})}function z(){h.each(h.keys(rt),function(t){var e=st.selectAll(t);h.each(h.keys(rt[t]),function(n){e.on(n,rt[t][n])})})}function k(){d(at.el).show()}function V(){d(at.el).hide()}function O(t){var e=T(at.numRows[t]),n=st.attr("height");et(e,n),st.transition().duration(at.animationDuration).attr("height",e).each("end",function(){nt(e,n)}),gt=e}function N(){var t=j();O(t)}function j(){var t=(ct+1)%(dt+1);return ht[t]||(g(st,at,lt.slice(at.numRows[ct],at.numRows[t]),i,at.numRows[ct]),z(),ht[t]=!0),ct=t,t}function R(t){for(var e=-1,n=ct;n<t&&n<dt;n++)e=j();e!==-1&&O(e)}function B(t,e){for(var n=-1,i=mt[r.chainKey(t,e)],o=0;o<at.numRows.length;o++)if(i<at.numRows[o]){n=o;break}n!==-1&&R(n)}function U(){return lt.length>at.numRows[0]}function q(t){vt=t;var e=G(t);st.selectAll(".pdb-selection-rectangle-group").remove();var n=st.append("g").attr("class","pdb-selection-rectangle-group").attr("opacity",0),i=n.append("rect").attr("fill","none").attr("stroke",at.highlightBorderColor).attr("stroke-width",at.highlightBorderWidth).attr("x",e.x).attr("y",e.y).attr("width",e.width).attr("height",e.height);n.transition().duration(at.animationDuration).attr("opacity",1),i.datum({initPos:{x:e.x,y:e.y}}),ot.trigger(l.PANEL_CHAIN_SELECTED,t)}function G(t){var e=1/0,n=-1,i=-1,r=-1;return t.selectAll("rect").each(function(t,o){var a=m.select(this);i=parseFloat(a.attr("y")),r=parseFloat(a.attr("height"));var s=parseFloat(a.attr("x")),l=parseFloat(a.attr("width"));s<e&&(e=s),s+l>n&&(n=s+l)}),{x:e,y:i,width:n-e,height:r}}function H(t){null!=vt&&W(vt,t)}function W(t,e){var n=at.animationDuration;Y(t,e),t==vt&&Y(st.selectAll(".pdb-selection-rectangle-group")),$(t);var i=T(1),r=st.attr("height");et(i,r),st.transition().duration(n).attr("height",i).each("end",function(){nt(i,r)})}function Y(t,e){var n=at.animationDuration,i=at.marginTop,r=at.chainHeight;t.selectAll("line").transition().duration(n).attr("y1",i+r/2).attr("y2",i+r/2),t.selectAll("rect").transition().duration(n).attr("y",i).each("end",function(){h.isFunction(e)&&e()})}function $(t,e){var n=at.animationDuration,i=t.datum(),o=r.chainKey(i.pdbId,i.chain.chainId);st.selectAll(".pdb-chain-group").transition().duration(n).attr("opacity",function(t){return r.chainKey(t.pdbId,t.chain.chainId)===o?1:0}),st.selectAll(".pdb-selection-rectangle-group").transition().duration(n).attr("opacity",function(e){return vt==t?1:0}),st.select(".pdb-panel-y-axis-label-group").transition().duration(n).attr("opacity",0).each("end",function(){h.isFunction(e)&&e()})}function X(t,e,n){st.selectAll(t).transition().duration(n).attr("y1",function(t){return e(this,t,"y1")}).attr("y2",function(t){return e(this,t,"y2")})}function K(t,e,n){st.selectAll(t).transition().duration(n).attr("y",function(t){return e(this,t,"y")})}function Z(t){var e=at.animationDuration;Q(),J();var n=st.attr("height");et(gt,n),st.transition().duration(e).attr("height",gt).each("end",function(){h.isFunction(t)&&t(),nt(gt,n)})}function Q(t){var e=at.animationDuration,n=function(t,e,n){return e.initPos.y};K(".pdb-chain-group rect",n,e),X(".pdb-chain-group line",n,e),K(".pdb-selection-rectangle-group rect",n,e),setTimeout(t,e+50)}function J(t){var e=at.animationDuration;st.selectAll(".pdb-chain-group").transition().duration(e).attr("opacity",1),st.selectAll(".pdb-selection-rectangle-group").transition().duration(e).attr("opacity",1),st.selectAll(".pdb-panel-y-axis-label-group").transition().duration(e).attr("opacity",1).each("end",function(){h.isFunction(t)&&t()})}function tt(){return vt}function et(t,e){ot.trigger(l.PDB_PANEL_RESIZE_STARTED,t,e,at.maxHeight)}function nt(t,e){ot.trigger(l.PDB_PANEL_RESIZE_ENDED,t,e,at.maxHeight)}var it={el:"#mutation_pdb_panel_d3",elWidth:740,elHeight:"auto",maxHeight:200,numRows:[1/0],marginLeft:45,marginRight:30,marginTop:2,marginBottom:0,chainHeight:6,chainPadding:3,labelY:["PDB","Chains"],labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",labelYPaddingRightH:45,labelYPaddingTopH:7,labelYPaddingRightV:25,labelYPaddingTopV:20,labelAlignThreshold:5,chainBorderColor:"#666666",chainBorderWidth:.5,highlightBorderColor:"#FF9900",highlightBorderWidth:2,colors:["#3366cc"],animationDuration:1e3,chainTipFn:function(t){var e=t.datum();n.getPdbInfo(e.pdbId,function(n){var i=null;n&&(i=r.generatePdbInfoSummary(n[e.pdbId],e.chain.chainId));var o=new s({model:{pdbId:e.pdbId,pdbInfo:i.title,molInfo:i.molecule,chain:e.chain}}),a=o.compileTemplate(),l={content:{text:a},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:d(window)}};c.util.addTargetedQTip(t,l)})},yHelpTipFn:function(t){var e=o.getTemplateFn("mutation_details_pdb_help_tip_template"),n=e({}),i={content:{text:n},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow qtip-wide"},position:{my:"bottom left",at:"top center",viewport:d(window)}};c.util.addTargetedQTip(t,i)}},rt={},ot={};h.extend(ot,f.Events);var at=p.extend(!0,{},it,t),st=null,lt=null,ut=null,ct=0,dt=null,pt=0,ht=[],ft={},mt={},gt=0,vt=null;return{init:P,addListener:E,removeListener:F,getChainGroup:w,getDefaultChainGroup:x,show:k,hide:V,toggleHeight:N,expandToChainLevel:B,minimizeToChain:W,minimizeToHighlighted:H,restoreToFull:Z,restoreChainPositions:Q,fadeInAll:J,hasMoreChains:U,highlight:q,getHighlighted:tt,dispatcher:ot}}var r=n(10),o=n(23),a=n(149),s=n(150),l=n(22),u=n(143),c={util:n(6)},d=n(7),p=d,h=n(5),f=n(12),m=n(19);t.exports=i},function(t,e,n){function i(t){function e(){return a<o.mergedString.length}function n(){var t=o.mergedString,e={};e.start=a+o.uniprotFrom;var n=t[a],r=a;if(i(n))for(e.type=n;t[r]==n&&r<=t.length;)r++;else for(e.type="regular";!i(t[r])&&r<=t.length;)r++;return e.end=r+o.uniprotFrom,e.str=t.substring(a,r),a=r,e}function i(t){return t==r.ALIGNMENT_GAP}var o=t,a=0;return{hasNextSegment:e,getNextSegment:n}}var r=n(10);t.exports=i},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t=this,e=t.model.pdbInfo,n=t.model.molInfo,r={pdbId:t.model.pdbId,chainId:t.model.chain.chainId,pdbInfo:"",molInfo:""};null!=e&&e.length>0&&(r.pdbInfo=": "+e),null!=n&&n.length>0&&(r.molInfo=": "+n);var o=i.getTemplateFn("mutation_details_pdb_chain_tip_template");return o(r)}});t.exports=o},function(t,e,n){var i=n(152),r=n(10),o=n(23),a=n(85),s=n(12),l=n(5),u=n(7),c=u;n(163);var d=s.View.extend({initialize:function(t){var e={config:{loaderImage:a}};this.options=c.extend(!0,{},e,t)},render:function(t){var e=this,n=o.getTemplateFn("pdb_table_view_template"),i=n({loaderImage:e.options.config.loaderImage});e.$el.html(i),e._initPdbTable(t),e.format()},format:function(){var t=this;t.$el.hide()},hideView:function(){var t=this;t.$el.slideUp()},showView:function(){var t=this;t.$el.slideDown()},toggleView:function(){var t=this;t.$el.slideToggle()},refreshView:function(){var t=this;t.pdbTable.getDataTable().fnAdjustColumnSizing()},resetFilters:function(){var t=this;t.pdbTable.cleanFilters()},selectChain:function(t,e){var n=this;null!=n.pdbTable&&n.pdbTable.selectRow(t,e)},scrollToSelected:function(){var t=this,e=t.pdbTable.getSelectedRow(),n=t.$el.find(".dataTables_scrollBody");n.scrollTo(u(e),{axis:"y",duration:800})},_initPdbTable:function(t){var e=this,n=e.model.pdbColl,r=e.model.pdbProxy,o=c.extend(!0,{},e.model.tableOpts);o.el=o.el||e.$el.find(".pdb-chain-table");var a=new i(o);return e.pdbTable=a,l.isFunction(t)&&t(e,a),e._generateRowData(a.getColumnOptions(),n,r,function(t){a.renderTable(t),e.$el.find(".pdb-chain-table-loader").hide()}),a},_generateRowData:function(t,e,n,i){var o=[],a=[];e.each(function(t){a.push(t.pdbId)}),n.getPdbInfo(a.join(" "),function(n){e.each(function(e){e.chains.each(function(i){for(var a={pdbId:e.pdbId,chain:i,organism:r.getOrganism(n[e.pdbId],i.chainId),summary:r.generatePdbInfoSummary(n[e.pdbId],i.chainId)},s=[a],u=0;u<l.size(t)-1;u++)s.push(null);o.push(s)})}),i(o)})}});t.exports=d},function(t,e,n){function i(t){function e(t,e,n,i,a,s,l,c){var d=o.getColumnOptions(n,a),h={aaData:e,aoColumns:d,aoColumnDefs:[{bVisible:!1,aTargets:s},{bSearchable:!1,aTargets:c}],oColVis:{aiExclude:l},fnDrawCallback:function(t){y._addColumnTooltips()},fnHeaderCallback:function(t,e,n,i,r){p(t).find("th").addClass("mutation-pdb-table-header")},fnRowCallback:function(t,e,n,i){var o=e[a.datum],s=r.chainKey(o.pdbId,o.chain.chainId);C[s]=t,p(t).addClass("pdb-chain-table-data-row")},fnInitComplete:function(t,e){w.trigger(u.PDB_TABLE_READY)}};return h}function n(t){var e=x.columnVisibility[t],n=e;return e?f.isFunction(e)&&(n=e()):n="hidden",
n}function i(t){var e=x.columnSearch[t],n=e;return null==e?n=!1:f.isFunction(e)&&(n=e()),n}function m(){y.getDataTable().fnFilter("")}function g(t,e){var n=r.chainKey(t,e);v();var i=C[n];p(i).addClass("row_selected"),A=i}function v(){p(x.el).find("tr").removeClass("row_selected")}function _(){return A}var y=this,b={el:"#mutation_pdb_table_d3",elWidth:740,columns:{datum:{sTitle:"datum",tip:""},pdbId:{sTitle:"PDB Id",tip:"",sType:"string"},chain:{sTitle:"Chain",tip:"",sType:"string"},uniprotPos:{sTitle:"Uniprot Positions",tip:"",sType:"numeric"},identityPercent:{sTitle:"Identity Percent",tip:"",sType:"numeric"},organism:{sTitle:"Organism",tip:"",sType:"string"},summary:{sTitle:"Summary",tip:"",sType:"string",sWidth:"65%"}},columnOrder:["datum","pdbId","chain","uniprotPos","identityPercent","organism","summary"],columnVisibility:{pdbId:"visible",chain:"visible",uniprotPos:"visible",identityPercent:"hidden",organism:"visible",summary:"visible",datum:"excluded"},columnSearch:{pdbId:!0,organism:!0,summary:!0},columnRender:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},pdbId:function(t){var e=a.getTemplateFn("mutation_pdb_table_pdb_cell_template");return e({pdbId:t.pdbId})},chain:function(t){var e=a.getTemplateFn("mutation_pdb_table_chain_cell_template");return e({chainId:t.chain.chainId})},organism:function(t){return t.organism},summary:function(t){var e={summary:t.summary.title,molecule:t.summary.molecule},n=a.getTemplateFn("mutation_pdb_table_summary_cell_template");return n(e)},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},columnTooltips:{simple:function(e){s.defaultTableTooltipOpts();d.util.addTargetedQTip(p(e).find(".simple-tip"),t)}},eventListeners:{pdbLink:function(t,e,n){p(t).on("click",".pbd-chain-table-chain-cell a",function(i){i.preventDefault(),v();var r=p(i.target).closest("tr.pdb-chain-table-data-row");r.addClass("row_selected");var o=t.fnGetData(r[0]),a=o[n.datum];e.trigger(u.TABLE_CHAIN_SELECTED,a.pdbId,a.chain.chainId)})}},columnSort:{identityPercent:function(t){return l.assignFloatValue(Math.round(100*t.chain.mergedAlignment.identityPerc))},pdbId:function(t){return t.pdbId},chain:function(t){return t.chain.chainId},organism:function(t){return t.organism},summary:function(t){return t.summary.title+t.summary.molecule},uniprotPos:function(t){return l.assignIntValue(t.chain.mergedAlignment.uniprotFrom)}},columnFilter:{identityPercent:function(t){return Math.round(100*t.chain.mergedAlignment.identityPerc)},summary:function(t){return t.summary.title+" "+t.summary.molecule},uniprotPos:function(t){return t.chain.mergedAlignment.uniprotFrom+"-"+t.chain.mergedAlignment.uniprotTo}},filteringDelay:0,dataTableOpts:{sDom:'<"H"<"mutation_pdb_datatable_info"i><"mutation_pdb_datatable_filter"f>>t',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"200px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ PDB chain(s)",sInfoFiltered:"(out of _MAX_ total chains)",sInfoEmpty:"No chains to show"}}},x=h.extend(!0,{},b,t);c.call(this,x),x=y._options;var w=y._dispatcher,C={},A=null;this._initDataTableOpts=e,this._visibilityValue=n,this._searchValue=i,this.selectRow=g,this.cleanFilters=m,this.getSelectedRow=_,this.dispatcher=this._dispatcher}var r=n(10),o=n(153),a=n(23),s=n(129),l=n(154),u=n(22),c=n(155),d={util:n(6)},p=n(7),h=p,f=n(5);i.prototype=new c,i.prototype.constructor=i,t.exports=i},function(t,e,n){var i=n(7),r=n(5),o=function(){function t(t){var e={};return r.each(t,function(t,n){null==e[t]&&(e[t]=n)}),e}function e(t){var e={};return r.each(r.pairs(t),function(t,n){var i=t[0],r=t[1];null!=r.sTitle&&r.sTitle.length>0&&(e[r.sTitle]=i)}),e}function n(t,e){var n={};return r.each(t,function(t,i){null==n[t]&&(r.isFunction(e)?n[t]=e(t):n[t]="hidden")}),n}function o(t,e){var n={};return r.each(t,function(t,i){null==n[t]&&(n[t]=r.isFunction(e)&&e(t))}),n}function a(t,e,n){var i=[];return r.each(t,function(t,r){"visible"!=n[t]&&i.push(e[t])}),i}function s(t,e,n){var i=[];return r.each(t,function(t,r){"excluded"==n[t]&&i.push(e[t])}),i}function l(t,e,n){var i=[];return r.each(t,function(t,r){n[t]===!1&&i.push(e[t])}),i}function u(t,e){var n=[];return r.each(r.pairs(t),function(t){var i=t[0],r=t[1],o=e[i];if(null!=o){var a={fnRender:function(t){var n=t.aData[e.datum];return r(t,n)},aTargets:[o]};n.push(a)}}),n}function c(t,e,n,i,o){var a={};return r.each(r.pairs(e),function(e){var r=e[0],o=e[1],s=n[r],l=i[r],u=t[r],c=function(t){return null!=s?s(t):o(t)};if(null!=u){var d={mData:function(e,n,i){var r=e[t.datum];return"set"===n?null:"display"===n?o(r):"sort"===n?c(r):"filter"===n?null!=l?l(r):c(r):e[u]},aTargets:[u]};a[r]=d}}),r.each(r.pairs(o),function(e){var n=e[0],i=e[1],r=t[n],o={mData:function(e,n,r){return i(e,n,r,t)},aTargets:[r]};a[n]=o}),r.values(a)}function d(t,e){var n=[];return r.each(r.pairs(t),function(t){var i=t[0],r=t[1],o=e[i];o>0&&(n[o]=r)}),n}function p(t){var e=i(t).attr("alt"),n=parseFloat(e);return isNaN(n)&&(n=""),n}function h(t){return t.indexOf("label")!=-1?i(t).find("label").text().trim()||i(t).text().trim():-1}function f(t){return t.indexOf("label")!=-1?parseInt(i(t).text()):-1}function m(t){return t.indexOf("label")!=-1?parseFloat(i(t).text()):-1}function g(t,e,n,i){return n>=0?i>=0?n==i?0:n<i?-1:1:-1:i>=0?1:t==e?0:t<e?1:-1}function v(t,e,n,i){return n>=0?i>=0?n==i?0:n<i?1:-1:-1:i>=0?1:t==e?0:t<e?-1:1}return{buildColumnIndexMap:t,buildColumnNameMap:e,buildColumnVisMap:n,buildColumnSearchMap:o,getHiddenColumns:a,getExcludedColumns:s,getNonSearchableColumns:l,getColumnOptions:d,getColumnRenderers:u,getColumnData:c,compareSortAsc:g,compareSortDesc:v,getAltTextValue:p,getLabelTextValue:h,getLabelTextIntValue:f,getLabelTextFloatValue:m}}();t.exports=o},function(t,e,n){var i=n(129),r=function(){function t(t){return e(F,t)}function e(t,e){var n,i,r;return null!=t[e]?(n=t[e].style,i=t[e].label,r=t[e].tooltip):(n=t.unknown.style,i=t.unknown.label,r=t.unknown.tooltip),{style:n,tip:r,text:i}}function n(t){var e=16,n=t,i="",r=t;return null!=t&&t.length>e+2&&(n=t.substring(0,e)+"...",i="simple-tip"),{style:i,tip:r,text:n}}function r(t){return o(I,t)}function o(t,e){var n,i;return null!=e&&(e=e.toLowerCase()),null!=t[e]?(n=t[e].style,i=t[e].label):(n=t.other.style,i=e),{style:n,text:i}}function a(t){return s(L,t)}function s(t,e){var n="simple-tip",i=e,r="";return null!=e&&(e=e.toLowerCase()),null!=t[e]&&(n=t[e].style,i=t[e].label,r=t[e].tooltip),{style:n,tip:r,text:i}}function l(t){return u(P,t)}function u(t,e){var n,i,r;return null!=e&&(e=e.toLowerCase()),null!=t[e]?(n=t[e].style,i=t[e].label,r=t[e].tooltip):(n=t.unknown.style,i=t.unknown.label,r=t.unknown.tooltip),{style:n,tip:r,text:i}}function c(t,e){return d(E,t,e)}function d(t,e,n){var i="",r="",o="",a="";return null!=e&&(e=e.toLowerCase()),null!=t[e]&&(a=t[e].tooltip,null!=n&&(a=n.toFixed(2)),i=t[e].label,r=t[e].style,o="oma_link"),{fisClass:r,omaClass:o,value:a,text:i}}function p(t,e,n,i){var r="NA",o=e+n,a="",s="";return t&&(a="mutation_table_allele_freq",r=t.toFixed(2),s=i),{text:r,total:o,style:a,tipClass:s}}function h(t){return m(t.get("pdbMatch"))}function f(t){return m(t.get("igvLink"))}function m(t){return t?"#":""}function g(t){var e="mutation-table-protein-change",n="click to highlight the position on the diagram",i="";return null!=t.get("aminoAcidChange")&&t.get("aminoAcidChange").length>0&&"NA"!==t.get("aminoAcidChange")&&null!=t.get("cancerStudyShort")&&t.get("cancerStudyShort").toLowerCase().indexOf("msk-impact")!=-1&&v(t.get("proteinChange"),t.get("aminoAcidChange"))&&(i="The original annotation file indicates a different value: <b>"+_(t.get("aminoAcidChange"))+"</b>"),{text:_(t.get("proteinChange")),style:e,tip:n,additionalTip:i}}function v(t,e){var n=!1;if(t=_(t),e=_(e),e!==t){var i=t.match(/[A-Z]/g),r=e.match(/[A-Z]/g),o=t.match(/[0-9]+/),a=e.match(/[0-9]+/),s=t.match(/([a-z]+)/),l=e.match(/([a-z]+)/);o&&a&&o.length>0&&a.length>0&&o[0]!=a[0]?n=!0:i&&r&&i.length>0&&r.length>0&&"X"!==i[0]&&"X"!==r[0]&&i[0]!==r[0]?n=!0:i&&r&&i.length>1&&r.length>1&&i[1]!==r[1]?n=!0:s&&l&&s.length>0&&l.length>0&&s[0]!==l[0]&&(n=!0)}return n}function _(t){var e="p.";return t.indexOf(e)!=-1&&(t=t.substr(t.indexOf(e)+e.length)),t}function y(t){var e="tumor_type",n="";return{text:t.get("tumorType"),style:e,tip:n}}function b(t){var e="",n="";return t>0&&(e="mutation_table_cosmic",n=t),{style:e,count:n}}function x(t){var e="",n="";return t>0&&(e="mutation_table_cbio_portal",n=t),{style:e,frequency:n}}function w(t){var e=t,n="mutation_table_int_value";return null==t&&(e="NA",n=""),{text:e,style:n}}function C(t){var e=t,n="mutation_table_allele_count";return null==t&&(e="NA",n=""),{text:e,style:n}}function A(t,e){var n;return null!=t&&(t=t.toLowerCase()),n="low"==t||"l"==t?2:"medium"==t||"m"==t?3:"high"==t||"h"==t?4:"neutral"==t||"n"==t?1:-1,n>0&&!isNaN(e)&&(n+=e/1e3),n}function T(t){var e=parseInt(t);return isNaN(e)&&(e=-(1/0)),e}function S(t){var e=parseFloat(t);return isNaN(e)&&(e=-(1/0)),e}var M=i.getVisualStyleMaps(),I=M.mutationType,P=M.validationStatus,L=M.mutationStatus,E=M.omaScore,F=M.cna;return{getCaseId:n,getProteinChange:g,getPdbMatchLink:h,getIgvLink:f,getAlleleCount:C,getAlleleFreq:p,getCNA:t,getMutationType:r,getMutationStatus:a,getValidationStatus:l,getFis:c,getTumorType:y,getCosmic:b,getCbioPortal:x,getIntValue:w,assignValueToPredictedImpact:A,assignIntValue:T,assignFloatValue:S}}();t.exports=r},function(t,e,n){function i(t){var e=this,n=null;e._defaultOpts={el:"",columns:{},columnOrder:[],columnVisibility:{},columnSearch:{},columnRender:{},columnSort:{},columnFilter:{},columnData:{},columnTooltips:{},eventListeners:{},customSort:{},filteringDelay:0,dataTableOpts:{}},e._options=a.extend(!0,{},e._defaultOpts,t),e._dispatcher={},s.extend(e._dispatcher,l.Events),e._dataTable=null,e._visibilityValue=function(t){return"hidden"},e._searchValue=function(t){return!1},e.renderTable=function(t){var i=e._options.columnOrder,a=n=r.buildColumnIndexMap(i),s=r.buildColumnNameMap(e._options.columns),l=r.buildColumnVisMap(i,e._visibilityValue);e._visiblityMap=l;var u=r.buildColumnSearchMap(i,e._searchValue),c=r.getHiddenColumns(i,a,l),d=r.getExcludedColumns(i,a,l),p=r.getNonSearchableColumns(i,a,u);e._addSortFunctions(),e._dataTable=e._initDataTable(o(e._options.el),t,e._options.columns,s,a,c,d,p),e._addEventListeners(a),e._options.filteringDelay>0&&e._dataTable.fnSetFilteringDelay(e._options.filteringDelay)},e._initDataTableOpts=function(t,e,n,i,r,o,a,s){return null},e._initDataTable=function(t,n,i,o,s,l,u,c){var d=e._initDataTableOpts(t,n,i,o,s,l,u,c),p=r.getColumnData(s,e._options.columnRender,e._options.columnSort,e._options.columnFilter,e._options.columnData);return d.aoColumnDefs=d.aoColumnDefs.concat(p),d=a.extend(!0,{},e._options.dataTableOpts,d),t.dataTable(d)},e._addSortFunctions=function(){s.each(s.pairs(e._options.customSort),function(t){var e=t[0],n=t[1];a.fn.dataTableExt.oSort[e]=n})},e._addEventListeners=function(t){null!=e.getDataTable()&&s.each(e._options.eventListeners,function(n){n(e.getDataTable(),e._dispatcher,t)})},e._addColumnTooltips=function(t){t=t||{};var n=o(e._options.el);s.each(s.keys(e._options.columnTooltips),function(i){if("excluded"!=e._visiblityMap[i]){var r=e._options.columnTooltips[i];s.isFunction(r)&&r(n,t)}})},e.getColumnOptions=function(){return e._options.columns},e.getDataTable=function(){return e._dataTable},e.setDataTable=function(t){e._dataTable=t},e.getIndexMap=function(){return n}}var r=(n(2),n(153)),o=n(7),a=o,s=n(5),l=n(12);n(156),n(158),n(159),n(160),n(161),n(162),t.exports=i},function(t,e,n){var i=n(157),r=n(7);i&&null==r.fn.DataTable&&i(window,r),t.exports=i},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_157__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_158__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_159__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_160__},function(t,e,n){(function(t,e){e.fn.dataTableExt.oApi.fnSetFilteringDelay=function(e,n){var i=this,n="undefined"==typeof n?250:n;return this.each(function(e){t.fn.dataTableExt.iApiIndex=e;var r=null,o=null,a=t("input",i.fnSettings().aanFeatures.f);return a.off("keyup search input").on("keyup",function(){null!==o&&o==a.val()||(window.clearTimeout(r),o=a.val(),r=window.setTimeout(function(){t.fn.dataTableExt.iApiIndex=e,i.fnFilter(a.val()),o=null},n))}),this}),this}}).call(e,n(7),n(7))},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_162__},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_163__},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t,e=this;e.model.clinicalProxy.getPatientData(e.model.sampleArray,function(n){t=n?e._germlineMutationSummary(n):e._mutationSummary();var r={mutationSummary:t,geneSymbol:e.model.geneSymbol},o=i.getTemplateFn("mutation_summary_view_template"),a=o(r);e.$el.html(a),e.format()})},format:function(){},_mutationSummary:function(){var t=this,e=t.model.mutationProxy.getMutationUtil(),n=t.model.geneSymbol,i=t.model.sampleArray,r="";if(i.length>0){var o=e.countMutations(n,i);r=e.generateSummary(o)}return r},_germlineMutationSummary:function(t){var e=this,n=e.model.mutationProxy.getMutationUtil(),i=e.model.geneSymbol,r=e.model.sampleArray,o=0,a="";if(r.length>0){for(var s=n.countMutations(i,r),l=0;l<t.length;l++){var u=t[l];"YES"===u.attr_val&&o++}s.numGermlineCases=o,a=n.generateSummary(s)}return a}});t.exports=o},function(t,e,n){var i=n(23),r=n(12),o=n(5),a=n(7);n(8),n(9);var s=r.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},o.extend(this.dispatcher,r.Events)},render:function(){var t=this,e=(t.model.geneSymbol,i.getTemplateFn("mutation_3d_view_template")),n=e({});this.$el.html(n),this.format()},format:function(){var t=this,e=t.$el.find(".mutation-3d-vis");e.attr("disabled","disabled");var n=function(n){if(n)e.removeAttr("disabled");else{var i=t.model.geneSymbol,r="No structure data for "+i,o={content:{text:r},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom center",at:"top center",viewport:a(window)}};t.$el.qtip(o)}},i=t.model.pdbProxy,r=t.model.uniprotId;i.hasPdbData(r,n)},addInitCallback:function(t){var e=this,n=e.$el.find(".mutation-3d-vis");n.click(t)},resetView:function(){var t=this,e=t.$el.find(".mutation-3d-vis");e.click()},isVisible:function(){var t=this;return t.$el.is(":visible")}});t.exports=s},function(t,e,n){var i=n(125),r=n(167),o=n(171),a=n(173),s=n(23),l={util:n(6),download:n(141)},u=n(12),c=n(5),d=n(7),p=u.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},c.extend(this.dispatcher,u.Events)},render:function(){var t=this,e={geneSymbol:t.model.geneSymbol,uniprotId:t.model.sequence.metadata.identifier},n=s.getTemplateFn("mutation_diagram_view_template"),i=n(e);t.$el.html(i),t.mutationDiagram=t._initMutationDiagram(t.model.geneSymbol,t.model.mutations,t.model.sequence,t.model.dataProxies,t.model.diagramOpts),t.format()},format:function(){var t=this;t.$el.find(".mutation-diagram-toolbar").hide(),t.$el.find(".mutation-diagram-customize").hide(),t.$el.find(".mutation-diagram-help").hide(),t.$el.find(".mutation-diagram-toolbar-buttons").css("visibility","hidden"),t.mutationDiagram&&t._initToolbar(t.mutationDiagram,t.model.geneSymbol)},_initMutationDiagram:function(t,e,n,o,a){var s=this;if(a||(a={}),""==n.length||parseInt(n.length)<=0)return null;a.el=s.$el.find(".mutation-diagram-container");var l=i.convertToCollection(e.getData()),u={mutations:l,sequence:n},c=new r(t,a,u,o);return null==n?d.getJSON("getPfamSequence.json",{geneSymbol:s.geneSymbol},function(t){t&&c.updateSequenceData(t[0]),c.initDiagram()}):c.initDiagram(),c},_initToolbar:function(t,e){var n=this,i=n.$el.find(".mutation-diagram-toolbar"),r=n.$el.find(".diagram-to-pdf"),s=n.$el.find(".diagram-to-svg"),u=n.$el.find(".diagram-customize"),c=n.$el.find(".diagram-help"),d=function(t,n,i){var r="mutation_diagram_"+e+"."+i;if(t(n,!1),"svg"==i)l.download.initDownload(n.svg[0][0],{filename:r});else if("pdf"==i){var o={filename:r,contentType:"application/pdf",servletName:"svgtopdf.do"};l.download.initDownload(n.svg[0][0],o)}t(n,!0)},p=function(t,n){var i=e;n&&(i=""),t.updateTopLabel(i)},h=function(t,e){p(t,e)};s.click(function(e){d(p,t,"svg")}),r.click(function(e){d(h,t,"pdf")}),u.click(function(e){var i=n.customizePanelView;i||(i=new o({el:n.$el.find(".mutation-diagram-customize"),diagram:t}),i.render(),n.customizePanelView=i),i.toggleView()}),c.click(function(t){var e=n.helpPanelView;e||(e=new a({el:n.$el.find(".mutation-diagram-help")}),e.render(),n.helpPanelView=e),e.toggleView()}),n._autoHideToolbarButtons(),i.show()},_autoHideToolbarButtons:function(){var t=this,e=t.$el.find(".mutation-diagram-toolbar-buttons");l.util.autoHideOnMouseLeave(t.$el,e)}});t.exports=p},function(t,e,n){function i(t,e,n,i){var o=this;o.listeners={},o.dispatcher={},h.extend(o.dispatcher,f.Events),o.options=p.extend(!0,{},o.defaultOpts,e),o.dataProxies=i,o.geneSymbol=t,o.data=n,o.pileups=null==n?null:r.convertToPileups(n.mutations,e.pileupConverter),o.initialPileups=o.pileups,o.highlighted={},o.multiSelect=!1,o.svg=null,o.bounds=null,o.gData=null,o.gLine=null,o.gLabel=null,o.xScale=null,o.yScale=null,o.topLabel=null,o.xAxisLabel=null,o.yAxisLabel=null,o.xMax=null,o.yMax=null,o.maxCount=null,o.mutationColorMap={},o.mutationPileupMap={}}var r=n(128),o=n(23),a=n(168),s=n(170),l=n(22),u={util:n(6)},c=n(19),d=n(7),p=d,h=n(5),f=n(12);i.prototype.defaultOpts={el:"#mutation_diagram_d3",elWidth:740,elHeight:180,marginLeft:45,marginRight:30,marginTop:30,marginBottom:60,labelTop:"",labelTopFont:"sans-serif",labelTopFontColor:"#2E3436",labelTopFontSize:"12px",labelTopFontWeight:"bold",labelTopMargin:2,labelX:!1,labelXFont:"sans-serif",labelXFontColor:"#2E3436",labelXFontSize:"12px",labelXFontWeight:"normal",labelY:"# Mutations",labelYFont:"sans-serif",labelYFontColor:"#2E3436",labelYFontSize:"12px",labelYFontWeight:"normal",minLengthX:0,minLengthY:5,maxLengthX:1/0,maxLengthY:1/0,seqFillColor:"#BABDB6",seqHeight:14,seqPadding:5,regionHeight:24,regionFont:"sans-serif",regionFontColor:"#FFFFFF",regionFontSize:"12px",regionTextAnchor:"middle",showRegionText:!0,showStats:!1,multiSelectKeycode:16,lollipopLabelCount:1,lollipopLabelThreshold:2,lollipopFont:"sans-serif",lollipopFontColor:"#2E3436",lollipopFontSize:"10px",lollipopTextAnchor:"auto",lollipopTextPadding:8,lollipopTextAngle:0,lollipopFillColor:{missense:"#008000",truncating:"#000000",inframe:"#8B4513",fusion:"#8B00C9",other:"#8B00C9",default:"#BB0000"},lollipopBorderColor:"#BABDB6",lollipopBorderWidth:.5,lollipopSize:30,lollipopHighlightSize:100,lollipopStrokeWidth:1,lollipopStrokeColor:"#BABDB6",lollipopShapeRegular:"circle",lollipopShapeSpecial:"circle",xAxisPadding:10,xAxisTickIntervals:[100,200,400,500,1e3,2e3,5e3,1e4,2e4,5e4],xAxisTicks:8,xAxisTickSize:6,xAxisStroke:"#AAAAAA",xAxisFont:"sans-serif",xAxisFontSize:"10px",xAxisFontColor:"#2E3436",yAxisPadding:5,yAxisLabelPadding:15,yAxisTicks:10,yAxisTickIntervals:[1,2,5,10,20,50,100,200,500],yAxisTickSize:6,yAxisStroke:"#AAAAAA",yAxisFont:"sans-serif",yAxisFontSize:"10px",yAxisFontColor:"#2E3436",yAxisAutoAdjust:!0,animationDuration:1e3,fadeDuration:1500,pileupConverter:!1,lollipopTipFn:function(t,e,n){var i=new a({model:e});i.setShowStats(n);var r=i.compileTemplate(),o={content:{text:r},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow cc-ui-tooltip"},position:{my:"bottom left",at:"top center",viewport:d(window)}};u.util.addTargetedQTip(t,o)},regionTipFn:function(t,e,n){var i={identifier:e.metadata.identifier,type:e.type,description:e.metadata.description,start:e.metadata.start,end:e.metadata.end,pfamAccession:e.metadata.accession,mutationAlignerInfo:""};n.getMutationAlignerData({pfamAccession:e.metadata.accession},function(e){if(null!=e&&null!=e.linkToMutationAligner&&e.linkToMutationAligner.length>0){var n=o.getTemplateFn("mutation_aligner_info_template");i.mutationAlignerInfo=n({linkToMutationAligner:e.linkToMutationAligner})}var r=new s({model:i}),a=r.compileTemplate(),l={content:{text:a},hide:{fixed:!0,delay:100,event:"mouseout"},show:{event:"mouseover"},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-lightyellow"},position:{my:"bottom left",at:"top center",viewport:d(window)}};u.util.addTargetedQTip(t,l)})}},i.prototype.updateOptions=function(t){var e=this;e.options=p.extend(!0,{},e.options,t),e.updateGlobals()},i.prototype.rescaleYAxis=function(t){var e=this;e.updateGlobals(),e.svg.select(".mut-dia-y-axis").remove(),e.drawYAxis(e.svg,e.yScale,e.yMax,e.options,e.bounds),t||e.updatePlot()},i.prototype.updateGlobals=function(t){var e=this;t=t||e.options;var n=e.initialPileups;t.yAxisAutoAdjust&&(n=e.pileups);var i=e.maxCount=e.calcMaxCount(n),r=e.xMax=e.calcXMax(t,e.data),o=e.yMax=e.calcYMax(t,i);e.bounds=this.calcBounds(t),e.xScale=this.xScaleFn(e.bounds,r),e.yScale=this.yScaleFn(e.bounds,o)},i.prototype.updateSequenceData=function(t){var e=this;e.data.sequence=t},i.prototype.initDiagram=function(){var t=this,e=d(t.options.el)[0],n=c.select(e),i=t.bounds=t.calcBounds(t.options);t.mutationPileupMap=r.mapToMutations(t.initialPileups);var o=t.createSvg(n,t.options.elWidth,t.options.elHeight);t.svg=o,t.drawDiagram(o,i,t.options,t.data),t.addDefaultListeners()},i.prototype.calcBounds=function(t){var e={};return e.width=t.elWidth-(t.marginLeft+t.marginRight),e.height=t.elHeight-(t.marginBottom+t.marginTop),e.x=t.marginLeft,e.y=t.elHeight-t.marginBottom,e},i.prototype.drawDiagram=function(t,e,n,i){var o=this,a=(parseInt(i.sequence.length),o.initialPileups||r.convertToPileups(i.mutations,n.pileupConverter)),s=o.maxCount=o.calcMaxCount(a),l=o.xMax=o.calcXMax(n,i),u=o.yMax=o.calcYMax(n,s),c=i.sequence.regions,d=o.generateSequenceTooltip(i),p=o.xScale=o.xScaleFn(e,l),h=o.yScale=o.yScaleFn(e,u);o.drawXAxis(t,p,l,n,e),0!=n.labelX,o.drawYAxis(t,h,u,n,e),0!=n.labelY&&(o.yAxisLabel=o.drawYAxisLabel(t,n,e)),0!=n.topLabel&&(o.topLabel=o.drawTopLabel(t,n,e));t.append("rect").attr("fill","#FFFFFF").attr("opacity",0).attr("x",e.x).attr("y",e.y-e.height).attr("width",e.width).attr("height",e.height).attr("class","mut-dia-background");o.drawPlot(t,a,n,e,p,h);var f=o.drawSequence(t,n,e);f.attr("title",d);for(var m=0,g=c.length;m<g;m++)o.drawRegion(t,c[m],n,e,p)},i.prototype.xScaleFn=function(t,e){return c.scale.linear().domain([0,e]).range([t.x,t.x+t.width])},i.prototype.yScaleFn=function(t,e){return c.scale.linear().domain([0,e]).range([t.y,t.y-t.height])},i.prototype.calcXMax=function(t,e){var n=parseInt(e.sequence.length);return Math.min(t.maxLengthX,Math.max(n,t.minLengthX))},i.prototype.calcYMax=function(t,e){return Math.min(t.maxLengthY,Math.max(e,t.minLengthY))},i.prototype.generateSequenceTooltip=function(t){var e="",n=parseInt(t.sequence.length);return t.sequence.metadata.identifier&&(e+=t.sequence.metadata.identifier,t.sequence.metadata.description&&(e+=", "+t.sequence.metadata.description)),e+=" ("+n+"aa)"},i.prototype.drawPlot=function(t,e,n,i,r,o){var a=this,s=a.gLabel;null===s&&(s=t.append("g").attr("class","mut-dia-lollipop-labels"),a.gLabel=s);var l=a.gLine;null===l&&(l=t.append("g").attr("class","mut-dia-lollipop-lines"),a.gLine=l);var u=a.gData;null===u&&(u=t.append("g").attr("class","mut-dia-lollipop-points"),a.gData=u);for(var c=0;c<e.length;c++)a.drawLollipop(u,l,e[c],n,i,r,o);a.drawLollipopLabels(s,e,n,r,o)},i.prototype.createSvg=function(t,e,n){var i=t.append("svg");return i.attr("width",e),i.attr("height",n),i},i.prototype.calcTickInterval=function(t,e,n){for(var i=-1,r=0;r<t.length;r++){i=t[r];var o=e/i;if(o<n-1)break}return i},i.prototype.getTickValues=function(t,e){for(var n=[],i=0;i<t;)n.push(i),i+=e/2;return n.push(t),n},i.prototype.drawXAxis=function(t,e,n,i,r){var o=this,a=o.calcTickInterval(i.xAxisTickIntervals,n,i.xAxisTicks),s=o.getTickValues(n,a),l=function(t){return t==n?t+" aa":t%a!=0?"":n-t>a/3?t:""},u=i.xAxisTickSize,d=c.svg.axis().scale(e).orient("bottom").tickValues(s).tickFormat(l).tickSize(u,u/2,0),p=r.y+i.regionHeight+i.xAxisPadding,h=t.append("g").attr("class","mut-dia-x-axis").attr("transform","translate(0,"+p+")").call(d);return o.formatAxis(".mut-dia-x-axis",i.xAxisStroke,i.xAxisFont,i.xAxisFontSize,i.xAxisFontColor),h},i.prototype.drawYAxis=function(t,e,n,i,r){var o=this,a=o.calcTickInterval(i.yAxisTickIntervals,n,i.yAxisTicks),s=o.getTickValues(n,2*a),l=function(t){var e="";return t===n?(e=t,o.maxCount>n&&(e=">"+t)):0===t&&(e=t),e},u=i.yAxisTickSize,d=c.svg.axis().scale(e).orient("left").tickValues(s).tickFormat(l).tickSize(u,u/2,0),p=r.x-i.yAxisPadding,h=t.append("g").attr("class","mut-dia-y-axis").attr("transform","translate("+p+",0)").call(d);return o.formatAxis(".mut-dia-y-axis",i.yAxisStroke,i.yAxisFont,i.yAxisFontSize,i.yAxisFontColor),h},i.prototype.drawTopLabel=function(t,e,n){var i=e.labelTopMargin,r=e.marginTop/2,o=t.append("text").attr("fill",e.labelTopFontColor).attr("text-anchor","start").attr("x",i).attr("y",r).attr("class","mut-dia-top-label").style("font-family",e.labelTopFont).style("font-size",e.labelTopFontSize).style("font-weight",e.labelTopFontWeight).text(e.labelTop);return o},i.prototype.drawYAxisLabel=function(t,e,n){var i=n.x-e.yAxisPadding-e.yAxisTickSize-e.yAxisLabelPadding,r=n.y-n.height/2,o=t.append("text").attr("fill",e.labelYFontColor).attr("text-anchor","middle").attr("x",i).attr("y",r).attr("class","mut-dia-y-axis-label").attr("transform","rotate(270, "+i+","+r+")").style("font-family",e.labelYFont).style("font-size",e.labelYFontSize).style("font-weight",e.labelYFontWeight).text(e.labelY);return o},i.prototype.formatAxis=function(t,e,n,i,r){var o=c.selectAll(t+" line");o.style("fill","none").style("stroke",e).style("shape-rendering","crispEdges"),o=c.selectAll(t+" path"),o.style("fill","none").style("stroke",e).style("shape-rendering","crispEdges"),o=c.selectAll(t+" text"),o.attr("fill",r).style("font-family",n).style("font-size",i)},i.prototype.drawLollipop=function(t,e,n,i,r,o,a){var s=this,l=i.lollipopShapeRegular,u=n.count,d=n.location,p=o(d),h=a(u);u>i.maxLengthY&&(l=i.lollipopShapeSpecial,h=a(i.maxLengthY));var f=s.getLollipopFillColor(i,n);s.updateColorMap(n,f);var m=t.append("path").attr("d",c.svg.symbol().size(i.lollipopSize).type(l)).attr("transform","translate("+p+","+h+")").attr("fill",f).attr("stroke",i.lollipopBorderColor).attr("stroke-width",i.lollipopBorderWidth).attr("id",n.pileupId).attr("class","mut-dia-data-point").attr("opacity",0);s.fadeIn(m),m.datum(n);var g=i.lollipopTipFn;g(m,n,i.showStats);var v=e.append("line").attr("x1",p).attr("y1",h).attr("x2",p).attr("y2",s.calcSequenceBounds(r,i).y).attr("stroke",i.lollipopStrokeColor).attr("stroke-width",i.lollipopStrokeWidth).attr("class","mut-dia-data-line").attr("opacity",0);return s.fadeIn(v),{dataPoint:m,line:v}},i.prototype.updateColorMap=function(t,e){for(var n=this,i=0;i<t.mutations.length;i++)n.mutationColorMap[t.mutations[i].get("mutationId")]=e},i.prototype.getLollipopShapeFn=function(){var t=this,e=function(e){var n=t.options.lollipopShapeRegular;return e.count>t.options.maxLengthY&&(n=t.options.lollipopShapeSpecial),n};return e},i.prototype.getLollipopFillColor=function(t,e){var n,i=t.lollipopFillColor;if(h.isFunction(i))n=i(e);else if(h.isString(i))n=i;else{var o=r.groupMutationsByMainType(e);n=0===o.length?i.default:i[o[0].type]}return n},i.prototype.drawLollipopLabels=function(t,e,n,i,r){var o=this,a=function(t,e){var i=e;if("auto"==i.toLowerCase()){var r=t.attr("x")-t.node().getComputedTextLength()/2;i=r<n.marginLeft?"start":"middle"}return i},s=n.lollipopLabelCount,l=2;if(e.length>1){for(var u=e[0].count,c=0;c<e.length&&!(e[c].count<u);c++);s<c&&c>l&&(s=0)}for(var d=0;d<s&&d<e.length&&!(e.length>1&&e[d].count<n.lollipopLabelThreshold);d++){var p=i(e[d].location),h=r(Math.min(e[d].count,n.maxLengthY))-n.lollipopTextPadding,f=t.append("text").attr("fill",n.lollipopFontColor).attr("x",p).attr("y",h).attr("class","mut-dia-lollipop-text").attr("transform","rotate("+n.lollipopTextAngle+", "+p+","+h+")").style("font-size",n.lollipopFontSize).style("font-family",n.lollipopFont).text(e[d].label).attr("opacity",0);o.fadeIn(f);var m=a(f,n.lollipopTextAnchor);f.attr("text-anchor",m)}},i.prototype.drawRegion=function(t,e,n,i,r){var o=this,a=e.metadata.start,s=e.metadata.end,l=e.text,u=e.colour,c=Math.abs(r(a)-r(s)),d=n.regionHeight,p=i.y+n.seqPadding,h=r(a),f=t.append("g").attr("class","mut-dia-region").attr("transform","translate("+h+","+p+")"),m=f.append("rect").attr("fill",u).attr("x",0).attr("y",0).attr("width",c).attr("height",d),g=n.regionTipFn;if(g(m,e,o.dataProxies.mutationAlignerProxy),n.showRegionText){var v=o.drawRegionText(l,f,n,c);v&&g(v,e,o.dataProxies.mutationAlignerProxy)}return f},i.prototype.drawRegionText=function(t,e,n,i){var r=i/2,o=n.regionHeight;"start"===n.regionTextAnchor?r=0:"end"===n.regionTextAnchor&&(r=i);var a=e.append("text").style("font-size",n.regionFontSize).style("font-family",n.regionFont).text(t).attr("text-anchor",n.regionTextAnchor).attr("fill",n.regionFontColor).attr("x",r).attr("y",2*o/3).attr("class","mut-dia-region-text");return a.node().getComputedTextLength()>i&&(t=t.substring(0,3)+"..",a.text(t),a.node().getComputedTextLength()>i&&(a.remove(),a=null)),a},i.prototype.drawSequence=function(t,e,n){var i=this.calcSequenceBounds(n,e);return t.append("rect").attr("fill",e.seqFillColor).attr("x",i.x).attr("y",i.y).attr("width",i.width).attr("height",i.height).attr("class","mut-dia-sequence")},i.prototype.calcMaxCount=function(t){var e=-1;return t.length>0&&(e=t[0].count),e},i.prototype.calcSequenceBounds=function(t,e){var n=t.x,i=t.y+Math.abs(e.regionHeight-e.seqHeight)/2+e.seqPadding,r=t.width,o=e.seqHeight;return{x:n,y:i,width:r,height:o}},i.prototype.updatePlot=function(t){var e=this,n=e.pileups,i=[];return t&&(i=r.convertToPileups(t,e.options.pileupConverter),e.pileups=n=i,e.mutationPileupMap=r.mapToMutations(n)),e.cleanPlotArea(),e.mutationColorMap={},e.options.yAxisAutoAdjust&&e.rescaleYAxis(!0),e.drawPlot(e.svg,n,e.options,e.bounds,e.xScale,e.yScale),h.each(h.keys(e.listeners),function(t){var n=e.svg.selectAll(t);h.each(h.keys(e.listeners[t]),function(i){n.on(i,e.listeners[t][i])})}),e.highlighted={},e.dispatcher.trigger(l.DIAGRAM_PLOT_UPDATED),e.isFiltered()},i.prototype.cleanPlotArea=function(){var t=this,e=t.gLabel.selectAll("text"),n=t.gLine.selectAll("line"),i=t.gData.selectAll(".mut-dia-data-point");t.fadeOut(e,function(t){d(t).remove()}),t.fadeOut(n,function(t){d(t).remove()}),t.fadeOut(i,function(t){d(t).remove()})},i.prototype.resetPlot=function(){var t=this;t.updatePlot(t.data.mutations),t.dispatcher.trigger(l.DIAGRAM_PLOT_RESET)},i.prototype.updateTopLabel=function(t){var e=this;void 0!=t&&null!=t||(t=""),e.topLabel.text(t)},i.prototype.addListener=function(t,e,n){var i=this;i.svg.selectAll(t).on(e,n),null==i.listeners[t]&&(i.listeners[t]={}),i.listeners[t][e]=n},i.prototype.removeListener=function(t,e){var n=this;n.svg.selectAll(t).on(e,null),n.listeners[t]&&n.listeners[t][e]&&delete n.listeners[t][e]},i.prototype.addDefaultListeners=function(){var t=this;t.addListener(".mut-dia-background","click",function(e,n){t.multiSelect||(t.clearHighlights(),t.dispatcher.trigger(l.ALL_LOLLIPOPS_DESELECTED))}),t.addListener(".mut-dia-data-point","click",function(e,n){t.multiSelect?t.dispatcher.trigger(l.LOLLIPOP_MULTI_SELECT,e,n):t.dispatcher.trigger(l.LOLLIPOP_SINGLE_SELECT,e,n)}),t.addListener(".mut-dia-data-point","mouseout",function(e,n){t.dispatcher.trigger(l.LOLLIPOP_MOUSEOUT,e,n)}),t.addListener(".mut-dia-data-point","mouseover",function(e,n){t.dispatcher.trigger(l.LOLLIPOP_MOUSEOVER,e,n)});var e=function(e,n){t.multiSelect&&c.event.preventDefault()};t.addListener(".mut-dia-data-point","mousedown",e),t.addListener(".mut-dia-background","mousedown",e),d(window).on("keydown",function(e){e.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!0)}),d(window).on("keyup",function(e){
e.keyCode==t.options.multiSelectKeycode&&(t.multiSelect=!1)})},i.prototype.isHighlighted=function(t){var e=this,n=!1;if(void 0==t)n=!h.isEmpty(e.highlighted);else{var i=c.select(t),r=i.datum().location;void 0!=e.highlighted[r]&&(n=!0)}return n},i.prototype.clearHighlights=function(){var t=this,e=t.gData.selectAll(".mut-dia-data-point");t.resizeLollipop(e,t.options.lollipopSize),t.highlighted={}},i.prototype.highlightMutation=function(t){var e=this,n=e.mutationPileupMap[t];if(null!=n){var i=e.svg.select("#"+n);i.length>0&&e.highlight(i[0][0])}},i.prototype.highlight=function(t){var e=this,n=c.select(t);e.resizeLollipop(n,e.options.lollipopHighlightSize);var i=n.datum().location;e.highlighted[i]=n},i.prototype.removeHighlight=function(t){var e=this,n=c.select(t);e.resizeLollipop(n,e.options.lollipopSize);var i=n.datum().location;delete e.highlighted[i]},i.prototype.resizeLollipop=function(t,e){var n=this;t.transition().ease("elastic").duration(n.options.animationDuration).attr("d",c.svg.symbol().size(e).type(n.getLollipopShapeFn()))},i.prototype.fadeIn=function(t,e){var n=this;t.transition().style("opacity",1).duration(n.options.fadeDuration).each("end",function(){h.isFunction(e)&&e(this)})},i.prototype.fadeOut=function(t,e){var n=this;t.transition().style("opacity",0).duration(n.options.fadeDuration).each("end",function(){h.isFunction(e)&&e(this)})},i.prototype.getSelectedElements=function(){var t=this;return h.values(t.highlighted)},i.prototype.isFiltered=function(){var t=this,e=!1;return r.countMutations(t.pileups)<r.countMutations(t.initialPileups)&&(e=!0),e},i.prototype.getThreshold=function(){return Math.max(this.maxCount,this.options.minLengthY)},i.prototype.getMaxY=function(){return this.yMax},i.prototype.getInitialMaxY=function(){var t=this;if(!t.initialYMax){var e=t.calcMaxCount(t.initialPileups);t.initialYMax=t.calcYMax(t.options,e)}return t.initialYMax},i.prototype.getMinY=function(){return this.options.minLengthY},t.exports=i},function(t,e,n){var i=n(169),r=n(23),o=n(12),a=n(7),s=o.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},showStats:!1,setShowStats:function(t){this.showStats=t},getShowStats:function(t){return this.showStats},compileTemplate:function(){var t=this.model,e=t.count>1?"mutations":"mutation",n={count:t.count,mutationStr:e,label:t.label},o=r.getTemplateFn("mutation_details_lollipop_tip_template"),s=a(o(n)),l=s.find(".lollipop-stats");return this.showStats?(new i({el:l,model:t.stats}).render(),l.find("table").dataTable({sDom:"t",bJQueryUI:!0,bDestroy:!0,aaSorting:[[1,"desc"]],aoColumns:[{bSortable:!1},{bSortable:!1}]})):l.hide(),s.html()}});t.exports=s},function(t,e,n){var i=n(23),r=n(12),o=n(5),a=r.View.extend({initialize:function(){},render:function(){var t=i.getTemplateFn("mutation_details_lollipop_tip_stats_template"),e=this.$el.find("table tbody");return o.each(this.model,function(n){e.append(t(n))}),this}});t.exports=a},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){},compileTemplate:function(){var t={identifier:this.model.identifier,type:this.model.type.toLowerCase(),description:this.model.description,start:this.model.start,end:this.model.end,pfamAccession:this.model.pfamAccession,mutationAlignerInfo:this.model.mutationAlignerInfo},e=i.getTemplateFn("mutation_details_region_tip_template");return e(t)}});t.exports=o},function(t,e,n){var i=n(23),r=n(12),o=n(7);n(172);var a=r.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,e=t.options.diagram,n={minY:2,maxY:e.getInitialMaxY()},r=i.getTemplateFn("mutation_customize_panel_template"),o=r(n);t.$el.html(o),t.format()},format:function(){var t=this,e=t.options.diagram;t.$el.hide();var n=t.$el.find(".diagram-customize-close"),i=t.$el.find(".diagram-y-axis-slider"),r=t.$el.find(".diagram-y-axis-limit-input");n.click(function(e){e.preventDefault(),t.toggleView()}),r.val(e.getMaxY()),i.slider({value:e.getMaxY(),min:2,max:e.getInitialMaxY(),change:function(t,n){var i=n.value;return i>e.getThreshold()?(i=e.getThreshold(),void o(this).slider("value",i)):(r.val(i),e.updateOptions({maxLengthY:i}),void e.rescaleYAxis())},slide:function(t,e){r.val(e.value)}}),r.keypress(function(t){var n=13;if(t.keyCode==n){var o=r.val(),a=o;isNaN(a)||a>e.getThreshold()?a=e.getThreshold():o<2&&(a=2),r.val(a),i.slider("option","value",Math.floor(a))}})},toggleView:function(){var t=this;t.$el.slideToggle()}});t.exports=a},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_172__},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({initialize:function(t){this.options=t||{}},render:function(){var t=this,e=i.getTemplateFn("mutation_help_panel_template"),n=e({});t.$el.html(n),t.format()},format:function(){var t=this,e=t.$el.find(".diagram-help-close");e.click(function(e){e.preventDefault(),t.toggleView()})},toggleView:function(){var t=this;t.$el.slideToggle()}});t.exports=o},function(t,e,n){var i=n(114),r=n(175),o=(n(113),n(125)),a=n(23),s=n(85),l=n(12),u=n(5),c=n(7),d=c,p=l.View.extend({initialize:function(t){var e={config:{loaderImage:s}};this.options=d.extend(!0,{},e,t),this.dispatcher={},u.extend(this.dispatcher,l.Events)},render:function(){var t=this,e=a.getTemplateFn("mutation_details_table_template"),n=e({loaderImage:t.options.config.loaderImage});t.$el.html(n),t._initMutationTable(),t.format()},_initMutationTable:function(t){var e=this,n=d.extend(!0,{},e.model.tableOpts);n.el=n.el||e.$el.find(".mutation_details_table");var a=o.convertToCollection(e.model.mutations.getData()),s=new i(a),l=new r(n,e.model.geneSymbol,s,e.model.dataProxies,e.model.dataManager);return e.mutationTable=l,u.isFunction(t)&&t(e,l),e._generateRowData(l,l.getColumnOptions(),a,function(t){l.renderTable(t)}),l},_generateRowData:function(t,e,n,i){var r=[];n.each(function(n){for(var i={table:t,mutation:n},o=[i],a=0;a<u.size(e)-1;a++)o.push(null);r.push(o)}),i(r)},format:function(){},hideView:function(){var t=this;t.$el.hide()},showView:function(){var t=this;t.$el.show()},highlight:function(t){for(var e=this,n=e.$el.find(".mutation_details_table"),i=0;i<t.length;i++){var r=n.find("tr."+t[i].get("mutationSid"));r.addClass("mutation-table-highlight")}},clearHighlights:function(){var t=this,e=t.$el.find(".mutation_details_table");e.find("tr").removeClass("mutation-table-highlight")},filter:function(t,e,n){for(var i=this,r=i.mutationTable.getDataTable(),o=[],a=0;a<t.length;a++)o.push(t[a].get("mutationSid"));var s="("+o.join("|")+")",l=!0;0==o.length&&(s="",l=!1),i.mutationTable.setFilterEventActive(!1),i._applyFilter(r,s,l,e,n),i.mutationTable.setFilterEventActive(!0)},resetFilters:function(){var t=this;t.filter([],!0),t.mutationTable.cleanFilters()},rollBack:function(){var t=this,e=t.mutationTable.getDataTable();t.mutationTable.setFilterEventActive(!1);var n=t.mutationTable.getManualSearch();t._applyFilter(e,n,!1),t.mutationTable.setFilterEventActive(!0)},clearSearchBox:function(){var t=this,e=t.$el.find(".mutation_datatables_filter input[type=search]");e.val("")},_applyFilter:function(t,e,n,i,r){var o=this;void 0==r&&(r=null),void 0==i&&(i=!1);var a=!0,s=!0,l=o.$el.find(".mutation_datatables_filter input[type=search]"),u=l.val();t.fnFilter(e,r,n,a,i,s),i||l.val(u)}});t.exports=p},function(t,e,n){function i(t,e,n,i,v){function _(t,r,o,a,s,l,u,d){var v=p.getColumnOptions(o,s),_={aaData:r,aoColumns:v,aoColumnDefs:[{bVisible:!1,aTargets:l},{bSearchable:!1,aTargets:d}],oColVis:{aiExclude:u},oTableTools:{aButtons:[{sExtends:"text",sButtonText:"Download",mColumns:y(o,u),fnCellRender:function(t,e,n,i){if(e===s.caseId){var r=D.getDataTable().fnGetData()[i];return r[0].mutation.get("caseId")}var o=t;return t.indexOf("<")!=-1&&t.indexOf(">")!=-1&&(o=f(t).text()),e===s.proteinChange&&(o=o.replace(/(\s)3D/,"")),o.trim()},fnClick:function(t,n){var i=this.fnGetTableData(n),r={filename:"mutation_table_"+e+".tsv",contentType:"text/plain;charset=utf-8",preProcess:!1};h.download.initDownload(i,r)}}]},fnDrawCallback:function(r){D._addColumnTooltips({gene:e,mutationUtil:n,dataProxies:i,table:D}),D._addEventListeners(s);var o=r.oPreviousSearch.sSearch;O&&N!=o&&(V.trigger(c.MUTATION_TABLE_FILTERED,t),j=o),N=o,V.trigger(c.MUTATION_TABLE_REDRAWN,D);var a=f(t).DataTable().rows({filter:"applied"}).data();f(r.nTableWrapper).find(".mutation-table-samples-info").text(g.size(I(a))),f(t).find('a[href=""]').remove(),f(t).find('span.mutation-table-additional-protein-change[alt=""]').remove()},fnRowCallback:function(t,e,n,i){var r=e[s.datum].mutation;f(t).attr("id",r.get("mutationId")),f(t).addClass(r.get("mutationSid")),f(t).addClass("mutation-table-data-row")},fnInitComplete:function(t,e){D.setDataTable(this),f(t.nTableWrapper).find(".ColVis_MasterButton").one("click",function(){m.each(f(".ColVis_radio"),function(t,e){var n=f(e).siblings(":first").text();f(e).children(":first").attr("title",n)})}),V.trigger(c.MUTATION_TABLE_INITIALIZED,D)},fnHeaderCallback:function(t,e,n,i,r){f(t).find("th").addClass("mutation-details-table-header"),D._addHeaderTooltips(t,a),V.trigger(c.MUTATION_TABLE_HEADER_CREATED,D)}};return _}function y(t,e){for(var n=[],i=0;i<=g.keys(t).length;i++)n.push(i);return g.difference(n,e)}function b(t){var i=k.columnVisibility[t],r=i;return i?g.isFunction(i)&&(r=i(n,e)):r="hidden",r}function x(t){var e=k.columnSearch[t],n=e;return null==e?n=!1:g.isFunction(e)&&(n=e()),n}function w(t){null!=D.getDataTable()&&g.each(k.eventListeners,function(t){t(D.getDataTable(),V,n,e)})}function C(t){O=t}function A(){N="",j=""}function T(){return j}function S(t,e){var n=a.defaultTableTooltipOpts(),i={};m.extend(!0,i,n),i.position={my:"bottom center",at:"top center",viewport:f(window)},f(t).find("th").each(function(){var t=f(this).text(),n=e[t];if(null!=n){var r=k.columns[n].tip,o={};g.isString(r)&&(r={content:r}),m.extend(!0,o,i,r),h.util.addTargetedQTip(this,o)}})}function M(t,e,n){function i(){V.off(c.MUTATION_TABLE_INITIALIZED,i),v.getData(t,{mutationTable:D},n)}e=e||t,"excluded"===D._visiblityMap[e]||B[t+":"+e]||(B[t+":"+e]=!0,n=n||function(n,i){var r=n.mutationTable;i&&(D.getCustomData()[t]=i),a.refreshTableColumn(r.getDataTable(),r.getIndexMap(),e)},null==D.getDataTable()?V.on(c.MUTATION_TABLE_INITIALIZED,i):i())}function I(t){var e={};return g.each(t,function(t,n){var i=t[0].mutation;i&&!g.isEmpty(i.get("caseId"))&&(e[i.get("caseId").toLowerCase()]=!0)}),e}function P(){var t=null;return n&&(t=n.getMutations()),t}function L(){return R}function E(){return n}function F(){return e}var D=this,z={el:"#mutation_details_table_d3",columns:{datum:{sTitle:"datum",tip:""},mutationId:{sTitle:"Mutation ID",tip:"Mutation ID",sType:"string"},mutationSid:{sTitle:"Mutation SID",tip:"",sType:"string"},caseId:{sTitle:"Sample ID",tip:"Sample ID",sType:"string"},cancerStudy:{sTitle:"Cancer Study",tip:"Cancer Study",sType:"string"},tumorType:{sTitle:"Cancer Type",tip:"Cancer Type",sType:"string"},proteinChange:{sTitle:"AA change",tip:"Protein Change",sType:"numeric"},mutationType:{sTitle:"Type",tip:"Mutation Type",sType:"string",sClass:"center-align-td"},cna:{sTitle:"Copy #",tip:"Copy-number status of the mutated gene",sType:"numeric",sClass:"center-align-td"},cosmic:{sTitle:"COSMIC",tip:"Overlapping mutations in COSMIC",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},mutationStatus:{sTitle:"MS",tip:"Mutation Status",sType:"string",sClass:"center-align-td"},validationStatus:{sTitle:"VS",tip:"Validation Status",sType:"string",sClass:"center-align-td"},mutationAssessor:{sTitle:"Mutation Assessor",tip:"Predicted Functional Impact Score (via Mutation Assessor) for missense mutations",sType:"numeric",sClass:"center-align-td",asSorting:["desc","asc"],sWidth:"2%"},sequencingCenter:{sTitle:"Center",tip:"Sequencing Center",sType:"string",sClass:"center-align-td"},chr:{sTitle:"Chr",tip:"Chromosome",sType:"string"},startPos:{sTitle:"Start Pos",tip:"Start Position",sType:"numeric",sClass:"right-align-td"},endPos:{sTitle:"End Pos",tip:"End Position",sType:"numeric",sClass:"right-align-td"},referenceAllele:{sTitle:"Ref",tip:"Reference Allele",sType:"string"},variantAllele:{sTitle:"Var",tip:"Variant Allele",sType:"string"},tumorFreq:{sTitle:"Allele Freq (T)",tip:"Variant allele frequency<br> in the tumor sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalFreq:{sTitle:"Allele Freq (N)",tip:"Variant allele frequency<br> in the normal sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorRefCount:{sTitle:"Var Ref",tip:"Variant Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},tumorAltCount:{sTitle:"Var Alt",tip:"Variant Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalRefCount:{sTitle:"Norm Ref",tip:"Normal Ref Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},normalAltCount:{sTitle:"Norm Alt",tip:"Normal Alt Count",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]},igvLink:{sTitle:"BAM",tip:"Link to BAM file",sType:"string",sClass:"center-align-td"},mutationCount:{sTitle:"#Mut in Sample",tip:"Total number of<br> nonsynonymous mutations<br> in the sample",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"],sWidth:"2%"},cBioPortal:{sTitle:"cBioPortal",tip:"Mutation frequency in cBioPortal",sType:"numeric",sClass:"right-align-td",asSorting:["desc","asc"]}},columnOrder:["datum","mutationId","mutationSid","caseId","cancerStudy","tumorType","proteinChange","mutationType","cna","cBioPortal","cosmic","mutationStatus","validationStatus","mutationAssessor","sequencingCenter","chr","startPos","endPos","referenceAllele","variantAllele","tumorFreq","normalFreq","tumorRefCount","tumorAltCount","normalRefCount","normalAltCount","igvLink","mutationCount"],columnVisibility:{datum:"excluded",proteinChange:"visible",caseId:function(t,e){return t.containsCaseId(e)?"visible":"hidden"},mutationType:function(t,e){return t.containsMutationType(e)?"visible":"hidden"},mutationAssessor:function(t,e){return t.containsFis(e)?"visible":"hidden"},cosmic:"visible",mutationCount:function(t,e){return t.containsMutationCount(e)?"visible":"hidden"},mutationId:"excluded",mutationSid:"excluded",cancerStudy:"excluded",cna:function(t,e){return t.containsCnaData(e)?"visible":"hidden"},tumorFreq:function(t,e){return t.containsAlleleFreqT(e)?"visible":"hidden"},igvLink:function(t,e){return t.containsIgvLink(e)?"visible":"hidden"},mutationStatus:function(t,e){return t.containsGermline(e)?"visible":"hidden"},validationStatus:function(t,e){return t.containsValidStatus(e)?"visible":"hidden"},tumorType:function(t,e){var n=t.distinctTumorTypeCount(e);return n>1?"visible":"hidden"},cBioPortal:"excluded"},columnSearch:{caseId:!0,mutationId:!0,mutationSid:!0,cancerStudy:!0,proteinChange:!0,tumorType:!0,mutationType:!0},columnRender:{mutationId:function(t){var e=t.mutation,n=e.get("mutationId");return void 0===n?"":n},mutationSid:function(t){var e=t.mutation,n=e.get("mutationSid");return void 0===n?"":n},caseId:function(t){var e=t.mutation,n=r.getCaseId(e.get("caseId")),i={};i.linkToPatientView=e.get("linkToPatientView"),i.caseId=n.text,i.caseIdClass=n.style,i.caseIdTip=n.tip;var a=o.getTemplateFn("mutation_table_case_id_template");return a(i)},proteinChange:function(t){var e=t.mutation;if(g.isUndefined(e.get("proteinChange")))return D.requestColumnData("variantAnnotation","proteinChange"),a.renderTablePlaceHolder();var n=r.getProteinChange(e),i={};i.proteinChange=n.text,i.proteinChangeClass=n.style,i.proteinChangeTip=n.tip,i.additionalProteinChangeTip=n.additionalTip,g.isUndefined(e.get("pdbMatch"))&&D.requestColumnData("pdbMatch","proteinChange"),i.pdbMatchLink=r.getPdbMatchLink(e);var s=o.getTemplateFn("mutation_table_protein_change_template");return s(i)},cancerStudy:function(t){var e=t.mutation,n={};n.cancerStudy=e.get("cancerStudy"),n.cancerStudyShort=e.get("cancerStudyShort"),n.cancerStudyLink=e.get("cancerStudyLink");var i=o.getTemplateFn("mutation_table_cancer_study_template");return i(n)},tumorType:function(t){var e=t.mutation,n=r.getTumorType(e),i={};i.tumorType=n.text,i.tumorTypeClass=n.style,i.tumorTypeTip=n.tip;var a=o.getTemplateFn("mutation_table_tumor_type_template");return a(i)},mutationType:function(t){var e=t.mutation;if(g.isUndefined(e.get("mutationType")))return D.requestColumnData("variantAnnotation","mutationType"),a.renderTablePlaceHolder();var n=r.getMutationType(e.get("mutationType")),i={};i.mutationTypeClass=n.style,i.mutationTypeText=n.text;var s=o.getTemplateFn("mutation_table_mutation_type_template");return s(i)},cosmic:function(t){var e=t.mutation,n=r.getCosmic(e.getCosmicCount()),i={};i.cosmicClass=n.style,i.cosmicCount=n.count;var a=o.getTemplateFn("mutation_table_cosmic_template");return a(i)},cna:function(t){var e=t.mutation,n=r.getCNA(e.get("cna")),i={};i.cna=n.text,i.cnaClass=n.style,i.cnaTip=n.tip;var a=o.getTemplateFn("mutation_table_cna_template");return a(i)},mutationCount:function(t){var e=t.mutation,n=r.getIntValue(e.get("mutationCount")),i={};i.mutationCount=n.text,i.mutationCountClass=n.style;var a=o.getTemplateFn("mutation_table_mutation_count_template");return a(i)},normalFreq:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("normalAltCount")),i=r.getAlleleFreq(e.get("normalFreq"),e.get("normalAltCount"),e.get("normalRefCount"),"simple-tip"),a={};a.normalFreq=i.text,a.normalFreqClass=i.style,a.normalFreqTipClass=i.tipClass,a.normalTotalCount=i.total,a.normalAltCount=n.text;var s=o.getTemplateFn("mutation_table_normal_freq_template");return s(a)},tumorFreq:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("tumorAltCount")),i=r.getAlleleFreq(e.get("tumorFreq"),e.get("tumorAltCount"),e.get("tumorRefCount"),"simple-tip"),a={};a.tumorFreq=i.text,a.tumorFreqClass=i.style,a.tumorFreqTipClass=i.tipClass,a.tumorTotalCount=i.total,a.tumorAltCount=n.text;var s=o.getTemplateFn("mutation_table_tumor_freq_template");return s(a)},mutationAssessor:function(t){var e=t.mutation,n=r.getFis(e.get("functionalImpactScore"),e.get("fisValue")),i={};i.fisClass=n.fisClass,i.omaClass=n.omaClass,i.fisText=n.text;var a=o.getTemplateFn("mutation_table_mutation_assessor_template");return a(i)},mutationStatus:function(t){var e=t.mutation,n=r.getMutationStatus(e.get("mutationStatus")),i={};i.mutationStatusTip=n.tip,i.mutationStatusClass=n.style,i.mutationStatusText=n.text;var a=o.getTemplateFn("mutation_table_mutation_status_template");return a(i)},validationStatus:function(t){var e=t.mutation,n=r.getValidationStatus(e.get("validationStatus")),i={};i.validationStatusTip=n.tip,i.validationStatusClass=n.style,i.validationStatusText=n.text;var a=o.getTemplateFn("mutation_table_validation_status_template");return a(i)},normalRefCount:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("normalRefCount")),i={};i.normalRefCount=n.text,i.normalRefCountClass=n.style;var a=o.getTemplateFn("mutation_table_normal_ref_count_template");return a(i)},normalAltCount:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("normalAltCount")),i={};i.normalAltCount=n.text,i.normalAltCountClass=n.style;var a=o.getTemplateFn("mutation_table_normal_alt_count_template");return a(i)},tumorRefCount:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("tumorRefCount")),i={};i.tumorRefCount=n.text,i.tumorRefCountClass=n.style;var a=o.getTemplateFn("mutation_table_tumor_ref_count_template");return a(i)},tumorAltCount:function(t){var e=t.mutation,n=r.getAlleleCount(e.get("tumorAltCount")),i={};i.tumorAltCount=n.text,i.tumorAltCountClass=n.style;var a=o.getTemplateFn("mutation_table_tumor_alt_count_template");return a(i)},startPos:function(t){var e=t.mutation;if(g.isUndefined(e.get("startPos")))return D.requestColumnData("variantAnnotation","startPos"),a.renderTablePlaceHolder();var n=r.getIntValue(e.get("startPos")),i={};i.startPos=n.text,i.startPosClass=n.style;var s=o.getTemplateFn("mutation_table_start_pos_template");return s(i)},endPos:function(t){var e=t.mutation;if(g.isUndefined(e.get("endPos")))return D.requestColumnData("variantAnnotation","endPos"),a.renderTablePlaceHolder();var n=r.getIntValue(e.get("endPos")),i={};i.endPos=n.text,i.endPosClass=n.style;var s=o.getTemplateFn("mutation_table_end_pos_template");return s(i)},sequencingCenter:function(t){var e=t.mutation,n=e.get("sequencingCenter");return void 0===n?"":n},chr:function(t){var e=t.mutation;return g.isUndefined(e.get("chr"))?(D.requestColumnData("variantAnnotation","chr"),a.renderTablePlaceHolder()):e.get("chr")||""},referenceAllele:function(t){var e=t.mutation;return g.isUndefined(e.get("referenceAllele"))?(D.requestColumnData("variantAnnotation","referenceAllele"),a.renderTablePlaceHolder()):e.get("referenceAllele")||""},variantAllele:function(t){var e=t.mutation;return g.isUndefined(e.get("variantAllele"))?(D.requestColumnData("variantAnnotation","variantAllele"),a.renderTablePlaceHolder()):e.get("variantAllele")||""},igvLink:function(t){var e=t.mutation,n={};n.igvLink=r.getIgvLink(e);var i=o.getTemplateFn("mutation_table_igv_link_template");return i(n)},cBioPortal:function(t){var e=t.mutation;if(g.isUndefined(e.get("cBioPortal")))return D.requestColumnData("cBioPortal"),a.renderTablePlaceHolder();var n=r.getCbioPortal(e.get("cBioPortal")),i={};i.portalFrequency=n.frequency,i.portalClass=n.style;var s=o.getTemplateFn("mutation_table_cbio_portal_template");return s(i)}},columnTooltips:{simple:function(t,e){var n=a.defaultTableTooltipOpts();h.util.addTargetedQTip(f(t).find(".simple-tip"),n)},cosmic:function(t,e){var n=e.gene,i=e.mutationUtil,r=a.defaultTableTooltipOpts();f(t).find(".mutation_table_cosmic").each(function(){var t=this,e=f(t).closest("tr.mutation-table-data-row").attr("id"),o=i.getMutationIdMap()[e],a={};m.extend(!0,a,r),a.content={text:"NA"},a.events={render:function(e,i){var r={cosmic:o.get("cosmic"),keyword:o.get("keyword"),geneSymbol:n,total:f(t).text()},a=f(this).find(".qtip-content"),l=new s({el:a,model:r});l.render()}},h.util.addTargetedQTip(t,a)})},mutationAssessor:function(t,e){var n=(e.gene,e.mutationUtil),i=a.defaultTableTooltipOpts();f(t).find(".oma_link").each(function(){var t=f(this).closest("tr.mutation-table-data-row").attr("id"),e=n.getMutationIdMap()[t],o=r.getFis(e.get("functionalImpactScore"),e.get("fisValue")),a={};m.extend(!0,a,i),a.content={text:"NA"},a.events={render:function(t,n){var i={impact:o.value,xvia:e.get("xVarLink").replace("getma.org","mutationassessor.org/r2"),msaLink:e.get("msaLink").replace("getma.org","mutationassessor.org/r2"),pdbLink:e.get("pdbLink").replace("getma.org","mutationassessor.org/r2")},r=f(this).find(".qtip-content"),a=new l({el:r,model:i});a.render()}},h.util.addTargetedQTip(this,a)})},cBioPortal:function(t,e){var n=e.gene,i=e.mutationUtil,r=e.dataProxies.portalProxy,o=e.table,a=function(e,r,o){f(t).find(".mutation_table_cbio_portal").each(function(t,a){var s=f(this).closest("tr.mutation-table-data-row").attr("id"),l=i.getMutationIdMap()[s],c=o||l.get("cancerStudy");h.util.addTargetedQTip(a,{content:{text:"pancancer mutation bar chart is broken"},events:{render:function(t,i){var o={pancanMutationFreq:e,cancerStudyMetaData:r,cancerStudyName:c,geneSymbol:n,keyword:l.get("keyword"),proteinPosStart:l.get("proteinPosStart"),mutationType:l.get("mutationType"),qtipApi:i},a=f(this),s=new u({el:a,model:o});s.render()}},hide:{fixed:!0,delay:100},style:{classes:"qtip-light qtip-rounded qtip-shadow",tip:!0},position:{my:"center right",at:"center left",viewport:f(window)}})})};null!=o.getCustomData().cBioPortal&&r.getPortalData({cancerStudyMetaData:!0,cancerStudyName:!0},function(t){a(o.getCustomData().cBioPortal,t.cancerStudyMetaData,t.cancerStudyName)})}},eventListeners:{windowResize:function(t,e,n,i){f(window).one("resize",function(){t.is(":visible")&&t.fnAdjustColumnSizing()})},igvLink:function(t,e,n,i){f(t).find(".igv-link").off("click").on("click",function(t){t.preventDefault();var e=f(this).closest("tr.mutation-table-data-row").attr("id"),i=n.getMutationIdMap()[e],r=i.get("igvLink");f.getJSON(r,function(t){prepIGVLaunch(t.bamFileUrl,t.encodedLocus,t.referenceGenome,t.trackName)})})},proteinChange3d:function(t,e,n,i){f(t).find(".mutation-table-3d-link").off("click").on("click",function(t){t.preventDefault();var n=f(this).closest("tr.mutation-table-data-row").attr("id");e.trigger(c.PDB_LINK_CLICKED,n)})},proteinChange:function(t,e,n,i){f(t).find(".mutation-table-protein-change a").off("click").on("click",function(t){t.preventDefault();var n=f(this).closest("tr.mutation-table-data-row").attr("id");e.trigger(c.PROTEIN_CHANGE_LINK_CLICKED,n)})}},columnSort:{mutationId:function(t){var e=t.mutation;return void 0===e.get("mutationId")?"":e.get("mutationId")},mutationSid:function(t){var e=t.mutation;return void 0===e.get("mutationSid")?"":e.get("mutationSid")},caseId:function(t){var e=t.mutation;return void 0===e.get("caseId")?"":e.get("caseId")},proteinChange:function(t){var e=t.mutation.get("proteinChange"),n=/[A-Za-z][0-9]+./g,i=/[0-9]+/g,r=/[^0-9]+/g,o=function(t){var e=t[0].match(r);if(e&&e.length>0){var n=e.join("");e=[];for(var i=0;i<n.length;i++)e.push(n.charCodeAt(i))}return e},a=e.match(n),s=[];if(a&&0!==a.length?(s=o(a),a=a[0].match(i)):a=e.match(i),a&&a.length>0){var l=a[0];return s&&s.length>0&&(l+="."+s.join("")),parseFloat(l)}return-(1/0)},cancerStudy:function(t){var e=t.mutation,n=e.get("cancerStudy");return void 0===n?"":n},tumorType:function(t){var e=t.mutation,n=e.get("tumorType");return void 0===n?"":n},mutationType:function(t){var e=t.mutation,n=e.get("mutationType");return void 0===n?"":n},cosmic:function(t){var e=t.mutation;return r.assignIntValue(e.getCosmicCount())},cna:function(t){var e=t.mutation;return r.assignIntValue(e.get("cna"))},mutationCount:function(t){var e=t.mutation;return r.assignIntValue(e.get("mutationCount"))},normalFreq:function(t){var e=t.mutation;return r.assignFloatValue(e.get("normalFreq"))},tumorFreq:function(t){var e=t.mutation;return r.assignFloatValue(e.get("tumorFreq"))},mutationAssessor:function(t){var e=t.mutation;return r.assignValueToPredictedImpact(e.get("functionalImpactScore"),e.get("fisValue"))},mutationStatus:function(t){var e=t.mutation,n=e.get("mutationStatus");return void 0===n?"":n},validationStatus:function(t){var e=t.mutation,n=e.get("validationStatus");return void 0===n?"":n},normalRefCount:function(t){var e=t.mutation;return r.assignIntValue(e.get("normalRefCount"))},normalAltCount:function(t){var e=t.mutation;return r.assignIntValue(e.get("normalAltCount"))},tumorRefCount:function(t){var e=t.mutation;return r.assignIntValue(e.get("tumorRefCount"))},tumorAltCount:function(t){var e=t.mutation;return r.assignIntValue(e.get("tumorAltCount"))},startPos:function(t){var e=t.mutation;return r.assignIntValue(e.get("startPos"))},endPos:function(t){var e=t.mutation;return r.assignIntValue(e.get("endPos"))},sequencingCenter:function(t){var e=t.mutation,n=e.get("sequencingCenter");return void 0===n&&(n=""),n},chr:function(t){var e=t.mutation,n=e.get("chr");return void 0===n?"":n},referenceAllele:function(t){var e=t.mutation,n=e.get("referenceAllele");return void 0===n?"":n},variantAllele:function(t){var e=t.mutation,n=e.get("variantAllele");return void 0===n?"":n},igvLink:function(t){var e=t.mutation,n=e.get("igvLink");return void 0===n?"":n},cBioPortal:function(t){var e=t.cBioPortal;return e||0}},columnFilter:{proteinChange:function(t){return t.mutation.get("proteinChange")||""},mutationType:function(t){var e=r.getMutationType(t.mutation.get("mutationType"));return e.text},cosmic:function(t){return t.mutation.getCosmicCount()||""},cna:function(t){return t.mutation.get("cna")||""},mutationCount:function(t){return t.mutation.get("mutationCount")||""},normalFreq:function(t){return t.mutation.get("normalFreq")||""},tumorFreq:function(t){return t.mutation.get("tumorFreq")||""},mutationAssessor:function(t){return t.mutation.get("functionalImpactScore")||""},normalRefCount:function(t){return t.mutation.get("normalRefCount")||""},normalAltCount:function(t){return t.mutation.get("normalAltCount")||""},tumorRefCount:function(t){return t.mutation.get("tumorRefCount")||""},tumorAltCount:function(t){return t.mutation.get("tumorAltCount")||""},startPos:function(t){return t.mutation.get("startPos")||""},endPos:function(t){return t.mutation.get("endPos")||""}},columnData:{},filteringDelay:600,dataTableOpts:{sDom:'<"H"<"mutation_datatables_filter"f>C<"mutation_datatables_info"i>>t<"F"<"mutation_datatables_download"T>>',bJQueryUI:!0,bPaginate:!1,bFilter:!0,sScrollY:"600px",bScrollCollapse:!0,oLanguage:{sInfo:"Showing _TOTAL_ mutation(s) in <span class='mutation-table-samples-info'></span> sample(s)",sInfoFiltered:"(out of _MAX_ total mutations)",sInfoEmpty:"No mutations to show"}}},k=m.extend(!0,{},z,t);d.call(this,k),k=D._options;var V=D._dispatcher,O=!0,N="",j="",R={},B={};this._initDataTableOpts=_,this._visibilityValue=b,this._searchValue=x,this._addEventListeners=w,this._addHeaderTooltips=S,this.setFilterEventActive=C,this.getManualSearch=T,this.cleanFilters=A,this.requestColumnData=M,this.getCustomData=L,this.getMutations=P,this.getMutationUtil=E,this.getGene=F,this.dispatcher=this._dispatcher}var r=n(154),o=n(23),a=n(129),s=n(176),l=n(177),u=n(178),c=n(22),d=n(155),p=n(153),h={util:n(6),download:n(141)},f=n(7),m=f,g=n(5);i.prototype=new d,i.prototype.constructor=i,t.exports=i},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){this.$el.find(".cosmic-details-table").dataTable({aaSorting:[[2,"desc"]],sDom:"pt",aoColumnDefs:[{mRender:function(t,e,n){return'<a href="http://cancer.sanger.ac.uk/cosmic/mutation/overview?id='+t+'">'+t+"</a>"},aTargets:[0]},{sType:"aa-change-col",sClass:"left-align-td",aTargets:[1]},{sType:"numeric",sClass:"left-align-td",aTargets:[2]}],bDestroy:!1,bPaginate:!0,bJQueryUI:!0,bFilter:!1})},_parseCosmic:function(t){var e=[];return t.forEach(function(t){e.push(t[0]+"</td><td>"+t[1]+"</td><td>"+t[2])}),"<tr><td>"+e.join("</td></tr><tr><td>")+"</td></tr>"},compileTemplate:function(){var t=this._parseCosmic(this.model.cosmic),e={cosmicDataRows:t,cosmicTotal:this.model.total,mutationKeyword:this.model.keyword},n=i.getTemplateFn("mutation_details_cosmic_tip_template");return n(e)}});t.exports=o},function(t,e,n){var i=n(23),r=n(12),o=r.View.extend({render:function(){var t=this.compileTemplate();this.$el.html(t),this.format()},format:function(){var t=function(t){var e=!0;return null!=t&&"NA"!=t&&0!=t.length||(e=!1),e},e=this.model.xvia;t(e)||this.$el.find(".mutation-assessor-main-link").hide();var n=this.model.pdbLink;t(n)||this.$el.find(".mutation-assessor-3d-link").hide();var i=this.model.msaLink;t(i)||this.$el.find(".mutation-assessor-msa-link").hide()},compileTemplate:function(){var t={linkOut:this.model.xvia,msaLink:this.model.msaLink,pdbLink:this.model.pdbLink,impact:this.model.impact},e=i.getTemplateFn("mutation_details_fis_tip_template");return e(t)}});t.exports=o},function(t,e,n){var i=n(179),r=n(23),o={download:n(141)},a=n(12),s=n(7);n(8),n(9);var l=a.View.extend({render:function(){var t=this,e={gene:t.model.geneSymbol},n=r.getTemplateFn("pancan_mutation_hist_tip_template"),i=n(e);t.model.qtipApi.set("content.text",i),this.format()},format:function(){var t=this,e=t.model.geneSymbol,n=t.model.proteinPosStart,r=t.model.cancerStudyMetaData,a=t.model.cancerStudyName,l=t.model.pancanMutationFreq[n],u=t.model.pancanMutationFreq[e],c=t.$el.find(".pancan-histogram-container"),d=i(l,u,r,c[0],{this_cancer_study:a});t.$el.find(".overall-count").html(d.overallCountText());var p=s(c).find("svg").attr("width");t.$el.css("max-width",parseInt(p));var h=t.$el.find("svg")[0];d.qtip(h),s(".cross-cancer-download").click(function(){var t=s(this).attr("file-type"),n=e+"_mutations."+t;"pdf"==t?o.download.initDownload(h,{filename:n,contentType:"application/pdf",servletName:"svgtopdf.do"}):o.download.initDownload(h,{filename:n})})}});t.exports=l},function(t,e,n){
function i(t,e,n,i,s){function l(t){return t.map(o.clone)}function u(t){return o.reduce(t,function(t,e){return t[e.cancer_study]=e,t},{})}function c(t){var e=b[t.cancer_study].num_sequenced_samples;return t.num_sequenced_samples=e,t.frequency=t.count/e,t}function d(t){var e=o.reduce(t,function(t,e){return t+e.frequency},0);return-1*e}function p(t){var e=t[0].cancer_type;if(!o.every(t,function(t){return t.cancer_type===e}))throw new Error("not all data in a group have the same cancer type");return e}function h(t){function e(t){return{cancer_study:t,count:0,cancer_type:b[t].cancer_type,num_sequenced_samples:b[t].num_sequenced_samples}}var n=u(t);return o.chain(x).reduce(function(t,e){return o.has(n,e)||t.push(e),t},[]).map(e).value()}function f(t){return t.concat(h(t))}function m(){var t,e=o.find(L[0],function(t){return t.cancer_study===s.this_cancer_study});try{t=e.cancer_type}catch(t){throw new Error(t+": could not find this the corresponding datum for this cancer study, ["+s.this_cancer_study+"]")}var n=function(t){return o.find(t,function(t){return t.cancer_study===s.this_cancer_study})},i=o.zip.apply(null,L);i=o.find(i,n);var r=d(i);D.append("text").text("*").attr("id","star").attr("x",V(s.this_cancer_study)).attr("y",j(-1*r)+10).style("font-family","Helvetica Neue, Helvetica, Arial, sans-serif").style("font-size",3*V.rangeBand()+"px")}function g(t){var e=a.select(t).selectAll(".mouseOver").data(x).enter().append("rect").attr("class","mouseOver").attr("y",s.margin.top).attr("x",function(t){return V(t)+s.margin.left}).attr("opacity","0").attr("height",F+5).attr("width",V.rangeBand()).on("mouseover",function(){a.select(this).attr("opacity","0.25")}).on("mouseout",function(){a.select(this).attr("opacity","0")});e.each(function(t){r(this).qtip({content:{text:"mouseover failed"},position:{my:"left top",at:"center right",viewport:r(window)},style:{classes:"qtip-light qtip-rounded qtip-shadow qtip-wide"},hide:{fixed:!0,delay:100},events:{render:function(e,n){var i=y(t).map(function(t){return t[0].__data__}),r=i.filter(function(t){return o.has(t,"keyword")})[0]||{},a=i.filter(function(t){return!o.has(t,"keyword")})[0]||{},s=a.cancer_study,l=b[s].num_sequenced_samples,u="<p style='font-weight:bold;'>"+s+"</p>"+_(r,a,l);n.set("content.text",u)}}})})}function v(t,e){var n=t.count||0;"frequency"in t||(t.frequency=n/e);var i=(100*t.frequency).toFixed(1)+"%";return o.template("<span><b>{{percent}}</b> (<b>{{count}}</b> of {{total}} sequenced samples)</span>")({percent:i,count:n,total:e})}function _(t,e,n){return"<p style='color: "+B+"; margin-bottom:0;'>"+A+": "+v(t,n)+"</p><p style='color: "+R+"; margin-top:0;'>Other "+Y+" mutations: "+v(e,n)+"</p>"}function y(t){return q.filter(function(e){return e.cancer_study===t})}s=s||{},s=s.sparkline?o.extend({margin:{top:-12,right:0,bottom:0,left:0},width:30,height:12,this_cancer_study:void 0},s):o.extend({margin:{top:6,right:10,bottom:20,left:40},width:600,height:300,this_cancer_study:void 0},s);var b=u(n),x=o.keys(b),w=l(t),C=l(e),A=w[0].hugo+" "+w[0].protein_pos_start;w=f(w).map(function(t){return t.keyword=A,t}),C=f(C);var T={bykeyword:u(w),bygene:u(C)},S=o.intersection(o.keys(T.bykeyword),o.keys(T.bygene));if(w=[],C=[],o.each(S,function(t){w.push(T.bykeyword[t]),C.push(T.bygene[t])}),C.length!==w.length)throw new Error("must be same length");if(C.length!==x.length)throw new Error("there must be a datum for every cancer study and visa versa");C.forEach(function(t){var e=T.bykeyword[t.cancer_study],n=t.count-e.count;if(n<0)throw new Error("more mutations for a particular keyword than for all keywords of a particular gene");t.count=n});var M=o.reduce(C,function(t,e){return t+e.count},0),I=o.reduce(w,function(t,e){return t+e.count},0),P=o.reduce(b,function(t,e){return t+e.num_sequenced_samples},0);o.mixin({unzip:function(t){return o.zip.apply(o,t)}});var L=w.concat(C);try{L=o.chain(L).map(c).groupBy(function(t){return t.cancer_study}).map(o.identity).sortBy(p).unzip().value()}catch(t){throw new Error(t)}var E=s.width-s.margin.left-s.margin.left,F=s.height-s.margin.top-s.margin.bottom,D=a.select(i).append("svg").attr("width",s.width).attr("height",s.height).append("g").attr("transform","translate("+s.margin.left+","+s.margin.top+")"),z=a.layout.stack().x(function(t){return t.cancer_study}).y(function(t){return t.frequency}),k=z(L),V=a.scale.ordinal().domain(L[0].map(function(t){return t.cancer_study})).rangeBands([0,E],.1),O=.2,N=s.sparkline?O:a.max(k,function(t){return a.max(t,function(t){return t.y0+t.y})}),j=a.scale.linear().domain([0,N]).range([F,0]).clamp(!0),R="LimeGreen",B="Green",U=D.selectAll(".layer").data(k).enter().append("g").attr("class","layer").style("fill",function(t,e){return[B,R][e]}),q=U.selectAll("rect").data(function(t){return t}).enter().append("rect").attr("x",function(t){return V(t.cancer_study)}).attr("y",function(t){return j(t.y0+t.y)}).attr("width",function(t){return V.rangeBand()}).attr("height",function(t){return j(t.y0)-j(t.y0+t.y)});if(s.sparkline)return{el:i,qtip:function(){throw new Error("don't qtip a sparkline")}};var G=a.format(N>.1?".0%":".1%"),H=a.svg.axis().scale(j).tickFormat(G).orient("left");H.tickSize(H.tickSize(),0,0);var W=function(){function t(t){return{cancer_type:t.cancer_type,start:t.cancer_study,end:t.cancer_study,color:b[t.cancer_study].color}}var e=L[0][0];return o.chain(L[0]).reduce(function(e,n){var i=o.last(e);return i.cancer_type!==n.cancer_type?e.concat(t(n)):i.cancer_type===n.cancer_type?(i.end=n.cancer_study,e):void 0},[t(e)]).value()}();D.selectAll("line").data(W).enter().append("line").attr("x1",function(t){return V(t.start)}).attr("x2",function(t){return V(t.end)+V.rangeBand()}).attr("y1",F+s.margin.bottom/3).attr("y2",F+s.margin.bottom/3).style("stroke-width",5).style("stroke",function(t){return t.color});var Y=(D.append("g").call(H).attr("stroke","#000").attr("shape-rendering","crispEdges"),o.find(k[0],function(t){return void 0!==t.hugo}).hugo),A=o.find(k[0],function(t){return void 0!==t.keyword}).keyword;return o.isUndefined(s.this_cancer_study)||m(),{el:i,qtip:g,overallCountText:function(){return _({count:I},{count:M},P)}}}var r=n(7),o=n(5),a=n(19);n(8),n(9),t.exports=i},function(t,e,n){var i=n(22),r=n(129),o=n(23),a=n(12),s=n(5),l=n(7),u=a.View.extend({initialize:function(t){this.options=t||{},this.dispatcher={},s.extend(this.dispatcher,a.Events),this.initialMapByType=this._mapMutationsByMainType(this.model.mutations.getData())},render:function(){var t=this;t.updateView(t.model.mutations.getData())},format:function(){var t=this;t.$el.find(".mutation-type-info-link").on("click",function(e){e.preventDefault();var n=l(this).attr("alt");t.dispatcher.trigger(i.INFO_PANEL_MUTATION_TYPE_SELECTED,n)})},updateView:function(t){var e=this;e.currentMapByType=e._mapMutationsByMainType(t);var n=e._countMutationsByType(e.currentMapByType),i=r.getVisualStyleMaps().mutationType,a=[];n=s.extend(e._generateZeroCountMap(e.initialMapByType),n);var l=s.keys(n).sort(function(t,e){var n=1024,r=1024;return i[t]&&i[t].priority&&(n=i[t].priority),i[e]&&i[e].priority&&(r=i[e].priority),n-r});s.each(l,function(t){var e=o.getTemplateFn("mutation_info_panel_type_template"),r="Other",s=i.other.style,l=i[t];l&&l.mainType&&(l=i[l.mainType]),l&&(r=l.longName||r,s=l.style||s);var u=n[t],c={mutationType:t,type:r,textStyle:s,count:u,countStyle:s+"_count"},d=e(c);a.push(d)});var u={mutationTypeContent:a.join("\n")},c=o.getTemplateFn("mutation_info_panel_template"),d=c(u);e.$el.html(d),e.format()},_generateZeroCountMap:function(t){var e={};return s.each(s.keys(t),function(t){e[t]=0}),e},resetSelectionMap:function(){var t=this;t.selectionMap=t._generateZeroCountMap(t.initialMapByType)},_mapMutationsByType:function(t){return s.groupBy(t,function(t){return t.get("mutationType").toLowerCase()})},_mapMutationsByMainType:function(t){var e=r.getVisualStyleMaps().mutationType;return s.groupBy(t,function(t){var n=t.get("mutationType");n=n?n.toLowerCase():"other";var i;return i=e[n]?e[n].mainType:"other"})},_countMutationsByType:function(t){var e={};return s.each(s.keys(t),function(n){e[n]=s.size(t[n])}),e}});t.exports=u},function(t,e,n){function i(t){function e(t){n(l.extend(!0,{},I,t))}function n(t){I=t,L.filtered=t,M=new o(a.convertToCollection(t))}function i(){return I}function c(){return M}function d(){return L}function p(t,e,n,i){var r=L[t];L[t]=e,u.isEqual(r,L[t])||s(S).trigger(n,A(i))}function h(t,e,n,i){var r=L[t];L[t]=u.union(L[t],e),u.isEqual(r,L[t])||s(S).trigger(n,A(i))}function f(t,e,n,i){var r=L[t];null==e?L[t]=[]:L[t]=u.difference(L[t],e),u.isEqual(r,L[t])||s(S).trigger(n,A(i))}function m(t,e){p("highlighted",t,r.MUTATION_HIGHLIGHT,e)}function g(t,e){h("highlighted",t,r.MUTATION_HIGHLIGHT,e)}function v(t,e){f("highlighted",t,r.MUTATION_HIGHLIGHT,e)}function _(t,e){p("filtered",t,r.MUTATION_FILTER,e)}function y(t,e){h("filtered",t,r.MUTATION_FILTER,e)}function b(t,e){null==t?(L.filtered=I,s(S).trigger(r.MUTATION_FILTER,A(e))):f("filtered",t,r.MUTATION_FILTER,e)}function x(t,e){p("selected",t,r.MUTATION_SELECT,e)}function w(t,e){h("selected",t,r.MUTATION_SELECT,e)}function C(t,e){f("selected",t,r.MUTATION_SELECT,e)}function A(t){var e=t||{};return e.mutationData=T,e}var T=this,S={},M=null,I={},P={},L={highlighted:[],selected:[],filtered:[]};l.extend(!0,{},P,t);this.updateData=e,this.setData=n,this.getData=i,this.getDataUtil=c,this.getState=d,this.updateHighlightedMutations=m,this.highlightMutations=g,this.unHighlightMutations=v,this.updateFilteredMutations=_,this.filterMutations=y,this.unfilterMutations=b,this.updateSelectedMutations=x,this.selectMutations=w,this.unSelectMutations=C,this.dispatcher=S}var r=n(22),o=n(114),a=n(125),s=n(7),l=s,u=n(5);t.exports=i},function(t,e,n){function i(){function t(t){var n=new r,o=t.split("\n");if(o.length>0)for(var a=i(o[0]),s=1;s<o.length;s++)o[s].length>0&&n.push(e(o[s],a));return d=n,n}function e(t,e){var i=new o,r=t.split("\t"),l={};return s.each(s.keys(m),function(t){var i=n(t,r,e);i&&(l[t]=i)}),l.mutationId=l.mutationId||c(),l.mutationSid=l.mutationSid||l.mutationId,l.variantKey=a.generateVariantKey(l),i.set(l),i}function n(t,e,n){var i=m[t],r=n[i],o=void 0;return null!=r&&null!=e[r]&&(o=e[r].trim()),o}function i(t){var e=t.split("\t"),n={};return s.each(e,function(t,e){n[t.trim().toLowerCase()]=e}),n}function l(){if(null==d)return[];if(null==h){var t={};d.each(function(e,n){null!=e.get("caseId")&&e.get("caseId").length>0&&(t[e.get("caseId")]=e.get("caseId"))}),h=s.values(t)}return h}function u(){if(null==d)return[];if(null==p){var t={};d.each(function(e,n){null!=e.get("geneSymbol")&&e.get("geneSymbol").length>0&&(t[e.get("geneSymbol").toUpperCase()]=e.get("geneSymbol").toUpperCase())}),p=s.values(t)}return p}function c(){return f++,"stalone_mut_"+f}var d=null,p=null,h=null,f=0,m={proteinPosEnd:"protein_position_end",uniprotId:"uniprot_id",cancerType:"cancer_type",tumorType:"tumor_type",cancerStudyLink:"cancer_study_link",codonChange:"codon_change",proteinPosStart:"protein_position_start",linkToPatientView:"patient_view_link",geneticProfileId:"genetic_profile_id",mutationCount:"mutation_count",mutationType:"mutation_type",referenceAllele:"reference_allele",uniprotAcc:"uniprot_accession",fisValue:"fis_value",functionalImpactScore:"fis",cancerStudy:"cancer_study",normalRefCount:"normal_ref_count",ncbiBuildNo:"ncbi_build",normalFreq:"normal_frequency",cancerStudyShort:"cancer_study_short",msaLink:"msa_link",mutationStatus:"mutation_status",cna:"copy_number",proteinChange:"protein_change",aminoAcidChange:"amino_acid_change",endPos:"end_position",geneSymbol:"hugo_symbol",tumorFreq:"tumor_frequency",startPos:"start_position",keyword:"keyword",cosmic:"cosmic",validationStatus:"validation_status",mutationSid:"mutation_sid",normalAltCount:"normal_alt_count",variantAllele:"variant_allele",mutationId:"mutation_id",caseId:"sample_id",xVarLink:"xvar_link",pdbLink:"pdb_link",tumorAltCount:"tumor_alt_count",tumorRefCount:"tumor_ref_count",sequencingCenter:"center",chr:"chromosome"};return{parseInput:t,getSampleArray:l,getGeneList:u}}var r=n(112),o=n(113),a=n(3),s=n(5);t.exports=i}])});